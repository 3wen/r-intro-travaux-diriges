% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  11pt,
]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Travaux dirigés d'Informatique},
  pdfauthor={Ewen Gallic},
  colorlinks=true,
  linkcolor={Maroon},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\usepackage[normalem]{ulem}
% Avoid problems with \sout in headers with hyperref
\pdfstringdefDisableCommands{\renewcommand{\sout}{}}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
%\reserveinserts{28} % (et plus loin encore)
%\usepackage{garamondlibre}
\usepackage[utf8]{inputenc}
\usepackage{xeCJK}
%\usepackage[T1]{fontenc} % pour taper les lettres accentuees
\usepackage[french]{babel}
\usepackage{amsthm,amssymb,amsbsy,amsmath,amsfonts,amssymb,amscd,mathrsfs}
%Mise en page
\usepackage{geometry} %pour la modification des marges
\usepackage{fancyhdr} %pour modification des pieds de page
\usepackage{lastpage} %numero de la derniËre page
\usepackage{lscape} % Pour pouvoir activer le mode landscape
\usepackage{lmodern}
%Images, figures, etc.
\usepackage{booktabs} %tableaux
\usepackage{siunitx}
\usepackage{float}	%pour forcer le placement des images.
\usepackage{graphicx} %pour afficher des images
\usepackage{longtable} %tables sur plusieurs pages
\usepackage{animate} %transformer des gifs
\usepackage{caption}
%\usepackage{subcaption}
\captionsetup{labelformat=simple}
\usepackage[scriptsize]{subfigure}
\usepackage{multirow} 			%fusionner lignes
\usepackage{tikz}
\usepackage{adjustbox}
\usetikzlibrary{arrows,positioning}
\usetikzlibrary{mindmap,trees,shadows,backgrounds}
\usepackage{tabularx}
%Code
\usepackage{verbatim}%insertion de code
\usepackage{listings}
%Polices, format,couleurs
\usepackage{dsfont} % Pour les lettres mathematiques

\usepackage[nottoc]{tocbibind}

\usepackage{hyperref} %pour que les references soient des liens hypertextes
\usepackage{natbib}
\usepackage{bibentry}
%\usepackage{color}
\usepackage{xcolor,colortbl}
\definecolor{light-gray}{gray}{0.85}
\usepackage{ragged2e} % Pour justifier
%Symboles, theoremes
\newcommand{\iid}{\stackrel{\mathrm{iid}}{\sim}}
\newtheorem{theorem}{Theorem}[part]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{hypothese}{Hypoth\`ese}
\newtheorem{corollary}[theorem]{Corollary}
\usepackage{enumerate}%listes
\usepackage[subnum]{cases}% cas numerotes
%\newtheorem{laRemarque}{Remarque}[section]
 \newtheorem{rmarque}{Remarque}[section]
\newtheorem{exmp}{Exemple}[section]
\numberwithin{equation}{section}

\usepackage[official,right]{eurosym} % symbols euro
\usepackage{gensymb} % symbole degre \degre
\usepackage{rotating}
\usepackage{multicol}
\usepackage{empheq}
% Bibliographie
%\usepackage{bib entry}
%\nobibliography*
%\let\newblock\relax

\usepackage{pmboxdraw}

%\usepackage[notocbib]{apacite}
%\usepackage[style=apa]{biblatex}
%\usepackage[round]{natbib}
%\usepackage[style=authoryear]{biblatex}
%\usepackage[backend=bibtex, style=authoryear-comp]{biblatex}
%\usepackage{biblatex}
\renewcommand*{\bibfont}{\scriptsize} % Pour avoir la biblio en plus petit
%\usepackage{apacite}
%\bibliographystyle{apacite}

%\titlegraphic{
%\centering
%\includegraphics[height=2em]{/Users/ewengallic/Dropbox/Universite_Aix_Marseille/Enseignements/template/assets/images/logo_amu_rvb_blanc.png}\hskip 3em
%%\colorbox{white}{\includegraphics[height=3em]{../../images/logo_feg.png}}
%\includegraphics[height=2em]{/Users/ewengallic/Dropbox/Universite_Aix_Marseille/Enseignements/template/assets/images/logo_feg_blanc.png}\hskip 3em
%%\colorbox{white}{\includegraphics[height=3em]{../../images/logo_amse.png}}
%\includegraphics[height=2em]{/Users/ewengallic/Dropbox/Universite_Aix_Marseille/Enseignements/template/assets/images/logo_amse.png}
%}

\justifying %on justifie le texte du document

\lstset{language=R,
belowskip=-1em
}

% Pour les codes Python
\lstset{
language=Python,
basicstyle=\small\ttfamily,
commentstyle=\ttfamily\color{gray},
backgroundcolor=\color{white},
showspaces=false,
showstringspaces=false,
showtabs=false,
tabsize=4,
captionpos=b,
breaklines=true,
breakatwhitespace=false,
title=\lstname,
escapeinside={},
keywordstyle={},
morekeywords={},
literate=%
         {á}{{\'a}}1
         {à}{{\`a}}1
         {^a}{{\^a}}1
         {í}{{\'i}}1
         {ï}{{\"\i}}1
         {é}{{\'e}}1
         {è}{{\`e}}1
         {ê}{{\^e}}1
         {ë}{{\"e}}1
         {ý}{{\'y}}1
         {ú}{{\'u}}1
         {ù}{{\`u}}1
         {ó}{{\'o}}1
         {ô}{{\^o}}1         
         {ě}{{\v{e}}}1
         {š}{{\v{s}}}1
         {č}{{\v{c}}}1
         {ř}{{\v{r}}}1
         {ž}{{\v{z}}}1
         {ď}{{\v{d}}}1
         {ť}{{\v{t}}}1
         {ň}{{\v{n}}}1                
         {ů}{{\r{u}}}1
         {Á}{{\'A}}1
         {Í}{{\'I}}1
         {É}{{\'E}}1
         {Ý}{{\'Y}}1
         {Ú}{{\'U}}1
         {Ó}{{\'O}}1
         {Ě}{{\v{E}}}1
         {É}{{\'E}}1
         {È}{{\`E}}1
         {Ê}{{\^E}}1
         {Š}{{\v{S}}}1
         {Č}{{\v{C}}}1
         {Ř}{{\v{R}}}1
         {Ž}{{\v{Z}}}1
         {Ď}{{\v{D}}}1
         {Ť}{{\v{T}}}1
         {Ň}{{\v{N}}}1                
         {Ů}{{\r{U}}}1 
}




%\graphicspath{{../images}}


\usepackage{array,dcolumn}
\newcolumntype{C}[1]{>{\centering\arraybackslash}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}m{#1}}
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}m{#1}}




\definecolor{vert}{RGB}{0,157,87}
\definecolor{Lime}{RGB}{191,255,0}
\definecolor{limegreen}{RGB}{50,205,50}
\definecolor{vertsombre}{RGB}{27,68,21}
\definecolor{vertclair}{HTML}{06D6A0}

%
\definecolor{Camel}{RGB}{193,154,107}
\definecolor{rouge}{HTML}{EF476F}
\definecolor{orange}{RGB}{199,118,34}
%
\definecolor{ProcessYellow}{RGB}{255, 239, 0}
\definecolor{jauneAMSE}{RGB}{240, 171, 0}
%\definecolor{jaune}{HTML}{FFD166}


%
\definecolor{bleu}{HTML}{118AB2}
\definecolor{LBlue}{RGB}{173, 216, 230}
\definecolor{bleusombre}{RGB}{18, 37, 67}
\definecolor{bleufonce}{RGB}{91,112,170}
\definecolor{bleuAMSE}{RGB}{0,101,189}
%
\definecolor{DPurple}{RGB}{48,25,52}
\definecolor{Indigo}{RGB}{75, 0, 130}
\definecolor{Periwinkle}{RGB}{204, 204, 255}
\definecolor{ElectricViolet}{RGB}{143, 0, 255}
\definecolor{AfricanViolet}{RGB}{178, 132, 190}
\definecolor{ChineseViolet}{RGB}{133, 96, 136}
\definecolor{Grape}{RGB}{111, 45, 168}
\definecolor{RussianViolet}{RGB}{50, 23, 77}
\definecolor{EnglishViolet}{RGB}{86, 60, 92}
%

\definecolor{bottomcolour}{rgb}{0.32,0.3,0.38}
\definecolor{middlecolour}{rgb}{0.08,0.08,0.16}



%\hypersetup{
%    colorlinks = true,
%    linkcolor = ProcessYellow
%}




\newcommand*\grasO[1]{\textbf{\textcolor{Camel}{#1}}} 
\newcommand*\grasR[1]{\textbf{\textcolor{rouge}{#1}}}
\newcommand*\grasV[1]{\textbf{\textcolor{vertclair}{#1}}} 
\newcommand*\grasB[1]{\textbf{\textcolor{bleu}{#1}}} 
\newcommand*\grasJ[1]{\textbf{\textcolor{jaune}{#1}}} 
\newcommand*\grasP[1]{\textbf{\textcolor{AfricanViolet}{#1}}} 

\definecolor{rcp26}{RGB}{39, 55, 122}
\definecolor{rcp45}{RGB}{112, 159, 200}
\definecolor{rcp60}{RGB}{222, 99, 43}
\definecolor{rcp85}{RGB}{205, 16, 32}

\newcommand*\grasRCPa[1]{\textbf{\textcolor{rcp26}{#1}}}
\newcommand*\grasRCPb[1]{\textbf{\textcolor{rcp45}{#1}}} 
\newcommand*\grasRCPc[1]{\textbf{\textcolor{rcp60}{#1}}} 
\newcommand*\grasRCPd[1]{\textbf{\textcolor{rcp85}{#1}}}

\definecolor{wongBlack}{HTML}{000000}
\definecolor{wongGold}{HTML}{E69F00}
\definecolor{wongLightBlue}{HTML}{56B4E9}
\definecolor{wongGreen}{HTML}{009E73}
\definecolor{wongYellow}{HTML}{F0E442}
\definecolor{wongBlue}{HTML}{0072B2}
\definecolor{wongOrange}{HTML}{D55E00}
\definecolor{wongPurple}{HTML}{CC79A7}

\definecolor{IBMBlue}{HTML}{648FFF}
\definecolor{IBMPurple}{HTML}{785EF0}
\definecolor{IBMMagenta}{HTML}{DC267F}
\definecolor{IBMOrange}{HTML}{FE6100}
\definecolor{IBMYellow}{HTML}{FFB000}
 


\usepackage[most]{tcolorbox}

\makeatletter
\let\@@magyar@captionfix\relax
\makeatother


\definecolor{deepblue}{RGB}{0,110,160}



\usepackage{xparse}
\NewDocumentCommand\afun{v}{%
\texttt{#1}\index[fonctions]{#1@\ifun{#1}}%
}
\NewDocumentCommand\afunDeux{v}{%
\index[fonctions]{#1@\ifun{#1}}%
}


\NewDocumentCommand{\ifun}{v}{\texttt{#1}}


 \newcounter{countremarque}


\newenvironment{remarque}{%
 \refstepcounter{countremarque}
    \begin{tcolorbox}[width=\linewidth, colback=blue!3, boxrule=0.5pt,arc=0pt,title = Remarque \thecountremarque]
    }%
    {
    \end{tcolorbox}
    }
\numberwithin{countremarque}{section}


\newcounter{exercices}[section]

\definecolor{shadecolorex}{HTML}{CFE3D1}
\makeatletter
\newenvironment{exframe}{%
 \def\at@end@of@exframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@exframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolorex}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@exframe}
\makeatother


\usepackage{color}
\usepackage{framed}
\setlength{\fboxsep}{.8em}

\setlength{\headheight}{14.5pt}


\definecolor{gris}{RGB}{230, 247, 255}
\definecolor{grisfonce}{RGB}{220,220,220}

\definecolor{jaune}{RGB}{255, 243, 199}

\newenvironment{notebox}{
  \begin{tcolorbox}[breakable, colback=jaune,coltext=black,
                  colframe=grisfonce]}
 {\end{tcolorbox}}
 
 
 
 \definecolor{vert}{RGB}{214, 245, 214}
 \newenvironment{greenbox}{
  \begin{tcolorbox}[breakable, colback=vert,coltext=black,
                  colframe=grisfonce]}
 {\end{tcolorbox}}



 \definecolor{bleu}{RGB}{163, 192, 230}
 \newenvironment{bluebox}{
  \begin{tcolorbox}[breakable, colback=bleu,coltext=black,
                  colframe=grisfonce]}
 {\end{tcolorbox}}


 \definecolor{rouge}{RGB}{207, 47, 68}
 \newenvironment{redbox}{
  \begin{tcolorbox}[breakable, colback=rouge,coltext=white,
                  colframe=grisfonce]}
 {\end{tcolorbox}}


 \definecolor{oran}{RGB}{255, 161, 0}
 \newenvironment{orangebox}{
  \begin{tcolorbox}[breakable, colback=oran,coltext=white,
                  colframe=grisfonce]}
 {\end{tcolorbox}}


% Reduire expace avant et apres les morceaux de code
\makeatletter
\preto{\@verbatim}{\topsep=-10pt \partopsep=-10pt }
\makeatother



\hypersetup{
bookmarks=true,
pdfauthor={Ewen Gallic},
unicode=false,
pdftoolbar=true,
pdfmenubar=true,
pdffitwindow=false
pdfnewwindow=true,
colorlinks=true,
linkcolor=bleuAMSE,
citecolor=bleuAMSE,
filecolor=bleuAMSE,
urlcolor=bleuAMSE,}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Travaux dirigés d'Informatique}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{Lience 3 parcours Economie-Finance}
\author{Ewen Gallic}
\date{2022-2023}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{3}
\tableofcontents
}
\listoftables
\hypertarget{introduction}{%
\chapter*{Introduction}\label{introduction}}
\addcontentsline{toc}{chapter}{Introduction}

Ce livret est conçu pour les séances de travaux dirigés d'Informatique en 3e année de Licence mention Economie et Gestion, à Aix-Marseille Université.

Chaque chapitre correspond à une séance ou deux de travaux dirigés. Le contenu alterne entre des courtes présentations de concepts et des exercices pour apprendre à mettre en pratique les concepts présentés.

Pour appréhender de manière aprofondie le contenu de ce livret, le lecteur ou la lectrice est invité(e) à consulter les notes de cours, disponibles à l'adresse suivantes : \url{http://egallic.fr/Enseignement/R/Book/avant-propos.html}.

Les conventions de lecture suivantes seront adoptées.

\begin{orangebox}
Les boîtes oranges désignent, en début de chapitre, les lectures recommandées des notes de cours.

\end{orangebox}

\begin{notebox}
Les boîtes jaunes indiquent des notes.

\end{notebox}

\begin{redbox}
Les boîtes rouges indiquent des avertissements.

\end{redbox}

\begin{greenbox}
Les boîtes vertes indiquent des exercices.

\end{greenbox}

\hypertarget{initiation-uxe0-r}{%
\chapter{Initiation à R}\label{initiation-uxe0-r}}

\hypertarget{travailler-par-projets}{%
\section{Travailler par projets}\label{travailler-par-projets}}

Durant vos études universitaires, vous allez réaliser des études en vous appuyant sur des données et sur leur analyse statistique. Il convient de prendre de bonnes habitudes en travaillant avec des projets RStudio. Dans cet exercice, vous allez mettre en place un projet pour la première séance de travaux dirigés.

En respectant l'arborescence présentée sur l'image ci-dessous, il sera aisé de vous repérer et le partage de vos codes avec vos collaborateurs sera simple.

\begin{figure}
\centering
\includegraphics[width=0.25\textwidth,height=\textheight]{figs/project_tree_structure.png}
\caption{Structure basique pour les projets. Source: \url{https://martinctc.github.io/}.}
\end{figure}

\begin{greenbox}

\textbf{Création d'un projet}

Ouvrez le logiciel RStudio :

\begin{itemize}
\tightlist
\item
  Cliquez sur le menu \texttt{File}, puis sur \texttt{New\ Project...}.
\item
  Cliquez sur \texttt{New\ Directory}, puis sur \texttt{New\ Project}.
\item
  Donnez un nom au nouveau projet, puis cliquez sur le bouton \texttt{Browse...}
\item
  Choisissez l'emplacement du projet, puis appuyez sur le bouton \texttt{Open}.
\item
  Cliquez sur le bouton \texttt{Create\ Project} pour créer le projet. Une nouvelle session RStudio s'ouvre alors. Le répertoire courant devient celui dans lequel vous avez créé le projet. Un fichier d'extention \texttt{.Rproj} a été créé dans ce répertoire. Il suffira d'ouvrir ce fichier à l'avenir pour ouvrir RStudio pour travailler sur ce projet.
\item
  À présent que le projet est créé, il est temps de créer un fichier de script : dans RStudio, cliquez sur le menu \texttt{File}, puis sur \texttt{New\ File} et enfin sur \texttt{R\ Script} (de manière équivalente, vous pouvez cliquer sur l'icône présentant un document blanc et une croix blanche sur fond vert).
\item
  Enfin, enregistrez votre fichier : menu \texttt{File}, puis \texttt{Save}.
\end{itemize}

\end{greenbox}

\hypertarget{cruxe9ation-modification-suppression-dun-objet}{%
\section{Création, modification, suppression d'un objet}\label{cruxe9ation-modification-suppression-dun-objet}}

Pour créer un objet, il est nécessaire de lui donner un nom et un contenu. On écrit le nom en respectant des conventions de nommage. Le nom d'une variable doit être composé de caractères alphanumériques ou du point ou du trait de soulignement uniquement. Il ne doit pas commencer par un chiffre ou contenir d'espace, sauf s'il est entouré par des guillemets. Il est important de noter que ces noms sont sensibles à la casse, c'est à dire qu'une distinction entre les majuscules et les minuscules a lieu.

Dans le cadre de ces travaux dirigés, nous utiliseront une convention supplémentaire, consistant à créer des variables dont on peut facilement deviner le contenu grâce à leur nom, en utilisant uniquement des lettres minuscules, et en ajoutant un trait de soulignement entre les différents termes s'il y a lieu d'utiliser plusieurs termes. Par exemple, une variable qui contiendrait l'année de naissance d'un individu pourrais être nommée \texttt{annee\_naissance}.

L'affectation du contenu à une variable, une fois son nom indiqué, se fait en ajoutant un symbole d'affectation : \VERB|\OtherTok{\textless{}{-}}| (on peut aussi utiliser le symbole égal (\texttt{=})).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{+}\DecValTok{1}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 2
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Créer un objet que vous nommerez \texttt{age} qui contiendra, en valeur numérique, votre âge.
\item
  Affichez dans la console la valeur de l'objet \texttt{age}.
\item
  Créez un objet appelé \texttt{annee\_naissance} qui, en s'appuyant sur la valeur contenue dans \texttt{age}, indiquera votre année de naissance (soustrayez la valeur de \texttt{age} à l'année actuelle)
\item
  Modifiez le contenu de l'objet \texttt{age} en lui ajoutant 10 ans. Affichez dans la console la valeur de l'objet \texttt{age} suite à la modification.
\item
  Affichez la valeur de l'objet \texttt{annee\_naissance} : que constatez-vous ?
\item
  Modifiez le contenu de l'objet \texttt{age} en lui soustrayant 10 ans. Affichez dans la console la valeur de l'objet \texttt{age} suite à la modification.
\item
  Calculez, sans modifier le contenu de l'objet \texttt{age}, le nombre de jours correspondant à votre âge (en multipliant votre âge par 365,25).
\item
  En faisant appel à la fonction \VERB|\FunctionTok{ls}\NormalTok{()}|, affichez le nom des objets existants dans l'environnement global.
\item
  À l'aide de la fonction \VERB|\FunctionTok{rm}\NormalTok{()}| (\emph{remove}), supprimez l'objet \texttt{age}, puis tentez d'afficher le contenu de l'objet \texttt{age} dans la console.
\item
  Affichez à nouveau le nom des objets existants dans l'environnement global.
\item
  Affichez la valeur de l'objet \texttt{annee\_naissance} : que constatez-vous ?
\end{enumerate}

\end{greenbox}

\hypertarget{lecture-dune-page-daide}{%
\section{Lecture d'une page d'aide}\label{lecture-dune-page-daide}}

Dans cet exercice, vous allez calculer la racine carrée d'un nombre. Pour cela, vous allez faire appel à une fonction native en R, dont vous ignorez le nom et le fonctionnement (si c'est la première fois que vous faites du R).

\begin{notebox}
Lorsque vous n'arrivez pas à effectuer une opération avec R, réfléchissez \textbf{en anglais} à votre question, puis consultez les pages d'aide ou bien un moteur de recherche en ligne.

\end{notebox}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Comment dit-on ``racine carrée'' en anglais ?
\item
  Sur le moteur de recherche que vous avez l'habitude d'utiliser, inscrivez la traduction de ``racine carrée'' en anglais, suivi de ``in r''.
\item
  Repérez le nom de la fonction qui vous permet de calculer une racine carrée en R, puis affichez (et parcourez) la page d'aide de cette fonction dans RStudio.
\item
  Calculez la racine carrée de 9 à l'aide de la fonction dont vous venez de consulter la page d'aide.
\end{enumerate}

\end{greenbox}

\hypertarget{installation-et-chargement-dun-package}{%
\section{Installation et chargement d'un package}\label{installation-et-chargement-dun-package}}

Les \emph{packages} sont des jeux de fonctions, accompagnés de fichiers d'aides, parfois de jeux de données. Pour pouvoir faire appel à une fonction contenue dans un \emph{package}, il faut soit :

\begin{itemize}
\tightlist
\item
  indiquer le nom du \emph{package} suivi de deux fois deux-points puis du nom de la fonction (\emph{e.g.}, \VERB|\NormalTok{dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(iris, }\StringTok{"Species"}\NormalTok{)}| qui fait appel à la fonction \VERB|\FunctionTok{select}\NormalTok{()}| du \emph{package} \{dplyr\})
\item
  charger le \emph{package} en mémoire à l'aide de la fonction \VERB|\FunctionTok{library}\NormalTok{()}| puis faire appel au nom de la fonction (\emph{e.g.}, \VERB|\FunctionTok{library}\NormalTok{(dplyr)}| puis dans une seconde instruction, \VERB|\FunctionTok{select}\NormalTok{(iris, }\StringTok{"Species"}\NormalTok{)}|).
\end{itemize}

\begin{notebox}

\begin{itemize}
\tightlist
\item
  Lorsque l'on charge un \emph{package} à l'aide de la fonction \VERB|\FunctionTok{library}\NormalTok{()}|, l'ensemble des fonctions contenues dans ce package sont chargées en mémoire et les pages d'aide associées deviennent consultables.
\item
  Lorsque l'on quitte R et qu'on le relance, les \emph{packages} chargés à l'aide de la fonction \VERB|\FunctionTok{library}\NormalTok{()}| ne sont plus en mémoire, et il faut de nouveau les charger pour pouvoir accéder aux fonctions qu'ils contiennent.
\end{itemize}

\end{notebox}

Pour pouvoir charger un \emph{package}, il est nécessaire que celui-ci soit installé sur votre machine. Pour installer un package disponible sur le dépôt CRAN (\emph{The Comprehensive R Archive Network}), il suffit d'utiliser la fonction \VERB|\FunctionTok{install.packages}\NormalTok{()}| et de lui donner le nom du \emph{package} sous la forme d'une chaîne de caractères (en entourant le nom par des guillemets doubles ou simples).

\begin{redbox}

\begin{itemize}
\tightlist
\item
  L'installation d'un \emph{package} (\VERB|\FunctionTok{install.packages}\NormalTok{()}|) se fait une seule fois, contrairement au chargement d'un \emph{package} (\VERB|\FunctionTok{library}\NormalTok{()}|) qui s'effectue à chaque fois que l'on relance R.
\item
  L'appel de la fonction \VERB|\FunctionTok{install.packages}\NormalTok{()}| sert également à mettre à jour un \emph{package}.
\end{itemize}

\end{redbox}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Évaluez le coode suivant, et lisez le message d'erreur :
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ iris, }\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length, }\AttributeTok{y =}\NormalTok{ Sepal.Width)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Les fonctions \VERB|\FunctionTok{ggplot}\NormalTok{()}|, \VERB|\FunctionTok{aes}\NormalTok{()}| et \VERB|\FunctionTok{geom\_point}\NormalTok{()}| sont contenues dans le \emph{package} \{ggplot2\}. \textbf{Sans charger} le \emph{package}, et en utilisant la syntaxe avec les deux-points (\texttt{::}), modifiez l'instruction de la question précédente pour afficher un nuage de point comme ci-dessous :
\end{enumerate}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-4-1} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Chargez le \emph{package} \{ggplot2\} à l'aide de la fonction \VERB|\FunctionTok{library}\NormalTok{()}| et évaluez à nouveau le même code qu'en première question.
\end{enumerate}

\end{greenbox}

\hypertarget{type-des-donnuxe9es-et-premiuxe8re-structure}{%
\chapter{Type des données et première structure}\label{type-des-donnuxe9es-et-premiuxe8re-structure}}

\hypertarget{types-de-donnuxe9es}{%
\section{Types de données}\label{types-de-donnuxe9es}}

\begin{orangebox}
La réalisation de cet exercice nécessite la lecture des sections \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#types-de-donn\%C3\%A9es}{2.1 Types de données du cours} et \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#structures-de-base}{2.2.1.1 Vecteurs}

\end{orangebox}

R gère des objets qui disposent de 4 caractéristiques :

\begin{itemize}
\item
  un nom ;
\item
  un type : la nature des éléments ; les 4 types principaux sont les suivants :

  \begin{itemize}
  \tightlist
  \item
    \emph{numeric} : des nombres entiers (on ajoute un L majuscule après le nombre pour le déclarer comme entier \VERB|\NormalTok{1L}|) ou réels (\texttt{1.4} ou \texttt{1} ou \texttt{1.0}),
  \item
    \emph{character} : des chaînes de caractère (que l'on créé à l'aide de guillemets doubles ou de guillemets simples),
  \item
    \emph{logical} : des valeurs logiques (\VERB|\ConstantTok{TRUE}|, \VERB|\ConstantTok{FALSE}| et \VERB|\ConstantTok{NA}|),
  \item
    \emph{complex} : des nombres complexes (\VERB|\DecValTok{2}\SpecialCharTok{+}\NormalTok{3i}|);
  \end{itemize}
\item
  une longueur ;
\item
  un contenu.
\end{itemize}

Par ailleurs, R propose un objet \VERB|\ConstantTok{NULL}|, de longueur 0 et de type \VERB|\ConstantTok{NULL}|. Il représente le vide.

Enfin, R propose de marquer les valeurs manquantes avec le mot réservé \VERB|\ConstantTok{NA}|. Comme indiqué plus haut, il s'agit d'un objet de type logique.

Il est important de connaître le type des données que l'on manipule : chaque objet dispose d'une classe qui dépend du type. Or, certaines opérations sont réalisables pour certaines classes mais pas pour d'autres. Par exemple, la fonction \VERB|\FunctionTok{abs}\NormalTok{()}| qui calcule la valeur absolue, est applicable à des objets de type numérique mais ne fonctionne pas pour des chaînes de caractères.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{3}
\FunctionTok{abs}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 3
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y }\OtherTok{\textless{}{-}} \StringTok{"toto"}
\FunctionTok{abs}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## Error in abs(y): argument non numérique pour une fonction mathématique
\end{lstlisting}

\begin{notebox}

\textbf{Note} :

Quelques fonctions à connaître concernant les types de données :

\begin{itemize}
\tightlist
\item
  Pour savoir le type d'un objet : \VERB|\FunctionTok{typeof}\NormalTok{()}|
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{3}
\FunctionTok{typeof}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "double"
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y }\OtherTok{\textless{}{-}} \StringTok{"hello"}
\FunctionTok{typeof}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "character"
\end{lstlisting}

\begin{itemize}
\tightlist
\item
  Pour savoir si un objet est d'un type spécifique, R propose des fonctions retournant une valeur logique. La syntaxe de ces fonctions est simple : on ajoute le suffixe \VERB|\NormalTok{is.}| au nom du type.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.character}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] FALSE
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.numeric}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] TRUE
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.na}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] FALSE
\end{lstlisting}

\begin{itemize}
\item
  La longueur d'un objet est obtenue avec la fonction \VERB|\FunctionTok{length}\NormalTok{()}|. Pour le moment, les objets que nous créons dans cette sectionsont tous de longueur 1. Nous verrons dans la section suivante qu'il s'agit simplement de vecteurs de longueur 1.
\item
  Pour forcer le changement de type d'un objet, R propose des fonctions à la syntaxe simple : il suffit d'ajouter le préfixe \VERB|\NormalTok{as.}| au type voulu. Lorsqu'une conversion n'est pas possible, R retourne la valeur \VERB|\ConstantTok{NA}|
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(x)}
\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "3"
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(z)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "character"
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.numeric}\NormalTok{(}\StringTok{"hello"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] NA
\end{lstlisting}

\end{notebox}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Créez les objets suivants :

  \begin{itemize}
  \tightlist
  \item
    \texttt{x\_1} : un objet contenant la valeur \VERB|\DecValTok{10}|,
  \item
    \texttt{x\_2} : un objet contenant la valeur \VERB|\DecValTok{20}|,
  \item
    \texttt{y} : un objet contenant la chaîne de caractères \texttt{10},
  \item
    \texttt{z} : un objet contenant la valeur \VERB|\ConstantTok{NULL}|,
  \item
    \texttt{t} : un objet contenant la valeur \VERB|\ConstantTok{NA}|,
  \item
    \texttt{v} : un objet contenant la valeur logique \VERB|\ConstantTok{TRUE}|,
  \item
    \texttt{f} : un objet contenant la valeur logique \VERB|\ConstantTok{FALSE}|.
  \end{itemize}
\item
  Dans un objet que vous nommerez \texttt{s}, additionnez \texttt{x\_1} et \texttt{x\_2}, puis affichez la valeur de \texttt{s} dans la console.
\item
  Dans un objet que vous nommerez \texttt{s\_2}, additionnez \texttt{x\_1} et \texttt{y}, puis affichez la valeur de \texttt{s\_2} dans la console. Lisez l'erreur.
\item
  Changez le type de \texttt{y} de sorte que l'objet ne soit plus une chaîne de caractères mais une valeur numérique.
\item
  Dans un objet que vous nommerez \texttt{s\_3}, additionnez \texttt{x\_1} et \texttt{z}, puis affichez la valeur de \texttt{s\_3} dans la console. Vérifiez, à l'aide de la fonction adéquate, la longueur de \texttt{s\_3}.
\item
  Dans un objet que vous nommerez \texttt{s\_4}, additionnez \texttt{x\_1} et \texttt{t}, puis affichez la valeur de \texttt{s\_4} dans la console.
\item
  Divisez la valeur \texttt{x\_1} par 0 et regardez la valeur retournée.
\item
  Affichez, sans modifier le contenu de \texttt{v} et \texttt{f}, le résultat de l'application de la fonction \VERB|\FunctionTok{as.numeric}\NormalTok{()}| aux objets \texttt{v} puis \texttt{f}.
\item
  Dans un objet que vous nommerez \texttt{s\_5}, additionnez \texttt{v} et \texttt{f}, puis affichez la valeur de \texttt{s\_5} dans la console.
\item
  Dans un objet que vous nommerez \texttt{s\_6}, additionnez \texttt{v} et \texttt{v}, puis affichez la valeur de \texttt{s\_6} dans la console.
\item
  Dans un objet que vous nommerez \texttt{s\_7}, multipliez \texttt{v} et \texttt{f}, puis affichez la valeur de \texttt{s\_7} dans la console.
\end{enumerate}

\end{greenbox}

\hypertarget{structure-de-donnuxe9es-les-vecteurs}{%
\section{Structure de données : les vecteurs}\label{structure-de-donnuxe9es-les-vecteurs}}

Les vecteurs sont les objets les plus communs en R. Il s'agit d'une collection d'éléments à une dimension. Les éléments contenus dans un vecteur doivent nécessairement être \textbf{de même type}. Lorsque nous avons créé des objets contenant un numérique ou une chaîne de caractère, R a stocké l'information sous la forme d'un vecteur de longueur 1 (vecteur contenant un seul élément).

La fonction \VERB|\FunctionTok{c}\NormalTok{()}| (pour \emph{combine}) permet de créer un vecteur, on lui donne les éléments en argument de la fonction, en les séparant par une virgule (et éventuellement d'une espace).

Le tableau Table~\ref{tab:pib-nominal} reporte les valeurs du PIB nominal de la France, en fréquence annuelle.

\begin{longtable}[]{@{}lr@{}}
\caption{\label{tab:pib-nominal} PIB nominal annuel de la France, en millions d'Euros (série ajustée de la saisonnalité) (Source: \href{https://fred.stlouisfed.org/series/CPMNACSCAB1GQFR}{Fred Economic Data}).}\tabularnewline
\toprule
Année & PIB \\
\midrule
\endfirsthead
\toprule
Année & PIB \\
\midrule
\endhead
2015 & 549901,2 \\
2016 & 558184,9 \\
2017 & 574852,5 \\
2018 & 591119,6 \\
2019 & 610003,3 \\
2020 & 577434,8 \\
2021 & 624705,6 \\
\bottomrule
\end{longtable}

Utilisons la fonction \VERB|\FunctionTok{c}\NormalTok{()}| pour créer un vecteur contenant les valeurs du PIB pour les années 2015 à 2019 :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib\_1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{549901.2}\NormalTok{, }\FloatTok{558184.9}\NormalTok{, }\FloatTok{574852.5}\NormalTok{, }\FloatTok{591119.6}\NormalTok{, }\FloatTok{610003.3}\NormalTok{)}
\NormalTok{pib\_1}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 549901.2 558184.9 574852.5 591119.6 610003.3
\end{lstlisting}

L'objet \texttt{pib\_1} que nous venons de créer est un vecteur de numériques de longueur 5 :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(pib\_1)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "numeric"
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(pib\_1)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 5
\end{lstlisting}

La fonction \VERB|\FunctionTok{c}\NormalTok{()}| permet également de combiner plusieurs vecteurs :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib\_2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{577434.8}\NormalTok{, }\FloatTok{624705.6}\NormalTok{)}
\NormalTok{pib }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pib\_1, pib\_2)}
\NormalTok{pib}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 549901.2 558184.9 574852.5 591119.6 610003.3 577434.8 624705.6
\end{lstlisting}

Pour \textbf{sélectionner} des sous-ensembles dans un vecteur, R propose l'indexation. Trois indexations différentes sont possibles : par position, par nom, et par condition.

\hypertarget{indexation-par-position}{%
\subsection{Indexation par position}\label{indexation-par-position}}

Chaque élément d'un vecteur possède une position, qui débute en R à 1. On utilise des crochets dans lesquels les positions des éléments à conserver sont données dans un vecteur. Pour extraire le premier élément de du vecteur de numériques \texttt{pib} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 549901.2
\end{lstlisting}

Pour extraire le 1er et le 3e éléments :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 549901.2 574852.5
\end{lstlisting}

Il est possible d'exclure les éléments dont les positions sont données dans le vecteur dans les crochets :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 558184.9 591119.6 610003.3 577434.8 624705.6
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Créez un vecteur que vous nommerez \texttt{annees} qui contiendra les valeurs des années du tableau~Table~\ref{tab:pib-nominal}.
\item
  En utilisant l'indexation par position, extrayez les années aux positions 2 et 4.
\item
  En utilisant l'indexation par position, récupérez le dernier élément du vecteur \texttt{annees}.
\item
  Si, à la question précédente, vous avez inscrit à la main la valeur de la position du dernier élément, recommencez la question en obtenant la position du dernier élément à l'aide d'une fonction (pour que votre instruction retourne le dernier élément du vecteur, peu importe sa taille).
\end{enumerate}

\end{greenbox}

\hypertarget{indexation-par-nom}{%
\subsection{Indexation par nom}\label{indexation-par-nom}}

Il est possible de nommer les éléments d'un vecteur lors de sa création :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{maths =} \DecValTok{10}\NormalTok{, }\AttributeTok{francais =} \DecValTok{12}\NormalTok{, }\AttributeTok{anglais =} \DecValTok{15}\NormalTok{)}
\NormalTok{notes}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##    maths francais  anglais 
##       10       12       15
\end{lstlisting}

Ou bien une fois que le vecteur a été créé, en utilisant la fonction \VERB|\FunctionTok{name}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{15}\NormalTok{)}
\FunctionTok{names}\NormalTok{(notes\_2) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"maths"}\NormalTok{, }\StringTok{"francais"}\NormalTok{, }\StringTok{"anglais"}\NormalTok{)}
\NormalTok{notes\_2}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##    maths francais  anglais 
##       10       12       15
\end{lstlisting}

La fonction \VERB|\FunctionTok{names}\NormalTok{()}| permet d'obtenir la liste des noms (et dans l'intruction précédente, les noms ont été remplacés avec une nouvelle assignation) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(notes\_2)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "maths"    "francais" "anglais"
\end{lstlisting}

Pour extraire des sous-éléments d'un vecteur à l'aide des noms, le fonctionnement est similaire à l'indexation par position :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_2[}\StringTok{"maths"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## maths 
##    10
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_2[}\FunctionTok{c}\NormalTok{(}\StringTok{"maths"}\NormalTok{, }\StringTok{"anglais"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##   maths anglais 
##      10      15
\end{lstlisting}

\hypertarget{indexation-par-condition}{%
\subsection{Indexation par condition}\label{indexation-par-condition}}

Plutôt que d'indiquer les positions ou les noms des éléments, il est possible de fournir un vecteur de logique précisant, pour chaque élément, si celui-ci doit être inclus (\VERB|\ConstantTok{TRUE}|) ou exclus (\VERB|\ConstantTok{FALSE}|) :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[}\FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 549901.2 558184.9 591119.6 624705.6
\end{lstlisting}

Evidemment, écrire un vecteur de logique à la main est assez fastidieux. Imaginons que nous disposons d'un vecteur indiquant pour chaque année correspondant à nos observations de PIB s'il s'agit d'une année touchée par une crise économique :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{crise }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Ce vecteur peut être utilisé pour filtrer les valeurs du PIB lors des crises :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[crise]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 577434.8 624705.6
\end{lstlisting}

Les vecteurs de logiques peuvent de surcroit être obtenus en faisant appel à des opérateurs de comparaison reportés dans le tableau ci-dessous.

\begin{longtable}[]{@{}lr@{}}
\caption{\label{tab:operateurs-comparaison} Opérateurs de comparaison}\tabularnewline
\toprule
Opérateur & Description \\
\midrule
\endfirsthead
\toprule
Opérateur & Description \\
\midrule
\endhead
\texttt{\textless{}} & inférieur à \\
\texttt{\textless{}=} & inféfieur ou égal à \\
\texttt{\textgreater{}} & supérieur à \\
\texttt{\textgreater{}=} & supérieur ou égal à \\
\texttt{==} & égal à \\
\texttt{!=} & différent de \\
\bottomrule
\end{longtable}

Par exemple, pour obtenir un vecteur qui indique pour chaque élément contenu dans le vecteur numérique \texttt{pib} si la valeur est inférieure à 560~000:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib }\SpecialCharTok{\textless{}} \DecValTok{560000}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1]  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE
\end{lstlisting}

Aussi, pour obtenir les éléments de \texttt{pib} dont les valeurs sont inférieures à 560~000, on peut écrire :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[pib }\SpecialCharTok{\textless{}} \DecValTok{560000}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 549901.2 558184.9
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Créez un vecteur de logiques à partir du vecteur \texttt{annees} créé lors du précédent exercice indiquant si chaque valeur du vecteur \texttt{annees} est égale à 2017.
\item
  Utilisez le vecteur de logiques de la question précédente pour extraire la valeur du vecteur \texttt{pib} correspondant à l'année 2017.
\item
  En consultant un moteur de recherche, cherchez l'opérateur mathématique permettant de calculer le modulo d'un nombre.
\item
  En utilisant l'opérateur trouvé en première question, créez un vecteur logique permettant d'obtenir les années paires du vecteur \texttt{annees}.
\end{enumerate}

\end{greenbox}

Les vecteurs de logiques peuvent être le résultat de l'évaluation de plusieurs conditions logiques, en s'appuyant sur les opérateurs logiques.

\begin{longtable}[]{@{}lr@{}}
\caption{\label{tab:operateurs-logiques} Opérateurs logiques}\tabularnewline
\toprule
Opérateur & Description \\
\midrule
\endfirsthead
\toprule
Opérateur & Description \\
\midrule
\endhead
\texttt{\&} & et logique \\
\texttt{\textbar{}} & ou logique \\
\texttt{!} & négation logique \\
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib }\SpecialCharTok{\textless{}} \DecValTok{560000} \SpecialCharTok{|}\NormalTok{ pib }\SpecialCharTok{\textgreater{}} \DecValTok{600000}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1]  TRUE  TRUE FALSE FALSE  TRUE FALSE  TRUE
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[pib }\SpecialCharTok{\textless{}} \DecValTok{560000} \SpecialCharTok{|}\NormalTok{ pib }\SpecialCharTok{\textgreater{}} \DecValTok{600000}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 549901.2 558184.9 610003.3 624705.6
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  À l'aide d'une condition logique multiple, extrayez les valeurs du vecteur \texttt{pib} pour lesquelles les deux conditions suivantes sont remplies : l'année est inférieure ou égale à 2018, et la valeur est inférieure à 560~000.
\item
  À quelles années les valeurs extraites correspondent-elles ?
\end{enumerate}

\end{greenbox}

\begin{notebox}

\textbf{Notes} :

Il existe en R un opérateur permettant de tester l'appartenance à un ensemble discret de valeurs : \VERB|\SpecialCharTok{\%in\%}|.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{, }\StringTok{"C"}\NormalTok{, }\StringTok{"D"}\NormalTok{)}
\NormalTok{x }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"D"}\NormalTok{, }\StringTok{"B"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] FALSE  TRUE FALSE  TRUE
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[x }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"D"}\NormalTok{, }\StringTok{"B"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "B" "D"
\end{lstlisting}

Par ailleurs, R propose deux fonctions très pratiques pour les vecteurs de logiques :

\begin{itemize}
\tightlist
\item
  \VERB|\FunctionTok{any}\NormalTok{()}| : au moins un des éléments du vecteur vaut \VERB|\ConstantTok{TRUE}| ;
\item
  \VERB|\FunctionTok{all}\NormalTok{()}| : tous les éléments du vecteur valent \VERB|\ConstantTok{TRUE}|.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{any}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] TRUE
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{all}\NormalTok{(}\SpecialCharTok{!}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] TRUE
\end{lstlisting}

Enfin, la fonction \VERB|\FunctionTok{which}\NormalTok{()}| permet d'obtenir les positions des valeurs \VERB|\ConstantTok{TRUE}| dans un vecteur de logiques :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{which}\NormalTok{(z)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1 4 5
\end{lstlisting}

\end{notebox}

\hypertarget{gestion-des-valeurs-manquantes}{%
\subsection{Gestion des valeurs manquantes}\label{gestion-des-valeurs-manquantes}}

Admettons que nous disposions d'une valeur manquante pour une des années.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{549901.2}\NormalTok{, }\FloatTok{558184.9}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\FloatTok{591119.6}\NormalTok{, }
         \FloatTok{610003.3}\NormalTok{, }\FloatTok{577434.8}\NormalTok{, }\FloatTok{624705.6}\NormalTok{)}
\NormalTok{pib}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 549901.2 558184.9       NA 591119.6 610003.3 577434.8 624705.6
\end{lstlisting}

Lorsque l'on fait un test logique sur une valeur \VERB|\ConstantTok{NA}|, le résultat est \VERB|\ConstantTok{NA}|:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib }\SpecialCharTok{\textgreater{}} \DecValTok{550000}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] FALSE  TRUE    NA  TRUE  TRUE  TRUE  TRUE
\end{lstlisting}

Les valeurs \VERB|\ConstantTok{NA}| d'un vecteur de logiques utilisé dans le cadre d'une indexation par condition retournent \VERB|\ConstantTok{NA}|

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[pib }\SpecialCharTok{\textgreater{}} \DecValTok{550000}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 558184.9       NA 591119.6 610003.3 577434.8 624705.6
\end{lstlisting}

Ce qui peut être pénible\ldots{} Si on souhaite obtenir les années pour lesquelles le PIB est supérieur à 550~000 :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{annees }\OtherTok{\textless{}{-}} \DecValTok{2015}\SpecialCharTok{:}\DecValTok{2022}
\NormalTok{annees}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 2015 2016 2017 2018 2019 2020 2021 2022
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{annees[pib }\SpecialCharTok{\textgreater{}} \DecValTok{550000}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 2016   NA 2018 2019 2020 2021
\end{lstlisting}

On note que l'année pour laquelle la valeur du PIB est manquante a été transformée en \VERB|\ConstantTok{NA}|.

Si on souhaite exclure les valeurs manquantes, on peut utiliser la fonction \VERB|\FunctionTok{is.na}\NormalTok{()}| à laquelle on applique l'opérateur de négation logique :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{annees[pib }\SpecialCharTok{\textgreater{}} \DecValTok{550000} \SpecialCharTok{\&} \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(pib)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 2016 2018 2019 2020 2021
\end{lstlisting}

\hypertarget{remplacement-et-ajout-de-valeurs}{%
\subsection{Remplacement et ajout de valeurs}\label{remplacement-et-ajout-de-valeurs}}

Pour effectuer un remplacement de valeurs à l'intérieur d'un vecteur, on peut utiliser la fonction crochet (\VERB|\StringTok{"["}\NormalTok{()}| que nous utilisons dans sa version plus pratique \VERB|\NormalTok{[]}|) et la flèche d'affectation (\VERB|\OtherTok{\textless{}{-}}|).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[}\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}} \FloatTok{574852.5}
\end{Highlighting}
\end{Shaded}

Plusieurs éléments peuvent être modifiés en une seule instruction.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[pib }\SpecialCharTok{\textless{}} \DecValTok{560000} \SpecialCharTok{|}\NormalTok{ pib }\SpecialCharTok{\textgreater{}} \DecValTok{600000}\NormalTok{] }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{1000}
\NormalTok{pib}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1]  -1000.0  -1000.0 574852.5 591119.6  -1000.0 577434.8  -1000.0
\end{lstlisting}

Nous avons vu précédemment que pour ajouter des valeurs, il est possible de combiner plusieurs vecteurs. Il est aussi possible d'utiliser l'indexation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib[}\DecValTok{8}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{10}
\NormalTok{pib}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1]  -1000.0  -1000.0 574852.5 591119.6  -1000.0 577434.8  -1000.0     10.0
\end{lstlisting}

\hypertarget{exercice-de-synthuxe8se}{%
\subsection{Exercice de synthèse}\label{exercice-de-synthuxe8se}}

\begin{greenbox}

Reprenons les données de PIB nominal de la France, en fréquence annuelle:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pib }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{549901.2}\NormalTok{, }\FloatTok{558184.9}\NormalTok{, }\FloatTok{574852.5}\NormalTok{, }\FloatTok{591119.6}\NormalTok{, }
         \FloatTok{610003.3}\NormalTok{, }\FloatTok{577434.8}\NormalTok{, }\FloatTok{624705.6}\NormalTok{)}
\NormalTok{annees }\OtherTok{\textless{}{-}} \DecValTok{2015}\SpecialCharTok{:}\DecValTok{2021}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  En utilisant la fonction appropriée, retournez le nombre d'éléments contenus dans le vecteur numérique \texttt{pib}.
\item
  Donnez la valeur du PIB en milliards plutôt qu'en millions, et placez le resultat dans un vecteur que vous nommerez \texttt{pib\_milliards}.
\item
  Quelles sont les années pour lesquelles le PIB est compris entre 560~000 et 590~000 (pensez à effectuer un test logique contenant deux conditions logiques et un opérateur logique).
\item
  Créez un indice pour le PIB, en prenant comme référence l'année 2020 (valeur 100 en 2020). Stockez le résultat dans un objet que vous nommerez \texttt{pib\_ind\_2020}. Pour ce faire :

  \begin{itemize}
  \tightlist
  \item
    créez un objet que vous nommerez \texttt{ref} qui contiendra la valeur du PIB en 2020 (utilisez une extraction par condition)
  \item
    divisez les valeurs de \texttt{pib} par la valeur stockée dans \texttt{ref}, puis multipliez le résultat par 100.
  \end{itemize}
\item
  Regardez le fonctionnement de la fonction \VERB|\FunctionTok{lag}\NormalTok{()}| du \emph{package} \{dplyr\} dans le fichier d'aide et en observant le résultat dans la console lorsque vous l'appliquez au vecteur \texttt{pib}.
\item
  En utilisant la fonction \VERB|\FunctionTok{lag}\NormalTok{()}|, calculez le taux de croissance, en pourcentage du PIB d'une année à l'autre.
\item
  Admettons que la réserve Fédérale de Saint Louis vous informe que la valeur du PIB en 2016 est finalement corrigée et est maintenant estimée à 55963.2. Corrigez la valeur à l'aide d'une affectation de remplacement.
\end{enumerate}

\end{greenbox}

\hypertarget{matrices-et-listes}{%
\chapter{Matrices et listes}\label{matrices-et-listes}}

\begin{orangebox}
Ce chapitre s'appuie sur les sections 2.2.1.4 Matrices et 2.2.1.5 Listes du \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#structures-de-base}{chapitre 2 des notes de cours}, ainsi que sur la \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#manipulation-des-donn\%C3\%A9es}{Section 2.4 Manipulation des données}.

\end{orangebox}

\hypertarget{matrice}{%
\section{Matrice}\label{matrice}}

En R, les matrices sont des vecteurs auxquels un attridut \texttt{dim} de dimension est ajouté (cet attribut est de longueur 2). La fonction \VERB|\FunctionTok{matrix}\NormalTok{()}| permet de créer une matrice. Son premier argument, \texttt{data} reçoit un vecteur de valeurs. Les arguments \texttt{ncol} et \texttt{nrow} reçoivent quant à eux le nombre de colonnes et de lignes, respectivement. Il est possible de ne préciser qu'un seul de ces deux derniers arguments (en fonction de la longueur du vecteur donné à l'argument \texttt{data}, R devine).

Créons la matrice suivante en R:

\[A = \begin{bmatrix}1 & 4 & 7 & 10\\2 & 5 & 8 & 11\\ 3 & 6 & 9 & 12\end{bmatrix}\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\AttributeTok{data =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{12}\NormalTok{), }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{)}
\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   10
## [2,]    2    5    8   11
## [3,]    3    6    9   12
\end{lstlisting}

\begin{notebox}

\textbf{Notes}

\begin{itemize}
\tightlist
\item
  Le remplissage de la matrice s'est effectué colonne par colonne, de sorte à avoir 4 colonnes dans le résultat final (\texttt{ncol=4\{.R\}}).
\item
  Les données fourniées à l'argument \texttt{data} doivent être de même type (puisqu'elles sont contenues dans un vecteur).
\item
  Nous pouvons ne pas écrire \texttt{data=} et simplement écrire \VERB|\FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{11}\NormalTok{,}\DecValTok{12}\NormalTok{), }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{)}|.
\item
  Au lieu d'écrire \VERB|\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{11}\NormalTok{,}\DecValTok{12}\NormalTok{)}|, il est possible de générer la même séquence de nombres à l'aide d'une syntaxe plus courte : \VERB|\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{12}\NormalTok{)}| ou encore plus court : \VERB|\DecValTok{1}\SpecialCharTok{:}\DecValTok{12}|.
\end{itemize}

\end{notebox}

Pour remplir la matrice en procédant ligne par ligne plutôt que colonne par colonne, on peut ajouter \VERB|\NormalTok{byrow }\OtherTok{=} \ConstantTok{TRUE}| en argument à la fonction \VERB|\FunctionTok{matrix}\NormalTok{()}|

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{12}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{, }\AttributeTok{byrow =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8
## [3,]    9   10   11   12
\end{lstlisting}

\hypertarget{accuxe8s-aux-uxe9luxe9ments-dune-matrice}{%
\subsection{Accès aux éléments d'une matrice}\label{accuxe8s-aux-uxe9luxe9ments-dune-matrice}}

\hypertarget{indexation-par-position-1}{%
\subsubsection{Indexation par position}\label{indexation-par-position-1}}

Avec les vecteurs, nous avons extrait des sous-ensembles à l'aide de la fonction crochet, en utilisant l'indexation. Les vecteurs étant des objets en dimension 1, nous n'avons donné à la fonction crochet qu'un seul argument : \VERB|\NormalTok{x[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)]}| permet d'extraire les éléments aux positions 2 et 3 de \texttt{x}. Les matrices étant des objets à deux dimensions, il convient de fournir deux arguments à la fonction crochet, en les séparant par une virgule : \texttt{x{[}i,j{]}}. Le premier argument, \texttt{i} correspond aux indices de la première dimension (les lignes) et \texttt{j} aux indices de la deuxième dimension (les colonnes).

Revenons à notre matrice \texttt{A}. Extrayons les observations des lignes 1 et 3 aux colonnes 2 et 4 :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2]
## [1,]    4   10
## [2,]    6   12
\end{lstlisting}

En ommettant l'argument \texttt{i} ou l'argument \texttt{j}, l'ensemble des lignes ou des colonnes respectivement est retourné.

Les éléments de l'ensemble des lignes aux colonnes 2 et 4 :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A[, }\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2]
## [1,]    4   10
## [2,]    5   11
## [3,]    6   12
\end{lstlisting}

Les éléments des lignes 1 et 3 pour l'ensemble des colonnes :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{), ]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   10
## [2,]    3    6    9   12
\end{lstlisting}

Pour exclure des éléments, comme pour les vecteurs, on utilise le symbole moins (\texttt{-}). Par exemple, pour extraire les éléments pour toutes les lignes, pour toutes les colonnes sauf la 2e et la 4e :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A[, }\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2]
## [1,]    1    7
## [2,]    2    8
## [3,]    3    9
\end{lstlisting}

\begin{notebox}

\textbf{Note}

Rappelez-vous que les matrices sont stockés sous forme de vecteurs. Il est donc possible d'utiliser la fonction crochet en lui fournissant uniquement l'argument \texttt{i}. L'instruction suivante retourne, sous la forme d'un vecteur, les éléments aux positions 1, 4, et 3 :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{3}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1 4 3
\end{lstlisting}

\end{notebox}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Créez la matrice suivante : \[B = \begin{bmatrix}-2 & 2 & -3 \\ -1 & 1 & 3\\4 & 0 & -1\end{bmatrix}.\]
\item
  Extrayez la 2e colonne de la matrice B.
\item
  Extrayez la sous-matrice dans le coin inférieur de B : \[C=\begin{bmatrix}1 & 3 \\ 0 & -1\end{bmatrix}.\]
\item
  Extrayez toutes les colonnes de B sauf la 2e.
\item
  Extrayez le terme en dernière ligne et en dernière colonne de B.
\end{enumerate}

\end{greenbox}

\hypertarget{indexation-par-condition-1}{%
\subsubsection{Indexation par condition}\label{indexation-par-condition-1}}

Comme pour les vecteur, nous pouvons utiliser une matrice de logique indiquant si les éléments doivent être retournés (\VERB|\ConstantTok{TRUE}|) ou non(\VERB|\ConstantTok{FALSE}|).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{masque }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }
                   \ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{), }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{)}
\NormalTok{masque}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##       [,1]  [,2]  [,3]  [,4]
## [1,]  TRUE FALSE  TRUE FALSE
## [2,] FALSE  TRUE  TRUE FALSE
## [3,] FALSE FALSE FALSE FALSE
\end{lstlisting}

En appliquant ce masque de valeurs logiques à la matrice A, on récpuère dans un vecteur les valeurs pour lesquelles la valeur dans le masque à la même position vaut \VERB|\ConstantTok{TRUE}| :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A[masque]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1 5 7 8
\end{lstlisting}

Evidemment, écrire de tels masques à la main n'est pas très utile. En revanche, ils peuvent être obtenus suite à l'évaluation d'une condition logique. Par exemple, si on souhaite obtenir les éléments de la matrice A dont la valeur est inférieure à 5, on peut créer le masque suivant :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}\SpecialCharTok{\textless{}}\DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1]  [,2]  [,3]  [,4]
## [1,] TRUE  TRUE FALSE FALSE
## [2,] TRUE FALSE FALSE FALSE
## [3,] TRUE FALSE FALSE FALSE
\end{lstlisting}

Et ensuite appliquer ce masque avec la fonction crochet :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A[A}\SpecialCharTok{\textless{}}\DecValTok{5}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1 2 3 4
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Récupérez les valeurs de la matrice A qui sont inférieures à 3 ou supérieures à 7.
\item
  Récupérez les valeurs paires de la matrice A (utilisez le modulo).
\end{enumerate}

\end{greenbox}

\hypertarget{remplacement-et-ajout-de-valeurs-1}{%
\subsection{Remplacement et ajout de valeurs}\label{remplacement-et-ajout-de-valeurs-1}}

Comme pour les vecteurs, le remplacement de valeurs peut s'effectuer avec la flèche d'affectation \VERB|\OtherTok{\textless{}{-}}|. On écrit à gauche de cette flèche l'extraction réalisée par indexation et à droite les valeurs de remplacement.

Reprenons notre matrice A :

\[A = \begin{bmatrix}1 & 4 & 7 & 10\\2 & 5 & 8 & 11\\ 3 & 6 & 9 & 12\end{bmatrix}\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{12}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{4}\NormalTok{)}
\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   10
## [2,]    2    5    8   11
## [3,]    3    6    9   12
\end{lstlisting}

Remplaçons les valeurs 10 et 11 par -10 et -11

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{),}\DecValTok{4}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{10}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{11}\NormalTok{)}
\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7  -10
## [2,]    2    5    8  -11
## [3,]    3    6    9   12
\end{lstlisting}

Cela fonctionne aussi avec un indexation par condition. Créons un masque indiquant si les valeurs sont négatives :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}\SpecialCharTok{\textless{}}\DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##       [,1]  [,2]  [,3]  [,4]
## [1,] FALSE FALSE FALSE  TRUE
## [2,] FALSE FALSE FALSE  TRUE
## [3,] FALSE FALSE FALSE FALSE
\end{lstlisting}

Puis affectons la valeur \VERB|\ConstantTok{NA}| à la place des valeurs négatives de la matrice \texttt{A} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A[A}\SpecialCharTok{\textless{}}\DecValTok{0}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   NA
## [2,]    2    5    8   NA
## [3,]    3    6    9   12
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Créez la matrice suivante : \[X = \begin{bmatrix}-2 & 2 & -3 \\ -1 & 1 & 3\\4 & 0 & -1\end{bmatrix}.\]
\item
  Remplacez les valeurs positives de \texttt{X} par 1000.
\item
  Remplacez les éléments aux positions (1,1) et (2,3) par \VERB|\ConstantTok{NA}|.
\end{enumerate}

\end{greenbox}

\hypertarget{calculs-matriciels}{%
\subsection{Calculs matriciels}\label{calculs-matriciels}}

En économie, et particulièrement en économétrie, nous manipulons beaucoup de matrices. Il est important de savoir effectuer avec R les différents calculs matriciels les plus courants dans notre discipline.

Considérons quelques matrices :

\[A = \begin{bmatrix}1 & 2 & 0\\ 4 & 3 & -1\end{bmatrix}\]

\[B = \begin{bmatrix}5 & 1\\ 2 & 3\\ 3 & 4\end{bmatrix}\]

\[C = \begin{bmatrix}1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1\end{bmatrix}\]

\[D = \begin{bmatrix}-2 & 2 & -3 \\ -1 & 1 & 3\\4 & 0 & -1\end{bmatrix}\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{0}\NormalTok{,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{), }\AttributeTok{nrow =} \DecValTok{2}\NormalTok{)}
\NormalTok{B }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{), }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{)}
\NormalTok{C }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{), }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{)}
\NormalTok{D }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{), }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Considérons par ailleurs le scalaire \(a = 3\).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\hypertarget{addition-soustraction}{%
\subsubsection{Addition, soustraction}\label{addition-soustraction}}

Pour additionner ou soustraire un scalaire ou une matrice à une matrice, on utilise simplement les opérateurs d'addition (\VERB|\SpecialCharTok{+}|) ou de soustraction (\VERB|\SpecialCharTok{{-}}|), respectivement :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}\SpecialCharTok{+}\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]    4    5    3
## [2,]    7    6    2
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}\SpecialCharTok{{-}}\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]   -2   -1   -3
## [2,]    1    0   -4
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{C}\SpecialCharTok{+}\NormalTok{D}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]   -1    2   -3
## [2,]   -1    2    3
## [3,]    4    0    0
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{C}\SpecialCharTok{{-}}\NormalTok{D}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]    3   -2    3
## [2,]    1    0   -3
## [3,]   -4    0    2
\end{lstlisting}

Lorsqu'on essaie d'additionner ou de soustraire deux matrices non compatibles, R retourne une erreur :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}\SpecialCharTok{+}\NormalTok{C}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## Error in A + C: tableaux de tailles inadéquates
\end{lstlisting}

\hypertarget{multiplication}{%
\subsubsection{Multiplication}\label{multiplication}}

La multiplication par un scalaire s'effectue avec l'étoile \VERB|\SpecialCharTok{*}|:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}\SpecialCharTok{*}\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]    3    6    0
## [2,]   12    9   -3
\end{lstlisting}

Pour multiplier deux matrices (compatibles) entre-elles, on utilise l'opérateur de produit matriciel \texttt{\%*\%} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A }\SpecialCharTok{\%*\%}\NormalTok{ B}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2]
## [1,]    9    7
## [2,]   23    9
\end{lstlisting}

En cas d'incompatibilité, R nous prévient :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{C }\SpecialCharTok{\%*\%}\NormalTok{ A}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## Error in C %*% A: arguments inadéquats
\end{lstlisting}

\begin{notebox}

Attention, si on utilise l'étoile au lieu de l'opérateur de produit matriciel, si les deux matrices ont la même dimension, alors R effectue une multiplication terme à terme :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{C }\SpecialCharTok{*}\NormalTok{ D}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]   -2    0    0
## [2,]    0    1    0
## [3,]    0    0   -1
\end{lstlisting}

\end{notebox}

\hypertarget{transposuxe9e}{%
\subsubsection{Transposée}\label{transposuxe9e}}

La transposée d'une matrice s'obtient en R avec la fonction \VERB|\FunctionTok{t}\NormalTok{()}|:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t}\NormalTok{(A)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2]
## [1,]    1    4
## [2,]    2    3
## [3,]    0   -1
\end{lstlisting}

\hypertarget{inversion}{%
\subsubsection{Inversion}\label{inversion}}

L'inversion d'une matrice est calculée à l'aide de la fonction \texttt{solve()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{solve}\NormalTok{(D)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##             [,1]       [,2] [,3]
## [1,] -0.02777778 0.05555556 0.25
## [2,]  0.30555556 0.38888889 0.25
## [3,] -0.11111111 0.22222222 0.00
\end{lstlisting}

\begin{notebox}

En économétrie, l'estimateur des moindres carrés ordinaires est donné par \((X^{\top}X)^{-1}(X^{\top}y)\), où \(X\) est la matrice des variables explicatives et \(y\) le vecteur de la variable endogène.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{solve}\NormalTok{(}\FunctionTok{t}\NormalTok{(X) }\SpecialCharTok{\%*\%}\NormalTok{ X) }\SpecialCharTok{\%*\%}\NormalTok{ (}\FunctionTok{t}\NormalTok{(X) }\SpecialCharTok{\%*\%}\NormalTok{ y)}
\end{Highlighting}
\end{Shaded}

Qui peut aussi se calculer de manière équivalente (nous le ferons dans un prochain exercice) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{crossprod}\NormalTok{(X,X) }\SpecialCharTok{\%*\%} \FunctionTok{crossprod}\NormalTok{(X,y)}
\end{Highlighting}
\end{Shaded}

\end{notebox}

\hypertarget{duxe9terminant}{%
\subsubsection{Déterminant}\label{duxe9terminant}}

Le déterminant s'obtient avec la fonction \VERB|\FunctionTok{det}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{det}\NormalTok{(D)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 36
\end{lstlisting}

\hypertarget{diagonale}{%
\subsubsection{Diagonale}\label{diagonale}}

La diagonale d'une matrice peut être obtenue avec la fonction \texttt{det()}\{.R :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{diag}\NormalTok{(C)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1 1 1
\end{lstlisting}

\begin{notebox}

\textbf{Note}

La fonction \texttt{diag()} permet par ailleurs de créer une matrice identité :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{diag}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]    1    0    0
## [2,]    0    1    0
## [3,]    0    0    1
\end{lstlisting}

\end{notebox}

Pour obtenir la trace d'une matrice carrée, on peut simplement sommer les éléments de la diagonale :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{diag}\NormalTok{(D))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] -2
\end{lstlisting}

\hypertarget{combiner-des-matrices}{%
\subsection{Combiner des matrices}\label{combiner-des-matrices}}

Pour ajouter des \textbf{colonnes} à une matrice, la fonction \VERB|\FunctionTok{cbind}\NormalTok{()}| peut être utilisée. Il s'agit de combiner (\emph{bind}) les colonnes (\emph{columns}) de deux matrices ou d'une matrice et d'un vecteur colonne.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cbind}\NormalTok{(B, C)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3] [,4] [,5]
## [1,]    5    1    1    0    0
## [2,]    2    3    0    1    0
## [3,]    3    4    0    0    1
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cbind}\NormalTok{(B, }\FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{11}\NormalTok{,}\DecValTok{12}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]    5    1   10
## [2,]    2    3   11
## [3,]    3    4   12
\end{lstlisting}

Pour ajouter des \textbf{lignes} à une matrice, la fonction \VERB|\FunctionTok{rbind}\NormalTok{()}| peut être utilisée. Il s'agit de combiner (\emph{bind}) les lignes (\emph{rows}) de deux matrices ou d'une matrice et d'un vecteur ligne.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rbind}\NormalTok{(C, D)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]    1    0    0
## [2,]    0    1    0
## [3,]    0    0    1
## [4,]   -2    2   -3
## [5,]   -1    1    3
## [6,]    4    0   -1
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rbind}\NormalTok{(C, }\FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{11}\NormalTok{,}\DecValTok{12}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]    1    0    0
## [2,]    0    1    0
## [3,]    0    0    1
## [4,]   10   11   12
\end{lstlisting}

\begin{notebox}

\textbf{Note}

Si on ajoute un vecteur colonne (ligne) à une matrice, et que la taille du vecteur est inférieure au nombre de colonnes (lignes), R effectue ce que l'on appelle un \textbf{recyclage}. C'est-à-dire que R va compléter le vecteur plus court à l'aide des valeurs de ce même vecteur, en repartant au début de celui-ci, afin d'obtenir deux objets de même taille.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cbind}\NormalTok{(B, }\FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{11}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      [,1] [,2] [,3]
## [1,]    5    1   10
## [2,]    2    3   11
## [3,]    3    4   10
\end{lstlisting}

\end{notebox}

\begin{greenbox}

\textbf{Exercice}

Dans cet exercice, nous allons considérer un modèle de régression linéaire.

\[y_i = \beta_0 + \sum_{j=1}^{p} \beta_j x_{p,i} + \varepsilon_i,\]

avec \(i=1,\ldots, n\) indiçant les individus statistiques, \(y\) la variable à expliquer, \(\beta_0\) le coefficient de la constante, \(\beta_j\) le coefficient associé à la variable explicative \(x_j\) (avec \(j=1, \ldots, p\)), et \(\epsilon\) un terme d'erreur distribué normalement avec une espérance nulle et une variance \(\sigma^2\).

L'écriture matricielle du modèle est la suivante :

\[y = \boldsymbol{X} \beta + \varepsilon,\]
avec \(y\) le vecteur de la variable à expliquer, \(\boldsymbol X\) la matrice contenant les variables explicatives (et la constante), et \(\varepsilon\) le terme d'erreur.

Dans cet exercice, vous allez utiliser vos connaissances acquises sur les matrices pour estimer les coefficients du modèle par la méthode des moindres carrés ordinaires.

Considérons le modèle suivant, pour les observations \(i=1,\ldots, n\) :

\[\textrm{consommation}_i = \beta_0 + \beta_1 \textrm{puissance}_i + \beta_2 \textrm{masse}_i + \varepsilon_i,\]
où \(\textrm{consommation}\) est la variables à expliquer (\(y\)). Il s'agit d'un vecteur de valeurs de consommation de carburant (miles par gallons). \(\textrm{puissance}\) et \(\textrm{masse}\) sont des vecteurs de puissance (nombre de chevaux) et de masse du véhicule (en millième de livres) respectivement. Le vecteur \(\varepsilon\) est un terme d'erreurs que l'on suppose distribué selon une normale d'espérance nulle.

L'objectif de l'exercice est d'estimer les paramètres \(\beta_0\), \(\beta_1\) et \(\beta_2\).

Dans un premier temps, évaluez les instructions suivantes pour récupérer les valeurs (qui sont stockées dans un tableau de données nommé \texttt{mtcars} qui est fourni dans le \emph{package} \{datasets\}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{consommation }\OtherTok{\textless{}{-}}\NormalTok{ mtcars}\SpecialCharTok{$}\NormalTok{mpg}
\NormalTok{puissance }\OtherTok{\textless{}{-}}\NormalTok{ mtcars}\SpecialCharTok{$}\NormalTok{hp}
\NormalTok{masse }\OtherTok{\textless{}{-}}\NormalTok{ mtcars}\SpecialCharTok{$}\NormalTok{wt}
\end{Highlighting}
\end{Shaded}

Créez également un vecteur pour la constante (ce vecteur ne contient que des 1) :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{constante }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(mtcars))}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Créez la matrice \texttt{X} qui doit contenir 3 colonnes : une pour la constante (\texttt{constante}), une autre pour la puissance (\texttt{puissance}) et une dernière pour la masse (\texttt{masse}) ;
\item
  Calculez la transposée de \(X\) : \(X^\top\) ;
\item
  Calculez le produit matriciel : \(X^\top X\) ;
\item
  Calculez l'inverse de ce produit matriciel : \((X^\top X)^{-1}\) ;
\item
  Calculez le produit matriciel \(X^\top y\);
\item
  Donnez les estimations des paramètres : \((X^\top X)^{-1} X^\top y\).
\end{enumerate}

\end{greenbox}

\hypertarget{listes}{%
\section{Listes}\label{listes}}

Tandis que les éléments d'un vecteur ou d'une matrice doivent nécessairement être de même type, les listes proposent une structure de données moins rigide à cet égard. Les types des élément d'une liste en R peuvent être différents.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_1 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{12}\NormalTok{,}\DecValTok{15}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\StringTok{"Janvier"}\NormalTok{, }\StringTok{"Fevrier"}\NormalTok{))}
\NormalTok{l\_1}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [[1]]
## [1] 10 12 15
## 
## [[2]]
## [1] "Janvier" "Fevrier"
\end{lstlisting}

Les classes d'objets à l'intérieur d'une liste ne sont pas non plus nécessairement identiques. Dans l'exemple qui suit, la liste \texttt{l\_2} contient un vecteur de numériques en premier élément, et une matrice de numériques en second :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_2 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{), }\FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{), }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{))}
\NormalTok{l\_2}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [[1]]
## [1] 1 2 3
## 
## [[2]]
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
\end{lstlisting}

Les éléments peuvent être, comme dans un vecteur, nommés. Les noms peuvent être indiqués au moment de la création\ldots{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_1 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{notes =} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{12}\NormalTok{,}\DecValTok{5}\NormalTok{), }\AttributeTok{mois =} \FunctionTok{c}\NormalTok{(}\StringTok{"Janvier"}\NormalTok{, }\StringTok{"Fevrier"}\NormalTok{))}
\NormalTok{l\_1}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $notes
## [1] 10 12  5
## 
## $mois
## [1] "Janvier" "Fevrier"
\end{lstlisting}

\ldots{} ou une fois la liste créée, à l'aide de la fonction \VERB|\FunctionTok{names}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_1 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{12}\NormalTok{,}\DecValTok{5}\NormalTok{),  }\FunctionTok{c}\NormalTok{(}\StringTok{"Janvier"}\NormalTok{, }\StringTok{"Fevrier"}\NormalTok{))}
\FunctionTok{names}\NormalTok{(l\_1) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"notes"}\NormalTok{, }\StringTok{"mois"}\NormalTok{)}
\NormalTok{l\_1}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $notes
## [1] 10 12  5
## 
## $mois
## [1] "Janvier" "Fevrier"
\end{lstlisting}

\hypertarget{accuxe8s-aux-uxe9luxe9ments}{%
\subsection{Accès aux éléments}\label{accuxe8s-aux-uxe9luxe9ments}}

Comme pour les vecteurs, il est possible d'utiliser les crochets pour extraire des éléments d'une liste. \textbf{La fonction crochet appliquée à une liste retourne une liste}. On donne en arguments de cette fonction, comme pour les vecteurs, soit des positions, soit des noms, soit des valeurs logiques.

Créons une liste contenant 4 éléments :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{nombres =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{alphabet\_min =}\NormalTok{ letters,}
            \AttributeTok{alphabet\_maj =}\NormalTok{ LETTERS, }\AttributeTok{mois =}\NormalTok{ month.name)}
\NormalTok{l\_3}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $nombres
## [1] 1 2 3 4 5
## 
## $alphabet_min
##  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s"
## [20] "t" "u" "v" "w" "x" "y" "z"
## 
## $alphabet_maj
##  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N" "O" "P" "Q" "R" "S"
## [20] "T" "U" "V" "W" "X" "Y" "Z"
## 
## $mois
##  [1] "January"   "February"  "March"     "April"     "May"       "June"     
##  [7] "July"      "August"    "September" "October"   "November"  "December"
\end{lstlisting}

\begin{notebox}

\textbf{Note}

Il existe 5 constantes intégrées en R :

\begin{itemize}
\tightlist
\item
  \texttt{LETTERS} : les 26 lettres de l'alphabet occidental, en majuscules ;
\item
  \texttt{letters} : les 26 lettres de l'alphabet occidental, en minuscules ;
\item
  \texttt{month} : les noms des 12 mois de l'année du calendrier grégorien ;
\item
  \texttt{month.abb} : les abbréviations en 3 lettres des 12 mois du calendrier grégorien ;
\item
  \texttt{pi} : le ratio de la circonférence d'un cercle sur son diamiètre (\(pi\)).
\end{itemize}

\end{notebox}

L'indexation par position fonctionne comme pour un vecteur :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $nombres
## [1] 1 2 3 4 5
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $nombres
## [1] 1 2 3 4 5
## 
## $alphabet_maj
##  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N" "O" "P" "Q" "R" "S"
## [20] "T" "U" "V" "W" "X" "Y" "Z"
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3[}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $nombres
## [1] 1 2 3 4 5
## 
## $mois
##  [1] "January"   "February"  "March"     "April"     "May"       "June"     
##  [7] "July"      "August"    "September" "October"   "November"  "December"
\end{lstlisting}

L'indexation par nom fonctionne aussi comme pour les vecteurs :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3[}\FunctionTok{c}\NormalTok{(}\StringTok{"mois"}\NormalTok{, }\StringTok{"nombres"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $mois
##  [1] "January"   "February"  "March"     "April"     "May"       "June"     
##  [7] "July"      "August"    "September" "October"   "November"  "December" 
## 
## $nombres
## [1] 1 2 3 4 5
\end{lstlisting}

Il en est de même pour l'indexation par condition :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3[}\FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $nombres
## [1] 1 2 3 4 5
## 
## $mois
##  [1] "January"   "February"  "March"     "April"     "May"       "June"     
##  [7] "July"      "August"    "September" "October"   "November"  "December"
\end{lstlisting}

\begin{notebox}
\textbf{Note}

Nous verrons lors de la séance de travaux dirigés sur les boucles comment parcourir les éléments d'une liste tout en appliquant un test logique à chaque élément.

\end{notebox}

On note bien que le résultat retourné est une liste :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(l\_3[}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "list"
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(l\_3[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "list"
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(l\_3[}\StringTok{"nombres"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "list"
\end{lstlisting}

Si l'on souhaite accéder au \textbf{contenu} d'un élément particulier, il faut utiliser la fonction double crochets (\VERB|\StringTok{"[["}\NormalTok{()}|). De manière analogue à la fonction crochets (\VERB|\StringTok{"["}\NormalTok{()}|), une syntaxe allégée est proposée.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3[[}\DecValTok{1}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1 2 3 4 5
\end{lstlisting}

Le résultat retourné est bien le contenu, ici un vecteur d'entiers :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(l\_3[[}\DecValTok{1}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "integer"
\end{lstlisting}

La fonction \VERB|\FunctionTok{str}\NormalTok{()}|, qui affiche la structure d'un objet de manière compacte, permet de mieux se fixer les idées :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(l\_3[}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## List of 1
##  $ nombres: int [1:5] 1 2 3 4 5
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(l\_3[[}\DecValTok{1}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##  int [1:5] 1 2 3 4 5
\end{lstlisting}

\begin{notebox}

\textbf{Note}

Lorsque les éléments de la liste son nommés et que l'on désire extraire le contenu d'un seul élément, il est possible d'utiliser le dollar en lieu et place des crochets, en indiquant le nom de l'élément.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3}\SpecialCharTok{$}\NormalTok{nombres}
\end{Highlighting}
\end{Shaded}

\end{notebox}

Créons une liste comprenant trois éléments, dont le 3e est une liste de deux éléments :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_4 }\OtherTok{\textless{}{-}} 
  \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{),}
     \FunctionTok{c}\NormalTok{(}\StringTok{"Bonjour"}\NormalTok{, }\StringTok{"Hello"}\NormalTok{),}
     \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{), month.name))}
\NormalTok{l\_4}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [[1]]
## [1] 1 2 3
## 
## [[2]]
## [1] "Bonjour" "Hello"  
## 
## [[3]]
## [[3]][[1]]
## [1] 1 2 3
## 
## [[3]][[2]]
##  [1] "January"   "February"  "March"     "April"     "May"       "June"     
##  [7] "July"      "August"    "September" "October"   "November"  "December"
\end{lstlisting}

Si on souhaite extraire le premier élément du troisième élément de \texttt{l\_4}, on utilise dans un premier temps les doubles crochets (pour extraire le contenu du 3e élément de \texttt{l\_4}), puis on utilise la fonction crochet sur le résultat (pour extraire le premier élément). Il s'agit d'une composition de fonctions, et la fonction appliquée en dernier étant la fonction crochet, le résultat est\ldots{} une liste !

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_4[[}\DecValTok{3}\NormalTok{]][}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [[1]]
## [1] 1 2 3
\end{lstlisting}

Si l'on souhaite extraire le \textbf{contenu} du 1er élément du 3e élément de \texttt{l\_4}, on utilisera deux fois la fonction double crochets : la première pour extraire le contenu du 3e élément (on récupère l'objet en 3e position, qui est une liste) puis la seconde pour extraire le contenu du premier élément de ce que l'on vient d'extraire :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_4[[}\DecValTok{3}\NormalTok{]][[}\DecValTok{1}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1 2 3
\end{lstlisting}

\hypertarget{remplacement-et-ajout-duxe9luxe9ments}{%
\subsection{Remplacement et ajout d'éléments}\label{remplacement-et-ajout-duxe9luxe9ments}}

Pour remplacer un élément dans une liste, comme pour un vecteur ou une matrice, on utilise une nouvelle affectation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3[[}\StringTok{"nombres"}\NormalTok{]] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{)}
\NormalTok{l\_3}\SpecialCharTok{$}\NormalTok{mois }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"January"}\NormalTok{, }\StringTok{"February"}\NormalTok{)}
\NormalTok{l\_3}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $nombres
## [1] 6 5 4 3 2 1 0
## 
## $alphabet_min
##  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s"
## [20] "t" "u" "v" "w" "x" "y" "z"
## 
## $alphabet_maj
##  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N" "O" "P" "Q" "R" "S"
## [20] "T" "U" "V" "W" "X" "Y" "Z"
## 
## $mois
## [1] "January"  "February"
\end{lstlisting}

Pour ajouter un élément, on effectue simplement une affectation. Soit on nomme le nouvel élément :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3[}\StringTok{"autres\_nombres"}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{l\_3}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $nombres
## [1] 6 5 4 3 2 1 0
## 
## $alphabet_min
##  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s"
## [20] "t" "u" "v" "w" "x" "y" "z"
## 
## $alphabet_maj
##  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N" "O" "P" "Q" "R" "S"
## [20] "T" "U" "V" "W" "X" "Y" "Z"
## 
## $mois
## [1] "January"  "February"
## 
## $autres_nombres
## [1] 1
\end{lstlisting}

Si l'élément n'as pas vocation à être nommé, on utilise la fonction \VERB|\FunctionTok{c}\NormalTok{()}| et on place le nouvel élément au sein d'une liste :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{l\_3 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(l\_3, }\FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{)))}
\NormalTok{l\_3}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $nombres
## [1] 6 5 4 3 2 1 0
## 
## $alphabet_min
##  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s"
## [20] "t" "u" "v" "w" "x" "y" "z"
## 
## $alphabet_maj
##  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N" "O" "P" "Q" "R" "S"
## [20] "T" "U" "V" "W" "X" "Y" "Z"
## 
## $mois
## [1] "January"  "February"
## 
## $autres_nombres
## [1] 1
## 
## [[6]]
## [1] 4 5 6
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Extrayez le 3e élément de la liste suivante :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ma\_liste }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{), LETTERS[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{26}\NormalTok{], month.abb)}
\end{Highlighting}
\end{Shaded}
\item
  Extrayez tous les éléments de la liste \texttt{ma\_liste} sauf le second.
\item
  Extrayez le contenu du troisième élément de la liste \VERB|\NormalTok{ma\_liste\_2}|, en utilisant le nom de l'élément.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ma\_liste\_2 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{nombre =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{),}
             \AttributeTok{lettre =}\NormalTok{ LETTERS[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{26}\NormalTok{], }\AttributeTok{mois =}\NormalTok{ month.abb)}
\end{Highlighting}
\end{Shaded}
\item
  Toujours en accédant par le nom, ajoutez \VERB|\DecValTok{10}| à chacune des valeurs du premier élément de \texttt{ma\_liste\_2}. Le résultat doit altérer \texttt{ma\_liste\_2}.
\item
  Ajouter un élément au vecteur de nombres de l'élément \texttt{nombre} de la liste \texttt{ma\_liste\_2}. Cet élément doit être le numérique \VERB|\SpecialCharTok{{-}}\DecValTok{10}|.
\end{enumerate}

\end{greenbox}

\hypertarget{importation-et-exportation-de-donnuxe9e}{%
\chapter{Importation et exportation de donnée}\label{importation-et-exportation-de-donnuxe9e}}

\begin{orangebox}
Ce chapitre s'appuie sur \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#importation-exportation-et-cr\%C3\%A9ation-de-donn\%C3\%A9es}{la Section 2.3 Importation, exportation et création de données} des notes de cours.

\end{orangebox}

\hypertarget{chargement-de-donnuxe9es-chemins}{%
\section{Chargement de données : chemins}\label{chargement-de-donnuxe9es-chemins}}

Lorsque l'on souhaite accéder à des données avec Excel, il suffit de double cliquer sur le fichier dans l'explorateur de fichiers pour que le logiciel se lance et que le tableur nous révèle son contenu. Avec R, il est nécessaire de payer un petit coût d'entrée pour pouvoir charger les données. Mais une fois ce coût payé, il nous est possible de réaliser des opérations avancées en fournissant des efforts moindres. Par ailleurs, le traitement des gros volumes de données est facilité avec R, comparativement à Excel.

Dans cet exercice, vous allez apprendre à importer des données dans R. Cela nécessite au préalable d'avoir connaissance de l'environnement de travail (en anglais, \emph{working directory}). Lorsqu'on lance RStudio en double cliquant sur un fichier de projet (dont l'extension est \texttt{.Rproj}), comme ce que l'on a fait jusqu'à présent, l'environnement de travail de R est le répertoire dans lequel se situe le fichier \texttt{.Rproj}. Aussi, lorsque nous donnons comme instruction à R d'importer ou d'exporter des informations, R se réfère à ce répertoire comme point d'ancrage, comme répertoire courant.

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  En choisissant l'option ``Enregistrer le fichier'' (**et non pas en choisissant ``Ouvrir avec''), téléchargez l'archive \texttt{exercice\_importation.zip} à l'adresse suivante : \url{https://egallic.fr/Enseignement/R/Exercices/exercice_importation.zip}.
\end{enumerate}

\end{greenbox}

Par défaut, sur les ordinateurs de l'Université, les fichiers téléchargés sont enregistrés dans le dossier \texttt{Téléchargement}. Pour être plus précis, les fichiers téléchargés sont enregistrés sur le disque dur nommé \texttt{C:}, dans un répertoire nommé \texttt{Downloads} qui se situe lui-même dans un répertoire nommé selon votre numéro d'étudiant, situé lui-même dans un répertoire nommé \texttt{Users}. Pour accéder à une ressource, le système d'exploitation utilise des chemins d'accès, qui sont constitués à l'aide des noms de répertoires séparés par des barres obliques inverse sous Windows (\texttt{\textbackslash{}}) (et des barres obliques \texttt{/} sous Unix) et qui se terminent soit par un nom de répertoire, soit par un nom de fichier. Le chemin qui permet de localiser le répertoire de téléchargement sur la machine de l'Université s'écrit ainsi : \texttt{C:\textbackslash{}Users\textbackslash{}votre\_numero\_etudiant\textbackslash{}Downloads}, tandis que le chemin qui permet de localiser le fichier que vous venez de télécharger s'écrit \texttt{C:\textbackslash{}Users\textbackslash{}votre\_numero\_etudiant\textbackslash{}Downloads\textbackslash{}exercice\_importation.zip}.

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Ouvrez l'explorateur de fichiers et déplacez vous dans le dossier de téléchargement.
\item
  Faites un clic droit sur le fichier \texttt{exercice\_importation.zip}, et dans le menu contextuel qui s'affiche, choisissez l'option \texttt{7-Zip}, puis \texttt{Extraire\ vers\ exercice\_importation}. Un répertoire nommé \texttt{exercice\_importation} a alors été extrait.
\end{enumerate}

\end{greenbox}

\begin{notebox}
\textbf{Note}

Dans votre répetoire \texttt{Téléchargement} vous pouvez à présent voir deux ressources portant le nom \texttt{exercice\_importation}. Si vous faites bien attention, l'icône de ces ressources diffère : l'une représente un porte document jaune ouvert (et désigne le répertoire que vous venez d'extraire de l'archive), tandis que l'autre présente un porte document jaune fermé et muni d'une fermeture éclair (un \emph{zip}).

Afin d'éviter de confondre les deux, un moyen simple consiste à afficher l'extension des fichiers. Il sera alors aisé de reconnaître les fichiers des répertoires : les dossiers n'auront pas d'extention. Pour afficher les extensions :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Dans l'explorateur de fichiers, atteignez l'onglet \texttt{Affichage} ;
\item
  Cliquez sur le bouton \texttt{Afficher/Masquer} ;
\item
  Cochez la case \texttt{Extensions\ de\ noms\ de\ fichiers}.
\end{enumerate}

À présent, vous pourrez bien voir la différence entre le répertoire \texttt{exercice\_importation} et le fichier ZIP \texttt{exercice\_importation.zip} (l'archive).

\end{notebox}

La hiérarchie du répertoire \texttt{exercice\_importation} que vous venez d'extraire peut être représentée à l'aide d'un arbre (on parle d'arborescence).

\begin{lstlisting}
exercice_importation
├── Dossier_C
│   └── fichier_donnees_C.csv
├── Dossier_D
│   └── Dossier_D_1
|   |   └── fichier_donnees_D_1.csv
├── Exercice
|   └── Dossier_A
|   |   └── Dossier_A_1
|   |   |   └── fichier_donnees_A_1.csv
|   |   └── Dossier_A_2
|   |   |   └── fichier_donnees_A_2.csv
|   |   └── fichier_donnees_A.csv
|   └── Dossier_B
|   |   └── fichier_donnees_B.csv
|   └── fichier_donnees.csv
|   └── L3_info.Rproj
\end{lstlisting}

\begin{redbox}
\textbf{Mise en garde}

Faites attention lorsque vous ouvrez des fichiers CSV avec Excel. Dès lors que vous enregistrerez des modifications, Excel ajoutera des informations dans le fichier. Ces ajouts peuvent rendre vos fichiers illisibles par d'autres logiciels ensuite.

\end{redbox}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Depuis l'explorateur de fichiers, descendez dans le répertoire \texttt{exercice\_importation}, puis dans \texttt{Exercice} et ouvrez le fichier \texttt{L3\_info.Rproj} en double cliquant dessus.
\end{enumerate}

En ayant ouvert le fichier \texttt{L3\_info.Rproj}, RStudio s'est lancé, en définissant le répertoire \texttt{Exercice} comme répertoire de travail.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Dans la console R de RStudio, évaluez l'instruction suivante : \texttt{getwd()} et observez le chemin retourné.
\item
  Créez un nouveau script R.
\end{enumerate}

\end{greenbox}

Le répertoire courant est donc \texttt{Exercice}. Lorsque nous allons charger ou exporter dans ou depuis R des données, nous pourrons créer des chemins relatifs à ce répertoire courant. Il convient ainsi de noter la distinction entre chemin absolu et chemin relatif:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Chemin absolu} : le chemin absolu décrit l'accès à une ressource sans se référer au chemin courant, mais en se rapportant à la place à la racine du disque ou du serveur.
\end{enumerate}

\begin{itemize}
\tightlist
\item
  exemple : le chemin absolu vers le fichier \texttt{fichier\_donnees.csv} sur \textbf{windows} sera : \texttt{C:\textbackslash{}Users\textbackslash{}votre\_numero\_etudiant\textbackslash{}Downloads\textbackslash{}exercice\_importation\textbackslash{}Exercice\textbackslash{}fichier\_donnees.csv}
\item
  Note : sous Unix, la racine du système de fichiers se note simplement \texttt{/}. Le lien absolu vers le fichier ressemblera à celui-ci : \texttt{/home/votre\_nom\_user/Downloads/fichier\_donnees.csv}.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  \textbf{Chemin relatif} : le chemin relatif décrit quant à lui l'accès à une ressource en se rapportant au répertoire courant.
\end{enumerate}

\begin{itemize}
\tightlist
\item
  le répertoire courant étant \texttt{Exercice}, pour accéder au fichier csv, le chemin est le suivant, sous \textbf{windows} : \texttt{fichier\_donnees.csv} (on peut aussi écrire \texttt{.\textbackslash{}fichier\_donnees.csv}, où \texttt{.} se réfère au \textbf{répertoire courant})
\item
  sous Unix : \texttt{fichier\_donnees.csv} ou \texttt{./fichier\_donnees.csv}.
\end{itemize}

\begin{notebox}
\textbf{Note}

La barre oblique \texttt{/} (inversée \texttt{\textbackslash{}} sous Windows) est le séparateur de chemin.

\end{notebox}

Nous allons à présent importer dans R le contenu du fichier \texttt{fichier\_donnees.csv}. Ce fichier contient une première ligne définissant les en-têtes, et une seconde ligne contenant une observation. Dans le fichier, les différents champs sont séparés par un point-virgule (\texttt{;}).

Pour importer le contenu de ce fichier CSV dans R, nous allons nous appuyer sur la fonction \VERB|\FunctionTok{read\_csv2}\NormalTok{()}| du \emph{package} \{readr\}. Nous allons indiquer le chemin vers le fichier à l'argument \texttt{file} de cette fonction. Le tableau de données sera stocké dans un objet que nous allons appeler \texttt{df\_exercice} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_exercice }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv2}\NormalTok{(}\AttributeTok{file =} \StringTok{"fichier\_donnees.csv"}\NormalTok{)}
\NormalTok{df\_exercice}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 1 x 2
##   Dossier          Valeur
##   <chr>            <chr> 
## 1 Dossier_Exercice Bravo
\end{lstlisting}

L'importation a bien fonctionné, R nous prévient avoir deviné que les valeurs dans les colonnes \texttt{Dossier} et \texttt{Valeur} sont des chaînes de caractères (la fonction \VERB|\FunctionTok{col\_character}\NormalTok{()}| a été utilisée pour ces deux colonnes).

Nous pouvons obtenir le même résultat en écrivant le chemin absolu vers le fichier :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"C:/Users/votre\_numero\_etudiant/Downloads/"}\NormalTok{,}
               \StringTok{"exercice\_importation/Exercice/fichier\_donnees.csv"}\NormalTok{)}
\FunctionTok{read\_csv2}\NormalTok{(}\AttributeTok{file =}\NormalTok{ path)}
\end{Highlighting}
\end{Shaded}

\begin{greenbox}
\textbf{Note} : le chemin étant trop long pour tenir sur une page PDF, la fonction \VERB|\NormalTok{paste0}| a été utilisée ici pour concaténer deux chaînes de caractères en une seule. Sur votre machine, vous pouvez écrire le chemin complet sans passer par l'utilisation de la fonction \VERB|\NormalTok{paste0}|.

\end{greenbox}

Nous verrons plus loin que l'utilisation des chemins absolus dans les scripts posent des soucis lorsque l'on change d'ordinateur ou que l'on partage son code avec d'autres personnes.

Le fichier \texttt{fichier\_donnees\_A.csv} n'est pas situé dans le répertoire courant : il se situe dans le répertoire \texttt{Dossier\_A}, contenu dans le répertoire courant (\texttt{Exercice}). Pour pouvoir charger le contenu de ce fichier dans R avec un lien relatif, il faut constuire le chemin en indiquant que l'on souhaite descendre dans le répertoire \texttt{Dossier\_A} dans un premier temps :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_exercice\_A }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv2}\NormalTok{(}\AttributeTok{file =} \StringTok{"Dossier\_A/fichier\_donnees\_A.csv"}\NormalTok{)}
\NormalTok{df\_exercice\_A}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 1 x 2
##   Dossier   Valeur
##   <chr>     <chr> 
## 1 Dossier_A Bravo
\end{lstlisting}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Dans un objet que vous nommerez \texttt{df\_exercice\_A\_1}, chargez dans R le contenu du fichier \texttt{fichier\_donnees\_A\_1.csv}.
\item
  Dans un objet que vous nommerez \texttt{df\_exercice\_A\_2}, chargez dans R le contenu du fichier \texttt{fichier\_donnees\_A\_2.csv}.
\item
  Dans un objet que vous nommerez \texttt{df\_exercice\_B}, chargez dans R le contenu du fichier \texttt{fichier\_donnees\_B.csv}.
\end{enumerate}

\end{greenbox}

Si la ressource que l'on souhaite atteindre nécessite de remonter dans un répertoire parent (un répertoire qui contient un autre est appelé ``répertoire parent''), il suffit d'utiliser sa désignation : \texttt{..}. Par exemple, pour accéder au fichier \texttt{fichier\_donnees\_C.csv}, qui se trouve dans le répertoire \texttt{Dossier\_C} contenu dans le répertoire \texttt{exercice\_importation} (qui contient le répertoire \texttt{Exercice} et est donc le répertoire parent de \texttt{Exercice}), on peut écrire :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_exercice\_C }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv2}\NormalTok{(}\AttributeTok{file =} \StringTok{"../Dossier\_C/fichier\_donnees\_C.csv"}\NormalTok{)}
\NormalTok{df\_exercice\_C}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 1 x 2
##   Dossier   Valeur
##   <chr>     <chr> 
## 1 Dossier_C Bravo
\end{lstlisting}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{9}
\tightlist
\item
  Dans un objet que vous nommerez \texttt{df\_exercice\_D}, chargez dans R le contenu du fichier \texttt{fichier\_donnees\_D\_1.csv}.
\item
  Enregistrez votre script dans le répertoire \texttt{Exercice} (en le nommant par exemple \texttt{importer\_donnees.R}) et fermez RStudio.
\end{enumerate}

\end{greenbox}

\hypertarget{avantages-de-lutilisation-de-chemins-relatifs}{%
\subsection{Avantages de l'utilisation de chemins relatifs}\label{avantages-de-lutilisation-de-chemins-relatifs}}

Pour finir cette section, nous allons illustrer le grand avantage que confère l'emploi de chemins relatifs.

\textbf{Mise en situation} : admettons que vous souhaitez partager votre projet R avec une autre personne. Une manière simple de le faire consiste à créer une archive de l'ensemble de votre projet, pour fournir à la fois les scripts et les données.

Le répertoire \texttt{exercice\_importation} se situe depuis le début de ce chapitre dans votre dossier de téléchargement. Dans l'explorateur de fichiers, allez dans le répertoire de téléchargements et créez une archive du répertoire \texttt{exercice\_importation} :

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{11}
\tightlist
\item
  clic droit sur le répertoire \texttt{exercice\_importation} ;
\item
  dans le menu contextuel qui s'affiche, cliquez sur \texttt{7-Zip}, puis sur \texttt{Ajouter\ à\ "exercice\_importation.zip"} ;
\item
  dans votre répetoire du cours d'informatique (dans vos documents), créez un répertoire intitulé \texttt{TD\_4} ;
\item
  dans le répetoire \texttt{TD\_4}, collez l'archive \texttt{exercice\_importation.zip} que vous venez de créer ;
\item
  dans le répertoire de \textbf{téléchargement}, \textbf{supprimez} le répertoire \texttt{exercice\_importation}.
\item
  dans le répetoire \texttt{TD\_4}, extrayez le contenu de l'archive (clic droit, \texttt{7-Zip\ \textgreater{}\ Extraire\ vers\ "exercice\_importation\textbackslash{}"}).
\item
  descendez dans le répertoire \texttt{exercice\_importation} qui vient d'être extrait, puis dans \texttt{Exercice} ;
\item
  Lancez le fichier \texttt{L3\_info.Rproj} ;
\item
  Dans la session RStudio qui vient de se lancer, ouvrez le script \texttt{importer\_donnees.R} que vous avez créé précédemment.
\end{enumerate}

\end{greenbox}

Si vous avez écrit les chemins vers les fichiers en utilisant des chemins absolus, vous serez obligé de les modifier un à un\ldots{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{path }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"C:/Users/votre\_numero\_etudiant/Downloads/"}\NormalTok{,}
               \StringTok{"exercice\_importation/Exercice/fichier\_donnees.csv"}\NormalTok{)}
\FunctionTok{read\_csv2}\NormalTok{(}\AttributeTok{file =}\NormalTok{ path)}
\end{Highlighting}
\end{Shaded}

Cette instruction qui permettait de charger le fichier \texttt{fichier\_donnees.csv} ne fonctionne plus. R retourne un message d'erreur indiquant ``\emph{No such file or directory}'' (un tel fichier ou répertoire n'existe pas).

Si vous avez employé des chemins relatifs, vous n'aurez rien à modifier.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_csv2}\NormalTok{(}\AttributeTok{file =} \StringTok{"./fichier\_donnees.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{chargement-de-formats-diffuxe9rents}{%
\section{Chargement de formats différents}\label{chargement-de-formats-diffuxe9rents}}

\begin{orangebox}
Cet exercice s'appuie sur la section \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#importation-exportation-et-cr\%C3\%A9ation-de-donn\%C3\%A9es}{2.3 Importation, exportation et création de données} des notes de cours.

\end{orangebox}

Dans cet exercice, vous allez apprendre à importer des données dans R lorsqu'elles proviennent de différents types de fichiers. Au programme :

\begin{itemize}
\tightlist
\item
  des fichiers texte (plus particulièrement, CSV :\emph{comma separated values}, et TSV, \emph{tab-separated values}) ;
\item
  des fichiers Excel ;
\item
  des fichiers de données R.
\end{itemize}

\hypertarget{fichiers-texte}{%
\subsection{Fichiers texte}\label{fichiers-texte}}

Dans un premier temps, concentrons-nous sur les fichiers texte contenant des données tabulaires. Chaque ligne de ces fichiers correspond à une ligne d'un tableau, et un caractère spécifique appelé le séparateur de champ permet de séparer les colonnes. À la fin de chaque ligne, un caractère (non visible) permet de passer à la ligne suivante (fin de ligne ou \emph{line break}). Parfois, les champs sont également placés entre double quotes (\texttt{"valeur"}).

Un format très répandu de ce type de fichiers s'appelle CSV, ou \emph{comma separated values} : la virgule sépare les champs. Souvent, la première ligne sert à nommer les colonnes. Voici un exemple :

\begin{lstlisting}
"nom","prenom","id","profile","matiere","note"
"Amsberry","Evan",1,1,"Microéconomie 1",11.5
"Basurto","Anthony",2,2,"Microéconomie 1",9
"Begaye","Kai",3,3,"Microéconomie 1",16.5
\end{lstlisting}

Dans certaines administrations françaises, les données au format CSV sont fournies avec une variante dans laquelle le séparateur de champ est le point-virgule plutôt que la virgule, cette dernière étant utilisée comme séparateur décimal.

\begin{lstlisting}
"nom";"prenom";"id";"profile";"matiere";"note"
"Amsberry";"Evan";1;1;"Mathématiques 1";5
"Basurto";"Anthony";2;2;"Mathématiques 1";6
"Begaye";"Kai";3;3;"Mathématiques 1";18
\end{lstlisting}

Face à la possibilité d'utiliser différents caractères pour séparer les champs ainsi que pour séparer la partie entière de la partie décimale des nombres, R propose tout un attirail de fonctions. Nous allons en utiliser une qui permet d'être polyvalent : \VERB|\FunctionTok{read\_delim}\NormalTok{()}|. Cette fonction est proposée dans le \emph{package} \{readr\}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}
\end{Highlighting}
\end{Shaded}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Affichez la page d'aide de la fonction \texttt{read\_delim}.
\item
  Lisez les descriptions des arguments suivants : \texttt{file}, \texttt{delim}, \texttt{col\_names}, \texttt{skip}, \texttt{n\_max}.
\end{enumerate}

\end{greenbox}

Vous allez devoir charger dans R 4 fichiers texte contenant des notes d'étudiants, selon les matières qu'ils et elles ont suivies. Pour les besoins de l'exercice, les séparateurs de champs et les séparateurs décimaux varient d'un fichier à l'autre. Le tableau ~\ref{tab:caracteristiques-fichiers-importation} reporte les valeurs utilisées.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}@{}}
\caption{\label{tab:caracteristiques-fichiers-importation} Caractéristiques des fichiers texte avec séparateur de champ}\tabularnewline
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
Nom de fichier
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Séparateur de champs
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Séparateur décimal
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
En-têtes
\end{minipage} \\
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
Nom de fichier
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Séparateur de champs
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Séparateur décimal
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
En-têtes
\end{minipage} \\
\midrule
\endhead
\texttt{Microeconomie\_1.csv} & Virgule (\texttt{,}) & Point (\texttt{.}) & Oui \\
\texttt{Macroeconomie\_1.csv} & Virgule (\texttt{,}) & Point (\texttt{.}) & Non \\
\texttt{Mathematiques\_1.csv} & Point-virgule (\texttt{;}) & Virgule (\texttt{,}) & Oui \\
\texttt{Informatique\_1.tsv} & Taquet de tabulation (\texttt{\textbackslash{}t}) & Point (\texttt{.}) & Oui \\
\bottomrule
\end{longtable}

Ces fichiers sont disponibles dans une archive disponible à l'adresse suivante : \url{https://egallic.fr/Enseignement/R/Exercices/importation_formats.zip}.

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Téléchargez l'archive, extrayez son contenu, puis déplacez le répertoire \texttt{importation\_formats} qui vient d'être extrait dans votre répertoire \texttt{TD\_4} créé lors du précédent exercice.
\item
  En utilisant la fonction \texttt{read\_delim()}, chargez le contenu du fichier \texttt{Microeconomie\_1.csv} dans R. Ce fichier est situé dans le répertoire \texttt{L1}. Vous prendrez soin de stocker le tableau qui sera importé dans un objet que vous nommerez \texttt{microeconomie\_1}.
\item
  En utilisant la fonction \texttt{read\_delim()}, chargez le contenu du fichier \texttt{Macroeconomie\_1.csv} dans R. Vous prendrez soin de stocker le tableau qui sera importé dans un objet que vous nommerez \texttt{macroeconomie\_1}.
\end{enumerate}

\end{greenbox}

Lorsque le séparateur décimal n'est pas le point, il est nécessaire de renseigner à l'argument \texttt{locale} la valeur \texttt{locale(decimal\_mark\ =\ ",")}.

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  En utilisant la fonction \texttt{read\_delim()}, chargez le contenu du fichier \texttt{Mathematiques\_1.csv} dans R. Vous prendrez soin de stocker le tableau qui sera importé dans un objet que vous nommerez \texttt{mathematiques\_1}. Attention, vérifiez bien les valeurs des notes.
\item
  En utilisant la fonction \texttt{read\_delim()}, chargez le contenu du fichier \texttt{Informatique\_1.tsv} dans R. Vous prendrez soin de stocker le tableau qui sera importé dans un objet que vous nommerez \texttt{informatique\_1}.
\end{enumerate}

\end{greenbox}

\begin{notebox}
Le \emph{package} \{readr\} propose également les fonctions \VERB|\FunctionTok{read\_csv}\NormalTok{()}| et \texttt{read\_csv2()} qui sont spécifiquement créées pour des fichiers \texttt{texte/csv} répondant exactement au standard anglo-saxon (virgule en séparateur de champs, point en séparateur décimal) et français (point-virgule en séparateur de champs, virgule en séparateur décimal).

\end{notebox}

\hypertarget{fichier-excel}{%
\subsection{Fichier Excel}\label{fichier-excel}}

L'archive \texttt{importation\_formats.zip} contient dans le répertoire \texttt{L1}, un fichier Excel intitulé \texttt{notes\_L1.xlsx}.

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Ouvrez ce fichier avec Excel, pour observer sa structure : le classeur est composé de 8 feuilles, une feuille par matière. Dans chaque feuille, les notes obtenues par les étudiants dans la matière correspondante sont reportées. La première ligne indique systématiquement les noms de clonnes.
\end{enumerate}

\end{greenbox}

Pour importer le contenu de fichiers Excel dans R, il existe plusieurs \emph{packages}. Nous allons utiliser \{readxl\}.

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{8}
\tightlist
\item
  Après avoir chargé le \emph{package} \{readxl\}, affichez la page d'aide de la fonction \VERB|\NormalTok{read\_excel}|. Lisez les descriptions des arguments suivants : \texttt{path}, \texttt{sheet}, \texttt{col\_names}, \texttt{na}, \texttt{skip}, \texttt{n\_max}.
\item
  En utilisant le numéro d'index de la feuille \texttt{info} (il s'agit de la 4e feuille), chargez son contenu, à l'aide de la fonction \VERB|\NormalTok{read\_excel}| dans un objet que vous nommerez \texttt{info}.
\item
  En utilisant le nom de la feuille \texttt{stats}, chargez son contenu, à l'aide de la fonction \VERB|\NormalTok{read\_excel}| dans un objet que vous nommerez \texttt{stats}.
\end{enumerate}

\end{greenbox}

\hypertarget{fichiers-r}{%
\subsection{Fichiers R}\label{fichiers-r}}

Il existe deux formats de fichier de données R : les fichiers \texttt{.RDS} et \texttt{.RData}. Les premiers contiennent un seul objet, tandis que les seconds peuvent en contenir plusieurs.

Dans le dossier \texttt{L1} de l'archive \texttt{importation\_formats.zip} que dont vous avez extrait le contenu se trouve deux fichiers de données R :

\begin{itemize}
\tightlist
\item
  \texttt{anglais.RDS} : tableau de données contenant les notes d'anglais` ;
\item
  \texttt{notes.RData} : 8 tableaux de données (\texttt{micro}, \texttt{macro}, \texttt{maths}, \texttt{info}, \texttt{stats}, \texttt{anglais}, \texttt{eco\_envir}, et \texttt{finance}).
\end{itemize}

Pour importer un fichier \texttt{.RDS}, on utilise la fonction \VERB|\FunctionTok{readRDS}\NormalTok{()}|. De la même manière que pour \VERB|\FunctionTok{read\_delim}\NormalTok{()}|, il est nécessaire de stocker le résultat dans un objet.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_anglais }\OtherTok{\textless{}{-}} \FunctionTok{readRDS}\NormalTok{(}\AttributeTok{file =} \StringTok{"importation\_formats/L1/anglais.RDS"}\NormalTok{)}
\NormalTok{notes\_anglais}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 32 x 5
##    nom        prenom     id matiere    note
##    <chr>      <chr>   <dbl> <chr>     <dbl>
##  1 Amsberry   Evan        1 Anglais 1   4  
##  2 Basurto    Anthony     2 Anglais 1   5.5
##  3 Begaye     Kai         3 Anglais 1  11  
##  4 Brack      Michael     4 Anglais 1   1.5
##  5 Burgess    Jamie       5 Anglais 1   7  
##  6 Christian  Colton      6 Anglais 1   4  
##  7 Cly        Jesse       7 Anglais 1   5  
##  8 Coberley   Rebecca     8 Anglais 1   6  
##  9 De Venecia Madison     9 Anglais 1   6  
## 10 Gurule     Elliott    12 Anglais 1   6  
## # ... with 22 more rows
\end{lstlisting}

Pour charger les objets d'un fichier \texttt{.RData} dans votre session R, il faut utiliser la fonction \VERB|\FunctionTok{load}\NormalTok{()}|. Attention, si un objet est nommé \texttt{x} dans votre fichier \texttt{.RData} et qu'un objet existant dans votre session R s'appelle également \texttt{x}, ce dernier sera remplacé par l'objet qui vient d'être chargé avec la fonction \VERB|\FunctionTok{load}\NormalTok{()}|.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"importation\_formats/L1/notes.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{exportation}{%
\section{Exportation}\label{exportation}}

\hypertarget{format-texte}{%
\subsection{Format texte}\label{format-texte}}

Pour enregistrer des données depuis un tableau de données, un vecteur ou une matrice, la fonction \VERB|\FunctionTok{write\_delim}\NormalTok{()}| peut être utilisée.

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{11}
\tightlist
\item
  Affichez la page d'aide de la fonction \VERB|\FunctionTok{write\_delim}\NormalTok{()}|, et lisez les descriptions des arguments \texttt{x}, \texttt{file}, \texttt{delim} et \texttt{append}.
\item
  Dans un fichier que vous nommerez \texttt{notes\_finance.csv}, exportez le tableau de données \texttt{finance} (qui a été chargé avec la fonction \VERB|\FunctionTok{load}\NormalTok{()}|) dans le dossier \texttt{L1}.
\end{enumerate}

\end{greenbox}

\hypertarget{format-r}{%
\subsection{Format R}\label{format-r}}

Pour sauvegarder un seul objet, on peut utiliser la fonction \VERB|\FunctionTok{saveRDS}\NormalTok{()}| et exporter les données au format \texttt{.RDS} :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{saveRDS}\NormalTok{(maths, }\AttributeTok{file =} \StringTok{"importation\_formats/L1/maths.RDS"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Pour sauvegarder plusieurs objets, on peut utiliser la fonction \VERB|\FunctionTok{save}\NormalTok{()}|, en indiquant les noms des objets à sauvegarder en argument de la fonction.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{save}\NormalTok{(micro, macro, maths, info, stats, anglais, eco\_envir, finance,}
     \AttributeTok{file =} \StringTok{"importation\_formats/L1/notes\_L1.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{tableaux-de-donnuxe9es}{%
\chapter{Tableaux de données}\label{tableaux-de-donnuxe9es}}

\begin{orangebox}
Ce chapitre s'appuie sur les \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#tableaux-de-donn\%C3\%A9es}{Sections 2.2.2 Tableaux de données} et \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#tableaux_de_donnees}{2.4.6 Tableaux de données} des notes de cours.

\end{orangebox}

Dans les chapitres \protect\hyperlink{matrices-et-listes}{Matrices et listes} et \protect\hyperlink{importation-et-exportation-de-donnuxe9e}{Importation de données}, vous avez appris à manipuler des matrices et à importer des données tabulaires dans R. Dans ce document, vous allez dans un premier temps utliser des techniques similaires à celles permettant de manipuler les matrices pour les appliquer à des tableaux que vous aurez importé depuis un fichier CSV dans R. Ensuite, vous apprendrez d'autres techniques proposées par l'environnement \{tidyverse\} pour manipuler des tableaux de données. Vous serez capable, une fois que vous aurez terminé de parcourir ce document, d'effectuer des opérations basiques de manipulation de tableau pour produire des statistiques descriptives.

\hypertarget{importation-des-donnuxe9es-de-la-suxe9ance}{%
\section{Importation des données de la séance}\label{importation-des-donnuxe9es-de-la-suxe9ance}}

Dans un premier temps, vous allez importer les données de notes des étudiant•es pour l'ensemble des matières, pour la première année (L1) et la deuxième année (L2). Ces données sont disponibles au format CSV, dans l'archive téléchargeable à l'adresse suivante : \url{https://egallic.fr/Enseignement/R/Exercices/exercice_notes.zip}.

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Créez un nouveau projet RStudio dans un dossier que nous intitulerez \texttt{TD\_5}, au sein de votre espace étudiant sur les serveurs de l'Université.
\item
  Dans le répertoire \texttt{TD\_5}, créez trois répertoires : \texttt{Data}, \texttt{Script} et \texttt{Output}.
\item
  Créez un script R que vous appellerez \texttt{notes.R} et enregistrez-le dans le répertoire \texttt{Script}.
\item
  Téléchargez l'archive \texttt{exercice\_notes.zip} en suivant le lien donné plus haut, et extrayez son contenu.
\item
  Placez les deux fichiers CSV (\texttt{notes\_L1.csv} et \texttt{notes\_L2.csv}) et le fichier de données R (\texttt{moyennes.RData}) dans le répertoire \texttt{Data}.
\end{enumerate}

L'arborescence de votre dossier de travaux dirigés pour cette séance doit être comme suit :

\begin{lstlisting}
TD_5
├──  notes.RProj
├── Data
│   └──  notes_L1.csv
│   └──  notes_L2.csv
│   └──  moyennes.RData
├── Script
|   └── notes.R
├── Output
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  À présent, dans R, dans un objet que vous appellerez \texttt{notes\_L1}, importez les données dans un tableau depuis le fichier \texttt{notes\_L1.csv}.
\item
  Dans un objet que vous appellerez \texttt{notes\_L2}, importez les données dans un tableau depuis le fichier \texttt{notes\_L2.csv}.
\end{enumerate}

\end{greenbox}

En appelant les deux tableaux dans la console, vous devez voir les aperçus suivants :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_L1}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 5
##    nom        prenom     id matiere          note
##    <chr>      <chr>   <dbl> <chr>           <dbl>
##  1 Amsberry   Evan        1 Microéconomie 1  11.5
##  2 Basurto    Anthony     2 Microéconomie 1   9  
##  3 Begaye     Kai         3 Microéconomie 1  16.5
##  4 Brack      Michael     4 Microéconomie 1   4  
##  5 Burgess    Jamie       5 Microéconomie 1   6.5
##  6 Christian  Colton      6 Microéconomie 1  14.5
##  7 Cly        Jesse       7 Microéconomie 1   2.5
##  8 Coberley   Rebecca     8 Microéconomie 1  20  
##  9 De Venecia Madison     9 Microéconomie 1   6  
## 10 Gurule     Elliott    12 Microéconomie 1   7.5
## # ... with 214 more rows
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_L2}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 217 x 5
##    nom        prenom     id matiere          note
##    <chr>      <chr>   <dbl> <chr>           <dbl>
##  1 Amsberry   Evan        1 Microéconomie 2   5.5
##  2 Basurto    Anthony     2 Microéconomie 2   5  
##  3 Begaye     Kai         3 Microéconomie 2   8.5
##  4 Brack      Michael     4 Microéconomie 2   5  
##  5 Burgess    Jamie       5 Microéconomie 2   9  
##  6 Christian  Colton      6 Microéconomie 2  20  
##  7 Coberley   Rebecca     8 Microéconomie 2  15.5
##  8 De Venecia Madison     9 Microéconomie 2   5.5
##  9 Dewitt     Amelia     10 Microéconomie 2   6.5
## 10 Eisenberg  Kelly      11 Microéconomie 2   7  
## # ... with 207 more rows
\end{lstlisting}

\hypertarget{tibbles}{%
\section{Tibbles}\label{tibbles}}

Les tableaux de données sont traditionnellement des objets à deux dimensions, comme les matrices. Une dimension pour les colonnes, et une autre pour les lignes. En R, les tableaux de données pricipaux sont appelés \emph{data frames}. Nous allons, dans le cadre de ce cours, utiliser majoritairement des tableaux de données de classe \texttt{tbl\_df}, une sous classe de \texttt{data.frame}, que l'on nommera des \emph{tibbles}. Il s'agit de la structure de données centrale dans l'environnement tidyverse. Pour pouvoir créer ou manipuler des tibbles, il est nécessaire de charger le \emph{package} \{tibble\}. Ce \emph{package} est automatiquement chargé lorsque vous chargez \{tidyverse\} :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

Avant de manipuler les tableaux de données que vous venez d'importer, vous allez apprendre quelques notions élémentaires au sujet des tibbles. La fonction \VERB|\FunctionTok{tibble}\NormalTok{()}| permet de créer un tableau de données. On lui donne en arguments les colonnes, en les séparant par une virgule. Pour une facilité d'utilisation, il est préférable de nommer ces colonnes, en inscrivant simplement le nom suivi du symbole \VERB|\OtherTok{=}| avant le contenu de la colonne :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{),}
  \AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{50}\NormalTok{),}
  \AttributeTok{z =} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"C"}\NormalTok{,}\StringTok{"D"}\NormalTok{, }\StringTok{"E"}\NormalTok{),}
  \AttributeTok{t =}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ y)}
\NormalTok{tableau}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 5 x 4
##       x     y z         t
##   <dbl> <dbl> <chr> <dbl>
## 1     1    10 A        11
## 2     2    20 B        22
## 3     3    30 C        33
## 4     4    40 D        44
## 5     5    50 E        55
\end{lstlisting}

Une colonne doit contenir des observations de même type. Comme vous l'avez vu dans le \protect\hyperlink{type-des-donnuxe9es-et-premiuxe8re-structure}{chapitre 2}, les éléments d'un vecteur sont tous de même type. Aussi, dans l'exemple précédent, où chaque colonne est un vecteur, l'ensemble des éléments de chaque colonne est bien de même type (\emph{double} pour \texttt{x}, \texttt{y} et \texttt{t}, \emph{character} pour \texttt{z}).

Il est possible de donner des noms non conventionnels aux colonnes. En pratique, lorsque nous importons des données issues d'un fichier CSV, il n'est pas rare de faire face à des noms de colonnes non conventionnels (contenant des espaces par exemple, ou commençant par un nombre ou bien contenant des caractères spéciaux). Aussi, il est important de savoir comment faire face à cette situation : en utilisant des accents graves (\texttt{\textasciigrave{}}, \emph{backtick}) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tibble}\NormalTok{(}
  \StringTok{\textasciigrave{}}\AttributeTok{nom de colonne}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 3 x 1
##   `nom de colonne`
##              <dbl>
## 1                1
## 2                2
## 3                3
\end{lstlisting}

\hypertarget{dimensions}{%
\subsection{Dimensions}\label{dimensions}}

Lors de l'affichage dans la console de l'aperçu d'un tableau de données, les premières colonnes, leur type, et leur contenu s'affichent. Les dimensions sont données dans la première ligne d'affichage :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 5 x 4
##       x     y z         t
##   <dbl> <dbl> <chr> <dbl>
## 1     1    10 A        11
## 2     2    20 B        22
## 3     3    30 C        33
## 4     4    40 D        44
## 5     5    50 E        55
\end{lstlisting}

La première valeur correspond au nombre de lignes, tandis que la deuxième valeur correspond au nombre de colonnes. Pour accéder à ces valeurs, R propose la fonction \VERB|\FunctionTok{dim}\NormalTok{()}|, qui retourne les dimensions sous la forme d'un vecteur :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(tableau)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 5 4
\end{lstlisting}

On peut ensuite, comme expliqué dans le \protect\hyperlink{initiation-uxe0-r}{chapitre introductif} accéder à une dimension spécifique avec la fonction crochet :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(tableau)[}\DecValTok{1}\NormalTok{] }\CommentTok{\# nombre de lignes}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 5
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(tableau)[}\DecValTok{2}\NormalTok{] }\CommentTok{\# nombre de colonnes}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 4
\end{lstlisting}

Il est également possible d'utiliser les fonctions \VERB|\FunctionTok{nrow}\NormalTok{()}| et \VERB|\FunctionTok{ncol}\NormalTok{()}| qui donnent le nombre de lignes (\emph{rows} en anglais) et de colonnes (\emph{columns} en anglais), respectivement :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(tableau)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 5
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ncol}\NormalTok{(tableau)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 4
\end{lstlisting}

\hypertarget{accuxe8s-aux-uxe9luxe9ments-1}{%
\subsection{Accès aux éléments}\label{accuxe8s-aux-uxe9luxe9ments-1}}

Pour accéder aux éléments d'un tibble, on peut utiliser les crochets simples (\texttt{{[}{]}}) ou doubles (\texttt{{[}{[}{]}{]}}), en utilisant l'indexation (par position, nom, ou condition). Avec les crochets simples, un tibble est retourné :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{),] }\CommentTok{\# Lignes 1 et 3}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 2 x 4
##       x     y z         t
##   <dbl> <dbl> <chr> <dbl>
## 1     1    10 A        11
## 2     3    30 C        33
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau[,}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{)] }\CommentTok{\# Colonnes 2 et 4}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 5 x 2
##       y     t
##   <dbl> <dbl>
## 1    10    11
## 2    20    22
## 3    30    33
## 4    40    44
## 5    50    55
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau[, }\FunctionTok{c}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\StringTok{"t"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 5 x 2
##       x     t
##   <dbl> <dbl>
## 1     1    11
## 2     2    22
## 3     3    33
## 4     4    44
## 5     5    55
\end{lstlisting}

Avec les crochets doubles, le contenu de la colonne que l'on souhaite extraire est retourné :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau[[}\DecValTok{2}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 10 20 30 40 50
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau[[}\StringTok{"z"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "A" "B" "C" "D" "E"
\end{lstlisting}

Pour extraire le contenu d'une colonne, R propose aussi d'utiliser le dollar plutôt que les crochets doubles, pour une écriture plus compacte :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau}\SpecialCharTok{$}\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "A" "B" "C" "D" "E"
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Affichez, à l'aide d'une fonction, le nombre de lignes du tableau \texttt{notes\_L1}.
\item
  Idem avec le nombre de colonnes.
\item
  Extrayez les valeurs de la colonne \texttt{note} du tableau \texttt{notes\_L1}.
\item
  Sur un moteur de recherche, cherchez comment afficher les valeurs distinctes d'un vecteur, puis appliquez les fruits de votre recherche pour afficher les valeurs distinctes de la colonne \texttt{matiere} du tableau \texttt{notes\_L1}. Stockez le résultat dans un objet que vous nommerez \texttt{matieres}.
\item
  Combien de matières différentes y a-t-il dans le tableau \texttt{notes\_L1} ? Utilisez le vecteur \texttt{matieres} et une fonction retournant le nombre d'éléments dans un vecteur pour répondre à cette question.
\end{enumerate}

\end{greenbox}

\hypertarget{ruxe9sumuxe9s-statistiques-sur-les-colonnes-dun-tableau}{%
\section{Résumés statistiques sur les colonnes d'un tableau}\label{ruxe9sumuxe9s-statistiques-sur-les-colonnes-dun-tableau}}

Des statistiques descriptives sur un vecteur peuvent facilement être obtenues à l'aide des fonctions suivantes :

\begin{itemize}
\tightlist
\item
  somme : \VERB|\FunctionTok{sum}\NormalTok{()}|
\item
  moyenne : \VERB|\FunctionTok{mean}\NormalTok{()}|
\item
  écart-type : \VERB|\FunctionTok{sd}\NormalTok{()}|
\item
  min : \VERB|\FunctionTok{min}\NormalTok{()}|
\item
  max : \VERB|\FunctionTok{max}\NormalTok{()}|
\item
  médiane : \VERB|\FunctionTok{median}\NormalTok{()}|
\item
  quantile quelconque : \VERB|\FunctionTok{quantile}\NormalTok{()}|
\end{itemize}

Il suffit de donner un vecteur de valeurs numériques à ces fonctions pour obtenir la statistique calculée sur la base de l'échantillon de valeurs fournies.

La moyenne et l'écart-type de la colonne \texttt{x} du tableau \texttt{tableau} :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 3
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sd}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1.581139
\end{lstlisting}

\begin{notebox}

Attention, la fonction \VERB|\FunctionTok{sd}\NormalTok{()}| retourne la valeur de l'estimateur de l'écart-type d'une population : \(\frac{1}{n-1}\sum_{i=1}^{n} (x_i - \bar{x})^2\), où \(\bar{x} = \frac{1}{n}\sum_{i=1}^{n} x_i\).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x)}

\NormalTok{moy }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x) }\SpecialCharTok{/}\NormalTok{ n}
\NormalTok{moy}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 3
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{variance }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((tableau}\SpecialCharTok{$}\NormalTok{x }\SpecialCharTok{{-}}\NormalTok{ moy)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ (n}\DecValTok{{-}1}\NormalTok{)}
\NormalTok{variance}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 2.5
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ecart\_type }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(variance)}
\NormalTok{ecart\_type}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1.581139
\end{lstlisting}

\end{notebox}

Le minimum et le maximum :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{min}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{max}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 5
\end{lstlisting}

La médiane :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{median}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 3
\end{lstlisting}

Pour d'autres quantiles que la médiane, on utilise la fonction \VERB|\FunctionTok{quantile}\NormalTok{()}|, en précisant le quantile à l'argument \texttt{probs} :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{quantile}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x, }\AttributeTok{probs =}\NormalTok{ .}\DecValTok{25}\NormalTok{) }\CommentTok{\# Premier quartile}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 25% 
##   2
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{quantile}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x, }\AttributeTok{probs =}\NormalTok{ .}\DecValTok{75}\NormalTok{) }\CommentTok{\# Troisième quartile}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 75% 
##   4
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{quantile}\NormalTok{(tableau}\SpecialCharTok{$}\NormalTok{x, }\AttributeTok{probs =}\NormalTok{ .}\DecValTok{90}\NormalTok{) }\CommentTok{\# Neuvième décile}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 90% 
## 4.6
\end{lstlisting}

En cas de présence de valeurs manquantes (\VERB|\ConstantTok{NA}|), les fonctions \VERB|\FunctionTok{sum}\NormalTok{()}| \VERB|\FunctionTok{mean}\NormalTok{()}|, \VERB|\FunctionTok{sd}\NormalTok{()}|, \VERB|\FunctionTok{min}\NormalTok{()}|, etc. retournent la valeur \VERB|\ConstantTok{NA}| :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\ConstantTok{NA}\NormalTok{,}\DecValTok{4}\NormalTok{,}\ConstantTok{NA}\NormalTok{)}
\FunctionTok{mean}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] NA
\end{lstlisting}

Pour que la fonction soit appliquée en retirant au préalable du calcul les observations manquantes, on peut ajouter l'argument \VERB|\NormalTok{na.rm}\OtherTok{=}\ConstantTok{TRUE}| (avec \texttt{rm} pour \emph{remove}, c'est-à-dire retirer) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(x, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 2.5
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  À partir du tableau \texttt{notes\_L1}, calculez la moyenne et l'écart-type des valeurs dans la colonne \texttt{note}.
\item
  Extrayez le vecteur de notes du tableau \texttt{notes\_L1}, et conservez uniquement les 32 premières valeurs (ce qui correspond aux notes de microéconomie), à l'aide des crochets. Calculez la moyenne en microéconomie, ainsi que les premier et troisième quartiles.
\end{enumerate}

\end{greenbox}

\hypertarget{suxe9lection-dune-ou-plusieurs-colonnes}{%
\section{Sélection d'une ou plusieurs colonnes}\label{suxe9lection-dune-ou-plusieurs-colonnes}}

La fonction \VERB|\FunctionTok{select}\NormalTok{()}| du \emph{package} \{dplyr\} (qui est chargé lorsque \{tiduverse\} est chargé) permet de sélectionner une ou plusieurs colonnes. On donne un tableau de données comme premier argument à cette fonction. On indique ensuite la ou les noms des colonnes à conserver, en les séparant par une virgule. Admettons par exemple que l'on souhaite conserver uniquement les colonnes \texttt{x} et \texttt{z} de \texttt{tableau} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau\_2 }\OtherTok{\textless{}{-}} \FunctionTok{select}\NormalTok{(tableau, x, z)}
\NormalTok{tableau\_2}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 5 x 2
##       x z    
##   <dbl> <chr>
## 1     1 A    
## 2     2 B    
## 3     3 C    
## 4     4 D    
## 5     5 E
\end{lstlisting}

\begin{notebox}

Pour conserver l'ensemble des colonnes \textbf{excepté} certaines, il faut faire précéder le nom de ces colonnes que l'on souhaite ne pas conserver par le signe moins (\VERB|\SpecialCharTok{{-}}|) dans la fonction \VERB|\NormalTok{select}|

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(tableau\_2, }\SpecialCharTok{{-}}\NormalTok{z)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 5 x 1
##       x
##   <dbl>
## 1     1
## 2     2
## 3     3
## 4     4
## 5     5
\end{lstlisting}

\end{notebox}

L'ordre dans lequel sont écrits les noms de colonnes lors de l'appel à la fonction \VERB|\FunctionTok{select}\NormalTok{()}| définit l'odre d'apparition des colonnes dans le résultat. Pour changer la position des colonnes d'un tibble, il existe une fonction dans \{tidyverse\} : \VERB|\FunctionTok{relocate}\NormalTok{()}|. Si on souhaite voir apparaître certaines colonnes sans se soucier de l'ordre d'autres colonnes, il suffit de nommer les colonnes à positionner dans les premières positions :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau }\OtherTok{\textless{}{-}} \FunctionTok{relocate}\NormalTok{(tableau, z, x)}
\NormalTok{tableau}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 5 x 4
##   z         x     y     t
##   <chr> <dbl> <dbl> <dbl>
## 1 A         1    10    11
## 2 B         2    20    22
## 3 C         3    30    33
## 4 D         4    40    44
## 5 E         5    50    55
\end{lstlisting}

Il est également possible de préciser que l'on désire placer une colonne avant ou après une autre colonne, en renseignant les arguments \VERB|\NormalTok{.before}| ou \VERB|\NormalTok{.after}|:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau }\OtherTok{\textless{}{-}} \FunctionTok{relocate}\NormalTok{(tableau, z, }\AttributeTok{.before =}\NormalTok{ y)}
\NormalTok{tableau}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 5 x 4
##       x z         y     t
##   <dbl> <chr> <dbl> <dbl>
## 1     1 A        10    11
## 2     2 B        20    22
## 3     3 C        30    33
## 4     4 D        40    44
## 5     5 E        50    55
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  À partir du tableau \texttt{notes\_L1}, créez le tableau \texttt{eleves} qui contiendra uniquement les colonnes \texttt{nom}, \texttt{prenom} et \texttt{id}.
\item
  Appliquez la fonction \VERB|\FunctionTok{unique}\NormalTok{()}| au tableau \texttt{eleves} pour ne conserver dans le tableau \texttt{eleves} que les enregistrements distincts (de sorte à avoir 1 ligne correspondant à une seule personne).
\end{enumerate}

\end{greenbox}

\hypertarget{cruxe9ationmodification-dune-nouvelle-colonne}{%
\section{Création/Modification d'une nouvelle colonne}\label{cruxe9ationmodification-dune-nouvelle-colonne}}

Le \emph{package} \{tidyverse\} offre une fonction permettant de créer ou de modifier une colonne d'un tableau de données : \VERB|\FunctionTok{mutate}\NormalTok{()}|. Son premier argument est le tableau de données, le ou les arguments suivants correspondent aux colonnes à créer ou modifier.

Illustrons le fonctionnement de cette fonction en ramenant les notes de la colonne \texttt{note} de \texttt{tableau} sur 10 plutôt que sur 20. Appelons \texttt{notes\_10} la colonne contenant les résultats de la division par deux des valeurs de la colonne \texttt{note} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_L1 }\OtherTok{\textless{}{-}} \FunctionTok{mutate}\NormalTok{(notes\_L1, }\AttributeTok{notes\_10 =}\NormalTok{ note}\SpecialCharTok{/}\DecValTok{2}\NormalTok{)}
\NormalTok{notes\_L1}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 6
##    nom        prenom     id matiere          note notes_10
##    <chr>      <chr>   <dbl> <chr>           <dbl>    <dbl>
##  1 Amsberry   Evan        1 Microéconomie 1  11.5     5.75
##  2 Basurto    Anthony     2 Microéconomie 1   9       4.5 
##  3 Begaye     Kai         3 Microéconomie 1  16.5     8.25
##  4 Brack      Michael     4 Microéconomie 1   4       2   
##  5 Burgess    Jamie       5 Microéconomie 1   6.5     3.25
##  6 Christian  Colton      6 Microéconomie 1  14.5     7.25
##  7 Cly        Jesse       7 Microéconomie 1   2.5     1.25
##  8 Coberley   Rebecca     8 Microéconomie 1  20      10   
##  9 De Venecia Madison     9 Microéconomie 1   6       3   
## 10 Gurule     Elliott    12 Microéconomie 1   7.5     3.75
## # ... with 214 more rows
\end{lstlisting}

Admettons à présent que l'on souhaite ajouter 1 point à l'ensemble des élèves :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_L1 }\OtherTok{\textless{}{-}} \FunctionTok{mutate}\NormalTok{(notes\_L1, }\AttributeTok{notes\_10\_augmentees =}\NormalTok{ notes\_10 }\SpecialCharTok{+}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Regardons les valeurs, en utilisant la fonction \VERB|\FunctionTok{select}\NormalTok{()}| pour éviter d'afficher toutes les colonnes :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(notes\_L1, nom, note, notes\_10, notes\_10\_augmentees)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 4
##    nom         note notes_10 notes_10_augmentees
##    <chr>      <dbl>    <dbl>               <dbl>
##  1 Amsberry    11.5     5.75                6.75
##  2 Basurto      9       4.5                 5.5 
##  3 Begaye      16.5     8.25                9.25
##  4 Brack        4       2                   3   
##  5 Burgess      6.5     3.25                4.25
##  6 Christian   14.5     7.25                8.25
##  7 Cly          2.5     1.25                2.25
##  8 Coberley    20      10                  11   
##  9 De Venecia   6       3                   4   
## 10 Gurule       7.5     3.75                4.75
## # ... with 214 more rows
\end{lstlisting}

Admettons que l'on souhaite ajouter 1 autre point à l'ensemble des élèves. Cette fois, nous allons \textbf{modifier} la colonne \texttt{notes\_10\_augmentees} en récupérant la valeur déjà présente, puis en lui ajoutante la valeur 1.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_L1 }\OtherTok{\textless{}{-}} \FunctionTok{mutate}\NormalTok{(notes\_L1, }\AttributeTok{notes\_10\_augmentees =}\NormalTok{ notes\_10\_augmentees }\SpecialCharTok{+}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Regardons à nouveau les valeurs, en utilisant la fonction \VERB|\FunctionTok{select}\NormalTok{()}| pour éviter d'afficher toutes les colonnes :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(notes\_L1, nom, note, notes\_10, notes\_10\_augmentees)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 4
##    nom         note notes_10 notes_10_augmentees
##    <chr>      <dbl>    <dbl>               <dbl>
##  1 Amsberry    11.5     5.75                7.75
##  2 Basurto      9       4.5                 6.5 
##  3 Begaye      16.5     8.25               10.2 
##  4 Brack        4       2                   4   
##  5 Burgess      6.5     3.25                5.25
##  6 Christian   14.5     7.25                9.25
##  7 Cly          2.5     1.25                3.25
##  8 Coberley    20      10                  12   
##  9 De Venecia   6       3                   5   
## 10 Gurule       7.5     3.75                5.75
## # ... with 214 more rows
\end{lstlisting}

Ainsi, lorsque le nom de la colonne que l'on donne en argument de la fonction \VERB|\FunctionTok{select}\NormalTok{()}| est déjà présent dans le tableau donné en premier argument, la fonction \VERB|\FunctionTok{select}\NormalTok{()}| effectue une modification de cette colonne. Si le nom de colonne fait référence à une colonne qui n'existe pas dans le tableau, alors la fonction \VERB|\FunctionTok{select}\NormalTok{()}| créé une nouvelle colonne.

\begin{notebox}

Ces opérations en plusieurs étapes peuvent se réaliser à l'aide d'une seule instruction :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_L1 }\OtherTok{\textless{}{-}} \FunctionTok{mutate}\NormalTok{(notes\_L1,}
                   \AttributeTok{notes\_10 =}\NormalTok{ note }\SpecialCharTok{/} \DecValTok{2}\NormalTok{,}
                   \AttributeTok{notes\_10\_augmentees =}\NormalTok{ notes\_10 }\SpecialCharTok{+} \DecValTok{1}\NormalTok{,}
                   \AttributeTok{notes\_10\_augmentees =}\NormalTok{ notes\_10\_augmentees }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}
\FunctionTok{select}\NormalTok{(notes\_L1, nom, note, notes\_10, notes\_10\_augmentees)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 4
##    nom         note notes_10 notes_10_augmentees
##    <chr>      <dbl>    <dbl>               <dbl>
##  1 Amsberry    11.5     5.75                7.75
##  2 Basurto      9       4.5                 6.5 
##  3 Begaye      16.5     8.25               10.2 
##  4 Brack        4       2                   4   
##  5 Burgess      6.5     3.25                5.25
##  6 Christian   14.5     7.25                9.25
##  7 Cly          2.5     1.25                3.25
##  8 Coberley    20      10                  12   
##  9 De Venecia   6       3                   5   
## 10 Gurule       7.5     3.75                5.75
## # ... with 214 more rows
\end{lstlisting}

\end{notebox}

\begin{greenbox}
\textbf{Exercice}

Dans le tableau \texttt{notes\_L1}, créez la colonne \texttt{notes\_100} qui contiendra les notes exprimées sur 100 points et non pas sur 20.

\end{greenbox}

\hypertarget{renommer-une-colonne}{%
\section{Renommer une colonne}\label{renommer-une-colonne}}

Pour renommer une colonne, le \emph{package} \{dplyr\} propose la fonction \VERB|\FunctionTok{rename}\NormalTok{()}|. Elle s'applique directement à un tableau de données et retourne un tableau de données. Il suffit d'indiquer le nouveau nom suivi du symbole égal (\VERB|\OtherTok{=}|) puis de l'ancien nom. Lorsqu'un nom n'est pas conventionnel, on utilise l'accent grave (\texttt{\textasciigrave{}}, \emph{backtick}) pour entourer le nom :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{notes\_L1 }\OtherTok{\textless{}{-}} 
  \FunctionTok{rename}\NormalTok{(notes\_L1,}
         \AttributeTok{notes\_dix =}\NormalTok{ notes\_10,}
         \StringTok{\textasciigrave{}}\AttributeTok{notes 10 augmentees}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ notes\_10\_augmentees)}
\NormalTok{notes\_L1}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 7
##    nom        prenom     id matiere          note notes_dix notes 10 augmentee~1
##    <chr>      <chr>   <dbl> <chr>           <dbl>     <dbl>                <dbl>
##  1 Amsberry   Evan        1 Microéconomie 1  11.5      5.75                 7.75
##  2 Basurto    Anthony     2 Microéconomie 1   9        4.5                  6.5 
##  3 Begaye     Kai         3 Microéconomie 1  16.5      8.25                10.2 
##  4 Brack      Michael     4 Microéconomie 1   4        2                    4   
##  5 Burgess    Jamie       5 Microéconomie 1   6.5      3.25                 5.25
##  6 Christian  Colton      6 Microéconomie 1  14.5      7.25                 9.25
##  7 Cly        Jesse       7 Microéconomie 1   2.5      1.25                 3.25
##  8 Coberley   Rebecca     8 Microéconomie 1  20       10                   12   
##  9 De Venecia Madison     9 Microéconomie 1   6        3                    5   
## 10 Gurule     Elliott    12 Microéconomie 1   7.5      3.75                 5.75
## # ... with 214 more rows, and abbreviated variable name
## #   1: `notes 10 augmentees`
\end{lstlisting}

\hypertarget{filtrage}{%
\section{Filtrage}\label{filtrage}}

Pour conserver uniquement les lignes d'un tableau qui remplissent les conditions d'un filtre, la fonction \VERB|\FunctionTok{filter}\NormalTok{()}| du package \{dplyr\} s'avère être très pratique. Cette fonction qui fait égalemnt partie de l'environnement \{tidyverse\}, s'applique directement à un tableau de données, et retourne un tableau de données comprenant les lignes pour lesquels le filtre retourne une valeur logique \VERB|\ConstantTok{TRUE}|.

Le premier argument de la fonction \VERB|\FunctionTok{filter}\NormalTok{()}| est le tableau de données. Les arguments suivants correspondent au(x) filtre(s) à appliquer. Par exemple, pour conserver uniquement les lignes du tableau \texttt{notes\_L1} pour lesquelles la note est inférieure à 10 :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(notes\_L1, note }\SpecialCharTok{\textless{}} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 148 x 7
##    nom        prenom     id matiere          note notes_dix notes 10 augmentee~1
##    <chr>      <chr>   <dbl> <chr>           <dbl>     <dbl>                <dbl>
##  1 Basurto    Anthony     2 Microéconomie 1   9        4.5                  6.5 
##  2 Brack      Michael     4 Microéconomie 1   4        2                    4   
##  3 Burgess    Jamie       5 Microéconomie 1   6.5      3.25                 5.25
##  4 Cly        Jesse       7 Microéconomie 1   2.5      1.25                 3.25
##  5 De Venecia Madison     9 Microéconomie 1   6        3                    5   
##  6 Gurule     Elliott    12 Microéconomie 1   7.5      3.75                 5.75
##  7 Israel     Joshua     14 Microéconomie 1   4        2                    4   
##  8 Jacket     Kanae      15 Microéconomie 1   6.5      3.25                 5.25
##  9 Kinney     Jonah      17 Microéconomie 1   2        1                    3   
## 10 Ledbetter  Conor      18 Microéconomie 1   9        4.5                  6.5 
## # ... with 138 more rows, and abbreviated variable name
## #   1: `notes 10 augmentees`
\end{lstlisting}

\begin{notebox}
Pour chaque ligne, le test logique consistant à regarder si la valeur de la colonne \texttt{note} est strictement supérieure à 10 est réalisé. Si la valeur retournée est \VERB|\ConstantTok{TRUE}|, la ligne est retournée. Dans tous les autres cas, la ligne est retirée du résultat.

\end{notebox}

Des filtres plus complexes peuvent être réalisés, à l'aide des opérateurs logiques présentés dans \protect\hyperlink{indexation-par-condition}{la section portant sur l'indexation par condition} (ET logique \VERB|\SpecialCharTok{\&}|, OU logique \VERB|\SpecialCharTok{\VerbBar{}}|, \VERB|\SpecialCharTok{!}| négation logique).

Par exemple, pour obtenir les lignes du tableau \texttt{notes\_L1} dont la valeur de la colonne \texttt{note} est comprise dans l'intervalle \([10;12]\), on écrira :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(notes\_L1, note }\SpecialCharTok{\textgreater{}=} \DecValTok{10} \SpecialCharTok{\&}\NormalTok{ note }\SpecialCharTok{\textless{}=} \DecValTok{12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 32 x 7
##    nom              prenom     id matiere          note notes_dix notes 10 aug~1
##    <chr>            <chr>   <dbl> <chr>           <dbl>     <dbl>          <dbl>
##  1 Amsberry         Evan        1 Microéconomie 1  11.5      5.75           7.75
##  2 Medicine Blanket Robert     23 Microéconomie 1  11        5.5            7.5 
##  3 Thiede           Tyler      33 Microéconomie 1  10.5      5.25           7.25
##  4 Gurule           Elliott    12 Macroéconomie 1  12        6              8   
##  5 Medicine Blanket Robert     23 Macroéconomie 1  10.5      5.25           7.25
##  6 Pereyra          Emilie     27 Macroéconomie 1  11.5      5.75           7.75
##  7 Jacket           Kanae      15 Mathématiques 1  11.5      5.75           7.75
##  8 Oyebi            Rachael    26 Mathématiques 1  12        6              8   
##  9 Joy              Michael    16 Informatique 1   10        5              7   
## 10 Kinney           Jonah      17 Informatique 1   10        5              7   
## # ... with 22 more rows, and abbreviated variable name 1: `notes 10 augmentees`
\end{lstlisting}

Pour conserver les lignes pour lesquelles la valeur d'une colonne fait partie d'un ensemble de valeurs, on utilise l'opérateur \VERB|\SpecialCharTok{\%in\%}|. Par exemple, pour conserver les observations du tableau \texttt{notes\_L1} pour lesquelles le nom est \VERB|\StringTok{"Amsberry"}| ou \VERB|\StringTok{"Basurto 1"}|, on écrira :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(notes\_L1, nom }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Amsberry"}\NormalTok{, }\StringTok{"Basurto"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 14 x 7
##    nom      prenom     id matiere                      note notes_dix notes 10~1
##    <chr>    <chr>   <dbl> <chr>                       <dbl>     <dbl>      <dbl>
##  1 Amsberry Evan        1 Microéconomie 1              11.5      5.75       7.75
##  2 Basurto  Anthony     2 Microéconomie 1               9        4.5        6.5 
##  3 Amsberry Evan        1 Macroéconomie 1               7.5      3.75       5.75
##  4 Basurto  Anthony     2 Macroéconomie 1               4.5      2.25       4.25
##  5 Amsberry Evan        1 Mathématiques 1               5        2.5        4.5 
##  6 Basurto  Anthony     2 Mathématiques 1               6        3          5   
##  7 Amsberry Evan        1 Informatique 1                5.5      2.75       4.75
##  8 Basurto  Anthony     2 Informatique 1                3.5      1.75       3.75
##  9 Amsberry Evan        1 Statistiques 1                9        4.5        6.5 
## 10 Basurto  Anthony     2 Statistiques 1                4        2          4   
## 11 Amsberry Evan        1 Anglais 1                     4        2          4   
## 12 Basurto  Anthony     2 Anglais 1                     5.5      2.75       4.75
## 13 Amsberry Evan        1 Economie environnementale 1   6        3          5   
## 14 Basurto  Anthony     2 Economie environnementale 1  12        6          8   
## # ... with abbreviated variable name 1: `notes 10 augmentees`
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Filtrez le tableau \texttt{notes\_L1} pour ne conserver que les lignes pour lesquelles la valeur de la colonne \texttt{note} est supérieure ou égale à 10.
\item
  Filtrez le tableau \texttt{notes\_L1} pour ne conserver que les lignes concernant la matière ``Microéconomie 1''.
\item
  Filtrez le tableau \texttt{notes\_L1} pour ne conserver que les lignes pour lesquelles la valeur de la colonne \texttt{matiere} est soit \texttt{Microéconomie\ 1}, soit \texttt{Macroéconomie\ 1}. Stockez le résultat dans un objet que vous appellerez \texttt{eco}.
\end{enumerate}

\end{greenbox}

\hypertarget{ruxe9sumuxe9s-statistiques-sur-lensemble-du-tableau}{%
\section{Résumés statistiques sur l'ensemble du tableau}\label{ruxe9sumuxe9s-statistiques-sur-lensemble-du-tableau}}

Nous avons vu précédemment que les fonctions \VERB|\FunctionTok{mean}\NormalTok{()}|, \VERB|\FunctionTok{sum}\NormalTok{()}|, \VERB|\FunctionTok{sd}\NormalTok{()}|, etc. permettent de calculer des statistiques sur des vecteurs de valeurs numériques. Il est possible d'appliquer ces mêmes fonctions à travers la fonction \VERB|\FunctionTok{summarise}\NormalTok{()}| sur les colonnes des tableaux de données, pour obtenir les mêmes statistiques. Le résultat sera retourné à l'intérieur d'un tableau de données.

Le premier argment de la fonction \VERB|\NormalTok{summarise}| est le tableau de données sur lequel les résumés statistiques sont effectués. Les arguments suivants indiquent les fonctions à appliquer sur une colonne. Ces fonctions doivent retourner une valeur unique (ce qui est le cas des fonctions \VERB|\FunctionTok{mean}\NormalTok{()}|, \VERB|\NormalTok{sum}|, \VERB|\FunctionTok{sd}\NormalTok{()}|, etc.). On indique d'abord le nom de la colonne qui contiendra la valeur calculée, puis la fonction à appliquer à une ou plusieurs colonnes du tableau. Par exemple, pour calculer la moyenne et l'écart-type des colonnes \texttt{note} et \texttt{notes\ 10\ augmentees}, on écrira :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summarise}\NormalTok{(notes\_L1,}
          \AttributeTok{moyenne =} \FunctionTok{mean}\NormalTok{(note),}
          \AttributeTok{ecart\_type =} \FunctionTok{sd}\NormalTok{(note),}
          \AttributeTok{moyennes\_aug =} \FunctionTok{mean}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{notes 10 augmentees}\StringTok{\textasciigrave{}}\NormalTok{),}
          \AttributeTok{sd\_aug =} \FunctionTok{sd}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{notes 10 augmentees}\StringTok{\textasciigrave{}}\NormalTok{)}
\NormalTok{          )}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 1 x 4
##   moyenne ecart_type moyennes_aug sd_aug
##     <dbl>      <dbl>        <dbl>  <dbl>
## 1    8.52       4.75         6.26   2.37
\end{lstlisting}

La fonction \VERB|\NormalTok{summarise}| a été utilisée sur l'ensemble du tableau \texttt{notes\_L1}. Nous avons fourni 4 opérations à éffectuer, le tableau retourné contient ainsi 4 colonnes correspondant aux résultats de ces opérations.

\hypertarget{agruxe9gation-par-groupes}{%
\section{Agrégation par groupes}\label{agruxe9gation-par-groupes}}

La colonne \texttt{matiere} du tableau de données \texttt{tableau} indique la matière dans lequel la note de l'élève est obtenue. Si l'on souhaite obtenir les moyennes de chaque matière, il est nécessaire de réaliser des agrégations par matière. Commençons par réaliser le calcul à la main.

Regardons les différentes matières :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{unique}\NormalTok{(notes\_L1}\SpecialCharTok{$}\NormalTok{matiere)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "Microéconomie 1"             "Macroéconomie 1"            
## [3] "Mathématiques 1"             "Informatique 1"             
## [5] "Statistiques 1"              "Anglais 1"                  
## [7] "Economie environnementale 1" "Finance 1"
\end{lstlisting}

Calculons la note moyenne dans le groupe pour la microéconomie :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{micro }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(notes\_L1, matiere }\SpecialCharTok{==} \StringTok{"Microéconomie 1"}\NormalTok{)}
\NormalTok{moyenne\_micro }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(micro}\SpecialCharTok{$}\NormalTok{note)}
\NormalTok{moyenne\_micro}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 8.96875
\end{lstlisting}

Pour la macroéconomie :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{macro }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(notes\_L1, matiere }\SpecialCharTok{==} \StringTok{"Macroéconomie 1"}\NormalTok{)}
\NormalTok{moyenne\_macro }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(macro}\SpecialCharTok{$}\NormalTok{note)}
\NormalTok{moyenne\_macro}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 8.484375
\end{lstlisting}

Bien qu'il soit possible de continuer, on se rend rapidement compte que ce calcul répétitif est pénible. Heureusement, \{tidyverse\} propose une combo de fonctions qui permet de grouper les observations d'un tableau dans un premier temps, puis d'appliquer une fonction à une ou plusieurs colonnes à chacun des sous groupes, et enfin de retourner le résultat. Ces fonctions sont les suivantes :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \VERB|\FunctionTok{group\_by}\NormalTok{()}| : dans un premier temps, les données du tableau sont regroupées selon les modalités d'une ou de plusieurs colonnes. Il s'agit de créer des sous-groupes dans le tableau de données. Dans notre cas, nous allons effectuer le regroupement selon les valeurs prises par la colonne \texttt{matiere}.
\item
  \VERB|\FunctionTok{summarise}\NormalTok{()}| : dans un deuxième temps, pour chaque groupe, les observations des lignes sont agrégées, résumées.
\end{enumerate}

Regroupons les observations de \texttt{notes\_L1} en fonction des valeurs de la colonne \texttt{matière} (la microéconomie 1 avec la microéconomie 1, la macroéconomie 1 avec la macroéconomie 1, etc.) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{group\_by}\NormalTok{(notes\_L1, matiere)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 7
## # Groups:   matiere [8]
##    nom        prenom     id matiere          note notes_dix notes 10 augmentee~1
##    <chr>      <chr>   <dbl> <chr>           <dbl>     <dbl>                <dbl>
##  1 Amsberry   Evan        1 Microéconomie 1  11.5      5.75                 7.75
##  2 Basurto    Anthony     2 Microéconomie 1   9        4.5                  6.5 
##  3 Begaye     Kai         3 Microéconomie 1  16.5      8.25                10.2 
##  4 Brack      Michael     4 Microéconomie 1   4        2                    4   
##  5 Burgess    Jamie       5 Microéconomie 1   6.5      3.25                 5.25
##  6 Christian  Colton      6 Microéconomie 1  14.5      7.25                 9.25
##  7 Cly        Jesse       7 Microéconomie 1   2.5      1.25                 3.25
##  8 Coberley   Rebecca     8 Microéconomie 1  20       10                   12   
##  9 De Venecia Madison     9 Microéconomie 1   6        3                    5   
## 10 Gurule     Elliott    12 Microéconomie 1   7.5      3.75                 5.75
## # ... with 214 more rows, and abbreviated variable name
## #   1: `notes 10 augmentees`
\end{lstlisting}

On note dans la sortie précédente que cela correspond à 8 groupes (il y a en effet 8 valeurs distinctes dans la colonne \texttt{matiere} du tableau de données).

Une fois les groupes désignés, il reste à effectuer le calcul de résumé (la moyenne des valeurs de la colonne \texttt{note}) sur chacun des groupes, à l'aide de la fonction \VERB|\FunctionTok{summarise}\NormalTok{()}|.Le résultat du calcul sera donné dans une colonne que l'on pourra nommer, par exemple, \texttt{moyenne}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{moyennes\_matieres }\OtherTok{\textless{}{-}} 
  \FunctionTok{summarise}\NormalTok{(}\FunctionTok{group\_by}\NormalTok{(notes\_L1, matiere), }\AttributeTok{moyenne =} \FunctionTok{mean}\NormalTok{(note))}
\NormalTok{moyennes\_matieres}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 8 x 2
##   matiere                     moyenne
##   <chr>                         <dbl>
## 1 Anglais 1                      7.11
## 2 Economie environnementale 1    8.56
## 3 Finance 1                      8.75
## 4 Informatique 1                 8.38
## 5 Macroéconomie 1                8.48
## 6 Mathématiques 1                9.05
## 7 Microéconomie 1                8.97
## 8 Statistiques 1                 9
\end{lstlisting}

Pour éviter d'écrire les compositions de fonctions de manière condensée comme dans l'exemple précédent, le \emph{package} \{magrittr\} propose un opérateur nommé ``pipe'', dont la syntaxe est la suivante \VERB|\SpecialCharTok{\%\textgreater{}\%}|.

Cet opérateur fournit le résultat de l'évaluation de ce qui se trouve avant lui en premier argument de la fonction qui se situe immédiatement après.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{moyennes\_matieres }\OtherTok{\textless{}{-}} 
\NormalTok{  notes\_L1 }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(matiere) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{moyenne =} \FunctionTok{mean}\NormalTok{(note))}
\end{Highlighting}
\end{Shaded}

Le code devient plus facile à lire :

\begin{itemize}
\tightlist
\item
  on part du tableau de données \texttt{notes\_L1} ;
\item
  ce tableau est donné en premier argument de la fonction \VERB|\FunctionTok{group\_by}\NormalTok{()}| ;
\item
  le regroupement est fait selon la colonne \texttt{matiere} ;
\item
  une fois le regroupement effectué, le résultat est donné comme premier argument de la fonction \VERB|\FunctionTok{summarise}\NormalTok{()}| ;
\item
  le calcul de la moyenne des valeurs de la colonne \texttt{note} est effectué pour chaque groupe du tableau de données, et le résultat est indiqué dans une colonne nommée \texttt{moyenne}.
\end{itemize}

Si on souhaite effectuer des regroupements en fonction des valeurs de plusieurs colonnes, il suffit d'ajouter les noms de colonnes dans la fonction \VERB|\FunctionTok{group\_by}\NormalTok{()}|. La syntaxe est la suivante :

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ne pas évaluer}
\FunctionTok{group\_by}\NormalTok{(tableau, colonne\_1, colonne\_2)}
\end{Highlighting}
\end{Shaded}

L'exercice qui suit vous permettra d'essayer un regroupement selon plusieurs colonnes.

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Intéressez-vous aux résultats de Rebecca Coberley. Créez un tableau que vous appellerez \texttt{notes\_coberley} qui contiendra les observations de \texttt{notes\_L1} concernant l'élève Rebecca Coberley (Note : vous devez créer ce nouveau tableau en manipulant le tableau \texttt{notes\_L1}, pas en inscrivant à la main les valeurs).
\item
  Calculez la moyenne des notes de cette élève à partir du tableau \texttt{notes\_coberley}.
\item
  À partir de \texttt{notes\_L1}, calculez la moyenne générale de chaque élève. Pour ce faire :
\end{enumerate}

\begin{enumerate}
\def\labelenumi{\alph{enumi}.}
\tightlist
\item
  regroupez les valeurs par les colonnes \texttt{nom}, \texttt{prenom}, \texttt{id}
\item
  calculez la moyenne de la colonne \texttt{note} pour chaque sous-groupe.
\end{enumerate}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Retrouvez dans le tableau ainsi obtenu la moyenne de Rebecca Coberley
\end{enumerate}

\end{greenbox}

\hypertarget{tri}{%
\section{Tri}\label{tri}}

La fonction \VERB|\FunctionTok{arrange}\NormalTok{()}| du \emph{package} \{dplyr\} permet d'ordonner les observations par valeurs croissantes ou décroissantes d'une ou de plusieurs colonnes. À nouveau, le premier argument attendu est un tableau de données, et le résultat est un tableau de données. Les arguments suivants sont les noms des colonnes sur lesquels effectuer le tri. Par défaut, le tri se fait par valeurs \textbf{croissantes}.

Par exemple, pour trier les valeurs par valeurs croissantes de la colonne \texttt{notes}, on écrit simplement :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(notes\_L1, note)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 7
##    nom        prenom      id matiere                      note notes_dix notes~1
##    <chr>      <chr>    <dbl> <chr>                       <dbl>     <dbl>   <dbl>
##  1 Lehi       Savannah    19 Informatique 1                1        0.5     2.5 
##  2 Cly        Jesse        7 Mathématiques 1               1.5      0.75    2.75
##  3 De Venecia Madison      9 Mathématiques 1               1.5      0.75    2.75
##  4 Brack      Michael      4 Anglais 1                     1.5      0.75    2.75
##  5 Lucero     Cole        21 Economie environnementale 1   1.5      0.75    2.75
##  6 Brack      Michael      4 Finance 1                     1.5      0.75    2.75
##  7 Kinney     Jonah       17 Microéconomie 1               2        1       3   
##  8 Cly        Jesse        7 Macroéconomie 1               2        1       3   
##  9 Slovonsky  Tevin       32 Informatique 1                2        1       3   
## 10 Thiede     Tyler       33 Informatique 1                2        1       3   
## # ... with 214 more rows, and abbreviated variable name
## #   1: `notes 10 augmentees`
\end{lstlisting}

Pour trier par valeurs décroissantes, on applique la fonction \VERB|\FunctionTok{desc}\NormalTok{()}| sur le nom de la colonne, à l'intérieur de la fonction \VERB|\NormalTok{arrange}| :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(notes\_L1, }\FunctionTok{desc}\NormalTok{(note))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 7
##    nom              prenom     id matiere                   note notes~1 notes~2
##    <chr>            <chr>   <dbl> <chr>                    <dbl>   <dbl>   <dbl>
##  1 Coberley         Rebecca     8 Microéconomie 1             20    10      12  
##  2 Joy              Michael    16 Microéconomie 1             20    10      12  
##  3 Massey           Taylor     22 Mathématiques 1             20    10      12  
##  4 Medicine Blanket Robert     23 Mathématiques 1             20    10      12  
##  5 Scholer          Julia      31 Informatique 1              20    10      12  
##  6 Riley            Paige      28 Statistiques 1              20    10      12  
##  7 Rosen            Richard    29 Anglais 1                   20    10      12  
##  8 Rosen            Richard    29 Economie environnementa~    20    10      12  
##  9 Begaye           Kai         3 Statistiques 1              19     9.5    11.5
## 10 Scholer          Julia      31 Statistiques 1              19     9.5    11.5
## # ... with 214 more rows, and abbreviated variable names 1: notes_dix,
## #   2: `notes 10 augmentees`
\end{lstlisting}

Lorsque une colonne utilisée pour faire un tri est une chaîne de caractères, l'ordre alphanumérique est utilisé :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(notes\_L1, nom)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 7
##    nom      prenom     id matiere                      note notes_dix notes 10~1
##    <chr>    <chr>   <dbl> <chr>                       <dbl>     <dbl>      <dbl>
##  1 Amsberry Evan        1 Microéconomie 1              11.5      5.75       7.75
##  2 Amsberry Evan        1 Macroéconomie 1               7.5      3.75       5.75
##  3 Amsberry Evan        1 Mathématiques 1               5        2.5        4.5 
##  4 Amsberry Evan        1 Informatique 1                5.5      2.75       4.75
##  5 Amsberry Evan        1 Statistiques 1                9        4.5        6.5 
##  6 Amsberry Evan        1 Anglais 1                     4        2          4   
##  7 Amsberry Evan        1 Economie environnementale 1   6        3          5   
##  8 Basurto  Anthony     2 Microéconomie 1               9        4.5        6.5 
##  9 Basurto  Anthony     2 Macroéconomie 1               4.5      2.25       4.25
## 10 Basurto  Anthony     2 Mathématiques 1               6        3          5   
## # ... with 214 more rows, and abbreviated variable name
## #   1: `notes 10 augmentees`
\end{lstlisting}

\begin{notebox}
Selon l'ordre alphanumérique, les caractères spéciaux apparaissent en premier, suivis des valeurs numériques, puis par les lettres.

\end{notebox}

Pour trier par une colonne, puis par une autre, il suffit d'ajouter les noms des colonnes en arguments. L'ordre d'énumération définit l'ordre du tri. Par exemple, pour trier par valeurs croissantes des matières (colonne \texttt{matiere}), puis, pour chaque matière, par valeurs décroissantes des notes (colonne \texttt{note}) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(notes\_L1, matiere, }\FunctionTok{desc}\NormalTok{(note))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 224 x 7
##    nom              prenom     id matiere    note notes_dix notes 10 augmentee~1
##    <chr>            <chr>   <dbl> <chr>     <dbl>     <dbl>                <dbl>
##  1 Rosen            Richard    29 Anglais 1  20       10                   12   
##  2 Joy              Michael    16 Anglais 1  13.5      6.75                 8.75
##  3 Massey           Taylor     22 Anglais 1  13        6.5                  8.5 
##  4 Begaye           Kai         3 Anglais 1  11        5.5                  7.5 
##  5 Medicine Blanket Robert     23 Anglais 1  10.5      5.25                 7.25
##  6 Pereyra          Emilie     27 Anglais 1  10        5                    7   
##  7 Mullins          Brenna     24 Anglais 1   9.5      4.75                 6.75
##  8 Slovonsky        Tevin      32 Anglais 1   9.5      4.75                 6.75
##  9 Schlaver         Lexa       30 Anglais 1   9        4.5                  6.5 
## 10 Kinney           Jonah      17 Anglais 1   8.5      4.25                 6.25
## # ... with 214 more rows, and abbreviated variable name
## #   1: `notes 10 augmentees`
\end{lstlisting}

\begin{notebox}

Pour avoir une meilleure idée de ce qu'il se passe, regardons avec un plus petit tableau. Considérons le tableau suivant :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tableau }\OtherTok{\textless{}{-}} 
  \FunctionTok{tibble}\NormalTok{(}
    \AttributeTok{numero\_ligne\_initial =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{),}
    \AttributeTok{matiere =} \FunctionTok{c}\NormalTok{(}\StringTok{"Microéconomie 1"}\NormalTok{, }\StringTok{"Anglais 1"}\NormalTok{,}
                \StringTok{"Microéconomie 1"}\NormalTok{, }\StringTok{"Anglais 1"}\NormalTok{),}
    \AttributeTok{notes =} \FunctionTok{c}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{18}\NormalTok{,}\DecValTok{15}\NormalTok{,}\DecValTok{5}\NormalTok{))}
\NormalTok{tableau}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 3
##   numero_ligne_initial matiere         notes
##                  <dbl> <chr>           <dbl>
## 1                    1 Microéconomie 1    20
## 2                    2 Anglais 1          18
## 3                    3 Microéconomie 1    15
## 4                    4 Anglais 1           5
\end{lstlisting}

Si on ordonne uniquement par la colonne \texttt{matiere}, par valeurs croissantes :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(tableau, matiere)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 3
##   numero_ligne_initial matiere         notes
##                  <dbl> <chr>           <dbl>
## 1                    2 Anglais 1          18
## 2                    4 Anglais 1           5
## 3                    1 Microéconomie 1    20
## 4                    3 Microéconomie 1    15
\end{lstlisting}

Les lignes où \texttt{matiere} vaut \texttt{"Anglais\ 1"} sont remontées avant celles où \texttt{matiere} vaut \texttt{"Microéconomie\ 1"}.

Si on veut, une fois ce tri effectué, trier par valeurs croissantes de \texttt{notes}, en conservant les observations pour l'anglais avant celles de la microéconomie :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(tableau, matiere, notes)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 3
##   numero_ligne_initial matiere         notes
##                  <dbl> <chr>           <dbl>
## 1                    4 Anglais 1           5
## 2                    2 Anglais 1          18
## 3                    3 Microéconomie 1    15
## 4                    1 Microéconomie 1    20
\end{lstlisting}

\end{notebox}

\begin{greenbox}

À votre tour.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Trier le tableau \texttt{notes\_L1} par valeurs décroissante des noms (colonne \texttt{nom}) .
\item
  Trier le tableau \texttt{notes\_L1} par valeurs croissante des matières (colonne \texttt{matiere}) et valeurs croissante des noms (colonne \texttt{nom}).
\item
  Affichez le top 3 des élèves par matière. Pour ce faire :
\end{enumerate}

\begin{itemize}
\tightlist
\item
  regroupez les les observations par matiere (colonne \texttt{matiere}),
\item
  triez les observations par valeurs décroissantes des notes (colonne \texttt{note}),
\item
  utilisez la fonction \VERB|\FunctionTok{slice\_head}\NormalTok{()}| sur le tableau trié (et groupé) pour extraire uniquement les 3 premières observations de chaque groupe.
\end{itemize}

\end{greenbox}

\hypertarget{jointures}{%
\section{Jointures}\label{jointures}}

Il n'est pas rare d'avoir deux tableaux de données qui disposent d'une ou de plusieurs colonnes communes, et qui peuvent être joints. Dans l'archive téléchargée au début de ce chapitre, vous avez extrait un fichier intitulé \texttt{moyennes.RData} que vous avez placé dans le répertoire \texttt{Data} de votre projet. Ce fichier contient deux tableaux de données :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{moyennes\_L1} : les moyennes à l'année de L1, sur 20, pour les élèves ;
\item
  \texttt{moyennes\_L2} : les moyennes à l'année de L2, sur 20, pour les élèves.
\end{enumerate}

\begin{greenbox}
Chargez dans R les données contenues dans le fichier \texttt{moyennes.RData}

\end{greenbox}

La plupart des élèves de L1 sont aussi en L2 et vice-versa, mais certaines personnes étaient en L1 et n'ont pas été en L2, tandis que d'autres sont arrivées en L2 mais sont absentes du tableau concernant la L1.

Admettons que l'on souhaite mettre en commun les deux tableaux. Ils diposent tous deux d'une colonne indiquant les noms, une autre indiquant les prénoms, une autre indiquant l'identifiant, et enfin une dernière indiquant la moyenne annuelle. Cependant, le nom des colonnes de noms et prénoms diffère d'une année à l'autre : la colonne \texttt{nom} du tableau \texttt{moyennes\_L1} s'appelle \texttt{last\_name} dans le tableau \texttt{moyennes\_L2} et la colonne \texttt{prenom} dans \texttt{moyennes\_L1} est désignée par \texttt{first\_name} dans \texttt{moyennes\_L2} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{moyennes\_L1}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 32 x 4
##    nom        prenom     id moyenne_L1
##    <chr>      <chr>   <dbl>      <dbl>
##  1 Amsberry   Evan        1       6.93
##  2 Basurto    Anthony     2       6.36
##  3 Begaye     Kai         3      13.4 
##  4 Brack      Michael     4       5   
##  5 Burgess    Jamie       5       9.36
##  6 Christian  Colton      6      10.3 
##  7 Cly        Jesse       7       5.29
##  8 Coberley   Rebecca     8       9.5 
##  9 De Venecia Madison     9       4.07
## 10 Gurule     Elliott    12       7.71
## # ... with 22 more rows
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{moyennes\_L2}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 31 x 4
##    last_name  first_name    id moyenne_L2
##    <chr>      <chr>      <dbl>      <dbl>
##  1 Amsberry   Evan           1       4.21
##  2 Basurto    Anthony        2       8.21
##  3 Begaye     Kai            3      15.6 
##  4 Brack      Michael        4       6.36
##  5 Burgess    Jamie          5       9.21
##  6 Christian  Colton         6      10.2 
##  7 Coberley   Rebecca        8      10.9 
##  8 De Venecia Madison        9       5.79
##  9 Dewitt     Amelia        10       6.93
## 10 Eisenberg  Kelly         11      12.1 
## # ... with 21 more rows
\end{lstlisting}

Si l'on souhaite réaliser une jointure entre les deux tableaux, une multitude de fonctions sont disponibles. Elles partagent une syntaxe commune :

\VERB|\FunctionTok{xx\_join}\NormalTok{(x, y, }\AttributeTok{by =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{copy =} \ConstantTok{FALSE}\NormalTok{, ...)}|,

où \texttt{x} et \texttt{y} sont les tableaux à joindre, \texttt{by} est un vecteur de chaînes de caractères contenant les noms des variables permettant la jointure (si la valeur est \VERB|\ConstantTok{NULL}| -- par défaut -- la jointure se fera à l'aide des variables portant le même nom dans les deux tables).

\begin{notebox}

Si la jointure s'effectue à l'aide de deux colonnes ou plus, on donner au paramètre \VERB|\NormalTok{by}| de la fonction de jointure un vecteur comportant plusieurs éléments, chaque élément indiquant la correspondance entre les noms de colonnes dans les deux tableaux.

La syntaxe est la suivante, si la colonne \texttt{nom\_colonne\_1\_x} du tableau \texttt{x} correspond à la colonne \texttt{nom\_colonne\_1\_y} du tableau \texttt{y}, et si la colonne \texttt{nom\_colonne\_2\_x} du tableau \texttt{x} correspond à la colonne \texttt{nom\_colonne\_2\_y} du tableau \texttt{y}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{xx\_join}\NormalTok{(x, y, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"nom\_colonne\_1\_x"} \OtherTok{=} \StringTok{"nom\_colonne\_1\_y"}\NormalTok{,}
                     \StringTok{"nom\_colonne\_2\_x"} \OtherTok{=} \StringTok{"nom\_colonne\_2\_y"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\end{notebox}

Pour illustrer les différentes jointures, travaillons sur un plus petit jeu de données. Vous aurez l'occasion de vous exercer sur le jeu complet par la suite.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{moy\_l1 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{nom =} \FunctionTok{c}\NormalTok{(}\StringTok{"Fuentes Gomez"}\NormalTok{, }\StringTok{"Kohyann"}\NormalTok{, }\StringTok{"Zagoury"}\NormalTok{, }\StringTok{"Souvestre"}\NormalTok{),}
  \AttributeTok{prenom =} \FunctionTok{c}\NormalTok{(}\StringTok{"Sofia"}\NormalTok{, }\StringTok{"Hugo"}\NormalTok{, }\StringTok{"David"}\NormalTok{, }\StringTok{"Pierre"}\NormalTok{),}
  \AttributeTok{id =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{),}
  \AttributeTok{moyenne\_L1 =} \FunctionTok{c}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{12}\NormalTok{),}
  \AttributeTok{groupe\_TD =} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{, }\StringTok{"A"}\NormalTok{, }\StringTok{"A"}\NormalTok{)}
\NormalTok{)}

\NormalTok{moy\_l2 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{last\_name =} \FunctionTok{c}\NormalTok{(}\StringTok{"Fuentes Gomez"}\NormalTok{, }\StringTok{"Kohyann"}\NormalTok{, }\StringTok{"Lang"}\NormalTok{, }\StringTok{"Souvestre"}\NormalTok{),}
  \AttributeTok{first\_name =} \FunctionTok{c}\NormalTok{(}\StringTok{"Sofia"}\NormalTok{, }\StringTok{"Hugo"}\NormalTok{, }\StringTok{"Lea"}\NormalTok{, }\StringTok{"Pierre"}\NormalTok{),}
  \AttributeTok{id =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{4}\NormalTok{),}
  \AttributeTok{moyenne\_L2 =} \FunctionTok{c}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{13}\NormalTok{),}
  \AttributeTok{groupe\_TD =} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{, }\StringTok{"B"}\NormalTok{)}
\NormalTok{)}

\NormalTok{moy\_l1}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 5
##   nom           prenom    id moyenne_L1 groupe_TD
##   <chr>         <chr>  <dbl>      <dbl> <chr>    
## 1 Fuentes Gomez Sofia      1         12 A        
## 2 Kohyann       Hugo       2         14 B        
## 3 Zagoury       David      3         12 A        
## 4 Souvestre     Pierre     4         12 A
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{moy\_l2}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 5
##   last_name     first_name    id moyenne_L2 groupe_TD
##   <chr>         <chr>      <dbl>      <dbl> <chr>    
## 1 Fuentes Gomez Sofia          1         12 A        
## 2 Kohyann       Hugo           2         14 A        
## 3 Lang          Lea            5         16 B        
## 4 Souvestre     Pierre         4         13 B
\end{lstlisting}

Les différentes fonctions de jointure sont les suivantes :

\begin{itemize}
\tightlist
\item
  \VERB|\FunctionTok{inner\_join}\NormalTok{()}| : toutes les lignes de \texttt{x} pour lesquelles il y a des valeurs correspondantes dans \texttt{y}, et toutes les colonnes de \texttt{x} et \texttt{y}. S'il y a plusieurs correspondances dans les noms entre \texttt{x} et \texttt{y}, toutes les combinaisons possibles sont retournées ;
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{inner\_join}\NormalTok{(moy\_l1, moy\_l2,}
           \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"nom"} \OtherTok{=} \StringTok{"last\_name"}\NormalTok{, }\StringTok{"prenom"} \OtherTok{=} \StringTok{"first\_name"}\NormalTok{, }\StringTok{"id"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 3 x 7
##   nom           prenom    id moyenne_L1 groupe_TD.x moyenne_L2 groupe_TD.y
##   <chr>         <chr>  <dbl>      <dbl> <chr>            <dbl> <chr>      
## 1 Fuentes Gomez Sofia      1         12 A                   12 A          
## 2 Kohyann       Hugo       2         14 B                   14 A          
## 3 Souvestre     Pierre     4         12 A                   13 B
\end{lstlisting}

La colonne \texttt{id} est présente à la fois dans \texttt{moy\_l1} et dans \texttt{moy\_l2}. Il est donc possible de ne pas écrire \VERB|\StringTok{"id"} \OtherTok{=} \StringTok{"id"}| dans le vecteur donné à l'argument \texttt{by}. Nénamoins, ce n'est pas une obligation, nous pouvons très bien écrire l'instruction suivante et obtenir le même résultat que précédemment.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{inner\_join}\NormalTok{(moy\_l1, moy\_l2,}
           \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"nom"} \OtherTok{=} \StringTok{"last\_name"}\NormalTok{, }\StringTok{"prenom"} \OtherTok{=} \StringTok{"first\_name"}\NormalTok{, }\StringTok{"id"} \OtherTok{=} \StringTok{"id"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \VERB|\FunctionTok{left\_join}\NormalTok{()}| : toutes les lignes de \texttt{x}, et toutes les colonnes de \texttt{x} et \texttt{y}. Les lignes dans \texttt{x} pour lesquelles il n'y a pas de correspondance dans y auront des valeurs \VERB|\ConstantTok{NA}| dans les nouvelles colonnes. S'il y a plusieurs correspondances dans les noms entre \texttt{x} et \texttt{y}, toutes les combinaisons sont retournées ;
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{left\_join}\NormalTok{(moy\_l1, moy\_l2,}
          \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"nom"} \OtherTok{=} \StringTok{"last\_name"}\NormalTok{, }\StringTok{"prenom"} \OtherTok{=} \StringTok{"first\_name"}\NormalTok{, }\StringTok{"id"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 7
##   nom           prenom    id moyenne_L1 groupe_TD.x moyenne_L2 groupe_TD.y
##   <chr>         <chr>  <dbl>      <dbl> <chr>            <dbl> <chr>      
## 1 Fuentes Gomez Sofia      1         12 A                   12 A          
## 2 Kohyann       Hugo       2         14 B                   14 A          
## 3 Zagoury       David      3         12 A                   NA <NA>       
## 4 Souvestre     Pierre     4         12 A                   13 B
\end{lstlisting}

\begin{itemize}
\tightlist
\item
  \VERB|\FunctionTok{right\_join}\NormalTok{()}| : toutes les lignes de \texttt{y}, et toutes les colonnes de \texttt{x} et \texttt{y}. Les lignes dans \texttt{y} pour lesquelles il n'y a pas de correspondance dans \texttt{x} auront des valeurs \VERB|\ConstantTok{NA}| dans les nouvelles colonnes. S'il y a plusieurs correspondances dans les noms entre \texttt{x} et \texttt{y}, toutes les combinaisons sont retournées ;
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{right\_join}\NormalTok{(moy\_l1, moy\_l2,}
           \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"nom"} \OtherTok{=} \StringTok{"last\_name"}\NormalTok{, }\StringTok{"prenom"} \OtherTok{=} \StringTok{"first\_name"}\NormalTok{, }\StringTok{"id"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 7
##   nom           prenom    id moyenne_L1 groupe_TD.x moyenne_L2 groupe_TD.y
##   <chr>         <chr>  <dbl>      <dbl> <chr>            <dbl> <chr>      
## 1 Fuentes Gomez Sofia      1         12 A                   12 A          
## 2 Kohyann       Hugo       2         14 B                   14 A          
## 3 Souvestre     Pierre     4         12 A                   13 B          
## 4 Lang          Lea        5         NA <NA>                16 B
\end{lstlisting}

\begin{itemize}
\tightlist
\item
  \VERB|\FunctionTok{semi\_join}\NormalTok{()}| : toutes les lignes de \texttt{x} pour lesquelles il y a des valeurs correspondantes dans \texttt{y}, en ne conservant uniquement les colonnes de \texttt{x};
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{semi\_join}\NormalTok{(moy\_l1, moy\_l2,}
          \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"nom"} \OtherTok{=} \StringTok{"last\_name"}\NormalTok{, }\StringTok{"prenom"} \OtherTok{=} \StringTok{"first\_name"}\NormalTok{, }\StringTok{"id"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 3 x 5
##   nom           prenom    id moyenne_L1 groupe_TD
##   <chr>         <chr>  <dbl>      <dbl> <chr>    
## 1 Fuentes Gomez Sofia      1         12 A        
## 2 Kohyann       Hugo       2         14 B        
## 3 Souvestre     Pierre     4         12 A
\end{lstlisting}

\begin{itemize}
\tightlist
\item
  \VERB|\FunctionTok{anti\_join}\NormalTok{()}| : toutes les lignes de \texttt{x} pour lesquelles il n'y a pas de correspondances dans \texttt{y}, en ne conservant que les colonnes de \texttt{x}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anti\_join}\NormalTok{(moy\_l1, moy\_l2,}
          \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"nom"} \OtherTok{=} \StringTok{"last\_name"}\NormalTok{, }\StringTok{"prenom"} \OtherTok{=} \StringTok{"first\_name"}\NormalTok{, }\StringTok{"id"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 1 x 5
##   nom     prenom    id moyenne_L1 groupe_TD
##   <chr>   <chr>  <dbl>      <dbl> <chr>    
## 1 Zagoury David      3         12 A
\end{lstlisting}

\begin{itemize}
\tightlist
\item
  \VERB|\FunctionTok{full\_join}\NormalTok{()}| : toutes les lignes et toutes les colonnes de \texttt{x} et de \texttt{y}. Les lignes dans \texttt{x} pour lesquelles il n'y a pas de correspondance dans \texttt{y} auront des valeurs \VERB|\ConstantTok{NA}| dans les colonnes de \texttt{y}. Les lignes dans \texttt{y} pour lesquelles il n'y a pas de correspondance dans \texttt{x} auront des valeurs \VERB|\ConstantTok{NA}| dans les colonnes de \texttt{x}. S'il y a plusieurs correspondances dans les noms entre \texttt{x} et \texttt{y}, toutes les combinaisons sont retournées ;
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{full\_join}\NormalTok{(moy\_l1, moy\_l2,}
          \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"nom"} \OtherTok{=} \StringTok{"last\_name"}\NormalTok{, }\StringTok{"prenom"} \OtherTok{=} \StringTok{"first\_name"}\NormalTok{, }\StringTok{"id"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 5 x 7
##   nom           prenom    id moyenne_L1 groupe_TD.x moyenne_L2 groupe_TD.y
##   <chr>         <chr>  <dbl>      <dbl> <chr>            <dbl> <chr>      
## 1 Fuentes Gomez Sofia      1         12 A                   12 A          
## 2 Kohyann       Hugo       2         14 B                   14 A          
## 3 Zagoury       David      3         12 A                   NA <NA>       
## 4 Souvestre     Pierre     4         12 A                   13 B          
## 5 Lang          Lea        5         NA <NA>                16 B
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  À partir des tableaux \texttt{moyennes\_L1} et \texttt{moyennes\_L2} (qui sont importés dans R en chargeant le fichier \texttt{moyennes.RData} que vous avez placé dans le répertoire \texttt{Data} de votre projet), effectuez une jointure permettant d'avoir dans un même tableau l'ensemble des élèves (ayant suivi ou non les deux années) et leur moyenne en L1 et en L2.
\item
  Identifiez à l'aide d'une jointure des tableaux \texttt{moyennes\_L1} et \texttt{moyennes\_L2} les élèves présents en L1 mais pas en L2.
\item
  Identifiez à l'aide d'une jointure des tableaux \texttt{moyennes\_L1} et \texttt{moyennes\_L2} les élèves présents en L2 mais pas en L1.
\end{enumerate}

\end{greenbox}

\hypertarget{r-markdown}{%
\chapter{R Markdown}\label{r-markdown}}

Ce chapitre vise à présenter R Markdown, un environnement de travail permettant de créer des documents en \emph{data science}.

Dans un unique fichier R Markdown, il est possible d'écrire du code et de l'exécuter, puis de produire des rapports (mêlant textes, codes, et résultats des évaluations des codes) visant à être partagés. Les codes peuvent être du R, mais pas uniquement : il est possible d'évaluer des instructions d'autres langages tels python ou SQL, entre autres. Les formats de sortie possible sont nombreux. Parmi les plus utilisés : html, pdf, Word, notebook, ioslides.

Le \emph{package} \{rmarkdown\} peut être installé à l'aide de l'instruction suivante.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"rmarkdown"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Le document de référence principal sur lequel s'appuie cette fiche est l'ouvrage R Markdown Cookbook, rédigé par Yihui Xie, Christophe Dervieux et Emily Riederer (Chapman \& Hall/CRC, 2020). Une version électronique est disponible gratuitement à l'adresse suivante : \url{https://bookdown.org/yihui/rmarkdown-cookbook/}.

Une antisèche de deux pages sur le R Markdown a été réalisée par RStudio : \url{https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf}.

\hypertarget{cruxe9er-un-document-r-markdown-avec-rstudio}{%
\section{Créer un document R Markdown avec RStudio}\label{cruxe9er-un-document-r-markdown-avec-rstudio}}

Pour conserver la prise de bonnes habitudes initiée lors des premières séances, créez dans un premier temps un projet RStudio, en respectant l'arborescence présentée sur l'image ci-dessous.

\begin{figure}
\centering
\includegraphics[width=0.25\textwidth,height=\textheight]{figs/project_tree_structure.png}
\caption{Structure basique pour les projets. Source: \url{https://martinctc.github.io/}.}
\end{figure}

\begin{greenbox}

\textbf{Création d'un projet}

Dans RStudio :

\begin{itemize}
\tightlist
\item
  Cliquez sur le menu \texttt{File}, puis sur \texttt{New\ Project...}.
\item
  Cliquez sur \texttt{New\ Directory}, puis sur \texttt{New\ Project}.
\item
  Donnez un nom au nouveau projet, puis cliquez sur le bouton \texttt{Browse...}
\item
  Choisissez l'emplacement du projet, puis appuyez sur le bouton \texttt{Open}.
\item
  Cliquez sur le bouton \texttt{Create\ Project} pour créer le projet. Une nouvelle session RStudio s'ouvre alors. Le répertoire courant devient celui dans lequel vous avez créé le projet. Un fichier d'extention \texttt{.Rproj} a été créé dans ce répertoire. Il suffira d'ouvrir ce fichier à l'avenir pour ouvrir RStudio pour travailler sur ce projet.
\end{itemize}

\end{greenbox}

\begin{redbox}
Sur les ordinateurs de l'Université, vous veillerez à créer le projet dans le dossier \texttt{C:/Workout}. La compilation sur les VDI (\emph{virtual desktop infrastructure}) semble être impossible pour le moment.

Attention : à la fin de la séance, il faudra penser à copier/coller l'ensemble du répertoire contenant votre projet dans votre dossier \texttt{Documents}. Les contenus du dossier \texttt{C:/Workout} sont effacés à la fermeture de session.

\end{redbox}

À présent que le projet est créé, il est temps de créer un document R Markdown.

\begin{greenbox}
\textbf{Création d'un document R Markdown}

Dans RStudio :

\begin{itemize}
\item
  Cliquez sur le menu \texttt{File}, puis sur \texttt{New\ File...}.
\item
  Cliquez sur \texttt{R\ Markdown...}.
\item
  Dans la fenêtre qui s'affiche :

  \begin{itemize}
  \tightlist
  \item
    assurez-vous d'être dans l'onglet ``Document''
  \item
    donnez un titre au document que vous allez créer
  \item
    renseignez le champ ``Author'' avec vos noms et prénom(s)
  \item
    laissez le bouton radio sur l'option \texttt{HTML} pour que le rapport qui sera créé après soit un document html (langage conçu pour présenter des pages web).
  \item
    créer le document en cliquant sur le bouton \texttt{OK}.
  \end{itemize}
\item
  Sauvegardez le fichier créé en lui donnant le nom de votre choix (par exemple : `premier\_rapport.Rmd``).
\end{itemize}

\includegraphics[width=0.75\textwidth,height=\textheight]{figs/creation_markdown.png}

\end{greenbox}

Un document R Markdown, dont l'extension est \texttt{.Rmd} est alors créé. Ce document est composé de trois parties :

\begin{itemize}
\tightlist
\item
  du YAML (des méta-données) ;
\item
  du texte ;
\item
  des morceaux de code (\emph{code chunks}).
\end{itemize}

\hypertarget{yaml}{%
\subsection{YAML}\label{yaml}}

Dans le document que vous venez de créer, l'en-tête YAML indique :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ }\StringTok{"Mon premier document R Markdown"}
\FunctionTok{author}\KeywordTok{:}\AttributeTok{ }\StringTok{"Ewen Gallic"}
\FunctionTok{date}\KeywordTok{:}\AttributeTok{ }\StringTok{"11/2/2022"}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ html\_document}
\end{Highlighting}
\end{Shaded}

Le titre du document, l'auteur et la date sont précisés dans cette en-tête. Lors de la conversion du fichier Rmd en fichier html par Pandoc (un logiciel de conversion de documents), ces informations seront stockées dans des variables et apparaîtront à un ou plusieurs endroits du fichier html (selon le modèle -- \emph{template} -- utilisé). La ligne \VERB|\FunctionTok{output}\KeywordTok{:}\AttributeTok{ html\_document}| indique quant à elle que le document de sortie sera un document html. D'autres éléments peuvent être indiqués, notamment dans la partie \VERB|\AttributeTok{output}| : présence d'une table des matières, numérotation des sections, ajout d'une feuille de style, etc.

En quelques mots, les étapes de conversion sont les suivantes :

\begin{itemize}
\tightlist
\item
  la fonction \VERB|\FunctionTok{knit}\NormalTok{()}| du \emph{package} \{\texttt{knitr}\} exécute les codes contenus dans les \emph{chunks} et prépare un fichier Markdow (\texttt{.md})
\item
  le logiciel Pandoc convertit le fichier \texttt{.md} dans un format de sortie (html, pdf, etc.)
\end{itemize}

Si le format de sortie est le pdf, une étape supplémentaire est ajoutée : le fichier \texttt{.md} est converti en un fichier LaTeX (\texttt{.tex}). Une compilation du fichier \texttt{.tex} est alors effectuée par LaTeX pour obtenir le fichier pdf final. Cela nécessite de fait d'installer LaTeX ou TinyTeX sur son système.

\begin{notebox}
Dans le cadre de ce cours, nous ne produirons pas de documents au format html sur les ordinateurs de l'Université.

\end{notebox}

\hypertarget{table-des-matiuxe8res}{%
\subsubsection{Table des matières}\label{table-des-matiuxe8res}}

Pour ajouter une table des matières dans un fichier html, on ajoute des paires de clés-valeurs :

\begin{itemize}
\tightlist
\item
  \texttt{toc:\ yes} : on désire la création d'une table des matières (\emph{table of contents}) ;
\item
  \texttt{toc\_depth:\ 3} : l'entier donné en valeur définit la profondeur de la table des matières (1 : uniquement les sections, 2 : sections et sous-sections, 3 : sections, sous-sections et sous-sous sections, etc.)
\item
  \texttt{toc\_float:\ true} : la table des matières sera insérée comme objet flotant et visible en permanence tout le long du document.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{{-}{-}{-}}
\AnnotationTok{title:}\CommentTok{ "Mon premier document R Markdown"}
\AnnotationTok{author:}\CommentTok{ "Ewen Gallic"}
\AnnotationTok{date:}\CommentTok{ "11/7/2022"}
\AnnotationTok{output:}\CommentTok{ html\_document:}
\CommentTok{    toc: yes}
\CommentTok{    toc\_depth: 3}
\CommentTok{    toc\_float: true}
\CommentTok{{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

\begin{notebox}
Attention, il faut respecter les indentations, comme dans l'exemple précédent.

\end{notebox}

Pour une table des matières sur un document final en pdf, le YAML doit contenir les paires \texttt{toc:\ yes} et \texttt{toc\_depth:3}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{{-}{-}{-}}
\AnnotationTok{title:}\CommentTok{ "Mon premier document R Markdown"}
\AnnotationTok{author:}\CommentTok{ "Ewen Gallic"}
\AnnotationTok{date:}\CommentTok{ "11/7/2022"}
\AnnotationTok{output:}\CommentTok{ pdf\_document:}
\CommentTok{    toc: yes}
\CommentTok{    toc\_depth: 3}
\CommentTok{{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

\hypertarget{textes}{%
\subsection{Textes}\label{textes}}

Le fichier \texttt{.Rmd} peut contenir du texte que l'on rédige en markdown. Davantage d'informations seront données dans la suite de cette fiche concernant la syntaxe markdown (qui est très simple).

\hypertarget{morceaux-de-code}{%
\subsection{Morceaux de code}\label{morceaux-de-code}}

Les morceaux de code contiennent deux parties :

\begin{itemize}
\tightlist
\item
  du code à évaluer, dans un langage donné (nous utiliserons du R) ;
\item
  une liste d'options pour le morceau de code.
\end{itemize}

Pour être exécuté, le code fait appel à un environnement (dans lequel des variables peuvent être créées). Cet environnement peut être modifié après l'exécution du code.

\hypertarget{compilation}{%
\subsection{Compilation}\label{compilation}}

Pour compiler un document R Markdown, une fois le YAML bien spécifié, il suffit au choix :

\begin{itemize}
\item
  d'appeler la fonction \VERB|\FunctionTok{render}\NormalTok{()}| du \emph{package} \{\texttt{rmarkdown}\} :

  \begin{itemize}
  \tightlist
  \item
    en lui fournissant le chemin vers le fichier \texttt{Rmd} via l'argument \texttt{input}:\\
    \VERB|\NormalTok{rmarkdown}\SpecialCharTok{::}\FunctionTok{render}\NormalTok{(}\AttributeTok{input =} \StringTok{"votre\_document\_rmarkdown.Rmd"}\NormalTok{)}|
  \item
    il faut ensuite aller dans l'explorateur de fichier / dans Finder pour ouvrir le fichier converti
  \end{itemize}
\item
  de cliquer sur le bouton \texttt{Knit} (on le repère facilement avec son icone d'aiguille à tricoter et sa pelote de laine) ;
\item
  d'appuyer simultanément sur les touches du clavier \texttt{Ctrl\ /\ Cmd\ +\ Shift\ +\ K}.
\end{itemize}

Les deux dernières solutions conduisent à un affichage du résultat dans une fenêtre qui s'ouvre à l'issue de la compilation.

\begin{greenbox}
Compilez votre premier fichier R Markdown avec l'une des trois manières indiquées, puis regardez le résultat.

\end{greenbox}

\hypertarget{markdown}{%
\section{Ecriture du texte : syntaxe en Markdown}\label{markdown}}

Les parties textuelles qui permettent d'ajouter une narration aux rapports peuvent être rédigées en markdown. La sytaxe est très simple.

\hypertarget{texte}{%
\subsection{Texte}\label{texte}}

Il suffit d'écrire comme dans un bloc note pour que le texte soit affiché dans le rapport final.\\
Terminer une ligne par deux espaces permet d'aller à la ligne.

Laisser une ligne vide entre deux textes permet de créer un nouveau paragraphe.

\hypertarget{styles-de-texte}{%
\subsection{Styles de texte}\label{styles-de-texte}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.1818}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2121}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.3030}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.3030}}@{}}
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
Style
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Syntaxe
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Exemple
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Rendu
\end{minipage} \\
\midrule
\endhead
Gras & \texttt{**\ **} ou \texttt{\_\_\ \_\_} & \texttt{Du\ texte\ **en\ gras**} & Du texte \textbf{en gras} \\
Italique & \texttt{*\ *} ou \texttt{\_\ \_} & \texttt{Un\ mot\ en\ *italique*} & Un mot en \emph{italique} \\
Barré & \texttt{\textasciitilde{}\textasciitilde{}\ \textasciitilde{}\textasciitilde{}} & \texttt{J\textquotesingle{}\textasciitilde{}\textasciitilde{}aime\textasciitilde{}\textasciitilde{}\ adore\ R} & J'\sout{aime} adore R \\
Une partie en italique dans du gras & \texttt{**-\ -**} & \texttt{Un\ **texte\ \_très\_\ important**} & Un \textbf{texte \emph{très} important} \\
Tout en gras et italique & \texttt{***\ ***} & \texttt{***新年快樂***\ (Xin\ nian\ kuai\ le)} & \textbf{\emph{新年快樂}} (Xin nian kuai le) \\
Exposant & \texttt{\^{}\ \^{}} & \texttt{Le\ 1\^{}er\^{}\ janvier} & Le 1\textsuperscript{er} janvier \\
\bottomrule
\end{longtable}

\hypertarget{titres}{%
\subsection{Titres}\label{titres}}

Il existe six niveaux de titres dans les documents R Markdown. On fait précéder le texte du titre par autant de croisillons (\texttt{\#}) que de niveau désiré.

\texttt{\#\ Titre\ de\ niveau\ 1}

\texttt{\#\#\ Titre\ de\ niveau\ 2}

\texttt{\#\#\#\ Titre\ de\ niveau\ 3}

\texttt{\#\#\#\#\ Titre\ de\ niveau\ 4}

\texttt{\#\#\#\#\#\ Titre\ de\ niveau\ 5}

\texttt{\#\#\#\#\#\#\ Titre\ de\ niveau\ 6}

\begin{notebox}

\emph{Notes} :

\begin{itemize}
\tightlist
\item
  il faut bien faire suivre le croisillon d'une espace ;
\item
  il est nécessaire d'insérer une ligne vide avant et après le titre.
\end{itemize}

\end{notebox}

\hypertarget{citations}{%
\subsection{Citations}\label{citations}}

Pour effectuer une citation dans un bloc, il convient de faire précéder la citation du symbole \textgreater, que l'on place en début de ligne. Exemple avec\texttt{\textgreater{}\ chúc\ mừng\ năm\ mới} :

\begin{quote}
chúc mừng năm mới
\end{quote}

Pour faire en sorte qu'une citation comporte plusieurs paragraphes, un chevron (\texttt{\textgreater{}}) doit être ajouté au début de lignes vides.

\begin{Shaded}
\begin{Highlighting}[]
\AttributeTok{\textgreater{} “How can two people hate so much without knowing each other?”}
\AttributeTok{\textgreater{}}
\AttributeTok{\textgreater{} {-}{-}{-} Alan Moore, \_The Killing Joke\_}
\end{Highlighting}
\end{Shaded}

\begin{quote}
``How can two people hate so much without knowing each other?''

--- Alan Moore, \emph{The Killing Joke}
\end{quote}

\hypertarget{tirets-longs-tirets-moyens}{%
\subsection{Tirets longs, tirets moyens}\label{tirets-longs-tirets-moyens}}

Pour insérer un tiret long (cadratin), on utilise trois tirets : \texttt{-\/-\/-} ; pour un tiret court (ou demi-cadratin), on utilise deux tirets : \texttt{-\/-}.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2821}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1795}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1795}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1795}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1795}}@{}}
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
Symbole voulu
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Syntaxe
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Exemple
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Rendu
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
\end{minipage} \\
\midrule
\endhead
Tiret long (cadratin) & \texttt{-\/-\/-} & \texttt{-\/-\/-\ une\ réplique} & --- une réplique & \\
Tiret moyen (demi-cadratin) & \texttt{-\/-} & \texttt{La\ frontière\ France-\/-Italie} & La frontière France--Italie & \\
\bottomrule
\end{longtable}

\hypertarget{lignes-horizontale}{%
\subsection{Lignes horizontale}\label{lignes-horizontale}}

En inscrivant trois tirets \texttt{-\/-\/-} et en passant immédiatement à la ligne, une ligne horizontale est insérée.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{points-de-suspension}{%
\subsection{Points de suspension}\label{points-de-suspension}}

Pour écrire des points de suspension, il suffit d'écrire trois points (\texttt{...}) à la suite\ldots{}

\hypertarget{liens-hypertextes}{%
\subsection{Liens hypertextes}\label{liens-hypertextes}}

La création d'un lien hypertexte se fait en utilisant deux éléments : un texte sur lequel on clique, qui doit être entouré par des crochets \texttt{{[}{]}} et une adresse vers laquelle le lien point, qui doit être entourée par des parenthèses (\texttt{()}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Regardez cette }\CommentTok{[}\OtherTok{vidéo épatante}\CommentTok{](https://www.youtube.com/watch?v=dQw4w9WgXcQ)}\NormalTok{.}
\end{Highlighting}
\end{Shaded}

Regardez cette \href{https://www.youtube.com/watch?v=dQw4w9WgXcQ}{vidéo épatante}.

Pour créer un lien sans définir de texte spécifique en remplacement de l'URL, il est possible de simplement écrire l'URL. Il est toutefois préférable d'encadrer l'URL par des chevrons. Il en va de même pour une adresse email.

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\textless{}https://www.youtube.com/watch?v=oavMtUWDBTM\textgreater{}}  
\OtherTok{\textless{}ewen.gallic@univ{-}amu.fr\textgreater{}}
\end{Highlighting}
\end{Shaded}

\url{https://www.youtube.com/watch?v=oavMtUWDBTM}\strut \\
\href{mailto:ewen.gallic@univ-amu.fr}{\nolinkurl{ewen.gallic@univ-amu.fr}}

Pour créer une ancre (un lien vers un endroit précis de la page déjà affichée) \textbf{vers un titre} du document, il faut connaître la référence vers le \protect\hyperlink{lien-ancre}{point d'ancrage}. Un moyen simple consiste à la définir soi-même, en utilisant la syntaxe suivante :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\# Le titre \{\#nom{-}de{-}la{-}reference\}}
\end{Highlighting}
\end{Shaded}

Le nom de la reference ne doit pas contenir d'espaces ni de traits de soulignement (\texttt{\_}). Il peut en revanche, comme dans l'exemple, contenir des tirets (\texttt{-}).

Dans ce document, la sous section dans laquelle ce texte est inscrit, est définie comme suit :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\#\# Liens hypertextes \{\#liens{-}hypertextes\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{On peut ainsi faire un lien vers cette }\CommentTok{[}\OtherTok{section}\CommentTok{](\#liens{-}hypertextes)}\NormalTok{.}
\end{Highlighting}
\end{Shaded}

On peut ainsi faire un lien vers cette \protect\hyperlink{liens-hypertextes}{section}.

\hypertarget{notes-de-bas-de-page}{%
\subsection{Notes de bas de page}\label{notes-de-bas-de-page}}

L'insertion de notes de bas de page numérotées s'effectue à l'aide de crochets (\texttt{{[}{]}}) contenant un accent circonflèxe et une référence qui peut être soit un nombre, soit un texte (mais sans espace ou autre caractère blanc).

Le numéro de la note de bas de page est un lien qui renvoie vers la note. Une flèche de retour est proposée pour ramener au texte lorsque le document créé est un document html.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Une note de bas de page simple}\OtherTok{[\^{}1]}\NormalTok{ suivie d\textquotesingle{}une plus longue}\OtherTok{[\^{}longue{-}note]}\NormalTok{.}

\OtherTok{[\^{}1]: }\NormalTok{la note de bas de page.}

\OtherTok{[\^{}longue{-}note]: }\NormalTok{une note de bas de page plus longue.}

\InformationTok{    Dans laquelle on peut écrire un paragraphe.}

\InformationTok{    \textasciigrave{}\{ du code \}\textasciigrave{}}

\InformationTok{    Plusieurs paragraphes, même.}
\end{Highlighting}
\end{Shaded}

Une note de bas de page simple\footnote{la note de bas de page.} suivie d'une plus longue\footnote{une note de bas de page plus longue.

  Dans laquelle on peut écrire un paragraphe.

  \texttt{\{\ du\ code\ \}}

  Plusieurs paragraphes, même.}.

\hypertarget{listes-1}{%
\subsection{Listes}\label{listes-1}}

On distingue deux types de listes : les listes ordonnées et les listes non ordonnées.

\hypertarget{listes-ordonnuxe9es}{%
\subsubsection{Listes ordonnées}\label{listes-ordonnuxe9es}}

Pour créer une liste ordonnée, on place en début de ligne, devant chaque élément de la lique, un nombre immédiatement suivi d'un point et d'une espace.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialStringTok{1. }\NormalTok{Un premier élément ;}
\SpecialStringTok{2. }\NormalTok{Un deuxième élément ;}
\SpecialStringTok{3. }\NormalTok{Un troisième élément.}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Un premier élément ;
\item
  Un deuxième élément ;
\item
  Un troisième élément.
\end{enumerate}

Il n'est pas nécessaire de respecter la numérotation :

\begin{Shaded}
\begin{Highlighting}[]
\SpecialStringTok{1. }\NormalTok{Un premier élément ;}
\SpecialStringTok{10. }\NormalTok{Un deuxième élément ;}
\SpecialStringTok{5. }\NormalTok{Un troisième élément.}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Un premier élément ;
\item
  Un deuxième élément ;
\item
  Un troisième élément.
\end{enumerate}

Le numéro du premier élément de la liste ordonnée définit la valeur du compteur :

\begin{Shaded}
\begin{Highlighting}[]
\SpecialStringTok{4. }\NormalTok{Un premier élément ;}
\SpecialStringTok{10. }\NormalTok{Un deuxième élément ;}
\SpecialStringTok{5. }\NormalTok{Un troisième élément.}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Un premier élément ;
\item
  Un deuxième élément ;
\item
  Un troisième élément.
\end{enumerate}

\hypertarget{listes-non-ordonnuxe9es}{%
\subsubsection{Listes non ordonnées}\label{listes-non-ordonnuxe9es}}

Pour insérer une liste non ordonnée, on fait précéder chaque élément du symbole \texttt{-} ou du symbole \texttt{*}.

\begin{Shaded}
\begin{Highlighting}[]
\AnnotationTok{Une liste comprenant :}

\SpecialStringTok{* }\NormalTok{un premier élément ;}
\SpecialStringTok{* }\NormalTok{un deuxième élément ;}
\SpecialStringTok{* }\NormalTok{un troisième élément.}
\end{Highlighting}
\end{Shaded}

Une liste comprenant :

\begin{itemize}
\tightlist
\item
  un premier élément ;
\item
  un deuxième élément ;
\item
  un troisième élément.
\end{itemize}

\hypertarget{listes-imbriquuxe9es}{%
\subsection{Listes imbriquées}\label{listes-imbriquuxe9es}}

Pour ajouter une liste à l'intérieur d'une liste, il faut ajouter avant le tiret ou l'étoile soit un taquet de tabulation, soit 4 espaces.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialStringTok{{-} }\NormalTok{un premier élément ;}
\SpecialStringTok{{-} }\NormalTok{un deuxième élément :}
\SpecialStringTok{    {-} }\NormalTok{qui contient un sous{-}élement,}
\SpecialStringTok{    {-} }\NormalTok{ainsi qu\textquotesingle{}un deuxième sous{-}élément,}
\SpecialStringTok{    {-} }\NormalTok{et un troisième ;}
\SpecialStringTok{{-} }\NormalTok{puis un troisième élément.}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  un premier élément ;
\item
  un deuxième élément :

  \begin{itemize}
  \tightlist
  \item
    qui contient un sous-élement,
  \item
    ainsi qu'un deuxième sous-élément,
  \item
    et un troisième ;
  \end{itemize}
\item
  puis un troisième élément.
\end{itemize}

Pour écrire un paragraphe à l'intérieur d'une liste, une identation (taquet de tabulation ou 4 espaces) doit être ajoutéé, pour préserver la continuité de la liste. Il faut également faire précéder le paragraphe d'une liste vide (on peut aussi ajouter une ligne vide après le paragraphe, mais celle-ci est optionnelle).

\begin{Shaded}
\begin{Highlighting}[]
\SpecialStringTok{{-} }\NormalTok{un premier élément ;}
\SpecialStringTok{{-} }\NormalTok{un deuxième élément :}

\NormalTok{    qui contient un paragraphe.}
    
\SpecialStringTok{{-} }\NormalTok{puis un troisième élément.}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  un premier élément ;
\item
  un deuxième élément :

  qui contient un paragraphe.
\item
  puis un troisième élément.
\end{itemize}

Il est tout à fait possible d'imbriquer une liste ordonnée dans une liste non ordonnée et vice-versa.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialStringTok{1. }\NormalTok{Un premier élément :}
\SpecialStringTok{    {-} }\NormalTok{avec un sous{-}élément ;}
\SpecialStringTok{2. }\NormalTok{Un deuxième élément.}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Un premier élément :

  \begin{itemize}
  \tightlist
  \item
    avec un sous-élément ;
  \end{itemize}
\item
  Un deuxième élément.
\end{enumerate}

\begin{notebox}

Règles de typographie :

En français, les listes sont généralement introduites par une phrase se terminant par deux tirets (\texttt{:}). Les éléments de la liste ne commencent alors pas par une majuscule. Les éléments sont séparés par un point virgule (\texttt{;}), et le dernier élément se termine par un point.

Une liste comprenant :

\begin{itemize}
\tightlist
\item
  un premier élément ;
\item
  un deuxième élément ;
\item
  un troisième élément.
\end{itemize}

Lorsque la liste est numérotée, il faut en revanche mettre une majuscule à chaque élément de la liste

Une liste comprenant :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Un premier élément ;
\item
  Un deuxième élément ;
\item
  Un troisième élément.
\end{enumerate}

Lorsqu'une liste se compose de plusieurs phrases, chaque élément commence par une majuscule et se termine par un point.

Les personnes pouvant postuler :

\begin{itemize}
\item
  Pour les personnes ayant validé une Licence 2 mention ``Économie-Gestion'' à Aix-Marseille Université ou dans une autre Université française : entrée de droit dans le parcours.
\item
  Pour les personnes ayant validé un niveau équivalent à la Licence 2 en Économie ou en Économie-Gestion (Licence 2 mention Économie, DUT, CPGE, etc.) : une commission pédagogique évalue les dossiers notamment sur la base des pré-requis mentionnés plus haut ainsi que sur la base des projets de Master des étudiantes et étudiants.
\item
  les règles de typographie françaises indiquent qu'il est d'usage de placer un point virgule à la fin des éléments de niveau 1 ou au dernier élément de niveau supérieur à 1 si celui-ci est immédiatement suivi par un élément de niveau 1 ;
\item
  pour les éléments de niveau 2, une
\end{itemize}

En cas de listes imbriquées, la virgule est utilisée en fin de ligne, sauf pour le dernier élément de la liste imbriquée qui lui, s'achève par un point virgule ou un point s'il s'agit du dernier élément de la liste.

Une liste qui comprend :

\begin{itemize}
\item
  un élément de niveau 1
\item
  un autre élément de niveau 1 :

  \begin{itemize}
  \tightlist
  \item
    avec un sous-élément de niveau 2,
  \item
    ainsi qu'un autre ;
  \end{itemize}
\item
  un troisième élément de niveau 1.
\end{itemize}

\end{notebox}

\hypertarget{images}{%
\subsection{Images}\label{images}}

L'ajout d'une image se fait en insérant un point d'exclamation (\texttt{!}), suivi d'une d'un titre entre crochets, puis du chemin vers l'image, entre parenthèses (\texttt{()}). Une description de l'image peut être ajoutée entre guillemets (\texttt{""}) après le chemin, toujours dans les parenthèses (cette description est visible au survol de l'image, lorsque le pointeur de la souris reste quelques secondes au-dessus de l'image, et peut être lue à voix haute par les systèmes destinés aux personnes en situation de handicap). Enfin, pour spécifier des paramètres de taille de l'image, il est possible d'ajouter des informations entre crochets (\texttt{\{\}}).

\begin{Shaded}
\begin{Highlighting}[]
\AlertTok{![Un tigre](figs/tigre.JPG "Tigre en papier")}\NormalTok{\{width="200px"\}}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics[width=2.08333in,height=\textheight]{figs/tigre.JPG}
\caption{Un tigre}
\end{figure}

\hypertarget{tableaux}{%
\subsection{Tableaux}\label{tableaux}}

La création d'un tableau se fait en distinguant l'en-tête du corps du tableau. Chaque cellule est séparée à l'aide d'une barre verticale (\texttt{\textbar{}}, \texttt{Alt\ gr\ +\ 6} sur un clavier azerty sous Windows, et Alt + Shift + L` sur Mac Os). On ajoute des barres verticales au début et à la fin de chaque ligne du tableau. Pour délimiter l'en-tête du corps du tableau, trois tirets ou plus doivent être placés entre les barres verticales.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{| Première colonne | Deuxième colonne | Troisième colonne |}
\NormalTok{| {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} | {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} | {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} |}
\NormalTok{| cellule 1, ligne 1 | cellule 2, ligne 1 | cellule 3, ligne 1 |}
\NormalTok{| cellule 1, ligne 2 | cellule 2, ligne 2 | cellule 3, ligne 2 |}
\NormalTok{| cellule 1, ligne 3 | cellule 2, ligne 3 | cellule 3, ligne 3 |}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lll@{}}
\toprule
Première colonne & Deuxième colonne & Troisième colonne \\
\midrule
\endhead
cellule 1, ligne 1 & cellule 2, ligne 1 & cellule 3, ligne 1 \\
cellule 1, ligne 2 & cellule 2, ligne 2 & cellule 3, ligne 2 \\
cellule 1, ligne 3 & cellule 2, ligne 3 & cellule 3, ligne 3 \\
\bottomrule
\end{longtable}

\hypertarget{alignement}{%
\subsubsection{Alignement}\label{alignement}}

La gestion de l'alignement des colonnes se fait à l'aide de la deuxième ligne, celle composée des tirets. Pour un alignement à gauche, on ajoute deux points (\texttt{:}) à gauche des tirets, pour un alignement à droite, on ajoute ces deux points à droite des tirets, et pour une colonne centrée, on ajoute les deux points à la fois à gauche et à droite.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{| Colonne alignée à gauche | Colonne centrée | Colonne alignée à droite |}
\NormalTok{| :{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} | :{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}: | {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}: |}
\NormalTok{| cellule 1, ligne 1 | cellule 2, ligne 1 | cellule 3, ligne 1 |}
\NormalTok{| cellule 1, ligne 2 | cellule 2, ligne 2 | cellule 3, ligne 2 |}
\NormalTok{| cellule 1, ligne 3 | cellule 2, ligne 3 | cellule 3, ligne 3 |  }
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3208}}
  >{\centering\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3396}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3396}}@{}}
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
Colonne alignée à gauche
\end{minipage} & \begin{minipage}[b]{\linewidth}\centering
Colonne centrée
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Colonne alignée à droite
\end{minipage} \\
\midrule
\endhead
cellule 1, ligne 1 & cellule 2, ligne 1 & cellule 3, ligne 1 \\
cellule 1, ligne 2 & cellule 2, ligne 2 & cellule 3, ligne 2 \\
cellule 1, ligne 3 & cellule 2, ligne 3 & cellule 3, ligne 3 \\
\bottomrule
\end{longtable}

\hypertarget{formules-mathuxe9matiques-en-latex}{%
\subsection{Formules mathématiques en LaTeX}\label{formules-mathuxe9matiques-en-latex}}

Il est possible d'utiliser du LaTeX pour écrure des équations mathématiques en Markdown. On distingue deux types de formules :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  les formules en ligne : en entourant l'expression des symboles dollar (\texttt{\$equation\$})
\item
  les formules en mode \emph{display} : en entourant l'expression de deux symboles dollar de chaque côté (\texttt{\$\$equation\$\$}).
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Les formules en ligne, $f(x)=x\^{}2+3x+4, x\textbackslash{}in\textbackslash{}mathbb\{R\}$, permettent}
\NormalTok{d\textquotesingle{}insérer des formules dans un paragraphe, tandis que les formules en mode}
\NormalTok{\_display\_ permettent d\textquotesingle{}insérer des formules dans un bloc à part $$X\textbackslash{}sim\textbackslash{}mathcal\{N\}(0,1).$$}
\end{Highlighting}
\end{Shaded}

Les formules en ligne, \(f(x)=x^2+3x+4, x\in\mathbb{R}\), permettent d'insérer des formules dans un paragraphe, tandis que les formules en mode \emph{display} permettent d'insérer des formules dans un bloc à part \[X\sim\mathcal{N}(0,1).\]

Une antisèche réalisée par Jim Hefferon, permettant de rédiger des formules en LaTeX est disponible sur le réseau complet d'archives TeX (CTAN) : \url{http://tug.ctan.org/info/undergradmath/undergradmath.pdf}.

\hypertarget{md-codes-blocs-codes}{%
\subsection{Codes et blocs de code}\label{md-codes-blocs-codes}}

Pour présenter du code, il existe deux manières en RMarkdown : soit des codes en ligne, directement insérés dans le texte, soit des blocs de code. Pour écrire des codes en ligne, on écrit le code entre deux accents graves (\texttt{\textasciigrave{}\ \textasciigrave{}}, \texttt{Alt\ gr\ +\ 7} sur un clavier azerty sous Windows, touche \texttt{\textasciigrave{}} sous Mac Os). Si on désire avoir une coloration syntaxique, il faut de surcroît indiquer le langage entre crochets (\texttt{\{\}}), après un point (\texttt{\{.nom-du-langage\}}) :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{La fonction }\InformationTok{\textasciigrave{}mean(x)\textasciigrave{}}\NormalTok{\{.R\} permet de calculer la moyenen de }\InformationTok{\textasciigrave{}x\textasciigrave{}}\NormalTok{.  }
\NormalTok{L\textquotesingle{}instruction }\InformationTok{\textasciigrave{}SELECT * FROM base\textasciigrave{}}\NormalTok{\{.SQL\} permet de récupérer}
\NormalTok{l\textquotesingle{}ensemble des colonnes de la base }\InformationTok{\textasciigrave{}base\textasciigrave{}}\NormalTok{ en SQL.}
\end{Highlighting}
\end{Shaded}

La fonction \VERB|\FunctionTok{mean}\NormalTok{(x)}| permet de calculer la moyenen de \texttt{x}.\\
L'instruction \VERB|\KeywordTok{SELECT} \OperatorTok{*} \KeywordTok{FROM}\NormalTok{ base}| permet de récupérer l'ensemble des colonnes de la base \texttt{base} en SQL.

Pour insérer des blocs de code, on utilise trois accents grave (\texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}}) avant et après le code :

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\InformationTok{x \textless{}{-} mean(ventes$Sales, na.rm=TRUE)}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

Ce qui produira :

\begin{lstlisting}
x <- mean(ventes$Sales, na.rm=TRUE)
\end{lstlisting}

À nouveau, si le langage du code contenu dans le bloc est spécifié, on obtient une coloration syntaxique. Le nom du langage est donné immédiatement après les trois accents graves.

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}r}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(ventes}\SpecialCharTok{$}\NormalTok{Sales, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{)}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

Donnera :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(ventes}\SpecialCharTok{$}\NormalTok{Sales, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{morceaux-de-code-1}{%
\section{Morceaux de code}\label{morceaux-de-code-1}}

Les codes et blocs de codes rédigés dans la \protect\hyperlink{md-codes-blocs-codes}{section ``Codes et blocs de code''} ne sont jamais exécutés. Un des intérêts du RMarkdown réside dans la possibilité d'évaluer des codes (nous n'exécuterons ici que du R, mais il est possible d'exécuter d'autres langages dans un ficher RMarkdown), de les afficher, et d'afficher les résultats et sorties résultants de l'évaluation.

À nouveau, on peut distinguer deux types de codes : ceux en ligne et les blocs ou \emph{chunks} de code.

\hypertarget{codes-en-ligne}{%
\subsection{Codes en ligne}\label{codes-en-ligne}}

Les codes en ligne sont délimités avec un accent grave au début et un à la fin, comme en markdown. La seule différence est que le nom du langage figure immédiatement après le premier accent grave. Le code ne sera pas retourné, seul son résultat apparaîtra dans le document final. Prenons un exemple simple.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{La moyenne des notes est de }\InformationTok{\textasciigrave{}r mean(c(20, 18, 15, 16))\textasciigrave{}}\NormalTok{.}
\end{Highlighting}
\end{Shaded}

La moyenne des notes est de 17.25.

\hypertarget{blocs-de-code}{%
\subsection{Blocs de code}\label{blocs-de-code}}

Pour insérer des blocs de code, on utilise comme en markdown les trois accents graves avant et après le code. On fait suivre le troisième accent grave du début par le nom du langage, entre crochets (\{r\}) :

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r\}}
\InformationTok{x \textless{}{-} c(20, 18, 15, 16)}
\InformationTok{x}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

Le résultat est le suivant :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{16}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 20 18 15 16
\end{lstlisting}

On note que par défaut, le code est présent dans le document final ainsi que le résultat de son évaluation (tel qu'affiché dans la console).

\emph{Note} : nous venons de créer l'objet \texttt{x} dans l'environnement. Nous pouvons le réutiliser dans un nouveau code, qu'il soit en ligne (\texttt{\textasciigrave{}r\ \textasciigrave{}}) : 20, 18, 15, 16 ou dans un \emph{chunk} (\texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r\}\ \textasciigrave{}\textasciigrave{}\textasciigrave{}}):

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r\}}
\InformationTok{x}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

qui donne ensuite :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 20 18 15 16
\end{lstlisting}

\begin{notebox}
\textbf{Note} : pour insérer un \emph{chunk}, on peut utiliser le raccourci \texttt{Ctrl\ +\ Alt\ +\ I} sous Windows ou bien \texttt{cmd\ +\ alt/option\ +\ I} sous Mac Os.

\end{notebox}

\hypertarget{paramuxe8tres-des-chunks}{%
\subsubsection{Paramètres des chunks}\label{paramuxe8tres-des-chunks}}

Lorsqu'on définit un \emph{chunk}, il est possible d'ajouter de nombreuses options qui auront un impact sur le fonctionnement du \emph{chunk}. Par exemple, on peut demander d'afficher le code sans l'exécuter, d'afficher le résultat en masquant le code, ou bien de contrôler les paramètres d'affichage des figures si le code en produit. Il existe plus de 50 paramétrages. La liste est disponible sur le site du créateur du \emph{package} \{\texttt{knitr}\} : \url{https://yihui.org/knitr/options/}.

La syntaxe est la suivante :

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r, options\}}
\InformationTok{code}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

Une bonne pratique consiste à attribuer un identifiant unique à chaque \emph{chunk}.

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r identifiant{-}du{-}chunk, options\}}
\InformationTok{x}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

Voici quelques options pratiques.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.5833}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.4167}}@{}}
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
Syntaxe
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Effet
\end{minipage} \\
\midrule
\endhead
\texttt{include\ =\ FALSE} & Ni le code ni les éventuels résultats affichés dans la console n'apparaitront dans le document final. \\
\texttt{echo\ =\ FALSE} & Le code n'apparaîtra pas dans le résultat final, tandis que les résultats seront visibles. \\
\texttt{eval\ =\ FALSE} & Le code apparaîtra dans le document final mais ne sera pas exécuté. \\
\texttt{message\ =\ FALSE} & Les messages générés par l'excution du code n'apparaîtront pas dans le document final. \\
\texttt{warning\ =\ FALSE} & Les messages d'avertissement générés par l'excution du code n'apparaîtront pas dans le document final. \\
\texttt{fig.cap\ =\ "titre"} & Si le code produit une image, le titre indiqué entre les guillemets sera utilisé comme titre de la figure \\
\texttt{fig.width\ =\ "2"}, \texttt{figh.height="4} & Si le code produit une image, permet de définir sa largeur et sa hauteur, respectivement. Les valeurs sont données en pouces (\emph{inches}). \\
\texttt{out.width=\textquotesingle{}50\%\textquotesingle{}}, \texttt{out.height=\textquotesingle{}75\%\textquotesingle{}} & Si le code produit ou affiche une image, permet de définir, en pourcentages, la taille de l'image. \\
\bottomrule
\end{longtable}

Voici un exemple avec une image :

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r plot{-}iris, out.width=\textquotesingle{}75\%\textquotesingle{},}
\InformationTok{fig.cap = "Largeur des sépals en fonction de leur longueur."\}}
\InformationTok{plot(iris$Sepal.Length, iris$Sepal.Width)}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

Ce qui donne :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Sepal.Width)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics[width=0.75\linewidth]{_main_files/figure-latex/plot-iris-1} 

}

\caption{Largeur des sépals en fonction de leur longueur.}\label{fig:plot-iris}
\end{figure}

Le paramétrage de l'\textbf{ensemble} des \emph{chunks} est réglé par une liste (\VERB|\NormalTok{knitr}\SpecialCharTok{::}\NormalTok{opts\_chunk}|). En modifiant les valeurs de cette liste comme dans l'exemple ci-dessous, et en plaçant cette instruction dans un \emph{chunk} positionné juste après l'en-tête en YAML, tous les \emph{chunks} adopteront le comportement spécifié.

Dans l'exemple ci-dessous, tous les codes des \emph{chunks} seront visibles (\VERB|\NormalTok{echo }\OtherTok{=} \ConstantTok{TRUE}|), les messages et les avertissements retournés lors de l'exécution des codes seront masqués (\VERB|\NormalTok{message }\OtherTok{=} \ConstantTok{FALSE}| et \VERB|\NormalTok{warning }\OtherTok{=} \ConstantTok{FALSE}|), les figures produites en R seront centrées (\VERB|\NormalTok{fig.align }\OtherTok{=} \StringTok{"center"}|)

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r chunks{-}settings, echo=FALSE, include=TRUE, message=FALSE, warning=FALSE\}}
\InformationTok{knitr::opts\_chunk$set(echo = TRUE,}
\InformationTok{                      message = FALSE,}
\InformationTok{                      warning = FALSE,}
\InformationTok{                      fig.align = "center")}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\begin{notebox}

\textbf{Note} : le paramétrage du comportement général des \emph{chunks} peut ensuite être modifié pour certains \emph{chunks} spécifiques. Pour ce faire, il suffit d'ajouter dans les paramètres des \emph{chunks} à modifier le comportement désiré. Par exemple, si \VERB|\NormalTok{echo }\OtherTok{=} \ConstantTok{TRUE}| est défini dans la liste des paramètres de la liste \VERB|\NormalTok{knitr}\SpecialCharTok{::}\NormalTok{opts\_chunk}|, si on souhaite masquer le code d'un \emph{chunk} spécifique, il suffit de lui ajouter l'option \VERB|\NormalTok{echo }\OtherTok{=} \ConstantTok{FALSE}| :

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r, echo=FALSE\}}
\InformationTok{\# code du chunk}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\end{notebox}

\hypertarget{mise-en-cache}{%
\subsection{Mise en cache}\label{mise-en-cache}}

Lorsqu'un document RMarkdown comprend des calculs qui prennent beaucoup de temps à s'effectuer lors de la compilation, il est possible de mettre en cache les résultats de tout ou partie des \emph{chunks}. Pour ce faire, il suffit d'indiquer le paramètre \texttt{cache\ =\ TRUE} dans le ou les \emph{chunks} que l(on souhaite mettre en cache.

Lors de la compilation du document, les \emph{chunks} ayant été mis en cache ne seront pas exécutés par \{\texttt{knitr}\} s'ils ont été exécutés lors de la précédente compilation et qu'aucune modification ne leur a été apportée. Si le code à l'intérieur d'un \emph{chunk} a été modifié entre le moment où il a été exécuté par \{\texttt{knitr}\} lors d'une compilation et une nouvelle compilation (ou si un paramètre du \emph{chunk} autre que \VERB|\NormalTok{include}| a été modifié), alors il sera de nouveau réévalué et remis en cache.

Il est risqué de paramétrer l'ensemble des \emph{chunks} de sorte qu'ils soient tous mis en cache. Si le j\textsuperscript{e} \emph{chunks} est modifié, il sera réévalué par \{\texttt{knitr}\} lors de la compilation. Or, si l'évaluation dépend de variables définies avant le j\textsuperscript{e} \emph{chunk} mais ayant été modifiées \emph{après}, les résultats retournés par la nouvelle évaluation du j\textsuperscript{e} \emph{chunk} risquent de ne pas être reproductibles\ldots{}

Il est parfois utile de vider le cache pour éviter les erreurs mentionnées précédemment. Pour ce faire, on peut cliquer sur la flèche pointant vers le bas située à droite du bouton \texttt{Knit}, puis cliquer sur la ligne commençant par l'emoji ballet \texttt{Clear\ Knitr\ Cache...}.

\begin{notebox}
\textbf{Note} : la mise en cache est surtout utile lordque l'on charge des résultats d'estimation de modèles longs à calculer (des modèles de machine-learning par exemple).

\end{notebox}

\hypertarget{insertion-dune-bibliographie}{%
\section{Insertion d'une bibliographie}\label{insertion-dune-bibliographie}}

Citer une source répond à des normes. Une des normes fréquemment rencontrées en économie est celle de l'association américaine de psychologie (American Psychological Association). Elle reprend l'acronyme de l'association : APA.

Des explications en français sur ces normes sont proposées sur le site des bibliothèques de l'Université de Montréal à l'adresse suivante \url{https://bib.umontreal.ca/citer/styles-bibliographiques/apa}.

On distingue deux manières de citer des références : dans le texte et en bibliographie.

Avec RMarkdown, nous n'avons qu'à nous soucier de la citation dans le texte. L'ajout des références citées en bibliographie se fait ensuite automatiquement, en respectant la norme utilisée. Pour cela, il faut :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  créer un fichier contenant les références, en les distinguant à l'aide d'un identifiant unique ;
\item
  créer le lien entre ce fichier et le document RMarkdown, en le renseignant dans l'en-tête YAML ;
\item
  insérer les références aux documents, dans la partie narrative (texte) du document RMarkdown.
\end{enumerate}

\hypertarget{cruxe9ation-du-fichier-de-bibliographie}{%
\subsection{Création du fichier de bibliographie}\label{cruxe9ation-du-fichier-de-bibliographie}}

Un fichier de bibliographie au format \texttt{.bib} (BibTeX) doit dans un premier temps être créé. Ce fichier contient les références, formatées selon le standard attendu des fichiers bib. Sur le site bibtex.com, la page suivante propose un guide sur les formats BibTeX. \url{https://www.bibtex.com/g/bibtex-format/}.

Chaque entrée dans le fichier BibTeX correspons à une référence bibliographique. Elle est composée de trois parties :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  le type de document : book (livre), article, inbook (un chapitre de livre), inproceedings (un article de colloque), techreport (un rapport technique), etc ;
\item
  un identifiant unique (que l'on utilise ensuite dans le fichier RMarkdown pour faire référence à cette entrée) ;
\item
  une liste de paires de clés-valeurs, où les éléments de la référence sont stockés (titre, auteurs, année de publication, nom de la revue, nom de l'éditeur, etc.).
\end{enumerate}

Prenons un exemple :

\begin{Shaded}
\begin{Highlighting}[]
\VariableTok{@book}\NormalTok{\{}\OtherTok{xie\_2018\_rmarkdown}\NormalTok{,}
  \DataTypeTok{title}\NormalTok{=\{R markdown: The definitive guide\},}
  \DataTypeTok{author}\NormalTok{=\{Xie, Yihui and Allaire, Joseph J and Grolemund, Garrett\},}
  \DataTypeTok{year}\NormalTok{=\{2018\},}
  \DataTypeTok{publisher}\NormalTok{=\{Chapman and Hall/CRC\}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Il s'agit d'un livre, donc le type de document est indiqué à l'aide de \VERB|\VariableTok{@book}|. La référence unique est \texttt{xie\_2018\_rmarkdown}, et les paires de clés-valeurs sont renseignées dans une liste où chaque clé est donnée avant le symbole égal et chaque valeur est donnée après le symbole égal. Les paires sont séparées par une virgule.

\begin{greenbox}
À votre tour : créez un nouveau fichier de script R dans RStudio. Dans ce fichier, collez l'entrée bibliographique du livre de Yihui Xie et al.~Enregistrez le document en le nommant \texttt{biblio.bib}.

Il vous sera demandé si vous souhaitez changer l'extension du fichier pour effectivement utiliser \texttt{.bib} plutôt que \texttt{.R} : dites oui.

\end{greenbox}

Afin d'éviter de devoir rédiger à la main l'ensemble des entrées du fichier BibTeX, il existe de nombreux outils pour nous faciliter le travail. Nous allons en voir quelques-uns.

\hypertarget{crossref}{%
\subsubsection{Crossref}\label{crossref}}

Dans un premier temps, on peut vérifier si la référence existe sur \href{https://www.crossref.org/}{Crossref}. Ce site est très pratique pour obtenir des citations généralement propres, mais il a un inconvénient : il faut parfois être patient, le site rencontre fréquemment des erreurs 500 (\emph{Internal Server Error}).

Essayons de chercher la référence pour l'article de Susan Athey intitulé ``The State of Applied Econometrics: Causality and Policy Evaluation'', publié dans ``The Journal of economic perspectives'' (JEP) en 2017.

Après avoir cliqué sur le bouton ``Search metadata'', on peut coller le titre de l'article : \texttt{The\ State\ of\ Applied\ Econometrics:\ Causality\ and\ Policy\ Evaluation}, puis lancer la recherche en appuyant sur la touche \texttt{Enter} du clavier.

\begin{figure}
\centering
\includegraphics[width=0.3\textwidth,height=\textheight]{figs/crossref_01.png}
\caption{Chercher l'article.}
\end{figure}

Parmi les références proposées, lorsqu'on a identifié celle qui correspond effectivement à celle que l'on recherche, on récupère les métadonnées en cliquant sur le lien \texttt{Actions} puis sur \texttt{Cite}.

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth,height=\textheight]{figs/crossref_02.png}
\caption{Identifier le bon résultat.}
\end{figure}

L'entrée bibliographique au format BibTeX est alors affichée, il ne reste plus qu'à la copier et à la coller dans notre fichier bib.

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth,height=\textheight]{figs/crossref_03.png}
\caption{L'entrée au format BibTeX.}
\end{figure}

\begin{greenbox}
À votre tour : recherchez la référence de l'article de Susan Athey publié dans le JEP en 2017 et collez l'entrée dans votre fichier BibTeX.

\end{greenbox}

Votre fichier BibTeX doit à présent contenir deux entrées (n'oubliez pas de le sauvegarder) :

\begin{Shaded}
\begin{Highlighting}[]
\VariableTok{@book}\NormalTok{\{}\OtherTok{xie\_2018\_rmarkdown}\NormalTok{,}
  \DataTypeTok{title}\NormalTok{=\{R markdown: The definitive guide\},}
  \DataTypeTok{author}\NormalTok{=\{Xie, Yihui and Allaire, Joseph J and Grolemund, Garrett\},}
  \DataTypeTok{year}\NormalTok{=\{2018\},}
  \DataTypeTok{publisher}\NormalTok{=\{Chapman and Hall/CRC\}}
\NormalTok{\}}
\VariableTok{@article}\NormalTok{\{}\OtherTok{Athey\_2017}\NormalTok{,}
    \DataTypeTok{doi}\NormalTok{ = \{10.1257/jep.31.2.3\},}
    \DataTypeTok{url}\NormalTok{ = \{https://doi.org/10.1257\%2Fjep.31.2.3\},}
    \DataTypeTok{year}\NormalTok{ = 2017,}
    \DataTypeTok{month}\NormalTok{ = \{may\},}
    \DataTypeTok{publisher}\NormalTok{ = \{American Economic Association\},}
    \DataTypeTok{volume}\NormalTok{ = \{31\},}
    \DataTypeTok{number}\NormalTok{ = \{2\},}
    \DataTypeTok{pages}\NormalTok{ = \{3{-}{-}32\},}
    \DataTypeTok{author}\NormalTok{ = \{Susan Athey and Guido W. Imbens\},}
    \DataTypeTok{title}\NormalTok{ = \{The State of Applied Econometrics:}
\NormalTok{    Causality and Policy Evaluation\},}
    \DataTypeTok{journal}\NormalTok{ = \{Journal of Economic Perspectives\}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{google-scholar}{%
\subsubsection{Google Scholar}\label{google-scholar}}

Parfois, on ne trouve pas l'information désirée sur Crossref. Il peut alors être une bonne idée d'aller chercher sur \href{https://scholar.google.fr/schhp?hl=fr}{Google Scholar} si la référence existe. Pour l'heure, les références sur Google Scholar ont l'air d'être moins bien renseignées que sur Crossref.

Essayons de retrouver la référence du papier d'Olivier Deschênes et de Michael Greenstone publié dans l'American Economic Review (AER) en 2007. Cherchons le papier par son titre :

\begin{quote}
The economic impacts of climate change: evidence from agricultural output and random fluctuations in weather
\end{quote}

Une fois l'article identifié dans les résultats, il suffit de cliquer sur le lien \texttt{Citer}.

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth,height=\textheight]{figs/google_scholar_1.png}
\caption{L'article de Deschênes et Greenstone sur Google Scholar.}
\end{figure}

Une fenêtre surgit. Les citations pré-formatées selon différents styles sont données. Pour récupérer les métadonnées au format BibTeX, il faut cliquer sur le lien \texttt{BibTeX}.

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth,height=\textheight]{figs/google_scholar_2.png}
\caption{L'article de Deschênes et Greenstone sur Google Scholar.}
\end{figure}

Les métadonnées s'affichent dans une page web. Il ne reste plus qu'à effectuer un copier/coller dans le fichier BibTeX.

\begin{greenbox}
À votre tour : recherchez la référence de l'article d'Olivier Deschênes et de Michael Greenstone publié dans l'AER en 2007 et collez l'entrée dans votre fichier BibTeX.

\end{greenbox}

Votre fichier BibTeX doit à présent contenir trois entrées (n'oubliez pas de le sauvegarder) :

\begin{Shaded}
\begin{Highlighting}[]
\VariableTok{@book}\NormalTok{\{}\OtherTok{xie\_2018\_rmarkdown}\NormalTok{,}
  \DataTypeTok{title}\NormalTok{=\{R markdown: The definitive guide\},}
  \DataTypeTok{author}\NormalTok{=\{Xie, Yihui and Allaire, Joseph J and Grolemund, Garrett\},}
  \DataTypeTok{year}\NormalTok{=\{2018\},}
  \DataTypeTok{publisher}\NormalTok{=\{Chapman and Hall/CRC\}}
\NormalTok{\}}
\VariableTok{@article}\NormalTok{\{}\OtherTok{Athey\_2017}\NormalTok{,}
    \DataTypeTok{doi}\NormalTok{ = \{10.1257/jep.31.2.3\},}
    \DataTypeTok{url}\NormalTok{ = \{https://doi.org/10.1257\%2Fjep.31.2.3\},}
    \DataTypeTok{year}\NormalTok{ = 2017,}
    \DataTypeTok{month}\NormalTok{ = \{may\},}
    \DataTypeTok{publisher}\NormalTok{ = \{American Economic Association\},}
    \DataTypeTok{volume}\NormalTok{ = \{31\},}
    \DataTypeTok{number}\NormalTok{ = \{2\},}
    \DataTypeTok{pages}\NormalTok{ = \{3{-}{-}32\},}
    \DataTypeTok{author}\NormalTok{ = \{Susan Athey and Guido W. Imbens\},}
    \DataTypeTok{title}\NormalTok{ = \{The State of Applied Econometrics:}
\NormalTok{    Causality and Policy Evaluation\},}
    \DataTypeTok{journal}\NormalTok{ = \{Journal of Economic Perspectives\}}
\NormalTok{\}}
\VariableTok{@article}\NormalTok{\{}\OtherTok{deschenes2007economic}\NormalTok{,}
  \DataTypeTok{title}\NormalTok{=\{The economic impacts of climate change:}
\NormalTok{  evidence from agricultural output and random fluctuations in weather\},}
  \DataTypeTok{author}\NormalTok{=\{Desch\{}\CharTok{\textbackslash{}\^{}}\NormalTok{e\}nes, Olivier and Greenstone, Michael\},}
  \DataTypeTok{journal}\NormalTok{=\{American economic review\},}
  \DataTypeTok{volume}\NormalTok{=\{97\},}
  \DataTypeTok{number}\NormalTok{=\{1\},}
  \DataTypeTok{pages}\NormalTok{=\{354{-}{-}385\},}
  \DataTypeTok{year}\NormalTok{=\{2007\}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{un-guxe9nuxe9rateur-de-citations}{%
\subsubsection{Un générateur de citations}\label{un-guxe9nuxe9rateur-de-citations}}

Si jamais la référence que l'on cherche n'est disponible ni sur le site du journal ou de l'éditeur, ni sur crossref, ni sur Google Scholar, il reste la possibilité d'utiliser un générateur de citations comme celui proposé sur ce site : \url{https://www.bibme.org/bibtex}. Il est également évidemment possible de rentrer l'ensemble des informations à la main (mais gare aux erreurs !).

\hypertarget{lier-le-fichier-dentruxe9es-bibliographiques-avec-le-document-rmarkdown}{%
\subsection{Lier le fichier d'entrées bibliographiques avec le document RMarkdown}\label{lier-le-fichier-dentruxe9es-bibliographiques-avec-le-document-rmarkdown}}

Une fois le fichier BibTeX créé, il faut renseigner dans l'en-tête YAML (en-tête de métadonnées) :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  un chemin vers le fichier de bibliographie (dans l'exemple ci-dessous, on suppose que le fichier \texttt{biblio.bib} se trouve dans le même répertoire que le fichier RMarkdown) ;
\item
  éventuellement, on peut préciser le style voulu (ici, nous utilisons la norme APA) ;
\item
  éventuellement, on peut indiquer que nous souhaitons que les citations soient cliquables et renvoient vers la bibliographie
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{{-}{-}{-}}
\AnnotationTok{output:}\CommentTok{ html\_document}
\AnnotationTok{bibliography:}\CommentTok{ biblio.bib}
\AnnotationTok{biblio{-}style:}\CommentTok{ apalike}
\AnnotationTok{link{-}citations:}\CommentTok{ yes}
\CommentTok{{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

\hypertarget{citer-les-documents-dans-le-corps-de-texte}{%
\subsection{Citer les documents dans le corps de texte}\label{citer-les-documents-dans-le-corps-de-texte}}

Nous disposons à présent d'un fichier BibTeX contenant 3 entrées, l'en-tête du document RMarkdown précise où se situe ce fichier d'entrées bibliographiques. Reste à présent à citer les entrées dans le texte.

Pour citer un document, on doit utilise son identifiant unique que l'on place entre crochets, après un symbole arobase : \texttt{{[}@identifiant{]}}.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3500}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3500}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3000}}@{}}
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
Description
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Syntaxe
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
Affichage dans le texte
\end{minipage} \\
\midrule
\endhead
Citation entre parenthèses & \texttt{{[}@xie\_2018\_rmarkdown{]}} & (\protect\hyperlink{ref-xie_2018_rmarkdown}{Xie, Allaire, and Grolemund 2018}) \\
Supprimer la mention de l'auteur & \texttt{{[}-@xie\_2018\_rmarkdown{]}} & (\protect\hyperlink{ref-xie_2018_rmarkdown}{2018}) \\
Ajout d'informations supplémentaires & \texttt{{[}voir\ @xie\_2018\_rmarkdown,\ pp.\ 10-\/-12{]}} & (voir \protect\hyperlink{ref-xie_2018_rmarkdown}{Xie, Allaire, and Grolemund 2018, 10--12}) \\
Citation multiple & \texttt{{[}@xie\_2018\_rmarkdown;Athey\_2017{]}} & (\protect\hyperlink{ref-xie_2018_rmarkdown}{Xie, Allaire, and Grolemund 2018}; \protect\hyperlink{ref-Athey_2017}{Athey and Imbens 2017}) \\
Citation sans les parenthèses pour les auteurs & \texttt{@xie\_2018\_rmarkdown} & Xie, Allaire, and Grolemund (\protect\hyperlink{ref-xie_2018_rmarkdown}{2018}) \\
\bottomrule
\end{longtable}

La bibliographie à la fin du document sera automatiquement ajoutée. On peut placer une section \texttt{\#\ Références} à la fin du document pour faire une rupture avec la section précédente. Cette section ne sera pas numérotée.

\hypertarget{statistiques-descriptives}{%
\chapter{Statistiques descriptives}\label{statistiques-descriptives}}

Ce chapitre vous permet de mobiliser vos connaissances acquises avec le \protect\hyperlink{tableaux-de-donnuxe9es}{chapitre sur les tableaux de données} et le \protect\hyperlink{markdown}{chapitre sur R Markdown} pour produire rapidement des résumés statistiques à partir de données tabulaires.

\hypertarget{donnuxe9es-du-chapitre}{%
\section{Données du chapitre}\label{donnuxe9es-du-chapitre}}

Dans ce chapitre, vous allez manipuler des données qui proviennent de l'article de Bertrand and Mullainathan (\protect\hyperlink{ref-bertrand_2004_AER}{2004}) intitulé \emph{Are Emily and Greg More Employable Than Lakisha and Jamal?}, dans lequel les auteurs se sont penchés sur l'existence de discrimination sur le marché du travail aux États-Unis. Dans leur travail, les chercheurs ont envoyé des faux CVs en réponse à des annonces postées dans des journeaux à Boston et à Chicago. Ces faux CVs ont été réalisés de manière aléatoire, en faisant varier diverses caractéristiques : le genre de la personne qui postule, la qualité de rédaction, l'expérience, le niveau d'études, etc. Ce qui intéresse les auteurs est de mesurer la discrimination raciale. Plutôt que d'indiquer l'ethnicité des personnes sur les CVs, les auteurs ont choisi de donner des noms à consonnance afro-américaine ou caucasienne aux faux CVs, en attribuant de manière aléatoire les noms aux faux CVs.

Le \emph{package} \{AER\} fournit les données de l'étude. Si ce \emph{package} n'est pas installé sur votre machine, vous pouvez l'installer comme suit :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"AER"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Ensuite, vous pouvez charger le jeu de données \texttt{ResumeNames} comme suit :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(ResumeNames, }\AttributeTok{package =} \StringTok{"AER"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Pour afficher la page d'aide du jeu de données \texttt{ResumeNames} et ainsi accéder au descriptif des variables, vous pouvez écrire dans la console R :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{help}\NormalTok{(}\StringTok{"ResumeNames"}\NormalTok{, }\AttributeTok{package =} \StringTok{"AER"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Nous allons nous concentrer sur les variables listées dans le Tableau~\ref{tab:resumes-liste-variables} (libre à vous d'en conserver davantage par la suite pour explorer ces données) :

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.4211}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.5789}}@{}}
\caption{\label{tab:resumes-liste-variables} Caractéristiques des fichiers texte avec séparateur de champ}\tabularnewline
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
Variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Description
\end{minipage} \\
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
Variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Description
\end{minipage} \\
\midrule
\endhead
\texttt{name} & Prénom de la personne qui postule (personne fictive) \\
\texttt{gender} & Genre de la personne qui postule (\texttt{female} ou \texttt{male}) \\
\texttt{ethnicity} & Ethnicité de la personne qui postule (\texttt{cauc}: prénom à consonnance caucasienne ou \texttt{afam} : prénom à consonnance afro-américaine) \\
\texttt{call} & La personne qui postule a-t-elle été rappelée ? (\texttt{no} ou \texttt{yes}) \\
\texttt{city} & Ville concernée par l'annonce (\texttt{chicago} ou \texttt{boston}) \\
\texttt{jobs} & Nombre d'emplois précédents listés dans le CV \\
\texttt{experience} & Nombre d'années d'expériences listées dans le CV \\
\bottomrule
\end{longtable}

Créons un objet contenant uniquement les colonnes mentionnées dans le Tableau~\ref{tab:resumes-liste-variables}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\OtherTok{\textless{}{-}} 
\NormalTok{  ResumeNames }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(name, gender, ethnicity, call, city, jobs, experience) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{as\_tibble}\NormalTok{()}
\NormalTok{resumes}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4,870 x 7
##    name    gender ethnicity call  city     jobs experience
##    <fct>   <fct>  <fct>     <fct> <fct>   <int>      <int>
##  1 Allison female cauc      no    chicago     2          6
##  2 Kristen female cauc      no    chicago     3          6
##  3 Lakisha female afam      no    chicago     1          6
##  4 Latonya female afam      no    chicago     4          6
##  5 Carrie  female cauc      no    chicago     3         22
##  6 Jay     male   cauc      no    chicago     2          6
##  7 Jill    female cauc      no    chicago     2          5
##  8 Kenya   female afam      no    chicago     4         21
##  9 Latonya female afam      no    chicago     3          3
## 10 Tyrone  male   afam      no    chicago     2          6
## # ... with 4,860 more rows
\end{lstlisting}

\hypertarget{ruxe9sumuxe9s-statistiques-uxe0-la-main}{%
\section{Résumés statistiques à la main}\label{ruxe9sumuxe9s-statistiques-uxe0-la-main}}

Dans un premier temps, il faut apprendre à connaître le contenu des données, fouiller dedans. Cette étape primordiale dans tout projet permet bien souvent de déceler des erreurs dans les données, ou de soulever des questions nécessitant un traitement spécifique.

\hypertarget{dimensions-ruxe9sumuxe9s-grossiers}{%
\subsection{Dimensions, résumés grossiers}\label{dimensions-ruxe9sumuxe9s-grossiers}}

La première chose à savoir sur un jeu de données est la suivante : \textbf{quelles en sont ses dimensions ?} Nous souhaitons connaître le nombre d'observations (\(n\)) et le nombre de colonnes (\(p\)). Nous l'avons vu dans le \protect\hyperlink{tableaux-de-donnuxe9es}{chapitre portant sur les tableaux de données}, pour ce faire, la fonction \VERB|\FunctionTok{dim}\NormalTok{()}| est très pratique :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(resumes)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 4870    7
\end{lstlisting}

Un simple affichage du tableau de données dans la console permet par ailleurs d'avoir accès à ces informations. L'avantage de \VERB|\FunctionTok{dim}\NormalTok{()}| est que les valeurs peuvent être stockées dans un objet et réutilisées ensuite (dans le cadre de la réalisation de boucles, par exemple).

Pour avoir un aperçu grossier du tableau de données, nous pouvons utiliser la fonction \VERB|\FunctionTok{summary}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(resumes)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##       name         gender     ethnicity    call           city     
##  Tamika : 256   male  :1124   cauc:2435   no :4478   boston :2166  
##  Anne   : 242   female:3746   afam:2435   yes: 392   chicago:2704  
##  Allison: 232                                                      
##  Latonya: 230                                                      
##  Emily  : 227                                                      
##  Latoya : 226                                                      
##  (Other):3457                                                      
##       jobs         experience    
##  Min.   :1.000   Min.   : 1.000  
##  1st Qu.:3.000   1st Qu.: 5.000  
##  Median :4.000   Median : 6.000  
##  Mean   :3.661   Mean   : 7.843  
##  3rd Qu.:4.000   3rd Qu.: 9.000  
##  Max.   :7.000   Max.   :44.000  
## 
\end{lstlisting}

Pour chaque variable, en fonction de son type, des informations sont proposées :

\begin{itemize}
\tightlist
\item
  pour des variables \textbf{numériques} : moyenne, étendue, quartiles ;
\item
  pour des variables \textbf{catégorielles} : la fréquence des 6 premières valeurs les plus présentes.
\end{itemize}

Pour la variable \texttt{name} du tableau \texttt{resumes}, nous pouvons voir qu'il semble y avoir plus de 6 valeurs. Nous pouvons les lister avec la fonction \VERB|\FunctionTok{unique}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{unique}\NormalTok{(resumes}\SpecialCharTok{$}\NormalTok{name)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##  [1] Allison  Kristen  Lakisha  Latonya  Carrie   Jay      Jill     Kenya   
##  [9] Tyrone   Aisha    Geoffrey Matthew  Tamika   Leroy    Todd     Greg    
## [17] Keisha   Brad     Laurie   Meredith Anne     Emily    Latoya   Ebony   
## [25] Brendan  Hakim    Jamal    Neil     Tremayne Brett    Darnell  Sarah   
## [33] Jermaine Tanisha  Rasheed  Kareem  
## 36 Levels: Allison Anne Carrie Emily Jill Laurie Kristen Meredith ... Tyrone
\end{lstlisting}

Pour dénombrer la fréquence de chaque modalité d'une variable catégorielle, on peut utiliser la fonction \VERB|\FunctionTok{table}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(resumes}\SpecialCharTok{$}\NormalTok{name)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 
##  Allison     Anne   Carrie    Emily     Jill   Laurie  Kristen Meredith 
##      232      242      168      227      203      195      213      187 
##    Sarah     Brad  Brendan Geoffrey     Greg    Brett      Jay  Matthew 
##      193       63       65       59       51       59       67       67 
##     Neil     Todd    Aisha    Ebony   Keisha    Kenya  Lakisha  Latonya 
##       76       68      180      208      183      196      200      230 
##   Latoya   Tamika  Tanisha  Darnell    Hakim    Jamal Jermaine   Kareem 
##      226      256      207       42       55       61       52       64 
##    Leroy  Rasheed Tremayne   Tyrone 
##       64       67       69       75
\end{lstlisting}

Rien ne nous empêche de trier les résultats avec la fonction \VERB|\FunctionTok{sort}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sort}\NormalTok{(}\FunctionTok{table}\NormalTok{(resumes}\SpecialCharTok{$}\NormalTok{name))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 
##  Darnell     Greg Jermaine    Hakim Geoffrey    Brett    Jamal     Brad 
##       42       51       52       55       59       59       61       63 
##   Kareem    Leroy  Brendan      Jay  Matthew  Rasheed     Todd Tremayne 
##       64       64       65       67       67       67       68       69 
##   Tyrone     Neil   Carrie    Aisha   Keisha Meredith    Sarah   Laurie 
##       75       76      168      180      183      187      193      195 
##    Kenya  Lakisha     Jill  Tanisha    Ebony  Kristen   Latoya    Emily 
##      196      200      203      207      208      213      226      227 
##  Latonya  Allison     Anne   Tamika 
##      230      232      242      256
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  En utilisant la fonction \VERB|\FunctionTok{table}\NormalTok{()}|, affichez le nombre de réponses ``\emph{no}'' et ``\emph{yes}'' pour le jeu de données \texttt{resumes}. Stockez le résultat dans une variable que vous nommerez \texttt{freq\_reponses}.
\item
  Il est possible d'accéder aux éléments d'un objet de type \texttt{table} à l'aide des crochets simples (\texttt{{[}{]}}). En utilisant les crochets sur l'objet \texttt{freq\_reponses}, calculez la proportion de ``\emph{yes}'' dans le jeu de données.
\end{enumerate}

\end{greenbox}

\hypertarget{exploration-des-valeurs-avec-des-tableaux}{%
\subsection{Exploration des valeurs avec des tableaux}\label{exploration-des-valeurs-avec-des-tableaux}}

\hypertarget{tableaux-uxe0-double-entruxe9e}{%
\subsubsection{Tableaux à double entrée}\label{tableaux-uxe0-double-entruxe9e}}

La fonction \VERB|\FunctionTok{table}\NormalTok{()}| est également très pratique pour faire des tableaux croisés. Pour ce faire, il convient de fournir en argument les vecteurs de valeurs (contenant des variables catégorielles de type \emph{character} ou \emph{factor}). Par exemple, dans l'article dont les données de ce chapitre sont issues, nous pouvons regarder combien de candidatures ont reçu ou non un retour, selon l'ethnicité :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{call\_ethnicity\_tb }\OtherTok{\textless{}{-}} 
  \FunctionTok{table}\NormalTok{(resumes}\SpecialCharTok{$}\NormalTok{call, resumes}\SpecialCharTok{$}\NormalTok{ethnicity)}
\NormalTok{call\_ethnicity\_tb}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      
##       cauc afam
##   no  2200 2278
##   yes  235  157
\end{lstlisting}

Pour davantage de lisibilité du tableau, les arguments de la fonction peuvent être nommés ; le tableau croisé affichera ainsi une étiquette pour les lignes et les colonnes :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{call\_ethnicity\_tb }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}\AttributeTok{call =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{call, }\AttributeTok{ethnicity =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{ethnicity)}
\NormalTok{call\_ethnicity\_tb}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      ethnicity
## call  cauc afam
##   no  2200 2278
##   yes  235  157
\end{lstlisting}

Les marges peuvent être ajoutées avec la fonction \VERB|\FunctionTok{addmargins}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{addmargins}\NormalTok{(call\_ethnicity\_tb)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      ethnicity
## call  cauc afam  Sum
##   no  2200 2278 4478
##   yes  235  157  392
##   Sum 2435 2435 4870
\end{lstlisting}

Pour obtenir les proportions sans avoir à utiliser les crochets comme dans l'exercice plus haut, R propose la fonction \VERB|\FunctionTok{prop.table}\NormalTok{()}|, que l'on applique au tableau croisé :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{prop.table}\NormalTok{(}\FunctionTok{table}\NormalTok{(}\AttributeTok{call =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{call, }\AttributeTok{ethnicity =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{ethnicity))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      ethnicity
## call        cauc       afam
##   no  0.45174538 0.46776181
##   yes 0.04825462 0.03223819
\end{lstlisting}

Ou en utilisant l'opérateur pipe (\VERB|\SpecialCharTok{\%\textgreater{}\%}|) pour davantage de lisibilité :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(}\AttributeTok{call =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{call, }\AttributeTok{ethnicity =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{prop.table}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      ethnicity
## call        cauc       afam
##   no  0.45174538 0.46776181
##   yes 0.04825462 0.03223819
\end{lstlisting}

Il est possible d'appliquer une fonction sur le tableau croisé ; par exemple, on peut vouloir appliquer la fonction \VERB|\FunctionTok{round}\NormalTok{()}| pour afficher moins de décimales :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(}\AttributeTok{call =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{call, }\AttributeTok{ethnicity =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{prop.table}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{round}\NormalTok{(}\AttributeTok{digits =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      ethnicity
## call  cauc afam
##   no  0.45 0.47
##   yes 0.05 0.03
\end{lstlisting}

Les proportions marginales peuvent être obtenues en précisant l'argument \texttt{margin} à la fonction \VERB|\FunctionTok{prop.table}\NormalTok{()}|. En optant pour \VERB|\NormalTok{margin }\OtherTok{=} \DecValTok{1}|, on obtient les fréquences relatives à chaque ligne (ici, on peut lire la fréquence marginale des ethnicités selon la réponse obtenue ou non) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(}\AttributeTok{call =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{call, }\AttributeTok{ethnicity =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{prop.table}\NormalTok{(}\AttributeTok{margin =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{round}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      ethnicity
## call  cauc afam
##   no  0.49 0.51
##   yes 0.60 0.40
\end{lstlisting}

En optant pour \VERB|\NormalTok{margin }\OtherTok{=} \DecValTok{2}|, on obtient les fréquences relatives à chaque colonne (ici, on peut lire la fréquence marginale des réponses selon l'ethnicité, ce qui est particulièrement intéressant dans la question posée par le papier de recherche) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(}\AttributeTok{call =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{call, }\AttributeTok{ethnicity =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{prop.table}\NormalTok{(}\AttributeTok{margin =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{round}\NormalTok{(}\AttributeTok{digits =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      ethnicity
## call  cauc afam
##   no  0.90 0.94
##   yes 0.10 0.06
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

Dans une expérience aléatoire, pour mesurer l'effet d'un traitement, il est important de s'assurer du côté aléatoire du traitement. Si on veut mesurer l'effet de l'ethnicité sur la probabilité d'être contacté lorsque l'on postule à une offre d'emploi, et que l'on veut aussi mesurer l'effet du genre sur cette probabilité, il est important que le genre et l'ethnicité ne soient pas des caractéristiques liées. On doit donc créer l'expérience de sorte que la proportion de CVs de femmes et d'hommes soit statistiquement identique selon que la personne soit afro-américaine ou caucasienne.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Affichez la proportion de femmes et d'hommes dans le jeu de données \texttt{resumes}.
\item
  Idem avec la proportion d'afro-américains et de caucasiens.
\item
  Affichez un tableau croisé montant les fréquences de femems et d'hommes selon l'ethnicité.
\item
  Affichez ensuite les fréquences marginales permettant de penser que l'ethnicité et le genre ne sont pas liés dans l'expérience.
\end{enumerate}

\end{greenbox}

Dans le cours de Statistiques Inférentielles de 2e année, vous avez appris à effectuer un test d'indépendance à l'aide d'une statistique du Khi-deux.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{effectifs\_obs }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}\AttributeTok{call =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{call, }\AttributeTok{ethnicity =}\NormalTok{ resumes}\SpecialCharTok{$}\NormalTok{ethnicity) }

\NormalTok{prop\_table }\OtherTok{\textless{}{-}} 
\NormalTok{  effectifs\_obs }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{prop.table}\NormalTok{(}\AttributeTok{margin =} \DecValTok{2}\NormalTok{)}
\NormalTok{prop\_table}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      ethnicity
## call        cauc       afam
##   no  0.90349076 0.93552361
##   yes 0.09650924 0.06447639
\end{lstlisting}

Avec ce tableau croisé, on lit que 9,6\% des CV de personnes caucasiennes ont obtenu une réponse, tandis que seulement 6,4\% des CV de personnes afro-américaines en ont obtenu une. Cette différence de 3,2\% est-elle due au hasard ? Sous l'hypothèse nulle du test de Khi-deux, on s'attend à ce que les proportions soient identiques, indépendamment de l'origine ethnique. Si nous rejetons l'hypothèse nulle de ce test, nous serons amenés à penser que la différence de3,2\% observée n'est pas due au hasard ; autrement dit, nous pourrons conclure, avec un risque de première espèce donné, que le taux de réponses suite à une candidature pour un emploi à Boston et Chicago est dépendant de l'ethnicité (et qu'il y a donc de la discrimination).

La statistique du test est la suivante :

\[\chi^2 = \sum_{j=1}^{q} \sum_{i=1}^{p} \frac{(n_{ij} - n_{ij}^e)^2}{n_{ij}^e},\]

avec \(q\) le nombre de sous-populations (ici, \(q=2\) : afro-américains et caucasiens) et \(p\) le nombre de modalités du caractère étudié (ici, \(p=2\) : rappel ou non), \(n_{ij}\) le nombre obseré d'observations dans la sous-population \(j\) disposant du caractère \(i\) et \(n_{ij}^e\) le nombre d'observations théoriques que l'on s'attend à observer dans la sous-population \(j\) avec le caractère \(i\) si l'hypothèse nulle est vraie.

Les effectifs observés sont les suivants :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{effectifs\_obs}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      ethnicity
## call  cauc afam
##   no  2200 2278
##   yes  235  157
\end{lstlisting}

Si l'etnicité est indépendante du fait de se faire rappeler suite à un dépot de CV, alors on s'attend aux valeurs suivantes :

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# caucasien \& pas de rappel}
\NormalTok{(}\DecValTok{2200}\SpecialCharTok{+}\DecValTok{235}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{2200}\SpecialCharTok{+}\DecValTok{2278}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(effectifs\_obs)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 2239
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# caucasien et rappel}
\NormalTok{(}\DecValTok{2200}\SpecialCharTok{+}\DecValTok{235}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{235}\SpecialCharTok{+}\DecValTok{157}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(effectifs\_obs)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 196
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# afro{-}américain \& pas de rappel}
\NormalTok{(}\DecValTok{2278} \SpecialCharTok{+} \DecValTok{157}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{2200}\SpecialCharTok{+}\DecValTok{2278}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(effectifs\_obs)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 2239
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# afro{-}américain \& rappel}
\NormalTok{(}\DecValTok{2278} \SpecialCharTok{+} \DecValTok{157}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{235}\SpecialCharTok{+}\DecValTok{157}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(effectifs\_obs)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 196
\end{lstlisting}

On peut obtenir ces effectifs théoriques sans entrer à la main une seule valeur :

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Effectifs selon le caractère (rappelé ou non)}
\NormalTok{somme\_ligne }\OtherTok{\textless{}{-}} \FunctionTok{rowSums}\NormalTok{(effectifs\_obs)}
\NormalTok{somme\_ligne}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##   no  yes 
## 4478  392
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Effectifs selon les sous{-}populations (afam ou cauc)}
\NormalTok{somme\_colonne }\OtherTok{\textless{}{-}} \FunctionTok{colSums}\NormalTok{(effectifs\_obs)}
\NormalTok{somme\_colonne}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## cauc afam 
## 2435 2435
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Nombre total d\textquotesingle{}observations}
\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(effectifs\_obs)}
\NormalTok{n}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 4870
\end{lstlisting}

Reste alors à calculer le produit extérieur (on multiplie chaque élément du vecteur \texttt{somme\_ligne} par chaque élément du vecteur \texttt{somme\_colonne}), puis à diviser par l'effectif total :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{effectifs\_theo }\OtherTok{\textless{}{-}} \FunctionTok{outer}\NormalTok{(somme\_ligne, somme\_colonne, }\StringTok{"*"}\NormalTok{)}\SpecialCharTok{/}\NormalTok{n}
\NormalTok{effectifs\_theo}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##     cauc afam
## no  2239 2239
## yes  196  196
\end{lstlisting}

On peut de fait calculer la statistique de test :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{statstique }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((effectifs\_obs }\SpecialCharTok{{-}}\NormalTok{ effectifs\_theo)}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{/}\NormalTok{ effectifs\_theo)}
\NormalTok{statstique}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 16.87905
\end{lstlisting}

Cette statistique est à comparer avec le quantile d'ordre \(\alpha\), \(\chi^{2, \alpha}_{(p-1)(q-1)}\) que l'on peut lire dans une table du Khi-deux à \((p-1)(q-1)\) degrés de liberté\ldots{} ou que l'on peut obtenir avec R ! La fonction \VERB|\FunctionTok{qchisq}\NormalTok{()}| permet d'obtenir le quantile \(\chi^{2, \alpha}_{(p-1)(q-1)}\) tel que la probabilité d'obtenir une valeur supérieure à ce quantile selon une Khi-deux à \((p-1)(q-1)\) degrés de liberté soit égale à \(1-\alpha\).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{alpha }\OtherTok{=} \DecValTok{5}\SpecialCharTok{/}\DecValTok{100}
\NormalTok{p }\OtherTok{\textless{}{-}} \DecValTok{2}\NormalTok{ ; q }\OtherTok{\textless{}{-}} \DecValTok{2}
\FunctionTok{qchisq}\NormalTok{(}\AttributeTok{p =} \DecValTok{1}\SpecialCharTok{{-}}\NormalTok{alpha, }\AttributeTok{df =}\NormalTok{ (p}\DecValTok{{-}1}\NormalTok{)}\SpecialCharTok{*}\NormalTok{(q}\DecValTok{{-}1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 3.841459
\end{lstlisting}

La statistique observée étant largement supérieure au quantile obtenu, on rejette l'hypothèse nulle du test (avec un risque de rejetter l'hypothèse nulle à tort de 5\%) d'indépendance de l'ethnicité et de la réponse à une candidature à Boston ou Chicago. Il semble bien qu'il y ait une discrimination à l'accès à l'emploi.

On peut également calculer la probabilité d'observer une valeur au moins aussi grande que celle que nous observons pour notre statistique (16.88) : c'est-à-dire, chercher à calculer la p-value associée au test. La fonction \VERB|\FunctionTok{pchisq}\NormalTok{()}| nous donne la probailité d'observer une valeur inférieure ou égale à un quantile donné, pour un degré de liberté spécifique. Aussi, ce que nous recherchons est 1 moins cette probabilité :

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\SpecialCharTok{{-}}\FunctionTok{pchisq}\NormalTok{(}\AttributeTok{q =}\NormalTok{ statstique, }\AttributeTok{df =}\NormalTok{ (p}\DecValTok{{-}1}\NormalTok{)}\SpecialCharTok{*}\NormalTok{(q}\DecValTok{{-}1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 3.983887e-05
\end{lstlisting}

Cette p-value est très faible. Grossièrement parlant, il y a une probabilité de \(3,98\times 10^{-5}\) d'observer une valeur de la statistique du test qui soit au moins aussi grande que 16.87, si l'hypothèse nulle du test est vraie.

Rassurez-vous, pour effectuer un test du Khi-deux, il n'est pas nécessaire de passer par toutes ces étapes avec R. Il existe évidemment une fonction qui vous permette d'effectuer le test en une seule ligne, à partir du moment où vous avez obtenu votre tableau croisé : \VERB|\FunctionTok{chisq.test}\NormalTok{()}|. On retrouve bien les mêmes valeurs.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(effectifs\_obs, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{res}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 
##  Pearson's Chi-squared test
## 
## data:  effectifs_obs
## X-squared = 16.879, df = 1, p-value = 3.984e-05
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res}\SpecialCharTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## X-squared 
##  16.87905
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res}\SpecialCharTok{$}\NormalTok{parameter}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## df 
##  1
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res}\SpecialCharTok{$}\NormalTok{p.value}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 3.983887e-05
\end{lstlisting}

\begin{notebox}
\textbf{Note} : Par défaut, l'argument \VERB|\NormalTok{correct}| de la fonction \VERB|\FunctionTok{chisq.test}\NormalTok{()}| vaut \VERB|\ConstantTok{TRUE}|. Dans ce cas, la correction de continuité de Yates est appliquée. La statistique de test est alors légèrment modifiée :

\[\chi^2 = \sum_{j=1}^{q} \sum_{i=1}^{p} \frac{\left(\left\vert n_{ij} - n_{ij}^e \right\vert - 0,5\right)^2}{n_{ij}^e}.\]

\end{notebox}

\hypertarget{statistiques-par-sous-groupes}{%
\subsubsection{Statistiques par sous-groupes}\label{statistiques-par-sous-groupes}}

Pour obtenir le même type d'informations que ce qui est offert par la fonction \VERB|\FunctionTok{table}\NormalTok{()}|, nous pouvons effectuer dans un premier temps un regroupement du tableau de données avec la fonction \VERB|\FunctionTok{group\_by}\NormalTok{()}| que nous avons déjà utilisée dans le \protect\hyperlink{tableaux-de-donnuxe9es}{chapitre portant sur les tableaux de données}. Ensuite, en appliquant la fonction \VERB|\FunctionTok{count}\NormalTok{()}| au résultat, nous pouvons obtenir les fréquence pour chacun des sous-groupes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(call, ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 3
## # Groups:   call, ethnicity [4]
##   call  ethnicity     n
##   <fct> <fct>     <int>
## 1 no    cauc       2200
## 2 no    afam       2278
## 3 yes   cauc        235
## 4 yes   afam        157
\end{lstlisting}

L'argument \texttt{name} de la fonction \VERB|\FunctionTok{count}\NormalTok{()}| permet de spécifier le nom de la colonne dans laquelle les effectifs seront reportés :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(call, ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(}\AttributeTok{name =} \StringTok{"Nombre d\textquotesingle{}observations"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 3
## # Groups:   call, ethnicity [4]
##   call  ethnicity `Nombre d'observations`
##   <fct> <fct>                       <int>
## 1 no    cauc                         2200
## 2 no    afam                         2278
## 3 yes   cauc                          235
## 4 yes   afam                          157
\end{lstlisting}

On peut vérifier, à l'aide de la fonction \VERB|\FunctionTok{filter}\NormalTok{()}| que le décompte correspond bien au nombre d'observations pour lesquelles la valeur dans la colonne \texttt{call} est \VERB|\StringTok{"no"}| et pour lesquelles celles dans la colonne \texttt{ethnicity} vaut \VERB|\StringTok{"cauc"}| :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(call }\SpecialCharTok{==} \StringTok{"no"} \SpecialCharTok{\&}\NormalTok{ ethnicity }\SpecialCharTok{==} \StringTok{"cauc"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{nrow}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 2200
\end{lstlisting}

Pour obtenir les fréquences marginales, il suffit d'effectuer un nouveau regroupement après l'appel à la fonction \VERB|\FunctionTok{count}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(call, ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(}\AttributeTok{name =} \StringTok{"Nombre d\textquotesingle{}observations"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{prop =} \StringTok{\textasciigrave{}}\AttributeTok{Nombre d\textquotesingle{}observations}\StringTok{\textasciigrave{}} \SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{Nombre d\textquotesingle{}observations}\StringTok{\textasciigrave{}}\NormalTok{),}
         \AttributeTok{prop =} \FunctionTok{round}\NormalTok{(prop, }\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 4
## # Groups:   ethnicity [2]
##   call  ethnicity `Nombre d'observations`  prop
##   <fct> <fct>                       <int> <dbl>
## 1 no    cauc                         2200  0.9 
## 2 no    afam                         2278  0.94
## 3 yes   cauc                          235  0.1 
## 4 yes   afam                          157  0.06
\end{lstlisting}

Pour obtenir des résumés statistiques de variables numériques, on peut utiliser le combo \VERB|\FunctionTok{group\_by}\NormalTok{()}| et \VERB|\FunctionTok{summarise}\NormalTok{()}| abordé dans le \protect\hyperlink{tableaux-de-donnuxe9es}{chapitre portant sur les tableaux de données} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(gender, ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean\_experience =} \FunctionTok{mean}\NormalTok{(experience),}
            \AttributeTok{sd\_experience =} \FunctionTok{sd}\NormalTok{(experience),}
            \AttributeTok{q1\_experience =} \FunctionTok{quantile}\NormalTok{(experience, }\AttributeTok{probs =}\NormalTok{ .}\DecValTok{25}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4 x 5
## # Groups:   gender [2]
##   gender ethnicity mean_experience sd_experience q1_experience
##   <fct>  <fct>               <dbl>         <dbl>         <dbl>
## 1 male   cauc                 7.68          5.34             5
## 2 male   afam                 7.37          5.01             5
## 3 female cauc                 7.91          4.99             5
## 4 female afam                 7.96          5.00             5
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Calculez le nombre d'observations pour chaque valeur différente de la colonne \texttt{name} du tableau \texttt{resumes}.
\item
  Calculez les proportions de chaque valeur différente de la colonne \texttt{name} du tableau \texttt{resumes}.
\item
  Calculez, pour chaque valeur différente de la colonne \texttt{name}, la proportion de réponses positives (\texttt{call} valant \texttt{"yes"}\{R\}) et de réponses négatives (\texttt{call} valant \texttt{"no"}\{R\}).
\item
  Calculez le nombre d'emplois passés (colonne \texttt{jobs}) selon le nom et le genre (colonnes \texttt{name} et \texttt{gender}).
\end{enumerate}

\end{greenbox}

\hypertarget{ruxe9sumuxe9s-avec-gtsummary-vers-la-communication-des-ruxe9sultats}{%
\section{Résumés avec gtsummary : vers la communication des résultats}\label{ruxe9sumuxe9s-avec-gtsummary-vers-la-communication-des-ruxe9sultats}}

Les différentes méthodes abordées jusqu'à présent pour réaliser des résumés statistiques sont très pratiques pour réaliser une fouille grossière des données. Dans cette partie, nous allons explorer quelques possibilités offertes par un \emph{package} nommé \{gtsummary\}, qui permet de produire des tableaux formatés pour être communiqués. Il existe de bien nombreux \emph{packages} qui permettent de réaliser des tableaux prêts pour la communication, mais il me semble que \{gtsummary\} offre des fonctionnalités particulièrement utiles pour des économètres.

Dans un premier temps, si le \emph{package} n'est pas installé :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(gtsummary)}
\end{Highlighting}
\end{Shaded}

Ensuite, chargons le \emph{package} :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(gtsummary)}
\end{Highlighting}
\end{Shaded}

La fonction au cœur du package se nomme \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}|. Elle produit un tableau qui s'affiche dans l'onglet ``Viewer''. Le tableau qui est produit s'adapte en fonction du contenu des colonnes : une détection automatique du type des variables est effectuée. Lorsque les variables sont \textbf{discrètes}, la colonne descriptive indique le nombre d'observation et la proportion que chaque modalité représente. Lorsque les variables sont \textbf{continues}, la description est la médiane et l'écart interquartile.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{longtable}{lc}
\toprule
\textbf{Characteristic} & \textbf{N = 4,870}\\
\midrule
name & \\
\hspace{1em}Allison & 232 (4.8\%)\\
\hspace{1em}Anne & 242 (5.0\%)\\
\hspace{1em}Carrie & 168 (3.4\%)\\
\hspace{1em}Emily & 227 (4.7\%)\\
\addlinespace
\hspace{1em}Jill & 203 (4.2\%)\\
\hspace{1em}Laurie & 195 (4.0\%)\\
\hspace{1em}Kristen & 213 (4.4\%)\\
\hspace{1em}Meredith & 187 (3.8\%)\\
\hspace{1em}Sarah & 193 (4.0\%)\\
\addlinespace
\hspace{1em}Brad & 63 (1.3\%)\\
\hspace{1em}Brendan & 65 (1.3\%)\\
\hspace{1em}Geoffrey & 59 (1.2\%)\\
\hspace{1em}Greg & 51 (1.0\%)\\
\hspace{1em}Brett & 59 (1.2\%)\\
\addlinespace
\hspace{1em}Jay & 67 (1.4\%)\\
\hspace{1em}Matthew & 67 (1.4\%)\\
\hspace{1em}Neil & 76 (1.6\%)\\
\hspace{1em}Todd & 68 (1.4\%)\\
\hspace{1em}Aisha & 180 (3.7\%)\\
\addlinespace
\hspace{1em}Ebony & 208 (4.3\%)\\
\hspace{1em}Keisha & 183 (3.8\%)\\
\hspace{1em}Kenya & 196 (4.0\%)\\
\hspace{1em}Lakisha & 200 (4.1\%)\\
\hspace{1em}Latonya & 230 (4.7\%)\\
\addlinespace
\hspace{1em}Latoya & 226 (4.6\%)\\
\hspace{1em}Tamika & 256 (5.3\%)\\
\hspace{1em}Tanisha & 207 (4.3\%)\\
\hspace{1em}Darnell & 42 (0.9\%)\\
\hspace{1em}Hakim & 55 (1.1\%)\\
\addlinespace
\hspace{1em}Jamal & 61 (1.3\%)\\
\hspace{1em}Jermaine & 52 (1.1\%)\\
\hspace{1em}Kareem & 64 (1.3\%)\\
\hspace{1em}Leroy & 64 (1.3\%)\\
\hspace{1em}Rasheed & 67 (1.4\%)\\
\addlinespace
\hspace{1em}Tremayne & 69 (1.4\%)\\
\hspace{1em}Tyrone & 75 (1.5\%)\\
gender & \\
\hspace{1em}male & 1,124 (23\%)\\
\hspace{1em}female & 3,746 (77\%)\\
\addlinespace
ethnicity & \\
\hspace{1em}cauc & 2,435 (50\%)\\
\hspace{1em}afam & 2,435 (50\%)\\
call & 392 (8.0\%)\\
city & \\
\addlinespace
\hspace{1em}boston & 2,166 (44\%)\\
\hspace{1em}chicago & 2,704 (56\%)\\
jobs & \\
\hspace{1em}1 & 110 (2.3\%)\\
\hspace{1em}2 & 704 (14\%)\\
\addlinespace
\hspace{1em}3 & 1,429 (29\%)\\
\hspace{1em}4 & 1,611 (33\%)\\
\hspace{1em}5 & 533 (11\%)\\
\hspace{1em}6 & 464 (9.5\%)\\
\hspace{1em}7 & 19 (0.4\%)\\
\addlinespace
experience & 6 (5, 9)\\
\bottomrule
\multicolumn{2}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\end{longtable}

Parmi les arguments de la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}|, figure \VERB|\NormalTok{by}\OtherTok{=}| qui permet de réaliser des sous-groupes dans les données avant de reporter les statistiques descriptives. Les différents groupes sont alors créés en fonction des valeurs distinctes rencontrées dans le colonne dont le nom est indiqué à l'argument \VERB|\NormalTok{by}\OtherTok{=}|. Par exemple, pour obtenir des statistiques descriptives du jeu de données \texttt{resumes} selon l'origine ethnique (colonne \texttt{ethnicity}), on pourra écrire :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}\AttributeTok{by =}\NormalTok{ ethnicity)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}{lcc}
\toprule
\textbf{Characteristic} & \textbf{cauc}, N = 2,435 & \textbf{afam}, N = 2,435\\
\midrule
name &  & \\
\hspace{1em}Allison & 232 (9.5\%) & 0 (0\%)\\
\hspace{1em}Anne & 242 (9.9\%) & 0 (0\%)\\
\hspace{1em}Carrie & 168 (6.9\%) & 0 (0\%)\\
\hspace{1em}Emily & 227 (9.3\%) & 0 (0\%)\\
\addlinespace
\hspace{1em}Jill & 203 (8.3\%) & 0 (0\%)\\
\hspace{1em}Laurie & 195 (8.0\%) & 0 (0\%)\\
\hspace{1em}Kristen & 213 (8.7\%) & 0 (0\%)\\
\hspace{1em}Meredith & 187 (7.7\%) & 0 (0\%)\\
\hspace{1em}Sarah & 193 (7.9\%) & 0 (0\%)\\
\addlinespace
\hspace{1em}Brad & 63 (2.6\%) & 0 (0\%)\\
\hspace{1em}Brendan & 65 (2.7\%) & 0 (0\%)\\
\hspace{1em}Geoffrey & 59 (2.4\%) & 0 (0\%)\\
\hspace{1em}Greg & 51 (2.1\%) & 0 (0\%)\\
\hspace{1em}Brett & 59 (2.4\%) & 0 (0\%)\\
\addlinespace
\hspace{1em}Jay & 67 (2.8\%) & 0 (0\%)\\
\hspace{1em}Matthew & 67 (2.8\%) & 0 (0\%)\\
\hspace{1em}Neil & 76 (3.1\%) & 0 (0\%)\\
\hspace{1em}Todd & 68 (2.8\%) & 0 (0\%)\\
\hspace{1em}Aisha & 0 (0\%) & 180 (7.4\%)\\
\addlinespace
\hspace{1em}Ebony & 0 (0\%) & 208 (8.5\%)\\
\hspace{1em}Keisha & 0 (0\%) & 183 (7.5\%)\\
\hspace{1em}Kenya & 0 (0\%) & 196 (8.0\%)\\
\hspace{1em}Lakisha & 0 (0\%) & 200 (8.2\%)\\
\hspace{1em}Latonya & 0 (0\%) & 230 (9.4\%)\\
\addlinespace
\hspace{1em}Latoya & 0 (0\%) & 226 (9.3\%)\\
\hspace{1em}Tamika & 0 (0\%) & 256 (11\%)\\
\hspace{1em}Tanisha & 0 (0\%) & 207 (8.5\%)\\
\hspace{1em}Darnell & 0 (0\%) & 42 (1.7\%)\\
\hspace{1em}Hakim & 0 (0\%) & 55 (2.3\%)\\
\addlinespace
\hspace{1em}Jamal & 0 (0\%) & 61 (2.5\%)\\
\hspace{1em}Jermaine & 0 (0\%) & 52 (2.1\%)\\
\hspace{1em}Kareem & 0 (0\%) & 64 (2.6\%)\\
\hspace{1em}Leroy & 0 (0\%) & 64 (2.6\%)\\
\hspace{1em}Rasheed & 0 (0\%) & 67 (2.8\%)\\
\addlinespace
\hspace{1em}Tremayne & 0 (0\%) & 69 (2.8\%)\\
\hspace{1em}Tyrone & 0 (0\%) & 75 (3.1\%)\\
gender &  & \\
\hspace{1em}male & 575 (24\%) & 549 (23\%)\\
\hspace{1em}female & 1,860 (76\%) & 1,886 (77\%)\\
\addlinespace
call & 235 (9.7\%) & 157 (6.4\%)\\
city &  & \\
\hspace{1em}boston & 1,083 (44\%) & 1,083 (44\%)\\
\hspace{1em}chicago & 1,352 (56\%) & 1,352 (56\%)\\
jobs &  & \\
\addlinespace
\hspace{1em}1 & 54 (2.2\%) & 56 (2.3\%)\\
\hspace{1em}2 & 347 (14\%) & 357 (15\%)\\
\hspace{1em}3 & 726 (30\%) & 703 (29\%)\\
\hspace{1em}4 & 800 (33\%) & 811 (33\%)\\
\hspace{1em}5 & 258 (11\%) & 275 (11\%)\\
\addlinespace
\hspace{1em}6 & 243 (10.0\%) & 221 (9.1\%)\\
\hspace{1em}7 & 7 (0.3\%) & 12 (0.5\%)\\
experience & 6 (5, 9) & 6 (5, 9)\\
\bottomrule
\multicolumn{3}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\end{longtable}

Pour la suite de cette section, nous allons éviter d'afficher les informations pour la colonne \texttt{name}, pour gagner un peu en lisibilité. Pour ce faire, il suffit d'exclure du tableau cette colonne avant d'appliquer la fonction \VERB|\NormalTok{tbl\_summary}| :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tbl\_summary}\NormalTok{(}\AttributeTok{by =}\NormalTok{ ethnicity)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}{lcc}
\toprule
\textbf{Characteristic} & \textbf{cauc}, N = 2,435 & \textbf{afam}, N = 2,435\\
\midrule
gender &  & \\
\hspace{1em}male & 575 (24\%) & 549 (23\%)\\
\hspace{1em}female & 1,860 (76\%) & 1,886 (77\%)\\
call & 235 (9.7\%) & 157 (6.4\%)\\
city &  & \\
\addlinespace
\hspace{1em}boston & 1,083 (44\%) & 1,083 (44\%)\\
\hspace{1em}chicago & 1,352 (56\%) & 1,352 (56\%)\\
jobs &  & \\
\hspace{1em}1 & 54 (2.2\%) & 56 (2.3\%)\\
\hspace{1em}2 & 347 (14\%) & 357 (15\%)\\
\addlinespace
\hspace{1em}3 & 726 (30\%) & 703 (29\%)\\
\hspace{1em}4 & 800 (33\%) & 811 (33\%)\\
\hspace{1em}5 & 258 (11\%) & 275 (11\%)\\
\hspace{1em}6 & 243 (10.0\%) & 221 (9.1\%)\\
\hspace{1em}7 & 7 (0.3\%) & 12 (0.5\%)\\
\addlinespace
experience & 6 (5, 9) & 6 (5, 9)\\
\bottomrule
\multicolumn{3}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\end{longtable}

Pour réaliser un \textbf{test d'indépendance} entre chaque variables et la variable de regroupement, on peut appliquer la fonction \VERB|\FunctionTok{add\_p}\NormalTok{()}| sur le tableau gtsummary. Une colonne est ajoutée à droite avec les p-values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tbl\_summary}\NormalTok{(}\AttributeTok{by =}\NormalTok{ ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{longtable}{lccc}
\toprule
\textbf{Characteristic} & \textbf{cauc}, N = 2,435 & \textbf{afam}, N = 2,435 & \textbf{p-value}\\
\midrule
gender &  &  & 0.4\\
\hspace{1em}male & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}female & 1,860 (76\%) & 1,886 (77\%) & \\
call & 235 (9.7\%) & 157 (6.4\%) & <0.001\\
city &  &  & >0.9\\
\addlinespace
\hspace{1em}boston & 1,083 (44\%) & 1,083 (44\%) & \\
\hspace{1em}chicago & 1,352 (56\%) & 1,352 (56\%) & \\
jobs &  &  & 0.7\\
\hspace{1em}1 & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 347 (14\%) & 357 (15\%) & \\
\addlinespace
\hspace{1em}3 & 726 (30\%) & 703 (29\%) & \\
\hspace{1em}4 & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 7 (0.3\%) & 12 (0.5\%) & \\
\addlinespace
experience & 6 (5, 9) & 6 (5, 9) & 0.9\\
\bottomrule
\multicolumn{4}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\multicolumn{4}{l}{\rule{0pt}{1em}\textsuperscript{2} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{longtable}

Avoir des statistiques pour chacun des sous groupes est très utile, mais il est parfois également intéressant d'afficher les statistiques pour l'échantillon total. Pour ce faire, on peut utiliser la fonction \VERB|\FunctionTok{add\_overall}\NormalTok{()}|, qui ajoutera une colonne à gauche. En fournissant à l'argument \VERB|\NormalTok{col\_label}\OtherTok{=}| une chaîne de caractère, le nom de la colonne ainsi ajoutée peut être modifié (par défaut, la valeur \VERB|\StringTok{"Overall"}| est utilisée) :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tbl\_summary}\NormalTok{(}\AttributeTok{by =}\NormalTok{ ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}{lcccc}
\toprule
\textbf{Characteristic} & Ech. total & \textbf{cauc}, N = 2,435 & \textbf{afam}, N = 2,435 & \textbf{p-value}\\
\midrule
gender &  &  &  & 0.4\\
\hspace{1em}male & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}female & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
call & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & <0.001\\
city &  &  &  & >0.9\\
\addlinespace
\hspace{1em}boston & 2,166 (44\%) & 1,083 (44\%) & 1,083 (44\%) & \\
\hspace{1em}chicago & 2,704 (56\%) & 1,352 (56\%) & 1,352 (56\%) & \\
jobs &  &  &  & 0.7\\
\hspace{1em}1 & 110 (2.3\%) & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\addlinespace
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 464 (9.5\%) & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 19 (0.4\%) & 7 (0.3\%) & 12 (0.5\%) & \\
\addlinespace
experience & 6 (5, 9) & 6 (5, 9) & 6 (5, 9) & 0.9\\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{2} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{longtable}

Sur la première colonne, on peut lire en cartouche : \textbf{Characteristic}. Pour changer cela, on peut faire appel à la fonction \VERB|\FunctionTok{modify\_header}\NormalTok{()}|, en indiquant la valeur souhaitée à l'argument \VERB|\NormalTok{label}\OtherTok{=}|. On peut fournir une valeur rédigée en markdown. Dans l'exemple ci-dessous, pour que la valeur \textbf{Variable} soit affichée, on écrit ainsi :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tbl\_summary}\NormalTok{(}\AttributeTok{by =}\NormalTok{ ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}{lcccc}
\toprule
\textbf{Variable} & Ech. total & \textbf{cauc}, N = 2,435 & \textbf{afam}, N = 2,435 & \textbf{p-value}\\
\midrule
gender &  &  &  & 0.4\\
\hspace{1em}male & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}female & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
call & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & <0.001\\
city &  &  &  & >0.9\\
\addlinespace
\hspace{1em}boston & 2,166 (44\%) & 1,083 (44\%) & 1,083 (44\%) & \\
\hspace{1em}chicago & 2,704 (56\%) & 1,352 (56\%) & 1,352 (56\%) & \\
jobs &  &  &  & 0.7\\
\hspace{1em}1 & 110 (2.3\%) & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\addlinespace
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 464 (9.5\%) & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 19 (0.4\%) & 7 (0.3\%) & 12 (0.5\%) & \\
\addlinespace
experience & 6 (5, 9) & 6 (5, 9) & 6 (5, 9) & 0.9\\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{2} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{longtable}

Pour ajouter une étiquette permettant de regrouper visuellement les sous-groupes, le \emph{package} \{gtsummary\} propose la fonction \VERB|\FunctionTok{modify\_spanning\_header}\NormalTok{()}|. Dans notre exemple, nous avons deux sous-groupes formés selon les modalités de la variable \texttt{ethnicity}. Aussi, nous pourrons indiquer que nous souhaitons que les colonnes \texttt{stat\_1} et \texttt{stat\_2} (colonne contenant les statistiques descriptives pour le premier et le second sous-groupes) disposent d'une en-tête :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tbl\_summary}\NormalTok{(}\AttributeTok{by =}\NormalTok{ ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{cauc}, N = 2,435 & \textbf{afam}, N = 2,435 & \textbf{p-value}\\
\midrule
gender &  &  &  & 0.4\\
\hspace{1em}male & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}female & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
call & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & <0.001\\
city &  &  &  & >0.9\\
\addlinespace
\hspace{1em}boston & 2,166 (44\%) & 1,083 (44\%) & 1,083 (44\%) & \\
\hspace{1em}chicago & 2,704 (56\%) & 1,352 (56\%) & 1,352 (56\%) & \\
jobs &  &  &  & 0.7\\
\hspace{1em}1 & 110 (2.3\%) & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\addlinespace
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 464 (9.5\%) & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 19 (0.4\%) & 7 (0.3\%) & 12 (0.5\%) & \\
\addlinespace
experience & 6 (5, 9) & 6 (5, 9) & 6 (5, 9) & 0.9\\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{2} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{longtable}

Lorsque les colonnes du tableau de données fourni à la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}| contient des étiquettes, ces dernières sont automatiquement utilisées dans le tableau retourné à la place des noms de variables. Pour ajouter des étiquettes à des colonnes, nous pouvons utiliser le \emph{package} \{labelled\}, qu'il faut au préalable installer.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"labelled"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Une fois le \emph{package} installé, il est nécessaire de le charger :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(labelled)}
\end{Highlighting}
\end{Shaded}

La fonction \VERB|\FunctionTok{set\_variable\_labels}\NormalTok{()}| de \{labelled\} permet d'ajouter les étiquettes aux variables. Il suffit de donner le nom des variables et, après un symbole égal (\VERB|\OtherTok{=}|), leur étiquette correspondante.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\OtherTok{\textless{}{-}} 
\NormalTok{  resumes }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  labelled}\SpecialCharTok{::}\FunctionTok{set\_variable\_labels}\NormalTok{(}
    \AttributeTok{name =} \StringTok{"Prénom"}\NormalTok{,}
    \AttributeTok{gender =} \StringTok{"Genre"}\NormalTok{,}
    \AttributeTok{ethnicity =} \StringTok{"Ethnicité"}\NormalTok{,}
    \AttributeTok{call =} \StringTok{"Entretien"}\NormalTok{,}
    \AttributeTok{city =} \StringTok{"Ville"}\NormalTok{,}
    \AttributeTok{jobs =} \StringTok{"Nombre d\textquotesingle{}emplois listés"}\NormalTok{,}
    \AttributeTok{experience =} \StringTok{"Nombre d\textquotesingle{}années d\textquotesingle{}expérience"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

Si on évalue à nouveau notre dernier code permettant d'afficher un tableau de statistiques descriptives pour notre jeu de données, on note que les noms de variables (\texttt{gender}, \texttt{call}, \texttt{city}, etc.) ne s'affichent plus et qu'à la place, l'étiquette est utilisée :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tbl\_summary}\NormalTok{(}\AttributeTok{by =}\NormalTok{ ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{cauc}, N = 2,435 & \textbf{afam}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre &  &  &  & 0.4\\
\hspace{1em}male & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}female & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & <0.001\\
Ville &  &  &  & >0.9\\
\addlinespace
\hspace{1em}boston & 2,166 (44\%) & 1,083 (44\%) & 1,083 (44\%) & \\
\hspace{1em}chicago & 2,704 (56\%) & 1,352 (56\%) & 1,352 (56\%) & \\
Nombre d'emplois listés &  &  &  & 0.7\\
\hspace{1em}1 & 110 (2.3\%) & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\addlinespace
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 464 (9.5\%) & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 19 (0.4\%) & 7 (0.3\%) & 12 (0.5\%) & \\
\addlinespace
Nombre d'années d'expérience & 6 (5, 9) & 6 (5, 9) & 6 (5, 9) & 0.9\\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{2} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

\begin{notebox}
\textbf{Note}

Il est possible de fournir à l'argument \VERB|\NormalTok{label}\OtherTok{=}| de la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}| les étiquettes à utiliser pour chaque variable, plutôt que de passer par la définition des étiquettes via l'ajout d'un attribut aux colonnes avec la fonction \VERB|\FunctionTok{set\_variable\_labels}\NormalTok{()}|.

\end{notebox}

Le nom des différents sous-groupes constitués à l'aide de la variable dont le nom est fourni à l'argument \VERB|\NormalTok{by}\OtherTok{=}| de la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}| sont définis selon les valeurs présentes dans le tableau. Pour recoder les valeurs d'une variable factorielle, nous pouvons utiliser la fonction \VERB|\FunctionTok{recode}\NormalTok{()}| de \{dplyr\}. Attention, la syntaxe est assez peu heureuse, dans la mesure où elle est à contre courant de ce que l'on peut trouver avec la fonction \VERB|\FunctionTok{rename}\NormalTok{()}| (fonction permettant de renommer les colonnes d'un tableau de données) : on écrit l'ancien nomn, puis après un symbole égal (\VERB|\OtherTok{=}|) le nouveau nom, dans une chaîne de caractères.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\OtherTok{\textless{}{-}} 
\NormalTok{  resumes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{gender =} \FunctionTok{recode}\NormalTok{(gender, }\AttributeTok{female =} \StringTok{"femme"}\NormalTok{, }\AttributeTok{male =} \StringTok{"homme"}\NormalTok{),}
    \AttributeTok{ethnicity =} \FunctionTok{recode}\NormalTok{(ethnicity,}
                       \AttributeTok{cauc =} \StringTok{"Caucasien"}\NormalTok{, }\AttributeTok{afam =} \StringTok{"Afro{-}americain"}\NormalTok{),}
    \AttributeTok{call =} \FunctionTok{recode}\NormalTok{(call, }\AttributeTok{no =} \StringTok{"Non"}\NormalTok{, }\AttributeTok{yes =} \StringTok{"Oui"}\NormalTok{)}
\NormalTok{  )}

\NormalTok{resumes}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 4,870 x 7
##    name    gender ethnicity      call  city     jobs experience
##    <fct>   <fct>  <fct>          <fct> <fct>   <int>      <int>
##  1 Allison femme  Caucasien      Non   chicago     2          6
##  2 Kristen femme  Caucasien      Non   chicago     3          6
##  3 Lakisha femme  Afro-americain Non   chicago     1          6
##  4 Latonya femme  Afro-americain Non   chicago     4          6
##  5 Carrie  femme  Caucasien      Non   chicago     3         22
##  6 Jay     homme  Caucasien      Non   chicago     2          6
##  7 Jill    femme  Caucasien      Non   chicago     2          5
##  8 Kenya   femme  Afro-americain Non   chicago     4         21
##  9 Latonya femme  Afro-americain Non   chicago     3          3
## 10 Tyrone  homme  Afro-americain Non   chicago     2          6
## # ... with 4,860 more rows
\end{lstlisting}

Une fois les valeurs recodées à l'intérieur du tableau, celui qui est produit par la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}| est également impacté :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tbl\_summary}\NormalTok{(}\AttributeTok{by =}\NormalTok{ ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & \\
Ville &  &  &  & >0.9\\
\hspace{1em}boston & 2,166 (44\%) & 1,083 (44\%) & 1,083 (44\%) & \\
\hspace{1em}chicago & 2,704 (56\%) & 1,352 (56\%) & 1,352 (56\%) & \\
Nombre d'emplois listés &  &  &  & 0.7\\
\addlinespace
\hspace{1em}1 & 110 (2.3\%) & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\addlinespace
\hspace{1em}6 & 464 (9.5\%) & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 19 (0.4\%) & 7 (0.3\%) & 12 (0.5\%) & \\
Nombre d'années d'expérience & 6 (5, 9) & 6 (5, 9) & 6 (5, 9) & 0.9\\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{2} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

Pour décider qulles variables inclure dans le tableau de statistiques descriptives, on peut utiliser la fonction \VERB|\FunctionTok{select}\NormalTok{()}| de \{dplyr\} sur le tableau de l'on fournit à la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}|, ou bien on peut préciser quelles colonnes inclure à l'aide de l'argument \VERB|\NormalTok{include}\OtherTok{=}| de \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}|.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}
    \AttributeTok{include =} \FunctionTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"ethnicity"}\NormalTok{, }\StringTok{"call"}\NormalTok{, }\StringTok{"jobs"}\NormalTok{, }\StringTok{"experience"}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ ethnicity) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & \\
Nombre d'emplois listés &  &  &  & 0.7\\
\hspace{1em}1 & 110 (2.3\%) & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\addlinespace
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 464 (9.5\%) & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 19 (0.4\%) & 7 (0.3\%) & 12 (0.5\%) & \\
Nombre d'années d'expérience & 6 (5, 9) & 6 (5, 9) & 6 (5, 9) & 0.9\\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Median (IQR)}\\
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{2} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

L'argument \VERB|\NormalTok{statistic}\OtherTok{=}| de la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}| permet de changer les statistiques reportées. On fournit une liste dans laquelle on indique des formules spécifiant les types de statistiques descriptives à afficher pour les variables. Nous avons vu plus haut que les valeurs par défaut qui sont utilisées sont la médiane, suivi, entre parenthèses de l'écart interquartile pour les variables continues, et le nombre d'observations suivi de la proportion entre parenthèses, soit :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{list}\NormalTok{(}\FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{median\} (\{p25\}, \{p75\})"}\NormalTok{,}
     \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{n\} (\{p\}\%)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Si on désire afficher la moyenne (\emph{mean}) suivie de l'écart-type (\emph{standard deviation}) pour les variables continues, et le nombre d'observations et la proportion pour les variables discrètes, on écrira :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}
    \AttributeTok{include =} \FunctionTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"ethnicity"}\NormalTok{, }\StringTok{"call"}\NormalTok{, }\StringTok{"jobs"}\NormalTok{, }\StringTok{"experience"}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ ethnicity,}
    \AttributeTok{statistic =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{mean\} (\{sd\})"}\NormalTok{,}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{n\} (\{p\}\%)"}
\NormalTok{      )}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & \\
Nombre d'emplois listés &  &  &  & 0.7\\
\hspace{1em}1 & 110 (2.3\%) & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\addlinespace
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 464 (9.5\%) & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 19 (0.4\%) & 7 (0.3\%) & 12 (0.5\%) & \\
Nombre d'années d'expérience & 8 (5) & 8 (5) & 8 (5) & 0.9\\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%); Mean (SD)}\\
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{2} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

Pour afficher des résumés statistiques sur plusieurs lignes pour les variables continues, il faut le préciser, à l'aide de l'argument \VERB|\NormalTok{type}\OtherTok{=}| de la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}|. En écrivant \VERB|\NormalTok{type }\OtherTok{=} \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}|, toutes les variables continues disposeront de deux lignes de résumés statistiques. Reste alors à indiquer ce qu'indiquera chaque ligne. Pour cela, ils nous suffit de fournir un vecteur de longueur 2 à l'élément de la liste fournie au pramètre \VERB|\NormalTok{statistic}\OtherTok{=}| qui se charge de définir les statistiques à retourner pour les variables continues. Dans l'exemple qui suit, nous reporterons la moyenne et l'écart-type sur la première ligne, et la médiane accompagnée de l'écart interquartile sur la seconde.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}
    \AttributeTok{include =} \FunctionTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"ethnicity"}\NormalTok{, }\StringTok{"call"}\NormalTok{, }\StringTok{"jobs"}\NormalTok{, }\StringTok{"experience"}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ ethnicity,}
    \AttributeTok{type =} \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{,}
    \AttributeTok{statistic =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"\{mean\} (\{sd\})"}\NormalTok{, }\StringTok{"\{median\} (\{p25\}, \{p75\})"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{n\} (\{p\}\%)"}
\NormalTok{      )}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & \\
Nombre d'emplois listés &  &  &  & 0.7\\
\hspace{1em}1 & 110 (2.3\%) & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\addlinespace
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 464 (9.5\%) & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 19 (0.4\%) & 7 (0.3\%) & 12 (0.5\%) & \\
Nombre d'années d'expérience &  &  &  & 0.9\\
\addlinespace
\hspace{1em}Mean (SD) & 8 (5) & 8 (5) & 8 (5) & \\
\hspace{1em}Median (IQR) & 6 (5, 9) & 6 (5, 9) & 6 (5, 9) & \\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} n (\%)}\\
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{2} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

Avec la fonction \VERB|\FunctionTok{add\_stat\_label}\NormalTok{()}|, nous pouvons préciser, en créant une liste contenant des formules, les indications à faire figurer dans le tableau pour les étiquettes des statistiques qui s'afficheront. Dans l'exemple qui suit, nous demandons à ce que sur la première ligne figure la valeur \texttt{Moyenne\ (Ecart-type)} et sur la deuxième \texttt{Médiane\ (IQR)} lorsque la variables est continue, et \texttt{n\ (\%)} lorsqu'elle est discrète.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}
    \AttributeTok{include =} \FunctionTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"ethnicity"}\NormalTok{, }\StringTok{"call"}\NormalTok{, }\StringTok{"jobs"}\NormalTok{, }\StringTok{"experience"}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ ethnicity,}
    \AttributeTok{type =} \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{,}
    \AttributeTok{statistic =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"\{mean\} (\{sd\})"}\NormalTok{, }\StringTok{"\{median\} (\{p25\}, \{p75\})"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{n\} (\{p\}\%)"}
\NormalTok{      )}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_stat\_label}\NormalTok{(}
    \AttributeTok{label =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"Moyenne (Ecart{-}type)"}\NormalTok{, }\StringTok{"Médiane (IQR)"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"n (\%)"}
\NormalTok{    )}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre, n (\%) &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien, n (\%) &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & \\
Nombre d'emplois listés, n (\%) &  &  &  & 0.7\\
\hspace{1em}1 & 110 (2.3\%) & 54 (2.2\%) & 56 (2.3\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\addlinespace
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 464 (9.5\%) & 243 (10.0\%) & 221 (9.1\%) & \\
\hspace{1em}7 & 19 (0.4\%) & 7 (0.3\%) & 12 (0.5\%) & \\
Nombre d'années d'expérience &  &  &  & 0.9\\
\addlinespace
\hspace{1em}Moyenne (Ecart-type) & 8 (5) & 8 (5) & 8 (5) & \\
\hspace{1em}Médiane (IQR) & 6 (5, 9) & 6 (5, 9) & 6 (5, 9) & \\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

Dans l'ensemble des tableaux que nous avons réalisés avec la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}|, la variable \texttt{jobs} qui indique le nombre de précédents emplois occupés a été considérée comme étant discrète. Si nous souhaitons que la fonction considère cette colonne comme étant numérique, il faut l'indiquer à travers l'argument \VERB|\NormalTok{type}|, en donnant comme élément de liste une formule spécifique pour cette colonne :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}
    \AttributeTok{include =} \FunctionTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"ethnicity"}\NormalTok{, }\StringTok{"call"}\NormalTok{, }\StringTok{"jobs"}\NormalTok{, }\StringTok{"experience"}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ ethnicity,}
    \AttributeTok{type =} \FunctionTok{list}\NormalTok{(}\FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{,}
\NormalTok{                jobs }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{),}
    \AttributeTok{statistic =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"\{mean\} (\{sd\})"}\NormalTok{, }\StringTok{"\{median\} (\{p25\}, \{p75\})"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{n\} (\{p\}\%)"}
\NormalTok{      )}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_stat\_label}\NormalTok{(}
    \AttributeTok{label =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"Moyenne (Ecart{-}type)"}\NormalTok{, }\StringTok{"Médiane (IQR)"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"n (\%)"}
\NormalTok{    )}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre, n (\%) &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien, n (\%) &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & \\
Nombre d'emplois listés &  &  &  & >0.9\\
\hspace{1em}Moyenne (Ecart-type) & 4 (1) & 4 (1) & 4 (1) & \\
\hspace{1em}Médiane (IQR) & 4 (3, 4) & 4 (3, 4) & 4 (3, 4) & \\
Nombre d'années d'expérience &  &  &  & 0.9\\
\addlinespace
\hspace{1em}Moyenne (Ecart-type) & 8 (5) & 8 (5) & 8 (5) & \\
\hspace{1em}Médiane (IQR) & 6 (5, 9) & 6 (5, 9) & 6 (5, 9) & \\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

Le contrôle du nombre de chiffres après la virgule s'effectue via l'argument \texttt{digits}. Encore une fois, une liste contenant des formules est donnée. Ici, demandons d'afficher 3 décimales après la virgule pour chaque statistique des variables continues :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}
    \AttributeTok{include =} \FunctionTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"ethnicity"}\NormalTok{, }\StringTok{"call"}\NormalTok{, }\StringTok{"jobs"}\NormalTok{, }\StringTok{"experience"}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ ethnicity,}
    \AttributeTok{type =} \FunctionTok{list}\NormalTok{(}\FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{,}
\NormalTok{                jobs }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{),}
    \AttributeTok{statistic =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"\{mean\} (\{sd\})"}\NormalTok{, }\StringTok{"\{median\} (\{p25\}, \{p75\})"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{n\} (\{p\}\%)"}
\NormalTok{      ),}
    \AttributeTok{digits =} \FunctionTok{list}\NormalTok{(}\FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \DecValTok{3}\NormalTok{)}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_stat\_label}\NormalTok{(}
    \AttributeTok{label =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"Moyenne (Ecart{-}type)"}\NormalTok{, }\StringTok{"Médiane (IQR)"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"n (\%)"}
\NormalTok{    )}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre, n (\%) &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien, n (\%) &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & \\
Nombre d'emplois listés &  &  &  & >0.9\\
\hspace{1em}Moyenne (Ecart-type) & 3.661 (1.219) & 3.664 (1.219) & 3.658 (1.219) & \\
\hspace{1em}Médiane (IQR) & 4.000 (3.000, 4.000) & 4.000 (3.000, 4.000) & 4.000 (3.000, 4.000) & \\
Nombre d'années d'expérience &  &  &  & 0.9\\
\addlinespace
\hspace{1em}Moyenne (Ecart-type) & 7.843 (5.045) & 7.856 (5.079) & 7.830 (5.011) & \\
\hspace{1em}Médiane (IQR) & 6.000 (5.000, 9.000) & 6.000 (5.000, 9.000) & 6.000 (5.000, 9.000) & \\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

Lorsque de multiples statistiques sont retournées pour une variable, on fournit un vecteur de valeurs à la formule si on désire que le nombre de décimales soit différent d'une statistique à l'autre. La longueur de ce vecteur doit correspondre au nombre de statistiques demandées via l'argument \VERB|\NormalTok{statistic}\OtherTok{=}|. Ici, demandons d'afficher 1 décimale pour la moyenne, 3 pour l'écart-type et la médiane, puis 1 pour les premiers et troisièmes quartiles.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}
    \AttributeTok{include =} \FunctionTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"ethnicity"}\NormalTok{, }\StringTok{"call"}\NormalTok{, }\StringTok{"jobs"}\NormalTok{, }\StringTok{"experience"}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ ethnicity,}
    \AttributeTok{type =} \FunctionTok{list}\NormalTok{(}\FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{,}
\NormalTok{                jobs }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{),}
    \AttributeTok{statistic =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"\{mean\} (\{sd\})"}\NormalTok{, }\StringTok{"\{median\} (\{p25\}, \{p75\})"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{n\} (\{p\}\%)"}
\NormalTok{      ),}
    \AttributeTok{digits =} \FunctionTok{list}\NormalTok{(}\FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_stat\_label}\NormalTok{(}
    \AttributeTok{label =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"Moyenne (Ecart{-}type)"}\NormalTok{, }\StringTok{"Médiane (IQR)"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"n (\%)"}
\NormalTok{    )}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre, n (\%) &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien, n (\%) &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & \\
Nombre d'emplois listés &  &  &  & >0.9\\
\hspace{1em}Moyenne (Ecart-type) & 3.7 (1.219) & 3.7 (1.219) & 3.7 (1.219) & \\
\hspace{1em}Médiane (IQR) & 4.000 (3.0, 4.0) & 4.000 (3.0, 4.0) & 4.000 (3.0, 4.0) & \\
Nombre d'années d'expérience &  &  &  & 0.9\\
\addlinespace
\hspace{1em}Moyenne (Ecart-type) & 7.8 (5.045) & 7.9 (5.079) & 7.8 (5.011) & \\
\hspace{1em}Médiane (IQR) & 6.000 (5.0, 9.0) & 6.000 (5.0, 9.0) & 6.000 (5.0, 9.0) & \\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

Il est également possible de définir le nombre de décimales spécifiquement pour une ou plusieurs variables, en ajoutant une ou plusieurs formules à la liste fournie à l'argument \VERB|\NormalTok{digits}\OtherTok{=}| de la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}|.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}
    \AttributeTok{include =} \FunctionTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"ethnicity"}\NormalTok{, }\StringTok{"call"}\NormalTok{, }\StringTok{"jobs"}\NormalTok{, }\StringTok{"experience"}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ ethnicity,}
    \AttributeTok{type =} \FunctionTok{list}\NormalTok{(}\FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{,}
\NormalTok{                jobs }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{),}
    \AttributeTok{statistic =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"\{mean\} (\{sd\})"}\NormalTok{, }\StringTok{"\{median\} (\{p25\}, \{p75\})"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{n\} (\{p\}\%)"}
\NormalTok{      ),}
    \AttributeTok{digits =} \FunctionTok{list}\NormalTok{(}\FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{),}
\NormalTok{                  jobs }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{))}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(}\AttributeTok{label =} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_stat\_label}\NormalTok{(}
    \AttributeTok{label =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"Moyenne (Ecart{-}type)"}\NormalTok{, }\StringTok{"Médiane (IQR)"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"n (\%)"}
\NormalTok{    )}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-value}\\
\midrule
Genre, n (\%) &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien, n (\%) &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8.0\%) & 235 (9.7\%) & 157 (6.4\%) & \\
Nombre d'emplois listés &  &  &  & >0.9\\
\hspace{1em}Moyenne (Ecart-type) & 4 (1) & 4 (1) & 4 (1) & \\
\hspace{1em}Médiane (IQR) & 4 (3, 4) & 4 (3, 4) & 4 (3, 4) & \\
Nombre d'années d'expérience &  &  &  & 0.9\\
\addlinespace
\hspace{1em}Moyenne (Ecart-type) & 7.8 (5.045) & 7.9 (5.079) & 7.8 (5.011) & \\
\hspace{1em}Médiane (IQR) & 6.000 (5.0, 9.0) & 6.000 (5.0, 9.0) & 6.000 (5.0, 9.0) & \\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} Pearson's Chi-squared test; Wilcoxon rank sum test}\\
\end{tabular}}
\end{table}

Les tableaux produits utilisent par défaut des normes anglo-saxonnes. Pour utiliser des normes françaises, on peut se servir de la fonction \VERB|\FunctionTok{theme\_gtsummary\_language}\NormalTok{()}| et indiquer la valeur \VERB|\StringTok{"fr"}| à l'argument \VERB|\NormalTok{language}\OtherTok{=}| :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{theme\_gtsummary\_language}\NormalTok{(}\AttributeTok{language =} \StringTok{"fr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resumes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tbl\_summary}\NormalTok{(}
    \AttributeTok{include =} \FunctionTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"ethnicity"}\NormalTok{, }\StringTok{"call"}\NormalTok{, }\StringTok{"jobs"}\NormalTok{, }\StringTok{"experience"}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ ethnicity,}
    \AttributeTok{type =} \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"continuous2"}\NormalTok{,}
    \AttributeTok{statistic =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"\{mean\} (\{sd\})"}\NormalTok{, }\StringTok{"\{median\} (\{p25\}, \{p75\})"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"\{n\} (\{p\}\%)"}\NormalTok{),}
    \AttributeTok{digits =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \DecValTok{2}\NormalTok{,}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \DecValTok{0}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_p}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_overall}\NormalTok{(}\AttributeTok{col\_label =} \StringTok{"Ech. total"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_header}\NormalTok{(label }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Variable**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{modify\_spanning\_header}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"stat\_1"}\NormalTok{, }\StringTok{"stat\_2"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"**Consonnance du nom**"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_stat\_label}\NormalTok{(}
    \AttributeTok{label =} \FunctionTok{list}\NormalTok{(}
      \FunctionTok{all\_continuous}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"Moyenne (Ecart{-}type)"}\NormalTok{, }\StringTok{"Médiane (IQR)"}\NormalTok{),}
      \FunctionTok{all\_categorical}\NormalTok{() }\SpecialCharTok{\textasciitilde{}} \StringTok{"n (\%)"}
\NormalTok{    )}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lcccc}
\toprule
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{\textbf{Consonnance du nom}} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4}
\textbf{Variable} & Ech. total & \textbf{Caucasien}, N = 2,435 & \textbf{Afro-americain}, N = 2,435 & \textbf{p-valeur}\\
\midrule
Genre, n (\%) &  &  &  & 0.4\\
\hspace{1em}homme & 1,124 (23\%) & 575 (24\%) & 549 (23\%) & \\
\hspace{1em}femme & 3,746 (77\%) & 1,860 (76\%) & 1,886 (77\%) & \\
Entretien, n (\%) &  &  &  & <0.001\\
\hspace{1em}Non & 4,478 (92\%) & 2,200 (90\%) & 2,278 (94\%) & \\
\addlinespace
\hspace{1em}Oui & 392 (8\%) & 235 (10\%) & 157 (6\%) & \\
Nombre d'emplois listés, n (\%) &  &  &  & 0.7\\
\hspace{1em}1 & 110 (2\%) & 54 (2\%) & 56 (2\%) & \\
\hspace{1em}2 & 704 (14\%) & 347 (14\%) & 357 (15\%) & \\
\hspace{1em}3 & 1,429 (29\%) & 726 (30\%) & 703 (29\%) & \\
\addlinespace
\hspace{1em}4 & 1,611 (33\%) & 800 (33\%) & 811 (33\%) & \\
\hspace{1em}5 & 533 (11\%) & 258 (11\%) & 275 (11\%) & \\
\hspace{1em}6 & 464 (10\%) & 243 (10\%) & 221 (9\%) & \\
\hspace{1em}7 & 19 (0\%) & 7 (0\%) & 12 (0\%) & \\
Nombre d'années d'expérience &  &  &  & 0.9\\
\addlinespace
\hspace{1em}Moyenne (Ecart-type) & 7.84 (5.04) & 7.86 (5.08) & 7.83 (5.01) & \\
\hspace{1em}Médiane (IQR) & 6.00 (5.00, 9.00) & 6.00 (5.00, 9.00) & 6.00 (5.00, 9.00) & \\
\bottomrule
\multicolumn{5}{l}{\rule{0pt}{1em}\textsuperscript{1} test du khi-deux d'indépendance; test de Wilcoxon-Mann-Whitney}\\
\end{tabular}}
\end{table}

\hypertarget{ruxe9gressions-linuxe9aires}{%
\chapter{Régressions linéaires}\label{ruxe9gressions-linuxe9aires}}

\begin{orangebox}
Pour aborder sereinement ce chapitre, il est utile de savoir \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#structures-de-base}{manipuler des vecteurs}, \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#calculs-matriciels}{des matrices} et des \href{http://egallic.fr/Enseignement/R/Book/donn\%C3\%A9es.html\#tableaux_de_donnees}{tableaux de données}.

Des compléments de lecture sont disponibles dans le chapitre des notes de cours concernant la \href{http://egallic.fr/Enseignement/R/Book/r\%C3\%A9gressions-lin\%C3\%A9aires.html}{régression linéaire avec R}.

\end{orangebox}

\hypertarget{contexte-et-rappels}{%
\section{Contexte et rappels}\label{contexte-et-rappels}}

Dans ce chapitre, nous allons utiliser R pour estimer la relation entre une variable à expliquer et une ou plusieurs autres variables. Nous effectuerons quelques rappels d'économétrie, puis effectuerons les calculs à la main dans un premier temps. Ensuite, nous utiliserons des routines permettant d'estimer des modèles de régression linéaire et nous attacherons à expliquer comment lire et extraire les résultats obtenus.

Pour illustrer notre propos, nous tâcherons de relier la mesure de la taille de l'empan à la taille d'un humain. L'empan correspond à la distance entre l'extrêmité du pouce et celle de l'auriculaire, comme illustré sur la Figure~\ref{fig:illustration-empan}.

\begin{figure}
\centering
\includegraphics[width=5.20833in,height=\textheight]{figs/Mesures_de_la_main_artlibre_jnl.png}
\caption{\label{fig:illustration-empan} Schéma montrant que l'empan correspond à la distance entre l'extrêmité du pouce et celle de l'auriculaire.}
\end{figure}

En notant \(y_i\) la taille de l'individu \(i\), et \(x\) son empan, il s'agit de regarder si la taille dépend linéairement de l'empan. On pose alors, pour tous les individus \(i = 1, \\ldots, n\):

\[y_i = \beta_0 x_i + \beta_1 + \varepsilon_i,\]
avec \(\mathbb{E}(\varepsilon_i) = 0, \quad \forall i \in 1,\ldots, n\), \(\mathbb{E}(\varepsilon_i \varepsilon_j) = 0, \forall i \ne j\), et \(\mathbb{V}(\varepsilon_i) = \sigma^2_{\varepsilon}, \quad \forall i = 1, \ldots, n.\)

En termes matriciels, on peut noter :
\[\boldsymbol y = \boldsymbol X \boldsymbol \beta + \boldsymbol \varepsilon,\]
avec \(\boldsymbol \varepsilon \sim \mathcal{N}(0, \Sigma^2)\), et
\begin{align*}
\textrm{où } \boldsymbol y = \begin{bmatrix}
y_1 \\ y_2 \\ \vdots \\ y_n
\end{bmatrix}, \, \boldsymbol X = \begin{bmatrix}
1 & x_{1,1}  \\
1 & x_{1,2}  \\
1 & \vdots  \\
1 & x_{1,n} 
\end{bmatrix}, \, \boldsymbol \beta =  \begin{bmatrix}
\beta_0\\
\beta_1\\
\end{bmatrix} \textrm{ et } \boldsymbol \varepsilon = \begin{bmatrix}
\varepsilon_1\\
\varepsilon_2\\
\vdots\\
\varepsilon_n
\end{bmatrix}.
\end{align*}

La méthode des moindres carrés ordinaires (MCO) propose une estimation \((\hat\alpha, \hat\beta)\) telle que la somme des carrés des résidus soit minimisée:
\[\arg \min_{\boldsymbol \beta}\mid \mid \boldsymbol y - \boldsymbol X \boldsymbol \beta \mid \mid^2 = \arg \min_{\boldsymbol \beta} \sum_{i=1}^{n} (y_i - x_i \beta)^2.\]

Les résidus correspondent à l'écart entre la valeur observée de la taille \(y_i\) et celle prédite par le modèle \(\hat y_i\) : \(e_i = y_i - \hat y_i\).

Le modèle estimé s'écrit :

\[\hat{y_i} = \hat{\beta_0} + \hat{\beta_1} x_i,\]
soit, en termes matriciels:
\[\hat{\boldsymbol y} = \boldsymbol X \hat{\boldsymbol \beta},\]
\begin{align*}
\textrm{où } \hat{\boldsymbol y} = \begin{bmatrix}
\hat{y}_1 \\ \hat{y}_2 \\ \vdots \\ \hat{y}_n
\end{bmatrix}, \, \boldsymbol X = \begin{bmatrix}
1 & x_{1,1} \\
1 & x_{1,2} \\
1 & \vdots \\
1 & x_{1,n}
\end{bmatrix}, \textrm{ et } \hat{\boldsymbol \beta} =  \begin{bmatrix}
\hat{\beta}_0\\
\hat{\beta}_1\\
\end{bmatrix}.
\end{align*}

La condition du premier ordre donne\footnote{On utilise les propriétés suivantes : \(\frac{\partial \boldsymbol x^t \boldsymbol A}{\partial \boldsymbol x} = \boldsymbol A^t\), \(\frac{\partial \boldsymbol A \boldsymbol x}{\partial \boldsymbol x} = \boldsymbol A\) et \(\frac{\partial a \boldsymbol \varepsilon}{\partial \boldsymbol x} = a \frac{\partial u}{\partial \boldsymbol x}\), avec \(u = u(\boldsymbol x)\).} :

\begin{align*}
& \boldsymbol X^t \boldsymbol X\hat{\boldsymbol \beta} - 2 \boldsymbol X^t \boldsymbol X \hat{\boldsymbol \beta} - 2 \boldsymbol X^t \boldsymbol y = 0\notag\\
\Leftrightarrow \quad & \boldsymbol X^t \boldsymbol X \hat{\boldsymbol\beta} = \boldsymbol X^t \boldsymbol y\notag\\
\Leftrightarrow \quad & \hat{\boldsymbol\beta} = (\boldsymbol X^t \boldsymbol X)^{-1} \boldsymbol X^t \boldsymbol y.
\end{align*}

\hypertarget{chargement-du-jeu-de-donnuxe9es}{%
\section{Chargement du jeu de données}\label{chargement-du-jeu-de-donnuxe9es}}

\begin{greenbox}
Créez un projet RStudio pour ce chapitre (cf.~le \protect\hyperlink{initiation-uxe0-r}{chapitre d'initiation à R}). Pensez bien à créer le répertoire \texttt{Data} dans le répertoire contenant le fichier de projet \texttt{.Rproj}.

\end{greenbox}

Les données ont été mesurées sur des étudiantes et étudiants de l'Université de Rennes 1. Elles sont disponibles dans un fichier CSV à l'adresse suivante : \url{https://egallic.fr/Enseignement/L3_EcoFi/Exercices/empan.csv}. Téléchargeons ces données et enregistrons le fichier dans le répertoire \texttt{Data} :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{download.file}\NormalTok{(}\StringTok{"https://egallic.fr/Enseignement/L3\_EcoFi/Exercices/empan.csv"}\NormalTok{,}
              \AttributeTok{destfile =} \StringTok{"Data/empan.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Puis, chargeons-le dans R :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\NormalTok{df\_empan }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Data/empan.csv"}\NormalTok{)}
\NormalTok{df\_empan}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## # A tibble: 40 x 6
##    empan_main_forte empan_main_faible   age genre taille forte
##               <dbl>             <dbl> <dbl> <chr>  <dbl> <chr>
##  1             19                19      19 H        172 D    
##  2             20.5              20.5    27 H        179 G    
##  3             21                21      26 H        179 G    
##  4             19                19      27 F        160 D    
##  5             21                22      25 H        186 D    
##  6             19                18.5    25 H        178 D    
##  7             19                19      20 H        182 B    
##  8             21                22      21 H        179 D    
##  9             23                22      19 H        186 D    
## 10             20                20      20 F        163 D    
## # ... with 30 more rows
\end{lstlisting}

Les colonnes sont les suivantes (les caractéristiques des individus) :

\begin{itemize}
\tightlist
\item
  \texttt{empan\_main\_forte} : empan main forte (en cm)
\item
  \texttt{empan\_main\_faible} : empan main faible (en cm)
\item
  \texttt{age} : age (en année)
\item
  \texttt{genre} : genre (H, F, A)
\item
  \texttt{taille} : taille (en cm)
\item
  \texttt{forte} : main forte (``G'' pour gauche, ``D'' pour droite, ``B'' pour ambidextre)
\end{itemize}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Affichez quelques statistiques descriptives pour vous familiariser avec les données (moyenne, écart-type, quantiles, proportions, etc.). Vous pouvez, par exemple utiliser la fonction \VERB|\FunctionTok{tbl\_summary}\NormalTok{()}| de \{gtsummary\} abordée au chapitre \protect\hyperlink{statistiques-descriptives}{de statistiques descriptives}.
\item
  Calculez la corrélation entre la taille de l'empan de la main forte et la taille des individus.
\end{enumerate}

\end{greenbox}

\hypertarget{ruxe9gression-pas-uxe0-pas}{%
\section{Régression pas à pas}\label{ruxe9gression-pas-uxe0-pas}}

Dans cette partie, nous allons effectuer quelques opérations ``à la main''. Nous allons créer avec R tous les objets nécessaires pour pouvoir estimer par la méthode des moindres carrés les coefficient de la régression. Ensuite, nous regarderons comment réaliser des tests d'hypothèse de nullité des coefficients. La section suivante permettra de retrouver les mêmes résultats à l'aide de routines.

Nous verrons dans un autre chapitre comment réaliser des graphiques avec le \emph{package} \{ggplot2\}. Pour réaliser des nuages de points facilement, nous pouvons utiliser la fonction \VERB|\FunctionTok{qplot}\NormalTok{()}| de ce \emph{package}. Le tableau de données contenant les observations à afficher est indiqué à l'argument \VERB|\NormalTok{data}\OtherTok{=}|. Les arguments \VERB|\NormalTok{x}\OtherTok{=}| et \VERB|\NormalTok{y}\OtherTok{=}| reçoivent le nom des colonnes du tableau à utiliser pour l'axe des abscisses et des ordonnées, respectivement. L'argument \VERB|\NormalTok{geom}\OtherTok{=}| définit le type de géométrie à représenter. Dans l'exemple ci-dessous, nous souhaitons réaliser un nuage de points. Nous indiquerons donc \VERB|\NormalTok{geom }\OtherTok{=}\NormalTok{ point}|. Une fois le nuage créé, nous ajoutons une couche au graphique, pour nommer les axes et le graphique, avec la fonction \VERB|\FunctionTok{labs}\NormalTok{()}|.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{qplot}\NormalTok{(}\AttributeTok{x =}\NormalTok{ empan\_main\_forte, }\AttributeTok{y =}\NormalTok{ taille,}
      \AttributeTok{data =}\NormalTok{ df\_empan, }\AttributeTok{geom =} \StringTok{"point"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"Empan de la main forte (en cm)"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Taille de l\textquotesingle{}individu (en cm)"}\NormalTok{,}
       \AttributeTok{title =} \StringTok{"Taille des individus en fonction de la mesure de l\textquotesingle{}empan"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-248-1} \end{center}

\hypertarget{estimation-des-coefficients-de-la-ruxe9gression-par-moindres-carruxe9s-ordinaires}{%
\subsection{Estimation des coefficients de la régression par moindres carrés ordinaires}\label{estimation-des-coefficients-de-la-ruxe9gression-par-moindres-carruxe9s-ordinaires}}

Comme indiqué précédemment, nous souhaitons estimer la relation suivante : \[\boldsymbol y = \boldsymbol X \boldsymbol \beta + \boldsymbol \varepsilon,\]

où \(\boldsymbol y\) est un vecteur contenant les tailles des individus, \(\boldsymbol X\) une matrice contenant deux colonne : une pour la constante et une deuxième pour les valeurs de l'empan de la main forte. Nous allons estimer les valeurs des deux coefficients du vecteur \(\boldsymbol \beta\) (celui pour la constante, et celui pour l'empan de la main forte).

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Dans un objet que vous appellerez \texttt{n}, stockez le nombre d'observations dans le tableau de données \texttt{df}.
\item
  Créez un vecteur que vous nommerez \texttt{constante}. Cet objet doit contenir la valeur \texttt{1} répétée \texttt{n} fois.
\item
  Créez un vecteur que vous nommerez \texttt{y}. Cet objet doit contenir les valeurs la colonne \texttt{taille} du tableau \texttt{df\_empan}. Cet objet sera notre variable de réponse, celle que nous souhaitons pouvoir prédire à l'aide du modèle de régression linéaire. Les premières valeurs de \texttt{y} seront comme suit :
\end{enumerate}

\begin{lstlisting}
## [1] 172 179 179 160 186 178
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Créez une matrice que vous nommerez \texttt{X}, qui contiendra deux colonnes : une première contenant les valeurs de \texttt{constante}, et une deuxième contenant les valeurs de la colonne \texttt{empan\_main\_forte} de \texttt{df}. Les premières valeurs de \texttt{X} seront comme suit :
\end{enumerate}

\begin{lstlisting}
##      [,1] [,2]
## [1,]    1 19.0
## [2,]    1 20.5
## [3,]    1 21.0
## [4,]    1 19.0
## [5,]    1 21.0
## [6,]    1 19.0
\end{lstlisting}

\end{greenbox}

Avec la méthode des moindres carrés, les coefficients de la régression sont estimé en effectuant le calcul suivant :
\[\hat{\boldsymbol\beta} = (\boldsymbol X^t \boldsymbol X)^{-1} \boldsymbol X^t \boldsymbol y.\]

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Calculez la transposée de \texttt{X}, c'est-à-dire \(\boldsymbol X^t\).
\item
  Calculez, à l'aide d'un produit matriciel, la matrice \(\boldsymbol X^t \boldsymbol X\)
\item
  Calculez l'inverse de la matrice de la fonction précédente, c'est-à-dire \(\left(\boldsymbol X^t \boldsymbol X\right)^{-1}\)
\item
  Calculez le vecteur colonne \(\boldsymbol X^t \boldsymbol y\)
\item
  Calculez le vecteur des coefficients de régression par la méthode des moindres carrés ordinaires, c'est-à-dire \(\hat{\boldsymbol\beta} = \left(\boldsymbol X^t \boldsymbol X\right)^{-1} \boldsymbol X^t \boldsymbol y\). Stockez le résultat dans un objet que vous nommerez \texttt{hat\_beta}.
\item
  Avec les crochets, extrayez chaque coefficient de \texttt{hat\_beta} (le coefficient associé à la constane -- \emph{i.e.}, la pente ici -- et le coefficient associé à la taille de l'empan). Vous devez obtenir les valeurs suivantes :
\end{enumerate}

\begin{lstlisting}
## Constante
\end{lstlisting}

\begin{lstlisting}
## [1] 96.27554
\end{lstlisting}

\begin{lstlisting}
## Coeff empan
\end{lstlisting}

\begin{lstlisting}
## [1] 3.885117
\end{lstlisting}

\emph{Note} : lors de la \protect\hyperlink{matrice}{séance portant sur les matrices}, vous avez déjà appris à effectuer toutes ces opérations.

\end{greenbox}

\hypertarget{pruxe9diction-des-valeurs}{%
\subsection{Prédiction des valeurs}\label{pruxe9diction-des-valeurs}}

Une fois que nous avons obtenu les coefficients de la régression, nous pouvons les réutiliser pour calculer les valeurs prédites par le modèle, à savoir \(\hat{\boldsymbol y}\). Il suffit pour cela d'appliquer la formule :

\[\hat{\boldsymbol y} = \boldsymbol X \boldsymbol{\hat{\beta}}.\]

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{12}
\tightlist
\item
  Calculez les valeurs prédites, c'est-à-dire \(\hat{\boldsymbol y} = \boldsymbol X \hat{\boldsymbol\beta}\). Stockez les valeurs dans un objet que vous nommerez \texttt{y\_pred}. Les premières valeurs sont les suivantes :
\end{enumerate}

\begin{lstlisting}
##          [,1]
## [1,] 170.0928
## [2,] 175.9204
## [3,] 177.8630
## [4,] 170.0928
## [5,] 177.8630
## [6,] 170.0928
\end{lstlisting}

\end{greenbox}

\hypertarget{les-ruxe9sidus-de-la-ruxe9gression}{%
\subsection{Les résidus de la régression}\label{les-ruxe9sidus-de-la-ruxe9gression}}

Les résidus correspondent à la différence entre les valeurs observées et les valeurs prédites, soit \(e = \boldsymbol y - \boldsymbol{X}\hat{\boldsymbol\beta}\).

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{13}
\tightlist
\item
  Calculez les résidus \(e = \boldsymbol y - \boldsymbol{X}\hat{\boldsymbol\beta}\). Stockez le résultat dans un objet que vous nommerez \texttt{residus}. Les premières valeurs sont les suivantes :
\end{enumerate}

\begin{lstlisting}
##            [,1]
## [1,]   1.907245
## [2,]   3.079570
## [3,]   1.137011
## [4,] -10.092755
## [5,]   8.137011
## [6,]   7.907245
\end{lstlisting}

\end{greenbox}

Nous pouvons regarder la distribution des résidus, pour voir s'ils ont une allure normale (ici, nous avons peu d'observations\ldots) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{qplot}\NormalTok{(residus, }\AttributeTok{geom=}\StringTok{"histogram"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{_main_files/figure-latex/unnamed-chunk-258-1} \end{center}

\hypertarget{un-indicateur-de-la-qualituxe9-dajustement-le-coefficient-de-duxe9termination}{%
\subsection{Un indicateur de la qualité d'ajustement : le coefficient de détermination}\label{un-indicateur-de-la-qualituxe9-dajustement-le-coefficient-de-duxe9termination}}

Pour avoir une idée de la qualité d'ajustement du modèle, il est coutume de calculer le coefficient de détermination, le \(R^2\). Nous pouvons au préalable calculer la somme des carrés des écarts expliqués ainsi que la somme des carrés totale.

La variance peut se décomposer en deux termes : une part expliquée par le modèle et une part inexpliquée :

\[\underbrace{(y_i - \bar{y})}_{\text{Ecart total}} = \underbrace{(\hat{y}_i - \bar{y})}_{\text{Écart expliqué}} + \underbrace{(y_i - \hat{y}_i)}_{\text{Écart résiduel}},\]
avec \(\overline y = \frac{1}{n}\sum_{i=1}^{n} y_i\) la moyenne de\(y\).

On peut montrer que :

\[\underbrace{\sum_{i=1}^{n}(y_i - \bar{y})^2}_{\text{SCT}} = \underbrace{\sum_{i=1}^{n}(\hat{y}_i - \bar{y})^2}_{\text{SCE}} + \underbrace{\sum_{i=1}^{n}(y_i - \hat{y}_i)^2}_{\text{SCR}},\]
avec :

\begin{itemize}
\tightlist
\item
  \(\text{SCT}\) : la somme des carrés totale
\item
  \(\text{SCE}\) : la somme des carrés des écarts expliqués par le modèle
\item
  \(\text{SCR}\) : la somme des carrés des résidus
\end{itemize}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{14}
\tightlist
\item
  Calculez la somme des carrés des résidus, c'est-à-dire \(\text{SCR} = \sum_{i=1}^{n} \left( y_i - \hat{y_i}\right)^2\). Stockez le résultat dans un objet que vous nommerez \texttt{somme\_carre\_residus}. Vous obtiendrez :
\end{enumerate}

\begin{lstlisting}
## [1] 3421.886
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{15}
\tightlist
\item
  Calculez \(\text{SCT}\) et \(\text{SCE}\) et stockez les valeurs dans des objets que vous nommerez \texttt{somme\_carres\_totale} et \texttt{somme\_carres\_expliques}, respectivement. Vous obtiendrez :
\end{enumerate}

\begin{lstlisting}
## Somme des carrés totale :
\end{lstlisting}

\begin{lstlisting}
## [1] 4666.775
\end{lstlisting}

\begin{lstlisting}
## Somme des carrés expliqués :
\end{lstlisting}

\begin{lstlisting}
## [1] 1244.889
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{16}
\tightlist
\item
  Calculez le coefficient de détermination : \(R^2 = \frac{\text{SCE}}{\text{SCT}}\). Vous obtiendrez :
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{r\_2}
\end{Highlighting}
\end{Shaded}

\end{greenbox}

\hypertarget{tests-de-nullituxe9-des-coefficients-de-la-ruxe9gression-linuxe9aire}{%
\subsection{Tests de nullité des coefficients de la régression linéaire}\label{tests-de-nullituxe9-des-coefficients-de-la-ruxe9gression-linuxe9aire}}

À présent, nous souhaitons pouvoir effectuer des tests de significativité des coefficients de la régression. Le test se présente sous la forme suivante :
\begin{align*}
\begin{cases}
H_0 : \beta_i = 0\\
H_1 : \beta_i \ne 0
\end{cases}, i = 1, 2
\end{align*}

Ce test s'appuie sur la statistique de test suivante :
\begin{align*}
T = \frac{\hat{\beta}_i - \beta_{i,H_0}}{\hat{\sigma}_{\hat{\beta}_i}} \sim \mathcal{S}t(n-m-1),
\end{align*}
avec \(\beta_{i,H_0}\) la valeur de \(\beta_i\) sous l'hypothèse nulle, \(\hat{\sigma}_{\hat{\beta}_i}\) l'estimation de l'écart-type de l'estimation du paramètre \(\beta_i\).

Pour effectuer ce test bilatéral, on peut lire dans la table de la loi de Student deux fractiles tels que :
\begin{align*}
\mathbb{P}\left( -t_{1-\alpha/2} < \frac{\hat{\beta}_i - \alpha_{i,H_0}}{\hat{\sigma}_{\hat{\beta}_i}} < t_{1-\alpha/2} \right) = 1 - \alpha.
\end{align*}
avec \(\alpha\) le risque de première espèce (le risque de rejeter \(H_0\) alors qu'elle est vraie).

À partir des observations, il est possible de calculer :
\begin{align*}
t_{i,\textrm{obs.}} = \frac{\hat{\beta}_i}{\hat{\sigma}_{\hat{\beta}_i}}.
\end{align*}

La règle de décision est la suivante :

\begin{itemize}
\tightlist
\item
  si \(t_{i,\textrm{obs.}} \in [-t_{1-\alpha/2}, t_{1-\alpha/2}]\), nous somme dans la région de non rejet, on ne rejette donc pas \(H_0\) au seuil \(\alpha\) (avec \(\alpha=5\%\), par exemple), et on considère alors que \(\beta_i\) n'est pas statistiquement différent de zéro ;
\item
  si en revanche \(t_{i,\textrm{obs.}} \notin [-t_{1-\alpha/2}, t_{1-\alpha/2}]\), nous sommes dans la région critique et cette fois on rejette l'hypothèse nulle en faveur de l'hypothèse alternative. On considère alors qu'avec un risque de première espèce \(\alpha\), on a \(\alpha_i \ne 0\).
\end{itemize}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{17}
\tightlist
\item
  Calculez la variance des erreurs \(\hat{\sigma}^2_\varepsilon = \frac{\text{SCR}}{n-m-1}\). Stockez le résultat dans un objet que vous nommerez \texttt{hat\_sigma\_2\_u}. Vous devez obtenir :
\end{enumerate}

\begin{lstlisting}
## [1] 90.04964
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{18}
\tightlist
\item
  Calculez la matrice de variance-covariance des estimateurs \(\mathbb{V}\left(\hat{\boldsymbol\beta}\right) = \hat{\sigma}^2_\varepsilon \left(\boldsymbol X^t \boldsymbol X\right)^{-1}\). Stockez le résultat dans un objet que vous nommerez \texttt{var\_cov}. Vous obtiendrez la matrice suivante :
\end{enumerate}

\begin{lstlisting}
##           [,1]       [,2]
## [1,] 440.08045 -21.864130
## [2,] -21.86413   1.091842
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{19}
\tightlist
\item
  Extrayez les éléments de la diagonale de la matrice de variance-covariance (les variances, donc), puis calculez leur racine carrée de manière à obtenir les erreurs-types \(\hat{\sigma}_{\hat{\boldsymbol\beta}}\). Stockez le résultat dans un vecteur que vous nommerez \texttt{hat\_sigma\_betas}. Vous obtiendrez les valeurs suivantes :
\end{enumerate}

\begin{lstlisting}
## [1] 20.978094  1.044912
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{20}
\tightlist
\item
  Pour chaque coefficient, calculez la statistique observée du test de nullité des coefficients \(t_{i,\textrm{obs.}} = \frac{\hat{\beta}_i}{\hat{\sigma}_{\hat{\beta}_i}}\). Stockez le résultat dans un vecteur que vous nommerez \texttt{t\_obs}. Vous obtiendrez les valeurs suivantes :
\end{enumerate}

\begin{lstlisting}
##          [,1]
## [1,] 4.589337
## [2,] 3.718127
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{21}
\tightlist
\item
  À l'aide de la fonction \VERB|\FunctionTok{qt}\NormalTok{()}|, stockez dans un objet que vous nommerez \texttt{t\_tab} le quantile d'ordre 95\% d'une Student à \texttt{n-m-1} degrés de libertés. Vous obtiendrez la valeur suivante :
\end{enumerate}

\begin{lstlisting}
## [1] 2.024394
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{22}
\item
  Comparez les valeurs de \texttt{t\_obs} avec celles de \texttt{t\_tab}. Concluez pour chaque coefficient.
\item
  À l'aide de la fonction \VERB|\FunctionTok{pt}\NormalTok{()}|, calculez la p-value associée au test de nullité de chaque coefficient (rappel : nous effectuons un test bilatéral ici, donc nous cherchons \(2 \times \mathbb{P}(\vert T \vert > t_{obs})\)). Vous obtiendrea les valeurs suivantes :
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_val}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##              [,1]
## [1,] 4.745605e-05
## [2,] 6.453478e-04
\end{lstlisting}

\end{greenbox}

\hypertarget{ruxe9gression-avec-lm}{%
\section{Régression avec lm}\label{ruxe9gression-avec-lm}}

La fonction permettant de réaliser une régression linéaire avec R se nomme \VERB|\FunctionTok{lm}\NormalTok{()}|. Il est nécessaire de fournir une formule à l'arguemnt \texttt{formula=}. L'argument \texttt{data=} indique le tableau de données dans lequel les variables mentionnées dans la formule se trouvent.

Pour écrire la formule, on indique le nom de la variable à expliquer, puis, après avoir ajouté un tilde (\VERB|\SpecialCharTok{\textasciitilde{}}|), on écrit le nom des variables explicatives en les séparant par un symbole plus (\VERB|\SpecialCharTok{+}|). Par défaut, la constante est ajoutée au modèle.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(taille }\SpecialCharTok{\textasciitilde{}}\NormalTok{ empan\_main\_forte, }\AttributeTok{data =}\NormalTok{ df\_empan)}
\NormalTok{reg}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 
## Call:
## lm(formula = taille ~ empan_main_forte, data = df_empan)
## 
## Coefficients:
##      (Intercept)  empan_main_forte  
##           96.276             3.885
\end{lstlisting}

\begin{notebox}

\textbf{Note}

Pour estimer le modèle sans la constante, on ajoute dans le membre à droite du tilde : \VERB|\SpecialCharTok{{-}} \DecValTok{1}| :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg\_2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(taille }\SpecialCharTok{\textasciitilde{}} \SpecialCharTok{{-}}\DecValTok{1} \SpecialCharTok{+}\NormalTok{empan\_main\_forte, }\AttributeTok{data =}\NormalTok{ df\_empan)}
\NormalTok{reg\_2}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 
## Call:
## lm(formula = taille ~ -1 + empan_main_forte, data = df_empan)
## 
## Coefficients:
## empan_main_forte  
##            8.668
\end{lstlisting}

\end{notebox}

Pour ajouter des variables explicatives, il suffit d'écrire leur nom en séparant chaque variables par le symbole plus (\VERB|\SpecialCharTok{+}|) :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg\_3 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(taille }\SpecialCharTok{\textasciitilde{}}\NormalTok{ empan\_main\_forte }\SpecialCharTok{+}\NormalTok{ genre, }\AttributeTok{data =}\NormalTok{ df\_empan)}
\NormalTok{reg\_3}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 
## Call:
## lm(formula = taille ~ empan_main_forte + genre, data = df_empan)
## 
## Coefficients:
##      (Intercept)  empan_main_forte            genreH  
##          141.897             1.058            16.275
\end{lstlisting}

L'objet retourné par la fonction \VERB|\FunctionTok{lm}\NormalTok{()}| est de classe \texttt{lm}. Il s'agit d'une liste contenant plusieurs éléments nommés, dont :

\begin{itemize}
\tightlist
\item
  \texttt{coefficients} : un vecteur nommé de coefficients (\(\hat{\boldsymbol\beta}\)) ; les noms correspondent aux noms des variables explicatives
\item
  \texttt{residuals} : les résidus
\item
  \texttt{fitted.values} : les valeurs prédites par le modèle
\end{itemize}

On peut donc accéder à ces éléments avec les crochets, ou à leur contenu avec les doubles crochets (ou le dollar) :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg[[}\StringTok{"coefficients"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      (Intercept) empan_main_forte 
##        96.275538         3.885117
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg}\SpecialCharTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##      (Intercept) empan_main_forte 
##        96.275538         3.885117
\end{lstlisting}

On retrouve bien les mêmes valeurs que celles que nous avons calculées ``à la main''. On note que le coefficient associé à la constante se nome \texttt{(Intercept)} (soit la pente de la droite de régression).

\hypertarget{ruxe9sumuxe9-de-lestimation}{%
\subsection{Résumé de l'estimation}\label{ruxe9sumuxe9-de-lestimation}}

La fonction \VERB|\FunctionTok{summary}\NormalTok{()}| permet d'obtenir quelques résumés concernant l'estimation :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resume\_reg }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(reg)}
\NormalTok{resume\_reg}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## 
## Call:
## lm(formula = taille ~ empan_main_forte, data = df_empan)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -17.150  -7.343   0.108   5.252  31.907 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(>|t|)    
## (Intercept)        96.276     20.978   4.589 4.75e-05 ***
## empan_main_forte    3.885      1.045   3.718 0.000645 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 9.489 on 38 degrees of freedom
## Multiple R-squared:  0.2668, Adjusted R-squared:  0.2475 
## F-statistic: 13.82 on 1 and 38 DF,  p-value: 0.0006453
\end{lstlisting}

Les valeurs qui s'affichent sont accessibles (avec les crochets doubles ou le symbole dollar) :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resume\_reg}\SpecialCharTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##                   Estimate Std. Error  t value     Pr(>|t|)
## (Intercept)      96.275538  20.978094 4.589337 4.745605e-05
## empan_main_forte  3.885117   1.044912 3.718127 6.453478e-04
\end{lstlisting}

Regardons d'un peu plus près les différents éléments de la sortie :

\begin{itemize}
\tightlist
\item
  \texttt{Call} : la formule du modèle.
\item
  \texttt{Residuals} : des statistiques descriptives des résidus.
\item
  \texttt{Coefficients} : un tableau à deux entrées où les lignes correspondent aux coefficients associés aux variables explicatives, et les colonnes, dans l'ordre, à l'estimation du coefficient, l'écart-type estimé, la valeur du test de Student de nullité statistique du coefficient et enfin la p-value associé à ce test, suivie d'un symbole pour lire rapidement la significativité.
\item
  \texttt{Signif.\ codes} : les significations des symboles de niveau de significativité.
\item
  \texttt{Residual\ standard\ error} : estimation de l'écart-type de l'aléa et degré de liberté.
\item
  \texttt{Multiple\ R-squared} : coefficient de détermination.
\item
  \texttt{Adjusted\ R-squared} : coefficient de détermination ajusté.
\item
  \texttt{F-statistic} : valeur de la statistique de Fisher du test de significativité globale, ainsi que les degrés de liberté et la p-value associée au test.
\end{itemize}

\hypertarget{pruxe9dictions-des-valeurs}{%
\subsection{Prédictions des valeurs}\label{pruxe9dictions-des-valeurs}}

Les valeurs prédites par le modèle sont dans l'élément \texttt{fitted.values} de l'objet retourné par \VERB|\FunctionTok{lm}\NormalTok{()}|.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg}\SpecialCharTok{$}\NormalTok{fitted.values}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##        1        2        3        4        5        6        7        8 
## 170.0928 175.9204 177.8630 170.0928 177.8630 170.0928 170.0928 177.8630 
##        9       10       11       12       13       14       15       16 
## 185.6332 173.9779 170.0928 173.9779 173.9779 173.9779 166.2076 181.7481 
##       17       18       19       20       21       22       23       24 
## 183.6907 175.9204 168.1502 181.7481 170.0928 177.8630 173.9779 177.8630 
##       25       26       27       28       29       30       31       32 
## 173.9779 170.0928 177.8630 170.0928 168.1502 177.8630 181.7481 172.0353 
##       33       34       35       36       37       38       39       40 
## 181.7481 179.8055 175.9204 166.2076 166.2076 160.3800 175.9204 166.2076
\end{lstlisting}

La fonction \VERB|\FunctionTok{predict}\NormalTok{()}| peut aussi être appliquée à l'objet de régression (il s'agit d'un alias de la fonction \VERB|\FunctionTok{predict.lm}\NormalTok{()}| ; pour afficher la fiche d'aide il faut écrire \VERB|\NormalTok{?}\FunctionTok{predict.lm}\NormalTok{()}|) :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(reg)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##        1        2        3        4        5        6        7        8 
## 170.0928 175.9204 177.8630 170.0928 177.8630 170.0928 170.0928 177.8630 
##        9       10       11       12       13       14       15       16 
## 185.6332 173.9779 170.0928 173.9779 173.9779 173.9779 166.2076 181.7481 
##       17       18       19       20       21       22       23       24 
## 183.6907 175.9204 168.1502 181.7481 170.0928 177.8630 173.9779 177.8630 
##       25       26       27       28       29       30       31       32 
## 173.9779 170.0928 177.8630 170.0928 168.1502 177.8630 181.7481 172.0353 
##       33       34       35       36       37       38       39       40 
## 181.7481 179.8055 175.9204 166.2076 166.2076 160.3800 175.9204 166.2076
\end{lstlisting}

Cette fonction permet par ailleurs d'effectuer des prédictions pour de nouvelles valeurs, à condition de fournir un tableau de données contenant les colonnes utilisées comme variables explicatrices. Pour prédire la taille d'une personne, selon notre premier modèle, si la mesure de l'empan est de 15 cm :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_data }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{empan\_main\_forte =} \DecValTok{15}\NormalTok{)}
\FunctionTok{predict}\NormalTok{(reg, }\AttributeTok{newdata =}\NormalTok{ new\_data)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##        1 
## 154.5523
\end{lstlisting}

Avec la régression de la taille sur l'empan de la main forte et le genre, si la mesure de l'empan est de 15 cm et que l'individu est un homme :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(reg\_3, }\AttributeTok{newdata =} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{empan\_main\_forte =} \DecValTok{15}\NormalTok{, }\AttributeTok{genre =} \StringTok{"H"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##        1 
## 174.0465
\end{lstlisting}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{24}
\tightlist
\item
  À l'aide d'un mètre-ruban, mesurez la taille de votre empan. En utilsant le modèle estimé de votre choix, prédisez votre taille. Comparez avec la réalité.
\end{enumerate}

\end{greenbox}

Pour munir une prédiction d'un intervalle de confiance, on peut ajouter des arguments à la fonction \VERB|\FunctionTok{predict}\NormalTok{()}|. Avec l'argument \VERB|\NormalTok{interval}\OtherTok{=}|, on choisit le type d'intervalle (\VERB|\StringTok{"confidence"}| ou \VERB|\StringTok{"prediction"}|), avec \VERB|\NormalTok{level}\OtherTok{=}| on choisir le niveau de confiance, et avec \VERB|\NormalTok{se.fit}\OtherTok{=}| on précise si l'on souhaite ou non que l'écart-type estimé soit retourné.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred }\OtherTok{\textless{}{-}} 
  \FunctionTok{predict}\NormalTok{(reg, }\AttributeTok{newdata =}\NormalTok{ new\_data,}
          \AttributeTok{interval =} \StringTok{"prediction"}\NormalTok{, }\AttributeTok{level =} \FloatTok{0.95}\NormalTok{, }\AttributeTok{se.fit =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{pred}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## $fit
##        fit      lwr      upr
## 1 154.5523 132.3881 176.7165
## 
## $se.fit
## [1] 5.460854
## 
## $df
## [1] 38
## 
## $residual.scale
## [1] 9.489449
\end{lstlisting}

Dans l'élément \VERB|\NormalTok{fit}|, les valeurs sont les suivantes : \texttt{fit} pour la valeur prédite, \texttt{lwr} et \texttt{upr} les bornes inférieure et supérieure de l'intervalle de confiance de la prédiction (\texttt{lwr} pour \emph{lower} et \texttt{upr} pour \emph{upper}).

\hypertarget{tests-de-nullituxe9-des-coefficients-de-la-ruxe9gression-linuxe9aire-1}{%
\subsection{Tests de nullité des coefficients de la régression linéaire}\label{tests-de-nullituxe9-des-coefficients-de-la-ruxe9gression-linuxe9aire-1}}

L'élément appelé \VERB|\NormalTok{coefficients}| obtenu en application de la fonction \VERB|\FunctionTok{summary}\NormalTok{()}| sur l'objet issu de la régression contient un tableau donnant pour chaque coefficient (en ligne), la valeur estimée (\texttt{Estimate}), l'écart-type de l'estimateur (\texttt{Std.\ Error}), la valeur observé de la statistique de Student du test de nullité du coefficient (\texttt{Std.\ Error}) et la p-value associée au test (\texttt{Pr(\textgreater{}\textbar{}t\textbar{})}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resume\_reg}\SpecialCharTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##                   Estimate Std. Error  t value     Pr(>|t|)
## (Intercept)      96.275538  20.978094 4.589337 4.745605e-05
## empan_main_forte  3.885117   1.044912 3.718127 6.453478e-04
\end{lstlisting}

\hypertarget{mise-en-forme-des-ruxe9sultats-avec-modelsummary}{%
\subsection{Mise en forme des résultats avec modelsummary}\label{mise-en-forme-des-ruxe9sultats-avec-modelsummary}}

Pour créer de jolis tableaux de statistiques descriptives, nous allons utiliser la fonction \VERB|\FunctionTok{modelsummary}\NormalTok{()}| du \emph{package} du même nom. Un \href{https://vincentarelbundock.github.io/modelsummary/articles/modelsummary.html}{tutoriel} est disponible sur le site du créateur du \emph{package}, Vincent Arel-Bundock. Nous allons ici explorer uniquement les rudiments de la fonction \VERB|\FunctionTok{modelsummary}\NormalTok{()}|.

\begin{notebox}
\textbf{Note}

Nous avons vu dans le chapitre sur les \protect\hyperlink{statistiques-descriptives}{résumés statistiques} que nous pouvions utiliser une fonction du \emph{package} \{gtsummary\}. Pour des tableaux présentant les tableaux de régression, bien que \{gtsummary\} propose une fonction nommée \VERB|\FunctionTok{tbl\_regression}\NormalTok{()}|, nous préférons utiliser ici le \emph{package} \{modelsummary\}. Pour celles et ceux qui voudraient apprendre à utiliser \VERB|\FunctionTok{tbl\_regression}\NormalTok{()}|, une bonne vignette facile d'accès est disponible sur le \href{https://www.danieldsjoberg.com/gtsummary/articles/tbl_regression.html}{site de Daniel D. Sjoberg, le créateur du \emph{package}}.

\end{notebox}

Dans un premier temps, nous allons charger le \emph{package} \{modelsummary\} :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(modelsummary)}
\end{Highlighting}
\end{Shaded}

L'argument \VERB|\NormalTok{models}\OtherTok{=}| de la fonction \VERB|\FunctionTok{modelsummary}\NormalTok{()}| reçoit un objet issu d'une régression (ou une liste d'objets issus de régressions si l'on souhaite afficher plusieurs estimateurs provenant de plusieurs modèles). En fournissant les objets issus d'une régression dans une liste nommée, les noms que l'on donne sont ensuite utilisés en en-tête.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}\AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                           \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                           \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3))}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}[t]{lccc}
\toprule
  & MCO 1 & MCO 2 & MCO 3\\
\midrule
(Intercept) & \num{96.276} &  & \num{141.897}\\
 & (\num{20.978}) &  & (\num{17.069})\\
empan\_main\_forte & \num{3.885} & \num{8.668} & \num{1.058}\\
 & (\num{1.045}) & (\num{0.092}) & (\num{0.896})\\
genreH &  &  & \num{16.275}\\
 &  &  & (\num{2.748})\\
\midrule
Num.Obs. & \num{40} & \num{40} & \num{40}\\
R2 & \num{0.267} & \num{0.996} & \num{0.624}\\
R2 Adj. & \num{0.247} & \num{0.996} & \num{0.603}\\
AIC & \num{297.5} & \num{313.1} & \num{272.8}\\
BIC & \num{302.5} & \num{316.5} & \num{279.6}\\
Log.Lik. & \num{-145.739} & \num{-154.559} & \num{-132.403}\\
F & \num{13.824} &  & \num{30.649}\\
RMSE & \num{9.25} & \num{11.53} & \num{6.63}\\
\bottomrule
\end{tabular}
\end{table}

Le tableau ainsi créé retourne les coefficients estimés et leur écart-type pour chaque modèle, suivis de du nombre d'observations et de quelques statistiques de qualité d'ajustement des modèles (R\(^2\), R\(^2\) ajusté, AIC, BIC, log vraisemblance, F de Fisher, racine de l'erreur quadratique moyenne).

Lorsque nous affichons le résumé d'une régression avec la fonction \VERB|\FunctionTok{summary}\NormalTok{()}|, le \textbf{nombre de décimales des coefficients} peut s'avérer plus grand que nécessaire pour la communication des résultats. L'argument \VERB|\NormalTok{fmt}\OtherTok{=}| permet de déterminer comment formater les valeurs numériques du tableau. Si l'on souhaite par exemple ne faire figurer que 2 décimales, on peut écrire :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}\AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                           \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                           \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3),}
             \AttributeTok{fmt =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}[t]{lccc}
\toprule
  & MCO 1 & MCO 2 & MCO 3\\
\midrule
(Intercept) & \num{96.28} &  & \num{141.90}\\
 & (\num{20.98}) &  & (\num{17.07})\\
empan\_main\_forte & \num{3.89} & \num{8.67} & \num{1.06}\\
 & (\num{1.04}) & (\num{0.09}) & (\num{0.90})\\
genreH &  &  & \num{16.28}\\
 &  &  & (\num{2.75})\\
\midrule
Num.Obs. & \num{40} & \num{40} & \num{40}\\
R2 & \num{0.267} & \num{0.996} & \num{0.624}\\
R2 Adj. & \num{0.247} & \num{0.996} & \num{0.603}\\
AIC & \num{297.5} & \num{313.1} & \num{272.8}\\
BIC & \num{302.5} & \num{316.5} & \num{279.6}\\
Log.Lik. & \num{-145.739} & \num{-154.559} & \num{-132.403}\\
F & \num{13.824} &  & \num{30.649}\\
RMSE & \num{9.25} & \num{11.53} & \num{6.63}\\
\bottomrule
\end{tabular}
\end{table}

Nous pouvons aussi utiliser une fonction pour formater les nombres, ce qui peut s'avérer utile pour produire un tableau avec des normes françaises (virgule utilisée comme séparateur décimal, espace comme sépartateur de milliers).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fmt\_fr }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x)\{}
  \FunctionTok{formatC}\NormalTok{(x, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{, }\AttributeTok{big.mark =} \StringTok{" "}\NormalTok{, }\AttributeTok{decimal.mark =} \StringTok{","}\NormalTok{, }\AttributeTok{format =} \StringTok{"f"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}\AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                           \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                           \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3),}
             \AttributeTok{fmt =}\NormalTok{ fmt\_fr)}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}[t]{lccc}
\toprule
  & MCO 1 & MCO 2 & MCO 3\\
\midrule
(Intercept) & \num{96,28} &  & \num{141,90}\\
 & (\num{20,98}) &  & (\num{17,07})\\
empan\_main\_forte & \num{3,89} & \num{8,67} & \num{1,06}\\
 & (\num{1,04}) & (\num{0,09}) & (\num{0,90})\\
genreH &  &  & \num{16,28}\\
 &  &  & (\num{2,75})\\
\midrule
Num.Obs. & \num{40} & \num{40} & \num{40}\\
R2 & \num{0.267} & \num{0.996} & \num{0.624}\\
R2 Adj. & \num{0.247} & \num{0.996} & \num{0.603}\\
AIC & \num{297.5} & \num{313.1} & \num{272.8}\\
BIC & \num{302.5} & \num{316.5} & \num{279.6}\\
Log.Lik. & \num{-145.739} & \num{-154.559} & \num{-132.403}\\
F & \num{13.824} &  & \num{30.649}\\
RMSE & \num{9.25} & \num{11.53} & \num{6.63}\\
\bottomrule
\end{tabular}
\end{table}

\begin{notebox}
\textbf{Note}

On remarque que les statistiques en bas du tableau ne sont pas affectées par l'argument \VERB|\NormalTok{fmt}\OtherTok{=}|. Nous verrons plus bas comment changer le format de ces statistiques.

\end{notebox}

Pour faire figurer une indication visuelle permettant de savoir rapidement le \textbf{seuil de significativité du test de nullité des coefficients}, la fonction \VERB|\FunctionTok{modelsummary}\NormalTok{()}| accepte un argument \VERB|\NormalTok{star}\OtherTok{=}|. Les symboles retenus sont les suivants : \texttt{+} pour un seuil de 10\%, \texttt{*} pour un seuil de 5\%, \texttt{**} pour un seuil de 1\%, \texttt{***} pour un seuil de 0,1\%. La légende est ajoutée en note de bas de tableau.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}\AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                           \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                           \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3),}
             \AttributeTok{stars =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}[t]{lccc}
\toprule
  & MCO 1 & MCO 2 & MCO 3\\
\midrule
(Intercept) & \num{96.276}*** &  & \num{141.897}***\\
 & (\num{20.978}) &  & (\num{17.069})\\
empan\_main\_forte & \num{3.885}*** & \num{8.668}*** & \num{1.058}\\
 & (\num{1.045}) & (\num{0.092}) & (\num{0.896})\\
genreH &  &  & \num{16.275}***\\
 &  &  & (\num{2.748})\\
\midrule
Num.Obs. & \num{40} & \num{40} & \num{40}\\
R2 & \num{0.267} & \num{0.996} & \num{0.624}\\
R2 Adj. & \num{0.247} & \num{0.996} & \num{0.603}\\
AIC & \num{297.5} & \num{313.1} & \num{272.8}\\
BIC & \num{302.5} & \num{316.5} & \num{279.6}\\
Log.Lik. & \num{-145.739} & \num{-154.559} & \num{-132.403}\\
F & \num{13.824} &  & \num{30.649}\\
RMSE & \num{9.25} & \num{11.53} & \num{6.63}\\
\bottomrule
\multicolumn{4}{l}{\rule{0pt}{1em}+ p $<$ 0.1, * p $<$ 0.05, ** p $<$ 0.01, *** p $<$ 0.001}\\
\end{tabular}
\end{table}

Pour utiliser des seuils que l'on définit nous-mêmes, il suffit de fournir à l'argument \VERB|\NormalTok{stars}\OtherTok{=}| un vecteur nommé : le nom correspond au symbole utilisé, la valeur au seuil retenu.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}\AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                           \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                           \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3),}
             \AttributeTok{stars =} \FunctionTok{c}\NormalTok{(}\StringTok{"*"} \OtherTok{=}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\StringTok{"**"} \OtherTok{=}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\StringTok{"***"} \OtherTok{=} \FloatTok{0.01}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}[t]{lccc}
\toprule
  & MCO 1 & MCO 2 & MCO 3\\
\midrule
(Intercept) & \num{96.276}*** &  & \num{141.897}***\\
 & (\num{20.978}) &  & (\num{17.069})\\
empan\_main\_forte & \num{3.885}*** & \num{8.668}*** & \num{1.058}\\
 & (\num{1.045}) & (\num{0.092}) & (\num{0.896})\\
genreH &  &  & \num{16.275}***\\
 &  &  & (\num{2.748})\\
\midrule
Num.Obs. & \num{40} & \num{40} & \num{40}\\
R2 & \num{0.267} & \num{0.996} & \num{0.624}\\
R2 Adj. & \num{0.247} & \num{0.996} & \num{0.603}\\
AIC & \num{297.5} & \num{313.1} & \num{272.8}\\
BIC & \num{302.5} & \num{316.5} & \num{279.6}\\
Log.Lik. & \num{-145.739} & \num{-154.559} & \num{-132.403}\\
F & \num{13.824} &  & \num{30.649}\\
RMSE & \num{9.25} & \num{11.53} & \num{6.63}\\
\bottomrule
\multicolumn{4}{l}{\rule{0pt}{1em}* p $<$ 0.1, ** p $<$ 0.05, *** p $<$ 0.01}\\
\end{tabular}
\end{table}

L'argument \VERB|\NormalTok{coef\_rename}\OtherTok{=}| permet de \textbf{renommer les coefficients dans le tableau}, afin de produire un résultat plus lisible.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}\AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                           \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                           \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3),}
             \AttributeTok{stars =} \FunctionTok{c}\NormalTok{(}\StringTok{"*"} \OtherTok{=}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\StringTok{"**"} \OtherTok{=}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\StringTok{"***"} \OtherTok{=} \FloatTok{0.01}\NormalTok{),}
             \AttributeTok{coef\_rename =} \FunctionTok{c}\NormalTok{(}\StringTok{"(Intercept)"} \OtherTok{=} \StringTok{"Constante"}\NormalTok{,}
                             \StringTok{"empan\_main\_forte"} \OtherTok{=} \StringTok{"Empan main forte"}\NormalTok{,}
                             \StringTok{"genreH"} \OtherTok{=} \StringTok{"Genre {-} Homme"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}[t]{lccc}
\toprule
  & MCO 1 & MCO 2 & MCO 3\\
\midrule
Constante & \num{96.276}*** &  & \num{141.897}***\\
 & (\num{20.978}) &  & (\num{17.069})\\
Empan main forte & \num{3.885}*** & \num{8.668}*** & \num{1.058}\\
 & (\num{1.045}) & (\num{0.092}) & (\num{0.896})\\
Genre - Homme &  &  & \num{16.275}***\\
 &  &  & (\num{2.748})\\
\midrule
Num.Obs. & \num{40} & \num{40} & \num{40}\\
R2 & \num{0.267} & \num{0.996} & \num{0.624}\\
R2 Adj. & \num{0.247} & \num{0.996} & \num{0.603}\\
AIC & \num{297.5} & \num{313.1} & \num{272.8}\\
BIC & \num{302.5} & \num{316.5} & \num{279.6}\\
Log.Lik. & \num{-145.739} & \num{-154.559} & \num{-132.403}\\
F & \num{13.824} &  & \num{30.649}\\
RMSE & \num{9.25} & \num{11.53} & \num{6.63}\\
\bottomrule
\multicolumn{4}{l}{\rule{0pt}{1em}* p $<$ 0.1, ** p $<$ 0.05, *** p $<$ 0.01}\\
\end{tabular}
\end{table}

L'argument \VERB|\NormalTok{gof\_map}\OtherTok{=}| contrôle l'\textbf{affichage des statistiques de qualité d'ajustement} (\emph{goodness of fit}) et d'autres informations relatives aux modèles.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}\AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                           \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                           \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3),}
             \AttributeTok{stars =} \FunctionTok{c}\NormalTok{(}\StringTok{"*"} \OtherTok{=}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\StringTok{"**"} \OtherTok{=}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\StringTok{"***"} \OtherTok{=} \FloatTok{0.01}\NormalTok{),}
             \AttributeTok{coef\_rename =} \FunctionTok{c}\NormalTok{(}\StringTok{"(Intercept)"} \OtherTok{=} \StringTok{"Constante"}\NormalTok{,}
                             \StringTok{"empan\_main\_forte"} \OtherTok{=} \StringTok{"Empan main forte"}\NormalTok{,}
                             \StringTok{"genreH"} \OtherTok{=} \StringTok{"Genre {-} Homme"}\NormalTok{),}
             \AttributeTok{gof\_map =} \FunctionTok{c}\NormalTok{(}\StringTok{"nobs"}\NormalTok{, }\StringTok{"r.squared"}\NormalTok{, }\StringTok{"adj.r.squared"}\NormalTok{, }\StringTok{"F"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}[t]{lccc}
\toprule
  & MCO 1 & MCO 2 & MCO 3\\
\midrule
Constante & \num{96.276}*** &  & \num{141.897}***\\
 & (\num{20.978}) &  & (\num{17.069})\\
Empan main forte & \num{3.885}*** & \num{8.668}*** & \num{1.058}\\
 & (\num{1.045}) & (\num{0.092}) & (\num{0.896})\\
Genre - Homme &  &  & \num{16.275}***\\
 &  &  & (\num{2.748})\\
\midrule
Num.Obs. & \num{40} & \num{40} & \num{40}\\
R2 & \num{0.267} & \num{0.996} & \num{0.624}\\
R2 Adj. & \num{0.247} & \num{0.996} & \num{0.603}\\
F & \num{13.824} &  & \num{30.649}\\
\bottomrule
\multicolumn{4}{l}{\rule{0pt}{1em}* p $<$ 0.1, ** p $<$ 0.05, *** p $<$ 0.01}\\
\end{tabular}
\end{table}

Les noms des statistiques à afficher correspondent aux noms des colonnes du tableau retourné par l'évaluation de la fonction \VERB|\FunctionTok{get\_gof}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{get\_gof}\NormalTok{(reg)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##        aic      bic r.squared adj.r.squared     rmse nobs        F    logLik
## 1 297.4778 302.5444 0.2667556     0.2474597 9.249171   40 13.82447 -145.7389
\end{lstlisting}

Pour \textbf{renommer} et contrôler le \textbf{format} des stastistiques affichées dans le bas du tableau, on peut fournir à l'argument \VERB|\NormalTok{gof\_map}\OtherTok{=}| une liste de liste, chacune contenant trois éléments :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{raw} : le nom de la statiqtique telle que retournée par la fonction \VERB|\FunctionTok{get\_gof}\NormalTok{()}|`
\item
  \texttt{clean} : le nom à afficher dans le tableau
\item
  \texttt{fmt} : le format à utiliser (on peut à nouveau utiliser une fonction définie par nous-mêmes) :
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}
  \AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3),}
  \AttributeTok{fmt =}\NormalTok{ fmt\_fr,}
  \AttributeTok{stars =} \FunctionTok{c}\NormalTok{(}\StringTok{"*"} \OtherTok{=}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\StringTok{"**"} \OtherTok{=}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\StringTok{"***"} \OtherTok{=} \FloatTok{0.01}\NormalTok{),}
  \AttributeTok{coef\_rename =} \FunctionTok{c}\NormalTok{(}\StringTok{"(Intercept)"} \OtherTok{=} \StringTok{"Constante"}\NormalTok{,}
                  \StringTok{"empan\_main\_forte"} \OtherTok{=} \StringTok{"Empan main forte"}\NormalTok{,}
                  \StringTok{"genreH"} \OtherTok{=} \StringTok{"Genre {-} Homme"}\NormalTok{),}
  \AttributeTok{gof\_map =} \FunctionTok{list}\NormalTok{(}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"nobs"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"N"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr),}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"r.squared"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"R2"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr),}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"adj.r.squared"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"R2 ajusté"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr),}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"F"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"F"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr)}
\NormalTok{  )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}[t]{lccc}
\toprule
  & MCO 1 & MCO 2 & MCO 3\\
\midrule
Constante & \num{96,28}*** &  & \num{141,90}***\\
 & (\num{20,98}) &  & (\num{17,07})\\
Empan main forte & \num{3,89}*** & \num{8,67}*** & \num{1,06}\\
 & (\num{1,04}) & (\num{0,09}) & (\num{0,90})\\
Genre - Homme &  &  & \num{16,28}***\\
 &  &  & (\num{2,75})\\
\midrule
N & \num{40,00} & \num{40,00} & \num{40,00}\\
R2 & \num{0,27} & \num{1,00} & \num{0,62}\\
R2 ajusté & \num{0,25} & \num{1,00} & \num{0,60}\\
F & \num{13,82} &  & \num{30,65}\\
\bottomrule
\multicolumn{4}{l}{\rule{0pt}{1em}* p $<$ 0.1, ** p $<$ 0.05, *** p $<$ 0.01}\\
\end{tabular}
\end{table}

Pour \textbf{exporter le tableau} dans un fichier, la fonction \VERB|\FunctionTok{modelsummary}\NormalTok{()}| propose l'argument \VERB|\NormalTok{output}\OtherTok{=}|. En fonction de l'extension du fichier dans lequel nous souhaitons exporter le tableau, la fonction `\VERB|\FunctionTok{modelsummary}\NormalTok{()}|` s'adapte. Les extensions que l'on peut utiliser :

\begin{itemize}
\tightlist
\item
  \texttt{.docx} : pour un export en format word ;
\item
  \texttt{.html} : pour un export en format html ;
\item
  \texttt{.tex} : pour un export en format LaTeX ;
\item
  \texttt{.md} : pour un export en format markdown ;
\item
  \texttt{.txt} : pour un export en format texte brut ;
\item
  \texttt{.png} : pour un export en format image PNG.
\end{itemize}

Voici un exemple pour créer un fichier word (\texttt{.docx}) intitulé \texttt{regressions.docx}, dans le répetoire \texttt{Output} contenu dans le répertoire courant :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}
  \AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3),}
  \AttributeTok{fmt =}\NormalTok{ fmt\_fr,}
  \AttributeTok{stars =} \FunctionTok{c}\NormalTok{(}\StringTok{"*"} \OtherTok{=}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\StringTok{"**"} \OtherTok{=}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\StringTok{"***"} \OtherTok{=} \FloatTok{0.01}\NormalTok{),}
  \AttributeTok{coef\_rename =} \FunctionTok{c}\NormalTok{(}\StringTok{"(Intercept)"} \OtherTok{=} \StringTok{"Constante"}\NormalTok{,}
                  \StringTok{"empan\_main\_forte"} \OtherTok{=} \StringTok{"Empan main forte"}\NormalTok{,}
                  \StringTok{"genreH"} \OtherTok{=} \StringTok{"Genre {-} Homme"}\NormalTok{),}
  \AttributeTok{gof\_map =} \FunctionTok{list}\NormalTok{(}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"nobs"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"N"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr),}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"r.squared"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"R2"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr),}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"adj.r.squared"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"R2 ajusté"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr),}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"F"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"F"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr)}
\NormalTok{  ),}
  \AttributeTok{output =} \StringTok{"Output/regression.docx"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{notebox}

\textbf{Note}

Si un message d'erreur vous indique qu'il faut installer le \emph{package} \{flextable\} :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"flextable"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{notebox}

Enfin, si vous souhaitez afficher le code LaTeX, HTML ou Markdown dans la console (sans créer de fichier), il suffit de donner à l'argument \VERB|\NormalTok{output}\OtherTok{=}| la chaine de caractère \VERB|\StringTok{"latex"}|, \VERB|\StringTok{"HTML"}|, ou \VERB|\StringTok{"markdown"}|, respectivement.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}
  \AttributeTok{models =} \FunctionTok{list}\NormalTok{(}\StringTok{"MCO 1"} \OtherTok{=}\NormalTok{ reg,}
                \StringTok{"MCO 2"} \OtherTok{=}\NormalTok{ reg\_2,}
                \StringTok{"MCO 3"} \OtherTok{=}\NormalTok{ reg\_3),}
  \AttributeTok{fmt =}\NormalTok{ fmt\_fr,}
  \AttributeTok{stars =} \FunctionTok{c}\NormalTok{(}\StringTok{"*"} \OtherTok{=}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\StringTok{"**"} \OtherTok{=}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\StringTok{"***"} \OtherTok{=} \FloatTok{0.01}\NormalTok{),}
  \AttributeTok{coef\_rename =} \FunctionTok{c}\NormalTok{(}\StringTok{"(Intercept)"} \OtherTok{=} \StringTok{"Constante"}\NormalTok{,}
                  \StringTok{"empan\_main\_forte"} \OtherTok{=} \StringTok{"Empan main forte"}\NormalTok{,}
                  \StringTok{"genreH"} \OtherTok{=} \StringTok{"Genre {-} Homme"}\NormalTok{),}
  \AttributeTok{gof\_map =} \FunctionTok{list}\NormalTok{(}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"nobs"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"N"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr),}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"r.squared"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"R2"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr),}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"adj.r.squared"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"R2 ajusté"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr),}
    \FunctionTok{list}\NormalTok{(}\StringTok{"raw"} \OtherTok{=} \StringTok{"F"}\NormalTok{, }\StringTok{"clean"} \OtherTok{=} \StringTok{"F"}\NormalTok{, }\StringTok{"fmt"} \OtherTok{=}\NormalTok{ fmt\_fr)}
\NormalTok{  ),}
  \AttributeTok{output =} \StringTok{"markdown"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{instructions-conditionnelles-et-boucles}{%
\chapter{Instructions conditionnelles et boucles}\label{instructions-conditionnelles-et-boucles}}

\begin{orangebox}
Ce chapitre s'appuie sur les notes de cours concernant les \href{http://egallic.fr/Enseignement/R/Book/boucles.html}{boucles}.

\end{orangebox}

Lorsqu'une ou plusieurs instructions doivent être répétées jusqu'à ce qu'une condition soit atteinte, plutôt que d'évaluer manuellement chaque itération du processus de répétition, nous pouvons utiliser des boucles. Dans ce chapitre, nous allons dans un premier temps aborder la notion d'instructions conditionnelles, puis nous verrons deux types de boucles.

\hypertarget{instructions-conditionnelles}{%
\section{Instructions conditionnelles}\label{instructions-conditionnelles}}

Dans le \protect\hyperlink{types-de-donnuxe9es}{chapitre 2}, nous avons rencontré les données de type logique (\VERB|\ConstantTok{TRUE}|, \VERB|\ConstantTok{FALSE}| et \VERB|\ConstantTok{NA}|). Lorsque nous avons réalisé des indexations d'objets par condition, nous avons fait appel à des valeurs logiques retournées par l'évaluation \textbf{d'instructions conditionnelles}. Dans ce chapitre, nous allons également nous appuyer sur des valeurs logiques retournées par l'évaluation d'instructions conditionnelles, pour savoir si un morceau de code doit être évalué ou non. La compréhension du fonctionnement des intructions conditionnelles nous permettra par la suite de pouvoir utiliser des boucles, pour savoir si le processur itératif doit continuer ou s'arrêter.

\hypertarget{instruction-if}{%
\subsection{\texorpdfstring{Instruction \texttt{if}}{Instruction if}}\label{instruction-if}}

Avec une instruction \texttt{if}, une action sera prise seulement si une condition particulière est vérifiée. La syntaxe est simple :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(instruction\_conditionnelle) action}
\end{Highlighting}
\end{Shaded}

avec \texttt{instruction\_conditionnelle} une instruction conditionnelle retournant une valeur logique, et \texttt{action} une instruction qui sera évaluée uniquement si le logique retourné par l'instruction conditionnelle vaut \VERB|\ConstantTok{TRUE}|.

Voici un exemple simple. Admettons que nous disposons d'un objet \texttt{x} contenant un entier naturel. Par xemple, supposons que \texttt{x} contient l'âge d'une personne, et que nous soyons amenés à divulguer une information à cette personne que si celle-ci a 13 ans ou plus. L'information peut être par exemple l'affichage du message suivant : ``La fée des dents n'existe pas''.

Admettons que la personne nous ait indiqué avoir 22 ans.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{22}
\end{Highlighting}
\end{Shaded}

Pour vérifier si la personne a 13 ans ou plus, on peut écrire l'instruction conditionnelle suivante, qui nous retourne \VERB|\ConstantTok{TRUE}| ici :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{\textgreater{}=} \DecValTok{13}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] TRUE
\end{lstlisting}

Écrivons à présent notre instruction conditionnelle. Si la personne a 13 ans ou plus, nous afficherons un message dans la console, à l'aide de la fonction \VERB|\FunctionTok{print}\NormalTok{()}| :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{\textgreater{}=} \DecValTok{13}\NormalTok{) }\FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents n\textquotesingle{}existe pas"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "La fée des dents n'existe pas"
\end{lstlisting}

Admettons à présent que la personne à qui nous faisons face n'est âgée que de 5 ans.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{5}
\end{Highlighting}
\end{Shaded}

Cette fois-ci, lorsqu'on évalue notre instruction conditionnelle, la valeur logique retournée est \VERB|\ConstantTok{FALSE}| :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{\textgreater{}=} \DecValTok{13}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] TRUE
\end{lstlisting}

Aussi, l'évaluation de notre instruction \texttt{if} ne donnera pas lieu à l'évaluation de l'action :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{\textgreater{}=} \DecValTok{13}\NormalTok{) }\FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents n\textquotesingle{}existe pas"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Si l'action à réaliser est composée de plusieurs instructions, la syntaxe de l'instruction \texttt{if} est légèrement modifiée : l'action est simplement placée à l'intérieur d'accolades \VERB|\NormalTok{\{\}}|.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(instruction\_conditionnelle) \{}
\NormalTok{  action\_1}
\NormalTok{  action\_2}
\NormalTok{  ...}
\NormalTok{  action\_n}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Retournons à notre exemple pour illustrer cela. Admettons que nous souhaitons afficher la carré de l'âge de la personne en plus du message.

Retournons à notre individu de 22 ans :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{22}
\end{Highlighting}
\end{Shaded}

L'instruction \texttt{if} :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{\textgreater{}=} \DecValTok{13}\NormalTok{) \{}
\NormalTok{  age\_carre }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{2}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Votre age au carré vaut :"}\NormalTok{, age\_carre))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents n\textquotesingle{}existe pas"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "Votre age au carré vaut : 484"
## [1] "La fée des dents n'existe pas"
\end{lstlisting}

\begin{notebox}
\textbf{Note}

L'instruction conditionnelle a été évaluée et la valeur logique \VERB|\ConstantTok{TRUE}| a été retournée :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{\textgreater{}=} \DecValTok{13}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] TRUE
\end{lstlisting}

Comme l'instruction logique vaut \VERB|\ConstantTok{TRUE}|, les instructions à l'intérieur des accoldes ont été exécutées. Dans un premier temps, la variable \texttt{age\_carre} a été créée. On peut noter que cette variable existe encore après l'évaluation de l'instruction \texttt{if} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age\_carre}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 484
\end{lstlisting}

Ensuite, les deux instructions suivantes permettant d'afficher des messages dans la console ont été évaluées.

\end{notebox}

Si notre individu est plus jeune :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{5}
\end{Highlighting}
\end{Shaded}

Le test \VERB|\NormalTok{x }\SpecialCharTok{\textgreater{}=}\DecValTok{13}| retourne \VERB|\ConstantTok{FALSE}| et les actions à l'intérieur des accolades ne sont pas réalisées.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{\textgreater{}=} \DecValTok{13}\NormalTok{) \{}
\NormalTok{  age\_carre }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{2}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Votre age au carré vaut :"}\NormalTok{, age\_carre))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents n\textquotesingle{}existe pas"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{notebox}

\textbf{Note}

L'instruction conditionnelle \VERB|\NormalTok{x }\SpecialCharTok{\textgreater{}=}\DecValTok{13}| ayant retourné la valeur logique \VERB|\ConstantTok{FALSE}|, la valeur de la variable \texttt{age\_carre} calculée précédemment n'a pas été modifiée :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age\_carre}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 484
\end{lstlisting}

\end{notebox}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  La fonction \VERB|\FunctionTok{readline}\NormalTok{()}| permet de demander à un utilisateur de rentrer une valeur dans la console. En affectant la valeur lue dans la console dans une variable, l'information donnée par l'utilisateur peut être stockée. Évaluez l'instruction suivante, et écrivez votre âge dans la console, puis validez en appuyant sur la touche \texttt{Entrée} :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age }\OtherTok{\textless{}{-}} \FunctionTok{readline}\NormalTok{(}\AttributeTok{prompt=}\StringTok{"Votre âge : "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\item
  Rédigez une instruction conditionnelle qui retourne la racine carrée de l'âge renseigné par l'utilisateur (stockée dans l'objet \texttt{age}) uniquement si la valeur stockée dans \texttt{age} est comprise entre 20 et 25.
\item
  Essayez d'évaluer votre instruction en renseignant différentes valeurs pour âge : 18 ans, 22 ans, 27 ans.
\end{enumerate}

\end{greenbox}

\hypertarget{instruction-if-else}{%
\subsection{\texorpdfstring{Instruction \texttt{if-else}}{Instruction if-else}}\label{instruction-if-else}}

Dans notre exemple, si l'individu est âgé de 13 ans ou plus, nous lui retournons une information. Dans le cas contraire, aucune action n'est menée. Si nous souhaitons réaliser une action dans les deux cas, que notre individu soit âgé de moins de 13 ans ou qu'il ait 13 ans ou plus, nous pouvons utiliser une instruction \texttt{if-else}. La syntaxe est la suivante :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(instruction\_conditionnelle) \{}
  \CommentTok{\# Si instruction\_conditionnelle retourne TRUE}
\NormalTok{  action\_1}
\NormalTok{  action\_2}
\NormalTok{  ...}
\NormalTok{  action\_n}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{ \{}
  \CommentTok{\# Sinon}
\NormalTok{  action\_a}
\NormalTok{  action\_b}
\NormalTok{  ...}
\NormalTok{  action\_x}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Pour notre individu, s'il est âgé de 13 ans ou plus, nous lui afficherons son âge au carré et le message d'information. Si en revanche l'individu est trop jeune, nous lui indiquerons un autre message. Admettons que l'utilisateur soit âgé de 22 ans :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age }\OtherTok{\textless{}{-}} \DecValTok{22}
\end{Highlighting}
\end{Shaded}

Notre instructions \texttt{if-else} sera :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textgreater{}=} \DecValTok{13}\NormalTok{)\{}
\NormalTok{  age\_carre }\OtherTok{\textless{}{-}}\NormalTok{ age}\SpecialCharTok{\^{}}\DecValTok{2}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Votre age au carré vaut :"}\NormalTok{, age\_carre))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents n\textquotesingle{}existe pas"}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
  \FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents passera{-}t{-}elle cette nuit ?"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "Votre age au carré vaut : 484"
## [1] "La fée des dents n'existe pas"
\end{lstlisting}

Seules les instructions dans le bloc de code correspondant aux actions à conduire si l'âge est supérieur ou égal à 13 sont évaluées. Si à présent notre individu est âgé de 5 ans :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age }\OtherTok{\textless{}{-}} \DecValTok{5}
\end{Highlighting}
\end{Shaded}

L'instruction logique \VERB|\NormalTok{age }\SpecialCharTok{\textgreater{}=} \DecValTok{13}| retournera \VERB|\ConstantTok{FALSE}|. Les actions à mener si l'instruction logique retourne \VERB|\ConstantTok{TRUE}| ne seront pas évaluées. En revanche, l'instruction à conduire dans le cas où l'instruction logique retourne \VERB|\ConstantTok{FALSE}| sera bien évaluée :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textgreater{}=} \DecValTok{13}\NormalTok{)\{}
\NormalTok{  age\_carre }\OtherTok{\textless{}{-}}\NormalTok{ age}\SpecialCharTok{\^{}}\DecValTok{2}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Votre age au carré vaut :"}\NormalTok{, age\_carre))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents n\textquotesingle{}existe pas"}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
  \FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents passera{-}t{-}elle cette nuit ?"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "La fée des dents passera-t-elle cette nuit ?"
\end{lstlisting}

Il est possible d'imbriquer des conditions \texttt{if} ou \texttt{if-else} à l'intérieure de conditions \texttt{if} et \texttt{if-else}. Par

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age }\OtherTok{\textless{}{-}} \DecValTok{22}

\ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textgreater{}=} \DecValTok{13}\NormalTok{)\{}
  
  \ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textgreater{}=} \DecValTok{18}\NormalTok{)\{}
    \FunctionTok{print}\NormalTok{(}\StringTok{"Vous êtes majeur(e)"}\NormalTok{)}
\NormalTok{  \}}
  
\NormalTok{  age\_carre }\OtherTok{\textless{}{-}}\NormalTok{ age}\SpecialCharTok{\^{}}\DecValTok{2}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Votre age au carré vaut :"}\NormalTok{, age\_carre))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents n\textquotesingle{}existe pas"}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
  
  \ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textless{}} \DecValTok{7}\NormalTok{)\{}
    \FunctionTok{print}\NormalTok{(}\StringTok{"Vous n\textquotesingle{}avez pas atteint l\textquotesingle{}âge de raison"}\NormalTok{)}
\NormalTok{  \}}\ControlFlowTok{else}\NormalTok{\{}
    \FunctionTok{print}\NormalTok{(}\StringTok{"Vous avez atteint l\textquotesingle{}âge de raison"}\NormalTok{)}
\NormalTok{  \}}
  
  \FunctionTok{print}\NormalTok{(}\StringTok{"La fée des dents passera{-}t{-}elle cette nuit ?"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "Vous êtes majeur(e)"
## [1] "Votre age au carré vaut : 484"
## [1] "La fée des dents n'existe pas"
\end{lstlisting}

Dans le code précédent :

\begin{itemize}
\item
  Si la valeur de l'objet \texttt{age} est supérieure ou égale à 13 :

  \begin{itemize}
  \tightlist
  \item
    Si la valeur de l'objet \texttt{age} est supérieure ou égale à 18 : le message ``Vous êtes majeur(e)'' s'affiche
  \item
    Si la valeur de l'objet \texttt{age} est n'est pas supérieure ou égale à 18, le message ``Vous êtes majeur(e)'' ne s'affiche pas
  \item
    Que la valeur de l'objet \texttt{age} soit supérieure ou égal à 18 ou non, du moment qu'elle est supérieure ou égale à 13, le carré de l'âge est calculé et les deux messages indiquant la valeur de l'âge au carré et la terrible vérité au sujet de l'existance de la fée des dents s'affichent.
  \end{itemize}
\item
  Si la valeur de l'objet \texttt{age} n'est pas supérieure ou égale à 13 :

  \begin{itemize}
  \tightlist
  \item
    Si de surcroît la valeur de l'objet \texttt{age} est inférieure à 7 : le message ``Vous n'avez pas atteint l'âge de raison'' s'affiche
  \item
    Si en revanche la valeur de l'objet \texttt{age} n'est pas inférieure à 7 (mais bien inférieure à 13) : le message ``Vous avez atteint l'âge de raison'' s'affiche.
  \item
    Que la valeur de l'objet \texttt{age} soit inférieure ou non à 7 (du moment qu'elle est inférieure à 13), le message ``La fée des dents passera-t-elle cette nuit ?'' s'affiche.
  \end{itemize}
\end{itemize}

\begin{greenbox}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Demandez à l'utilisateur de renseigner sa moyenne dans les deux Éléments Constitutifs de l'Unité d'Enseignement d'Economie et Finance internationales :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{finance\_inter }\OtherTok{\textless{}{-}} 
  \FunctionTok{readline}\NormalTok{(}\AttributeTok{prompt=}\StringTok{"Votre moyenne en Finance internationale : "}\NormalTok{)}
\NormalTok{eco\_inter }\OtherTok{\textless{}{-}} 
  \FunctionTok{readline}\NormalTok{(}\AttributeTok{prompt=}\StringTok{"Votre moyenne en Economie internationale : "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\item
  Si la moyenne à l'Unité d'Enseignement est supérieure ou égale à 10, affichez dans la console le message suivant : ``Vous validez l'UE''. Si en revanche la moyenne est inférieure à 10, affichez dans la console le message ``Vous ne validez pas l'UE''.
\item
  Reprenez le code de la question précédente, et ajoutez la fonctionnalité suivantes :

  \begin{itemize}
  \tightlist
  \item
    Si la personne ne valide pas l'Unité d'Enseignement (moyenne aux deux épreuves inférieure à 10), indiquez-lui quelles sont les matières à repasser (uniquement celles pour lesquelles la note est strictement inférieure à 10).
  \end{itemize}
\end{enumerate}

\end{greenbox}

Il est possible de vérifier successivement des instructions conditionnelles et d'effectuer une action dès lors qu'une des instructions est évaluée à \VERB|\ConstantTok{TRUE}|. Pour notre exemple de message à afficher en fonction de l'âge de l'utilisateur, on peut dans un premier temps regarder si l'individu a moins de 13 ans et lui adresser un message adapté ; puis, s'il n'a pas moins de 13 ans, s'il a moins de 18 ans et lui adresser un autre message ; et enfin, s'il n'a pas moins de 18, lui retourner un message encore différent. La syntaxe de ce type d'expression sera la suivante :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(instruction\_conditionnelle\_1)\{}
\NormalTok{  actions\_1}
\NormalTok{\}}\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(instruction\_conditionnelle\_2)\{}
\NormalTok{  actions\_2}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{  actions\_3}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Si notre individu a 7 ans :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age }\OtherTok{\textless{}{-}} \DecValTok{7}

\ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textless{}} \DecValTok{13}\NormalTok{)\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"L\textquotesingle{}âge que vous avez indiqué :"}\NormalTok{, age, }\StringTok{"ans"}\NormalTok{))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"L\textquotesingle{}âge minimum pour s\textquotesingle{}inscrire est de 13 ans."}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textless{}} \DecValTok{18}\NormalTok{)\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"L\textquotesingle{}âge que vous avez indiqué :"}\NormalTok{, age, }\StringTok{"ans"}\NormalTok{))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"Contenus sensibles masqués."}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"L\textquotesingle{}âge que vous avez indiqué :"}\NormalTok{, age, }\StringTok{"ans"}\NormalTok{))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"Contenus sensibles non masqués."}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "L'âge que vous avez indiqué : 7 ans"
## [1] "L'âge minimum pour s'inscrire est de 13 ans."
\end{lstlisting}

La valeur de l'objet \texttt{age} étant \VERB|\DecValTok{7}|, l'instruction \VERB|\NormalTok{age }\SpecialCharTok{\textless{}} \DecValTok{13}| retourne \VERB|\ConstantTok{TRUE}| et seules les instructions à l'intérieur du premier bloc défini par les accolades sont exécutées.

Si notre individu a 22 ans :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age }\OtherTok{\textless{}{-}} \DecValTok{22}

\ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textless{}=} \DecValTok{13}\NormalTok{)\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"L\textquotesingle{}âge que vous avez indiqué :"}\NormalTok{, age, }\StringTok{"ans"}\NormalTok{))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"L\textquotesingle{}âge minimum pour s\textquotesingle{}inscrire est de 13 ans."}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textless{}} \DecValTok{18}\NormalTok{)\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"L\textquotesingle{}âge que vous avez indiqué :"}\NormalTok{, age, }\StringTok{"ans"}\NormalTok{))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"Contenus sensibles masqués."}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"L\textquotesingle{}âge que vous avez indiqué :"}\NormalTok{, age, }\StringTok{"ans"}\NormalTok{))}
  \FunctionTok{print}\NormalTok{(}\StringTok{"Contenus sensibles non masqués."}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "L'âge que vous avez indiqué : 22 ans"
## [1] "Contenus sensibles non masqués."
\end{lstlisting}

La valeur de l'objet \texttt{age} étant \VERB|\DecValTok{7}|, l'instruction \VERB|\NormalTok{age }\SpecialCharTok{\textless{}} \DecValTok{13}| retourne \VERB|\ConstantTok{FALSE}|. Les instructions à l'intérieur du premier bloc défini par les accolades ne sont pas exécutées. La deuxième instruction conditionnelle, \VERB|\NormalTok{age }\SpecialCharTok{\textless{}} \DecValTok{18}|, est évaluée et retourne \VERB|\ConstantTok{FALSE}|. Les instructions à l'intérieur du deuxième bloc défini par les accolades ne sont pas exécutées. Il n'y a pas d'autres instruction conditionnelle avant le mot clé \VERB|\ControlFlowTok{else}|, donc le code à l'intérieur du bloc défini par les accolades associées à \VERB|\ControlFlowTok{else}| est évalué.

\hypertarget{boucles}{%
\section{Boucles}\label{boucles}}

Il existe deux sortes de boucles dans R. Celles pour lesquelles les itérations continuent tant qu'une condition n'est pas invalidée (\VERB|\ControlFlowTok{while}\NormalTok{()}|), et celles pour lesquelles le nombre d'itérations est défini au moment de lancer la boucle (\VERB|\ControlFlowTok{for}\NormalTok{()}|).

\hypertarget{boucles-while}{%
\subsection{\texorpdfstring{Boucles \texttt{while()}}{Boucles while()}}\label{boucles-while}}

Les codes à l'intérieur d'une boucle \texttt{while} seront évaluées de manière itérative. Avant chaque itération, une instruction conditionnelle est évaluée. Si cette instruction retourne le logique \VERB|\ConstantTok{TRUE}|, le code est évalué. Puis débute une nouvelle itération. Si en revanche l'instruction conditionnelle retourne le logique \VERB|\ConstantTok{FALSE}|, le code n'est pas évalué et le processus itératif cesse. Le schéma de la Figure~\ref{fig:boucle-while} illustre le fonctionnement d'une boucle \VERB|\ControlFlowTok{while}\NormalTok{()}|.

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth,height=\textheight]{figs/boucle_while.png}
\caption{\label{fig:boucle-while} Fonctionnement d'une boucle while.}
\end{figure}

La syntaxte est la suivante :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{while}\NormalTok{(condition) instruction}
\end{Highlighting}
\end{Shaded}

Ou encore, si plusieurs instructions doivent être évaluées à chaque itération :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{while}\NormalTok{(condition)\{}
\NormalTok{  instruction\_1}
\NormalTok{  instruction\_2}
\NormalTok{  ...}
\NormalTok{  instruction\_n}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Prenons un exemple. Soit un entier \texttt{x} contenant une valeur qui peut varier. Admettons que cette valeur vaille 50 :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{50}
\end{Highlighting}
\end{Shaded}

Créons une boucle \texttt{while} dans laquelle chaque itération vient diviser la valeur de \texttt{x} par 3, puis remplace l'ancienne de valeur de \texttt{x} par le résultat de la division :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{while}\NormalTok{(x }\SpecialCharTok{/} \DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{)\{}
  \FunctionTok{print}\NormalTok{(x }\SpecialCharTok{/} \DecValTok{3}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{/}\DecValTok{3}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 16.66667
## [1] 5.555556
## [1] 1.851852
\end{lstlisting}

\begin{notebox}
Regardons pas-à-pas les étapes du processus itératif précédent.
Lors de l'initialisation, la valeur de \texttt{x} vaut 50.

L'instruction conditionnelle \VERB|\NormalTok{x }\SpecialCharTok{/} \DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{1}| est évaluée et retourne le logique \VERB|\ConstantTok{TRUE}|. En effet, 50/3 \textasciitilde{} 16.66667 est bien strictement supérieur à 1.

\begin{itemize}
\tightlist
\item
  La \emph{première itération} commence.
\item
  Le bloc de code de la boucle, défini par les accolades, peut alors être évalué.
\item
  La valeur \texttt{x/3} est affichée avec la fonction \VERB|\FunctionTok{print}\NormalTok{()}| : la valeur \VERB|\FloatTok{16.66667}| s'affiche dans la console.
\item
  Puis, la valeur de \texttt{x} est remplacée par le tiers de sa valeur (\VERB|\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{/}\DecValTok{3}|).
\item
  La nouvelle valeur de \texttt{x} est donc \VERB|\FloatTok{16.66667}|.
\item
  La première itération s'achève.
\end{itemize}

Ensuite, l'instruction conditionnelle \VERB|\NormalTok{x }\SpecialCharTok{/} \DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{1}| est évaluée et retourne le logique \VERB|\ConstantTok{TRUE}|. En effet, 16.66667/3 \textasciitilde{} 5.555556 est bien strictement supérieur à 1.

\begin{itemize}
\tightlist
\item
  La \emph{deuxième itération} commence.
\item
  Le bloc de code de la boucle, défini par les accolades, peut alors être évalué.
\item
  La valeur \texttt{x/3} est affichée avec la fonction \VERB|\FunctionTok{print}\NormalTok{()}| : la valeur \VERB|\FloatTok{5.555556}| s'affiche dans la console.
\item
  Puis, la valeur de \texttt{x} est remplacée par le tiers de sa valeur (\VERB|\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{/}\DecValTok{3}|).
\item
  La nouvelle valeur de \texttt{x} est donc \VERB|\FloatTok{5.555556}|.
\item
  La deuxième itération s'achève.
\end{itemize}

L'instruction conditionnelle \VERB|\NormalTok{x }\SpecialCharTok{/} \DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{1}| est évaluée et retourne le logique \VERB|\ConstantTok{TRUE}|. En effet, 5.555556/3 \textasciitilde{} 1.851852 est bien strictement supérieur à 1.

\begin{itemize}
\tightlist
\item
  La \emph{troisième itération} commence.
\item
  Le bloc de code de la boucle, défini par les accolades, peut alors être évalué.
\item
  La valeur \texttt{x/3} est affichée avec la fonction \VERB|\FunctionTok{print}\NormalTok{()}| : la valeur \VERB|\FloatTok{1.851852}| s'affiche dans la console.
\item
  Puis, la valeur de \texttt{x} est remplacée par le tiers de sa valeur (\VERB|\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{/}\DecValTok{3}|).
\item
  La nouvelle valeur de \texttt{x} est donc \VERB|\FloatTok{1.851852}|.
\item
  La troisième itération s'achève.
\end{itemize}

L'instruction conditionnelle \VERB|\NormalTok{x }\SpecialCharTok{/} \DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{1}| est évaluée et retourne le logique \VERB|\ConstantTok{FALSE}|. En effet, 1.851852/3 \textasciitilde{} 0.617284 et n'est donc pas strictement supérieur à 1. Le processus itératif s'arrête. La valeur contenue dans \texttt{x} est donc \VERB|\FloatTok{1.851852}|.

\end{notebox}

\begin{notebox}

Il n'existe pas qu'une seule manière de rédiger des boucles. Il est parfois utile, avec une boucle \texttt{while}, de créer une variable (que l'on peut appeler \texttt{continuer} par exemple) contenant une valeur logique \VERB|\ConstantTok{TRUE}| et d'utiliser cette variable comme instruction conditionnelle pour continuer les itérations. Le code à l'intérieur de la boucle se chargera de venir changer la valeur de cette variable au moment opportun. Par exemple, pour obtenir le même résultat dans \texttt{x} que dans l'exemple précédent, on pourra écrire :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{50}
\NormalTok{continuer }\OtherTok{\textless{}{-}}\NormalTok{ (x }\SpecialCharTok{/} \DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{)}

\ControlFlowTok{while}\NormalTok{(continuer)\{}
  \FunctionTok{print}\NormalTok{(x }\SpecialCharTok{/} \DecValTok{3}\NormalTok{)}
  
  \ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{/} \DecValTok{3} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{)\{}
\NormalTok{    continuer }\OtherTok{\textless{}{-}} \ConstantTok{FALSE}
\NormalTok{  \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    x }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{/}\DecValTok{3}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 16.66667
## [1] 5.555556
## [1] 1.851852
## [1] 0.617284
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1.851852
\end{lstlisting}

Pour éviter de créer la variable \texttt{continuer}, nous pouvons utiliser le mot clé \VERB|\ControlFlowTok{break}| à l'intérieur de la boucle pour stopper la boucle au moment opportun.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{50}
\ControlFlowTok{while}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{)\{}
  \FunctionTok{print}\NormalTok{(x }\SpecialCharTok{/} \DecValTok{3}\NormalTok{)}
  
  \ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{/} \DecValTok{3} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{)\{}
    \ControlFlowTok{break}
\NormalTok{  \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    x }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{/}\DecValTok{3}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 16.66667
## [1] 5.555556
## [1] 1.851852
## [1] 0.617284
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1.851852
\end{lstlisting}

\end{notebox}

\begin{greenbox}
\textbf{Exercice}

À l'aide de la fonction \texttt{while()}, créez une boucle qui permet de calculer la factorielle d'un nombre.

\end{greenbox}

\begin{greenbox}
\textbf{Exercice bonus}

À l'aide d'une boucle \texttt{while}, créez un code dans lequel vous devrez tenter de faire deviner un nombre magique tiré aléatoirement entre 1 et 100.

Dans une première étape, un nombre magique est tiré aléatoirement :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nombre\_magique }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\DecValTok{100}\NormalTok{, }\AttributeTok{size =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Votre code doit demander à l'utilisateur d'entrer une réponse :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tentative }\OtherTok{\textless{}{-}} 
  \FunctionTok{readline}\NormalTok{(}\AttributeTok{prompt=}\StringTok{"Nombre entier compris entre 1 et 100 : "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Vous devez ensuite indiquer, à l'aide d'instructions conditionnelles si le nombre donné par l'utilisateur est inférieur, supérieur, ou égal au nombre magique.

\end{greenbox}

\hypertarget{boucles-for}{%
\subsection{\texorpdfstring{Boucles \texttt{for()}}{Boucles for()}}\label{boucles-for}}

Lorsqu'on connaît \emph{a priori} le nombre d'itérations que l'on souhaite faire, il est coutume de faire appel à une boucle \VERB|\ControlFlowTok{for}\NormalTok{()}|. On définit un itérateur qui prendra successivement des valeurs dans un ensemble donné jusqu'à ce que toutes les valeurs de l'ensemble auront été utilisées comme itérateur. La syntaxe est la suivante :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{(iterateur }\ControlFlowTok{in}\NormalTok{ ensemble)\{}
\NormalTok{  instruction\_1}
\NormalTok{  instruction\_2}
\NormalTok{  ...}
\NormalTok{  instruction\_n}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Le schéma de la Figure~\ref{fig:boucle-for} illustre le fonctionnement d'une boucle \VERB|\ControlFlowTok{for}\NormalTok{()}|.

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth,height=\textheight]{figs/boucle_for.png}
\caption{\label{fig:boucle-for} Fonctionnement d'une boucle for}
\end{figure}

Illustrons par ailleurs le fonctionnement à l'aide d'un exemple simple. Considérons un itérateur que l'on nommera \texttt{i} et l'ensemble des entiers naturels de 1 à 10. À chaque itération, \texttt{i} prendra une des valeurs de l'ensemble :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)\{}
\NormalTok{  carre }\OtherTok{\textless{}{-}}\NormalTok{ i}\SpecialCharTok{\^{}}\DecValTok{2}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Le carré de"}\NormalTok{, i, }\StringTok{"est :"}\NormalTok{, carre))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "Le carré de 1 est : 1"
## [1] "Le carré de 2 est : 4"
## [1] "Le carré de 3 est : 9"
## [1] "Le carré de 4 est : 16"
## [1] "Le carré de 5 est : 25"
## [1] "Le carré de 6 est : 36"
## [1] "Le carré de 7 est : 49"
## [1] "Le carré de 8 est : 64"
## [1] "Le carré de 9 est : 81"
## [1] "Le carré de 10 est : 100"
\end{lstlisting}

\begin{notebox}

Regardons en détail ce qu'il s'est passé lors de l'éxécution de ce bout de code.

\begin{itemize}
\tightlist
\item
  À la \emph{première itération}, l'objet \texttt{i} est créé et la valeur \VERB|\DecValTok{1}| lui est affectée (si un objet \texttt{i} existait déjà, sa valeur eut été remplacée par la valeur \texttt{1}).
\item
  L'objet \texttt{carre} est créé et le carré de \texttt{i}, c'est à dire \(1^2=1\) lui est affecté.
\item
  La chaîne de caractère indiquant la valeur de \texttt{i} et de son carré est ensuite affichée dans la console.
\item
  La première itération prend fin.
\item
  L'ensemble des valeurs des entiers de 1 à 10 n'a pas encore été utilisé lors du processus itératif ; ce dernier se poursuit donc.
\item
  La \emph{deuxième itération} débute, et la valeur de l'objet \texttt{i} devient la valeur suivante de l'ensemble \VERB|\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}|, c'est-à-dire 2.
\item
  La valeur du carré de \texttt{i}, c'est-à-dire \(2^2=4\) est affectée à l'objet \texttt{carré}.
\item
  La chaîne de caractère indiquant la valeur de \texttt{i} et de son carré est ensuite affichée dans la console.
\item
  La deuxième itération prend fin.
\item
  L'ensemble des valeurs des entiers de 1 à 10 n'a pas encore été utilisé lors du processus itératif ; ce dernier se poursuit donc.
\item
  \ldots{}
\item
  La \emph{dixième itération} débute, et la valeur de l'objet \texttt{i} devient la valeur suivante de l'ensemble \VERB|\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}|, c'est-à-dire 10.
\item
  La valeur du carré de \texttt{i}, c'est-à-dire \(10^2=100\) est affectée à l'objet \texttt{carré}.
\item
  La chaîne de caractère indiquant la valeur de \texttt{i} et de son carré est ensuite affichée dans la console.
\item
  La dixième itération prend fin.
\item
  L'ensemble des valeurs des entiers de 1 à 10 a été utilisé lors du processus itératif ; ce dernier s'achève.
\end{itemize}

\end{notebox}

\begin{notebox}
\textbf{Note}

À l'issue des itérations, l'objet \texttt{i} contient la dernière valeur de l'ensemble.

\end{notebox}

\begin{notebox}

\textbf{Note}

Nous pouvons utiliser une boucle \VERB|\ControlFlowTok{while}\NormalTok{()}| pour obtenir le même résultat. Le code est un tout petit moins lisible.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i }\OtherTok{\textless{}{-}} \DecValTok{0}
\ControlFlowTok{while}\NormalTok{(i }\SpecialCharTok{\textless{}} \DecValTok{10}\NormalTok{)\{}
\NormalTok{  i }\OtherTok{\textless{}{-}}\NormalTok{ i}\SpecialCharTok{+}\DecValTok{1}
\NormalTok{  carre }\OtherTok{\textless{}{-}}\NormalTok{ i}\SpecialCharTok{\^{}}\DecValTok{2}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Le carré de"}\NormalTok{, i, }\StringTok{"est :"}\NormalTok{, carre))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "Le carré de 1 est : 1"
## [1] "Le carré de 2 est : 4"
## [1] "Le carré de 3 est : 9"
## [1] "Le carré de 4 est : 16"
## [1] "Le carré de 5 est : 25"
## [1] "Le carré de 6 est : 36"
## [1] "Le carré de 7 est : 49"
## [1] "Le carré de 8 est : 64"
## [1] "Le carré de 9 est : 81"
## [1] "Le carré de 10 est : 100"
\end{lstlisting}

\end{notebox}

L'ensemble de valeurs n'est pas nécessairement composé d'entiers. Il peut s'agir de n'importe quel élément contenu dans une structure sur laquelle il est possible d'itérer :

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{, }\StringTok{"C"}\NormalTok{))\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"La valeur courante de i vaut :"}\NormalTok{, i))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] "La valeur courante de i vaut : A"
## [1] "La valeur courante de i vaut : B"
## [1] "La valeur courante de i vaut : C"
\end{lstlisting}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \FunctionTok{list}\NormalTok{(}\AttributeTok{toto=}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{), }\AttributeTok{titi=}\FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{)))\{}
  \FunctionTok{print}\NormalTok{(i)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
## [1] 1 2
## [1] "A" "B"
\end{lstlisting}

\begin{greenbox}

\textbf{Exercice}

Si vous avez quelques interrogations quant à l'utilité des boucles dans le cadre de vos études en économie, cet exercice devrait vous permettre d'apprécier le gain de temps potentiel que celles-ci peuvent vous faire gagner.

Il s'agit d'importer une multitude de fichiers CSV (en l'occurence, 35) présentant une structure similaire. Ces fichiers contiennent des observations de commptage de vélos à des points spécifiques de la ville de Paris, en 2018. Chaque fichier correspond à une localisation donnée, la localisation est utilisée comme nom de fichier.

Les 35 fichiers CSV sont contenus dans une archive Zip disponible à l'adresse suivante : \url{https://egallic.fr/Enseignement/R/Exercices/Boucles/velo.zip}. (\emph{Note} : Les données brutes sont disponible sur le \href{https://opendata.paris.fr/explore/dataset/comptage-velo-historique-donnees-compteurs/information/}{site de l'open data de la ville de Paris}.)

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Téléchargez l'archive contenant les 35 fichiers CSV, puis extrayez son contenu dans le dossier \texttt{Data} de votre répertoire de projet.
\item
  Créez un objet que vous nommerez \texttt{df\_velo} qui contiendra la valeur \VERB|\ConstantTok{NULL}|.
\item
  Importez le fichier \texttt{Voie\_Georges\_Pompidou.csv} dans R, dans un objet que vous nommerez \texttt{df\_tmp}.
\item
  Utilisez la fonction \VERB|\FunctionTok{bind\_rows}\NormalTok{()}| pour empiler les données du tableau \texttt{df\_tmp} sur \texttt{df\_velo}. Le résultat doit venir écraser l'objet \texttt{df\_velo} pour que son contenu devienne le résultat de l'application de la fonction \VERB|\FunctionTok{bind\_rows}\NormalTok{()}|. Le tableau \texttt{df\_velo} contiendra alors 17~473 observations.
\item
  Importez le fichier \texttt{106\_Avenue\_Denfert\_Rochereau\_NE-SO.csv} dans R, dans un objet que vous nommerez \texttt{df\_tmp}.
\item
  Utilisez la fonction \VERB|\FunctionTok{bind\_rows}\NormalTok{()}| pour empiler les données du tableau \texttt{df\_tmp} sur \texttt{df\_velo}. Le résultat doit venir écraser l'objet \texttt{df\_velo} pour que son contenu devienne le résultat de l'application de la fonction \VERB|\FunctionTok{bind\_rows}\NormalTok{()}|. Votre tableau \texttt{df\_velo} contiendra alors les 17~473 observations du premier fichier et les 8~737 du deuxième, soit 26~210 observations.
\item
  Importez le fichier \texttt{28\_Boulevard\_Diderot.csv} dans R, dans un objet que vous nommerez \texttt{df\_tmp}.
\item
  Utilisez la fonction \VERB|\FunctionTok{bind\_rows}\NormalTok{()}| pour empiler les données du tableau \texttt{df\_tmp} sur \texttt{df\_velo}. Le résultat doit venir écraser l'objet \texttt{df\_velo} pour que son contenu devienne le résultat de l'application de la fonction \VERB|\FunctionTok{bind\_rows}\NormalTok{()}|. Votre tableau \texttt{df\_velo} contiendra alors les 17~473 observations du premier fichier, les 8~737 du deuxième, et les 17~473 du troisième, soit 43~684 observations.
\item
  Prenez le temps d'imginer à quel point il serait pénible d'empiler les 35 fichiers.
\end{enumerate}

À présent, tentons de réfléchir à l'utilisation d'une boucle pour effectuer la tâche. Les premières questions devraient vous laisser apercevoir que vous avez réalisé une tâche répétitive qui consiste à chaque itération à charger un fichier et à ajouter son contenu à un tableau existant. Vous avez donc besoin dans un premier temps de récupérer dans un vecteur le lien de chacun des fichiers. Pour ce faire, vous allez utiliser la fonction \VERB|\FunctionTok{list.files}\NormalTok{()}|, qui permet de lister le contenu d'un répertoire.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{N }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\StringTok{"Data/velo/"}\NormalTok{, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{N}
\end{Highlighting}
\end{Shaded}

\begin{lstlisting}
##  [1] "Data/velo//10_avenue_de_la_Grande_Armée_SE-NO.csv"          
##  [2] "Data/velo//10_Bd_Auguste_Blanqui_NE-SO.csv"                 
##  [3] "Data/velo//100_Rue_La_Fayette_O-E.csv"                      
##  [4] "Data/velo//102_Bd_magenta_SE-NO.csv"                        
##  [5] "Data/velo//105_Rue_La_Fayette_E-O.csv"                      
##  [6] "Data/velo//106_Avenue_Denfert_Rochereau_NE-SO.csv"          
##  [7] "Data/velo//135_Avenue_Daumesnil_SE-NO.csv"                  
##  [8] "Data/velo//152_Boulevard_du_Montparnasse.csv"               
##  [9] "Data/velo//16_Avenue_de_la_Porte_des_Ternes_E-O.csv"        
## [10] "Data/velo//18_quai_de_l'hotel_de_ville.csv"                 
## [11] "Data/velo//21_Boulevard_Auguste_Blanqui_SO-NE.csv"          
## [12] "Data/velo//243_Boulevard_Saint_Germain_NO-SE.csv"           
## [13] "Data/velo//26_Boulevard_de_Ménilmontant_SE-NO.csv"          
## [14] "Data/velo//27_Boulevard_Diderot_E-O.csv"                    
## [15] "Data/velo//28_Boulevard_Diderot.csv"                        
## [16] "Data/velo//35_Boulevard_de_Menilmontant_NO-SE.csv"          
## [17] "Data/velo//39_Quai_François_Mauriac.csv"                    
## [18] "Data/velo//6_rue_Julia_Bartet.csv"                          
## [19] "Data/velo//67_boulevard_Voltaire_SE-NO.csv"                 
## [20] "Data/velo//7_Avenue_de_la_Grande_Armée_NO-SE.csv"           
## [21] "Data/velo//72_Bd_Richard_Lenoir_S-N.csv"                    
## [22] "Data/velo//72_boulevard_Voltaire_NO-SE.csv"                 
## [23] "Data/velo//77_Bd_Richard_Lenoir_N-S.csv"                    
## [24] "Data/velo//89_boulevard_de_Magenta_NO-SE.csv"               
## [25] "Data/velo//97_Avenue_Denfert_Rochereau_SO-NE.csv"           
## [26] "Data/velo//Face_104_Rue_d'Aubervilliers.csv"                
## [27] "Data/velo//Face_au_16_Avenue_de_la_Porte_des_Ternes_O-E.csv"
## [28] "Data/velo//Face_au_25_quai_de_l'Oise.csv"                   
## [29] "Data/velo//Face_au_48_quai_de_la_marne.csv"                 
## [30] "Data/velo//face_au_70_Quai_de_Bercy.csv"                    
## [31] "Data/velo//Pont_du_Garigliano_NO-SE.csv"                    
## [32] "Data/velo//Pont_du_Garigliano_SE-NO.csv"                    
## [33] "Data/velo//Pont_National_NE-SO.csv"                         
## [34] "Data/velo//Pont_National_SO-NE.csv"                         
## [35] "Data/velo//Voie_Georges_Pompidou.csv"
\end{lstlisting}

L'objet \texttt{N} consistera votre ensemble sur lequel itérer.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{9}
\tightlist
\item
  À l'aide d'une boucle \VERB|\ControlFlowTok{for}\NormalTok{()}|, chargez l'ensemble des 35 fichiers CSV du répertoire \texttt{velo} et placez leur contenu dans un tableau de données que vous nommerez \texttt{df\_velo}.
\end{enumerate}

\end{greenbox}

\begin{greenbox}
\textbf{Exercice bonus}

Utilisez une boucle \VERB|\ControlFlowTok{for}\NormalTok{()}| pour reproduire la suite de Fibonacci jusqu'à son dixième terme (la séquence \(F_n\) est définie par la relation de récurrence suivante : \(F_n=F_n−1+F_n−2\) ; les valeurs initiales sont : \(F_0=0\) et \(F_1=1\)).

\end{greenbox}

Des compléments sur les fonctions de type \VERB|\FunctionTok{lapply}\NormalTok{()}| ou \VERB|\FunctionTok{map}\NormalTok{()}| vous permettront de réaliser des opérations répétées. Nous n'aurons malheureusement pas le temps de les aborder dans le cadre de ces travaux dirigés. En revanche, vous êtes invité(e) à consulter la \href{http://egallic.fr/Enseignement/R/Book/boucles.html}{section consacrée à la vectorisation} sur les notes de cours.

\hypertarget{references}{%
\chapter{References}\label{references}}

\hypertarget{refs}{}
\begin{CSLReferences}{1}{0}
\leavevmode\vadjust pre{\hypertarget{ref-Athey_2017}{}}%
Athey, Susan, and Guido W. Imbens. 2017. {``The State of Applied Econometrics: Causality and Policy Evaluation.''} \emph{Journal of Economic Perspectives} 31 (2): 3--32. \url{https://doi.org/10.1257/jep.31.2.3}.

\leavevmode\vadjust pre{\hypertarget{ref-bertrand_2004_AER}{}}%
Bertrand, Marianne, and Sendhil Mullainathan. 2004. {``Are Emily and Greg More Employable Than Lakisha and Jamal? A Field Experiment on Labor Market Discrimination.''} \emph{American Economic Review} 94 (4): 991--1013. \url{https://doi.org/10.1257/0002828042002561}.

\leavevmode\vadjust pre{\hypertarget{ref-xie_2018_rmarkdown}{}}%
Xie, Yihui, Joseph J Allaire, and Garrett Grolemund. 2018. \emph{R Markdown: The Definitive Guide}. Chapman; Hall/CRC.

\end{CSLReferences}

\end{document}
